<!DOCTYPE html>
<html lang="en"><head>
<script src="rnns-and-time-series_files/libs/clipboard/clipboard.min.js"></script>
<script src="rnns-and-time-series_files/libs/quarto-html/tabby.min.js"></script>
<script src="rnns-and-time-series_files/libs/quarto-html/popper.min.js"></script>
<script src="rnns-and-time-series_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="rnns-and-time-series_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="rnns-and-time-series_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="rnns-and-time-series_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.2.269">

  <meta name="author" content="Dr Patrick Laub">
  <title>Recurrent Neural Networks</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="rnns-and-time-series_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="rnns-and-time-series_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #1f1c1b;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #1f1c1b; } /* Normal */
    code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
    code span.an { color: #ca60ca; } /* Annotation */
    code span.at { color: #0057ae; } /* Attribute */
    code span.bn { color: #b08000; } /* BaseN */
    code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
    code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #924c9d; } /* Char */
    code span.cn { color: #aa5500; } /* Constant */
    code span.co { color: #898887; } /* Comment */
    code span.cv { color: #0095ff; } /* CommentVar */
    code span.do { color: #607880; } /* Documentation */
    code span.dt { color: #0057ae; } /* DataType */
    code span.dv { color: #b08000; } /* DecVal */
    code span.er { color: #bf0303; text-decoration: underline; } /* Error */
    code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
    code span.fl { color: #b08000; } /* Float */
    code span.fu { color: #644a9b; } /* Function */
    code span.im { color: #ff5500; } /* Import */
    code span.in { color: #b08000; } /* Information */
    code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
    code span.op { color: #ca60ca; } /* Operator */
    code span.ot { color: #006e28; } /* Other */
    code span.pp { color: #006e28; } /* Preprocessor */
    code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
    code span.sc { color: #3daee9; } /* SpecialChar */
    code span.ss { color: #ff5500; } /* SpecialString */
    code span.st { color: #bf0303; } /* String */
    code span.va { color: #0057ae; } /* Variable */
    code span.vs { color: #bf0303; } /* VerbatimString */
    code span.wa { color: #bf0303; } /* Warning */
  </style>
  <link rel="stylesheet" href="rnns-and-time-series_files/libs/revealjs/dist/theme/quarto.css" id="theme">
  <link href="rnns-and-time-series_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="rnns-and-time-series_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="rnns-and-time-series_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="rnns-and-time-series_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="rnns-and-time-series_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="rnns-and-time-series_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-captioned.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-captioned) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-captioned.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-captioned .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-captioned .callout-caption  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-captioned.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-captioned.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-caption {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-caption {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-caption {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-captioned .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-captioned .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-captioned) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-caption {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-caption {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-caption {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-caption {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-caption {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
</head>
<body class="quarto-light">
<div class="line right"></div>
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="unsw-yellow-shape.png" data-background-size="contain !important" class="quarto-title-block center">
  <h1 class="title">Recurrent Neural Networks</h1>
  <p class="subtitle">ACTL3143 &amp; ACTL5111 Deep Learning for Actuaries</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Dr Patrick Laub 
</div>
</div>
</div>

</section>
<section id="load-packages" class="slide level2" data-visibility="uncounted">
<h2>Load packages</h2>
<p><br> <br></p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> random</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="im">from</span> tensorflow.keras.models <span class="im">import</span> Sequential</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Dense</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="im">from</span> tensorflow.keras.callbacks <span class="im">import</span> EarlyStopping</span>
<span id="cb1-10"><a href="#cb1-10"></a></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="op">%</span>load_ext watermark</span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="op">%</span>watermark <span class="op">-</span>p numpy,pandas,tensorflow</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>numpy     : 1.23.4
pandas    : 1.5.1
tensorflow: 2.10.0
</code></pre>
</div>
</div>
</section>
<section>
<section id="tensors" class="title-slide slide level1 center" data-background-image="unsw-yellow-shape.png" data-visibility="uncounted">
<h1>Tensors</h1>

</section>
<section id="shapes-of-data" class="slide level2">
<h2>Shapes of data</h2>

<img data-src="medium-tensor-rank.png" class="r-stretch quarto-figure-center"><p class="caption">Illustration of tensors of different rank.</p><div class="footer">
<p>Source: Paras Patidar (2019), <a href="https://medium.com/mlait/tensors-representation-of-data-in-neural-networks-bbe8a711b93b">Tensors — Representation of Data In Neural Networks</a>, Medium article.</p>
</div>
</section>
<section id="shapes-of-photos" class="slide level2">
<h2>Shapes of photos</h2>

<img data-src="rgb-channels.png" class="r-stretch quarto-figure-center"><p class="caption">A photo is a rank 3 tensor.</p><div class="footer">
<p>Source: Kim et al (2021), <a href="https://www.mdpi.com/applsci/applsci-11-03418/article_deploy/html/images/applsci-11-03418-g001.png">Data Hiding Method for Color AMBTC Compressed Images Using Color Difference</a>, Applied Sciences.</p>
</div>
</section>
<section id="the-axis-argument-in-numpy" class="slide level2">
<h2>The <code>axis</code> argument in numpy</h2>
<p>Starting with a <span class="math inline">\((3, 4)\)</span>-shaped matrix:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a>X <span class="op">=</span> np.arange(<span class="dv">12</span>).reshape(<span class="dv">3</span>,<span class="dv">4</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a>X</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>array([[ 0,  1,  2,  3],
       [ 4,  5,  6,  7],
       [ 8,  9, 10, 11]])</code></pre>
</div>
</div>
<div class="columns">
<div class="column">
<p><code>axis=0</code>: <span class="math inline">\((3, 4) \leadsto (4,)\)</span>.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a>X.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>array([12, 15, 18, 21])</code></pre>
</div>
</div>
</div><div class="column">
<p><code>axis=1</code>: <span class="math inline">\((3, 4) \leadsto (3,)\)</span>.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a>X.prod(axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>array([   0,  840, 7920])</code></pre>
</div>
</div>
</div>
</div>
<p>The return value’s rank is one less than the input’s rank.</p>
<div class="callout callout-important callout-captioned callout-style-default">
<div class="callout-body">
<div class="callout-caption">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Important</strong></p>
</div>
<div class="callout-content">
<p>The <code>axis</code> parameter tells us which dimension is removed.</p>
</div>
</div>
</div>
</section>
<section id="using-axis-keepdims" class="slide level2">
<h2>Using <code>axis</code> &amp; <code>keepdims</code></h2>
<p>With <code>keepdims=True</code>, the rank doesn’t change.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a>X <span class="op">=</span> np.arange(<span class="dv">12</span>).reshape(<span class="dv">3</span>,<span class="dv">4</span>)</span>
<span id="cb9-2"><a href="#cb9-2"></a>X</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>array([[ 0,  1,  2,  3],
       [ 4,  5,  6,  7],
       [ 8,  9, 10, 11]])</code></pre>
</div>
</div>
<div class="columns">
<div class="column">
<p><code>axis=0</code>: <span class="math inline">\((3, 4) \leadsto (1, 4)\)</span>.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a>X.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>, keepdims<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>array([[12, 15, 18, 21]])</code></pre>
</div>
</div>
</div><div class="column">
<p><code>axis=1</code>: <span class="math inline">\((3, 4) \leadsto (3, 1)\)</span>.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a>X.prod(axis<span class="op">=</span><span class="dv">1</span>, keepdims<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>array([[   0],
       [ 840],
       [7920]])</code></pre>
</div>
</div>
</div>
</div>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a>X <span class="op">/</span> X.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>ValueError: operands could not be broadcast together with shapes (3,4) (3,) </code></pre>
</div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a>X <span class="op">/</span> X.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>, keepdims<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>array([[0.  , 0.17, 0.33, 0.5 ],
       [0.18, 0.23, 0.27, 0.32],
       [0.21, 0.24, 0.26, 0.29]])</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="the-rank-of-a-time-series" class="slide level2">
<h2>The rank of a time series</h2>
<p>Say we had <span class="math inline">\(n\)</span> observations of a time series <span class="math inline">\(x_1, x_2, \dots, x_n\)</span>.</p>
<p>This <span class="math inline">\(\mathbf{x} = (x_1, \dots, x_n)\)</span> would have shape <span class="math inline">\((n,)\)</span> &amp; rank 1.</p>
<p>If instead we had a batch of <span class="math inline">\(b\)</span> time series’</p>
<p><span class="math display">\[
\mathbf{X} = \begin{pmatrix}
x_7 &amp; x_8 &amp; \dots &amp; x_{7+n-1} \\
x_2 &amp; x_3 &amp; \dots &amp; x_{2+n-1} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
x_3 &amp; x_4 &amp; \dots &amp; x_{3+n-1} \\
\end{pmatrix}  \,,
\]</span></p>
<p>the batch <span class="math inline">\(\mathbf{X}\)</span> would have shape <span class="math inline">\((b, n)\)</span> &amp; rank 2.</p>
</section>
<section id="multivariate-time-series" class="slide level2">
<h2>Multivariate time series</h2>
<div class="columns">
<div class="column" style="width:35%;">
<center>
<div class="cell" data-execution_count="11">
<div class="cell-output cell-output-display" data-execution_count="11">
<table>
<thead>
<tr class="header">
<th style="text-align: right;"><span class="math inline">\(t\)</span></th>
<th style="text-align: left;"><span class="math inline">\(x\)</span></th>
<th style="text-align: left;"><span class="math inline">\(y\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: left;"><span class="math inline">\(x_0\)</span></td>
<td style="text-align: left;"><span class="math inline">\(y_0\)</span></td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;"><span class="math inline">\(x_1\)</span></td>
<td style="text-align: left;"><span class="math inline">\(y_1\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;"><span class="math inline">\(x_2\)</span></td>
<td style="text-align: left;"><span class="math inline">\(y_2\)</span></td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;"><span class="math inline">\(x_3\)</span></td>
<td style="text-align: left;"><span class="math inline">\(y_3\)</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</center>
</div><div class="column" style="width:65%;">
<p>Say <span class="math inline">\(n\)</span> observations of the <span class="math inline">\(m\)</span> time series, would be a shape <span class="math inline">\((n, m)\)</span> matrix of rank 2.</p>
<p>In Keras, a batch of <span class="math inline">\(b\)</span> of these time series has shape <span class="math inline">\((b, n, m)\)</span> and has rank 3.</p>
</div>
</div>
<div class="callout callout-note callout-captioned callout-style-default">
<div class="callout-body">
<div class="callout-caption">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>Use <span class="math inline">\(\mathbf{x}_t \in \mathbb{R}^{1 \times m}\)</span> to denote the vector of all time series at time <span class="math inline">\(t\)</span>. Here, <span class="math inline">\(\mathbf{x}_t = (x_t, y_t)\)</span>.</p>
</div>
</div>
</div>
</section></section>
<section>
<section id="recurrent-neural-networks" class="title-slide slide level1 center" data-background-image="unsw-yellow-shape.png" data-visibility="uncounted">
<h1>Recurrent Neural Networks</h1>

</section>
<section id="basic-facts-of-rnns" class="slide level2">
<h2>Basic facts of RNNs</h2>
<ul>
<li>A recurrent neural network is a type of neural network that is designed to process sequences of data (e.g.&nbsp;time series, sentences).</li>
<li>A recurrent neural network is any network that contains a recurrent layer.</li>
<li>A recurrent layer is a layer that processes data in a sequence.</li>
<li>An RNN can have one or more recurrent layers.</li>
</ul>
</section>
<section id="diagram-of-an-rnn" class="slide level2">
<h2>Diagram of an RNN</h2>
<p>The RNN processes each data in the sequence one by one, while keeping memory of what came before.</p>

<img data-src="rnn-unrolled.svg" class="r-stretch quarto-figure-center"><p class="caption">Illustration of <em>unrolling the network through time</em>.</p><p>Common RNN structures are: LSTM and GRU cells.</p>
<div class="footer">
<p>Source: Marcus Lautier (2022).</p>
</div>
</section>
<section id="australian-house-price-indices" class="slide level2">
<h2>Australian House Price Indices</h2>

<img data-src="rnns-and-time-series_files/figure-revealjs/cell-13-output-1.png" class="r-stretch"></section>
<section id="percentage-changes" class="slide level2 smaller">
<h2>Percentage changes</h2>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a>changes <span class="op">=</span> housePrices.pct_change().dropna()</span>
<span id="cb19-2"><a href="#cb19-2"></a>changes.<span class="bu">round</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Brisbane</th>
      <th>East_Bris</th>
      <th>North_Bris</th>
      <th>West_Bris</th>
      <th>Melbourne</th>
      <th>North_Syd</th>
      <th>Sydney</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1990-02-28</th>
      <td>0.03</td>
      <td>-0.01</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>0.00</td>
      <td>-0.00</td>
      <td>-0.02</td>
    </tr>
    <tr>
      <th>1990-03-31</th>
      <td>0.01</td>
      <td>0.03</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>0.02</td>
      <td>-0.00</td>
      <td>0.03</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2021-04-30</th>
      <td>0.03</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>-0.00</td>
      <td>0.01</td>
      <td>0.02</td>
      <td>0.02</td>
    </tr>
    <tr>
      <th>2021-05-31</th>
      <td>0.03</td>
      <td>0.03</td>
      <td>0.03</td>
      <td>0.03</td>
      <td>0.03</td>
      <td>0.02</td>
      <td>0.04</td>
    </tr>
  </tbody>
</table>
<p>376 rows × 7 columns</p>
</div>
</div>
</div>
</section>
<section id="percentage-changes-1" class="slide level2">
<h2>Percentage changes</h2>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a>changes.plot()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<img data-src="rnns-and-time-series_files/figure-revealjs/cell-17-output-1.png" class="r-stretch"></section>
<section id="the-size-of-the-changes" class="slide level2">
<h2>The size of the changes</h2>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a>changes.mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>Brisbane      0.005496
East_Bris     0.005416
North_Bris    0.005024
West_Bris     0.004842
Melbourne     0.005677
North_Syd     0.004819
Sydney        0.005526
dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a>changes <span class="op">*=</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1"></a>changes.mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>Brisbane      0.549605
East_Bris     0.541562
North_Bris    0.502390
West_Bris     0.484204
Melbourne     0.567700
North_Syd     0.481863
Sydney        0.552641
dtype: float64</code></pre>
</div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1"></a>changes.plot(legend<span class="op">=</span><span class="va">False</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img data-src="rnns-and-time-series_files/figure-revealjs/cell-22-output-1.png"></p>
</div>
</div>
</div>
</div>
</section>
<section id="split-without-shuffling" class="slide level2">
<h2>Split <em>without</em> shuffling</h2>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1"></a>numTrain <span class="op">=</span> <span class="bu">int</span>(<span class="fl">0.6</span> <span class="op">*</span> <span class="bu">len</span>(changes))</span>
<span id="cb27-2"><a href="#cb27-2"></a>numVal <span class="op">=</span> <span class="bu">int</span>(<span class="fl">0.2</span> <span class="op">*</span> <span class="bu">len</span>(changes))</span>
<span id="cb27-3"><a href="#cb27-3"></a>numTest <span class="op">=</span> <span class="bu">len</span>(changes) <span class="op">-</span> numTrain <span class="op">-</span> numVal</span>
<span id="cb27-4"><a href="#cb27-4"></a><span class="bu">print</span>(<span class="ss">f"# Train: </span><span class="sc">{</span>numTrain<span class="sc">}</span><span class="ss">, # Val: </span><span class="sc">{</span>numVal<span class="sc">}</span><span class="ss">, # Test: </span><span class="sc">{</span>numTest<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Train: 225, # Val: 75, # Test: 76</code></pre>
</div>
</div>

<img data-src="rnns-and-time-series_files/figure-revealjs/cell-24-output-1.png" class="r-stretch"></section>
<section id="subsequences-of-a-time-series" class="slide level2">
<h2>Subsequences of a time series</h2>
<p>Keras has a built-in method for converting a time series into subsequences/chunks.</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1"></a><span class="im">from</span> tensorflow.keras.utils <span class="im">import</span> timeseries_dataset_from_array</span>
<span id="cb29-2"><a href="#cb29-2"></a></span>
<span id="cb29-3"><a href="#cb29-3"></a>integers <span class="op">=</span> <span class="bu">range</span>(<span class="dv">10</span>)                                </span>
<span id="cb29-4"><a href="#cb29-4"></a>dummyDataset <span class="op">=</span> timeseries_dataset_from_array(</span>
<span id="cb29-5"><a href="#cb29-5"></a>    data<span class="op">=</span>integers[:<span class="op">-</span><span class="dv">3</span>],                                 </span>
<span id="cb29-6"><a href="#cb29-6"></a>    targets<span class="op">=</span>integers[<span class="dv">3</span>:],                               </span>
<span id="cb29-7"><a href="#cb29-7"></a>    sequence_length<span class="op">=</span><span class="dv">3</span>,                                      </span>
<span id="cb29-8"><a href="#cb29-8"></a>    batch_size<span class="op">=</span><span class="dv">2</span>,                                           </span>
<span id="cb29-9"><a href="#cb29-9"></a>)</span>
<span id="cb29-10"><a href="#cb29-10"></a></span>
<span id="cb29-11"><a href="#cb29-11"></a><span class="cf">for</span> inputs, targets <span class="kw">in</span> dummyDataset:</span>
<span id="cb29-12"><a href="#cb29-12"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(inputs.shape[<span class="dv">0</span>]):</span>
<span id="cb29-13"><a href="#cb29-13"></a>        <span class="bu">print</span>([<span class="bu">int</span>(x) <span class="cf">for</span> x <span class="kw">in</span> inputs[i]], <span class="bu">int</span>(targets[i]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0, 1, 2] 3
[1, 2, 3] 4
[2, 3, 4] 5
[3, 4, 5] 6
[4, 5, 6] 7</code></pre>
</div>
</div>
<div class="footer">
<p>Source: Code snippet in Chapter 10 of Chollet.</p>
</div>
</section></section>
<section>
<section id="predicting-sydney-house-prices" class="title-slide slide level1 center" data-background-image="unsw-yellow-shape.png" data-visibility="uncounted">
<h1>Predicting Sydney House Prices</h1>

</section>
<section id="creating-dataset-objects" class="slide level2">
<h2>Creating dataset objects</h2>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># Num. of input time series.</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>numTS <span class="op">=</span> changes.shape[<span class="dv">1</span>]</span>
<span id="cb31-3"><a href="#cb31-3"></a></span>
<span id="cb31-4"><a href="#cb31-4"></a><span class="co"># How many prev. months to use.</span></span>
<span id="cb31-5"><a href="#cb31-5"></a>seqLength <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb31-6"><a href="#cb31-6"></a></span>
<span id="cb31-7"><a href="#cb31-7"></a><span class="co"># Predict the next month ahead.</span></span>
<span id="cb31-8"><a href="#cb31-8"></a>ahead <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb31-9"><a href="#cb31-9"></a></span>
<span id="cb31-10"><a href="#cb31-10"></a><span class="co"># The index of the first target.</span></span>
<span id="cb31-11"><a href="#cb31-11"></a>delay <span class="op">=</span> (seqLength<span class="op">+</span>ahead<span class="op">-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1"></a><span class="co"># Which suburb to predict.</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>targetSuburb <span class="op">=</span> changes[<span class="st">"Sydney"</span>]</span>
<span id="cb32-3"><a href="#cb32-3"></a></span>
<span id="cb32-4"><a href="#cb32-4"></a>trainDS <span class="op">=</span> <span class="op">\</span></span>
<span id="cb32-5"><a href="#cb32-5"></a>  timeseries_dataset_from_array(</span>
<span id="cb32-6"><a href="#cb32-6"></a>    changes[:<span class="op">-</span>delay],</span>
<span id="cb32-7"><a href="#cb32-7"></a>    targets<span class="op">=</span>targetSuburb[delay:],</span>
<span id="cb32-8"><a href="#cb32-8"></a>    sequence_length<span class="op">=</span>seqLength,</span>
<span id="cb32-9"><a href="#cb32-9"></a>    end_index<span class="op">=</span>numTrain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1"></a>valDS <span class="op">=</span> <span class="op">\</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>  timeseries_dataset_from_array(</span>
<span id="cb33-3"><a href="#cb33-3"></a>    changes[:<span class="op">-</span>delay],</span>
<span id="cb33-4"><a href="#cb33-4"></a>    targets<span class="op">=</span>targetSuburb[delay:],</span>
<span id="cb33-5"><a href="#cb33-5"></a>    sequence_length<span class="op">=</span>seqLength,</span>
<span id="cb33-6"><a href="#cb33-6"></a>    start_index<span class="op">=</span>numTrain,</span>
<span id="cb33-7"><a href="#cb33-7"></a>    end_index<span class="op">=</span>numTrain<span class="op">+</span>numVal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1"></a>testDS <span class="op">=</span> <span class="op">\</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>  timeseries_dataset_from_array(</span>
<span id="cb34-3"><a href="#cb34-3"></a>    changes[:<span class="op">-</span>delay],</span>
<span id="cb34-4"><a href="#cb34-4"></a>    targets<span class="op">=</span>targetSuburb[delay:],</span>
<span id="cb34-5"><a href="#cb34-5"></a>    sequence_length<span class="op">=</span>seqLength,</span>
<span id="cb34-6"><a href="#cb34-6"></a>    start_index<span class="op">=</span>numTrain<span class="op">+</span>numVal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="converting-dataset-to-numpy" class="slide level2">
<h2>Converting <code>Dataset</code> to numpy</h2>
<p>The <code>Dataset</code> object can be handed to Keras directly, but if we really need a numpy array, we can run:</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1"></a>X_train <span class="op">=</span> np.concatenate(<span class="bu">list</span>(trainDS.<span class="bu">map</span>(<span class="kw">lambda</span> x, y: x)))</span>
<span id="cb35-2"><a href="#cb35-2"></a>y_train <span class="op">=</span> np.concatenate(<span class="bu">list</span>(trainDS.<span class="bu">map</span>(<span class="kw">lambda</span> x, y: y)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The shape of our training set is now:</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1"></a>X_train.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>(220, 6, 7)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1"></a>y_train.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>(220,)</code></pre>
</div>
</div>
<p>Later, we need the targets as numpy arrays:</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1"></a>y_train <span class="op">=</span> np.concatenate(<span class="bu">list</span>(trainDS.<span class="bu">map</span>(<span class="kw">lambda</span> x, y: y)))</span>
<span id="cb40-2"><a href="#cb40-2"></a>y_val <span class="op">=</span> np.concatenate(<span class="bu">list</span>(valDS.<span class="bu">map</span>(<span class="kw">lambda</span> x, y: y)))</span>
<span id="cb40-3"><a href="#cb40-3"></a>y_test <span class="op">=</span> np.concatenate(<span class="bu">list</span>(testDS.<span class="bu">map</span>(<span class="kw">lambda</span> x, y: y)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="a-dense-network" class="slide level2">
<h2>A dense network</h2>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Input, Flatten</span>
<span id="cb41-2"><a href="#cb41-2"></a>random.seed(<span class="dv">1</span>)</span>
<span id="cb41-3"><a href="#cb41-3"></a>modelDense <span class="op">=</span> Sequential([</span>
<span id="cb41-4"><a href="#cb41-4"></a>    Input(shape<span class="op">=</span>(seqLength, numTS)),</span>
<span id="cb41-5"><a href="#cb41-5"></a>    Flatten(),</span>
<span id="cb41-6"><a href="#cb41-6"></a>    Dense(<span class="dv">50</span>, activation<span class="op">=</span><span class="st">"leaky_relu"</span>),</span>
<span id="cb41-7"><a href="#cb41-7"></a>    Dense(<span class="dv">20</span>, activation<span class="op">=</span><span class="st">"leaky_relu"</span>),</span>
<span id="cb41-8"><a href="#cb41-8"></a>    Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"linear"</span>)</span>
<span id="cb41-9"><a href="#cb41-9"></a>])</span>
<span id="cb41-10"><a href="#cb41-10"></a>modelDense.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">"mse"</span>, optimizer<span class="op">=</span><span class="st">"adam"</span>)</span>
<span id="cb41-11"><a href="#cb41-11"></a><span class="bu">print</span>(<span class="ss">f"This model has </span><span class="sc">{</span>modelDense<span class="sc">.</span>count_params()<span class="sc">}</span><span class="ss"> parameters."</span>)</span>
<span id="cb41-12"><a href="#cb41-12"></a></span>
<span id="cb41-13"><a href="#cb41-13"></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">50</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>, verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb41-14"><a href="#cb41-14"></a><span class="op">%</span>time hist <span class="op">=</span> modelDense.fit(trainDS, epochs<span class="op">=</span><span class="dv">1_000</span>, <span class="op">\</span></span>
<span id="cb41-15"><a href="#cb41-15"></a>  validation_data<span class="op">=</span>valDS, callbacks<span class="op">=</span>[es], verbose<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>This model has 3191 parameters.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Restoring model weights from the end of the best epoch: 13.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 63: early stopping</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: total: 984 ms
Wall time: 4.06 s</code></pre>
</div>
</div>
</section>
<section id="plot-the-model" class="slide level2">
<h2>Plot the model</h2>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1"></a><span class="im">from</span> tensorflow.keras.utils <span class="im">import</span> plot_model</span>
<span id="cb46-2"><a href="#cb46-2"></a>plot_model(modelDense, show_shapes<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="rnns-and-time-series_files/figure-revealjs/cell-36-output-1.png" class="r-stretch"></section>
<section id="assess-the-fits" class="slide level2">
<h2>Assess the fits</h2>

<img data-src="rnns-and-time-series_files/figure-revealjs/cell-37-output-1.png" class="r-stretch"><div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1"></a>modelDense.evaluate(valDS, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>1.170551061630249</code></pre>
</div>
</div>
</section>
<section id="plotting-the-predictions" class="slide level2 smaller">
<h2>Plotting the predictions</h2>

<img data-src="rnns-and-time-series_files/figure-revealjs/cell-39-output-1.png" class="r-stretch"></section>
<section id="a-simplernn-layer" class="slide level2">
<h2>A <code>SimpleRNN</code> layer</h2>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> SimpleRNN</span>
<span id="cb49-2"><a href="#cb49-2"></a></span>
<span id="cb49-3"><a href="#cb49-3"></a>random.seed(<span class="dv">1</span>)</span>
<span id="cb49-4"><a href="#cb49-4"></a></span>
<span id="cb49-5"><a href="#cb49-5"></a>modelSimple <span class="op">=</span> Sequential([</span>
<span id="cb49-6"><a href="#cb49-6"></a>    SimpleRNN(<span class="dv">50</span>, input_shape<span class="op">=</span>(seqLength, numTS)),</span>
<span id="cb49-7"><a href="#cb49-7"></a>    Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"linear"</span>)</span>
<span id="cb49-8"><a href="#cb49-8"></a>])</span>
<span id="cb49-9"><a href="#cb49-9"></a>modelSimple.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">"mse"</span>, optimizer<span class="op">=</span><span class="st">"adam"</span>)</span>
<span id="cb49-10"><a href="#cb49-10"></a><span class="bu">print</span>(<span class="ss">f"This model has </span><span class="sc">{</span>modelSimple<span class="sc">.</span>count_params()<span class="sc">}</span><span class="ss"> parameters."</span>)</span>
<span id="cb49-11"><a href="#cb49-11"></a></span>
<span id="cb49-12"><a href="#cb49-12"></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">50</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>, verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb49-13"><a href="#cb49-13"></a><span class="op">%</span>time hist <span class="op">=</span> modelSimple.fit(trainDS, epochs<span class="op">=</span><span class="dv">1_000</span>, <span class="op">\</span></span>
<span id="cb49-14"><a href="#cb49-14"></a>  validation_data<span class="op">=</span>valDS, callbacks<span class="op">=</span>[es], verbose<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>This model has 2951 parameters.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Restoring model weights from the end of the best epoch: 17.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 67: early stopping</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: total: 1.36 s
Wall time: 4.24 s</code></pre>
</div>
</div>
</section>
<section id="assess-the-fits-1" class="slide level2">
<h2>Assess the fits</h2>

<img data-src="rnns-and-time-series_files/figure-revealjs/cell-41-output-1.png" class="r-stretch"><div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1"></a>modelSimple.evaluate(valDS, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>1.0176857709884644</code></pre>
</div>
</div>
</section>
<section id="plot-the-model-1" class="slide level2">
<h2>Plot the model</h2>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1"></a>plot_model(modelSimple, show_shapes<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="rnns-and-time-series_files/figure-revealjs/cell-43-output-1.png" class="r-stretch"></section>
<section id="plotting-the-predictions-1" class="slide level2 smaller">
<h2>Plotting the predictions</h2>

<img data-src="rnns-and-time-series_files/figure-revealjs/cell-44-output-1.png" class="r-stretch"></section>
<section id="a-lstm-layer" class="slide level2">
<h2>A <code>LSTM</code> layer</h2>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> LSTM</span>
<span id="cb57-2"><a href="#cb57-2"></a></span>
<span id="cb57-3"><a href="#cb57-3"></a>random.seed(<span class="dv">1</span>)</span>
<span id="cb57-4"><a href="#cb57-4"></a></span>
<span id="cb57-5"><a href="#cb57-5"></a>modelLSTM <span class="op">=</span> Sequential([</span>
<span id="cb57-6"><a href="#cb57-6"></a>    LSTM(<span class="dv">50</span>, input_shape<span class="op">=</span>(seqLength, numTS)),</span>
<span id="cb57-7"><a href="#cb57-7"></a>    Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"linear"</span>)</span>
<span id="cb57-8"><a href="#cb57-8"></a>])</span>
<span id="cb57-9"><a href="#cb57-9"></a></span>
<span id="cb57-10"><a href="#cb57-10"></a>modelLSTM.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">"mse"</span>, optimizer<span class="op">=</span><span class="st">"adam"</span>)</span>
<span id="cb57-11"><a href="#cb57-11"></a></span>
<span id="cb57-12"><a href="#cb57-12"></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">50</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>, verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb57-13"><a href="#cb57-13"></a></span>
<span id="cb57-14"><a href="#cb57-14"></a><span class="op">%</span>time hist <span class="op">=</span> modelLSTM.fit(trainDS, epochs<span class="op">=</span><span class="dv">1_000</span>, <span class="op">\</span></span>
<span id="cb57-15"><a href="#cb57-15"></a>  validation_data<span class="op">=</span>valDS, callbacks<span class="op">=</span>[es], verbose<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Restoring model weights from the end of the best epoch: 28.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 78: early stopping</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: total: 2.06 s
Wall time: 5.65 s</code></pre>
</div>
</div>
</section>
<section id="assess-the-fits-2" class="slide level2">
<h2>Assess the fits</h2>

<img data-src="rnns-and-time-series_files/figure-revealjs/cell-46-output-1.png" class="r-stretch"><div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1"></a>modelLSTM.evaluate(valDS, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>0.8097982406616211</code></pre>
</div>
</div>
</section>
<section id="plotting-the-predictions-2" class="slide level2 smaller">
<h2>Plotting the predictions</h2>

<img data-src="rnns-and-time-series_files/figure-revealjs/cell-48-output-1.png" class="r-stretch"></section>
<section id="a-gru-layer" class="slide level2">
<h2>A <code>GRU</code> layer</h2>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> GRU</span>
<span id="cb63-2"><a href="#cb63-2"></a></span>
<span id="cb63-3"><a href="#cb63-3"></a>random.seed(<span class="dv">1</span>)</span>
<span id="cb63-4"><a href="#cb63-4"></a></span>
<span id="cb63-5"><a href="#cb63-5"></a>modelGRU <span class="op">=</span> Sequential([</span>
<span id="cb63-6"><a href="#cb63-6"></a>    GRU(<span class="dv">50</span>, input_shape<span class="op">=</span>(seqLength, numTS)),</span>
<span id="cb63-7"><a href="#cb63-7"></a>    Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"linear"</span>)</span>
<span id="cb63-8"><a href="#cb63-8"></a>])</span>
<span id="cb63-9"><a href="#cb63-9"></a></span>
<span id="cb63-10"><a href="#cb63-10"></a>modelGRU.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">"mse"</span>, optimizer<span class="op">=</span><span class="st">"adam"</span>)</span>
<span id="cb63-11"><a href="#cb63-11"></a></span>
<span id="cb63-12"><a href="#cb63-12"></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">50</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>, verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb63-13"><a href="#cb63-13"></a></span>
<span id="cb63-14"><a href="#cb63-14"></a><span class="op">%</span>time hist <span class="op">=</span> modelGRU.fit(trainDS, epochs<span class="op">=</span><span class="dv">1_000</span>, <span class="op">\</span></span>
<span id="cb63-15"><a href="#cb63-15"></a>  validation_data<span class="op">=</span>valDS, callbacks<span class="op">=</span>[es], verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Restoring model weights from the end of the best epoch: 28.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 78: early stopping</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: total: 1.05 s
Wall time: 5.57 s</code></pre>
</div>
</div>
</section>
<section id="assess-the-fits-3" class="slide level2">
<h2>Assess the fits</h2>

<img data-src="rnns-and-time-series_files/figure-revealjs/cell-50-output-1.png" class="r-stretch"><div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1"></a>modelGRU.evaluate(valDS, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>0.8060945868492126</code></pre>
</div>
</div>
</section>
<section id="plotting-the-predictions-3" class="slide level2 smaller">
<h2>Plotting the predictions</h2>

<img data-src="rnns-and-time-series_files/figure-revealjs/cell-52-output-1.png" class="r-stretch"></section>
<section id="two-gru-layers" class="slide level2">
<h2>Two <code>GRU</code> layers</h2>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1"></a>random.seed(<span class="dv">1</span>)</span>
<span id="cb69-2"><a href="#cb69-2"></a></span>
<span id="cb69-3"><a href="#cb69-3"></a>modelTwoGRUs <span class="op">=</span> Sequential([</span>
<span id="cb69-4"><a href="#cb69-4"></a>    GRU(<span class="dv">50</span>, input_shape<span class="op">=</span>(seqLength, numTS), return_sequences<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb69-5"><a href="#cb69-5"></a>    GRU(<span class="dv">50</span>),</span>
<span id="cb69-6"><a href="#cb69-6"></a>    Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"linear"</span>)</span>
<span id="cb69-7"><a href="#cb69-7"></a>])</span>
<span id="cb69-8"><a href="#cb69-8"></a></span>
<span id="cb69-9"><a href="#cb69-9"></a>modelTwoGRUs.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">"mse"</span>, optimizer<span class="op">=</span><span class="st">"adam"</span>)</span>
<span id="cb69-10"><a href="#cb69-10"></a></span>
<span id="cb69-11"><a href="#cb69-11"></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">50</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>, verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb69-12"><a href="#cb69-12"></a></span>
<span id="cb69-13"><a href="#cb69-13"></a><span class="op">%</span>time hist <span class="op">=</span> modelTwoGRUs.fit(trainDS, epochs<span class="op">=</span><span class="dv">1_000</span>, <span class="op">\</span></span>
<span id="cb69-14"><a href="#cb69-14"></a>  validation_data<span class="op">=</span>valDS, callbacks<span class="op">=</span>[es], verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Restoring model weights from the end of the best epoch: 17.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 67: early stopping</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: total: 1.7 s
Wall time: 6.08 s</code></pre>
</div>
</div>
</section>
<section id="assess-the-fits-4" class="slide level2">
<h2>Assess the fits</h2>

<img data-src="rnns-and-time-series_files/figure-revealjs/cell-54-output-1.png" class="r-stretch"><div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1"></a>modelTwoGRUs.evaluate(valDS, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>0.7850584983825684</code></pre>
</div>
</div>
</section>
<section id="plotting-the-predictions-4" class="slide level2 smaller">
<h2>Plotting the predictions</h2>

<img data-src="rnns-and-time-series_files/figure-revealjs/cell-56-output-1.png" class="r-stretch"></section>
<section id="compare-the-models" class="slide level2">
<h2>Compare the models</h2>
<div class="cell" data-execution_count="56">
<div class="cell-output cell-output-display" data-execution_count="55">

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Model</th>
      <th>MSE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Dense</td>
      <td>1.170551</td>
    </tr>
    <tr>
      <th>1</th>
      <td>SimpleRNN</td>
      <td>1.017686</td>
    </tr>
    <tr>
      <th>2</th>
      <td>LSTM</td>
      <td>0.809798</td>
    </tr>
    <tr>
      <th>3</th>
      <td>GRU</td>
      <td>0.806095</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2 GRUs</td>
      <td>0.785058</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>The network with a single GRU layer is the best.</p>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1"></a>modelGRU.evaluate(testDS, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>1.9685560464859009</code></pre>
</div>
</div>
</section>
<section id="test-set" class="slide level2">
<h2>Test set</h2>

<img data-src="rnns-and-time-series_files/figure-revealjs/cell-59-output-1.png" class="r-stretch"></section></section>
<section>
<section id="predicting-multiple-time-series" class="title-slide slide level1 center" data-background-image="unsw-yellow-shape.png" data-visibility="uncounted">
<h1>Predicting Multiple Time Series</h1>

</section>
<section id="creating-dataset-objects-1" class="slide level2">
<h2>Creating dataset objects</h2>
<div class="columns">
<div class="column">
<p>Change the <code>targets</code> argument to include all the suburbs.</p>
</div><div class="column">
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1"></a>trainDS <span class="op">=</span> <span class="op">\</span></span>
<span id="cb77-2"><a href="#cb77-2"></a>  timeseries_dataset_from_array(</span>
<span id="cb77-3"><a href="#cb77-3"></a>    changes[:<span class="op">-</span>delay],</span>
<span id="cb77-4"><a href="#cb77-4"></a>    targets<span class="op">=</span>changes[delay:],</span>
<span id="cb77-5"><a href="#cb77-5"></a>    sequence_length<span class="op">=</span>seqLength,</span>
<span id="cb77-6"><a href="#cb77-6"></a>    end_index<span class="op">=</span>numTrain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1"></a>valDS <span class="op">=</span> <span class="op">\</span></span>
<span id="cb78-2"><a href="#cb78-2"></a>  timeseries_dataset_from_array(</span>
<span id="cb78-3"><a href="#cb78-3"></a>    changes[:<span class="op">-</span>delay],</span>
<span id="cb78-4"><a href="#cb78-4"></a>    targets<span class="op">=</span>changes[delay:],</span>
<span id="cb78-5"><a href="#cb78-5"></a>    sequence_length<span class="op">=</span>seqLength,</span>
<span id="cb78-6"><a href="#cb78-6"></a>    start_index<span class="op">=</span>numTrain,</span>
<span id="cb78-7"><a href="#cb78-7"></a>    end_index<span class="op">=</span>numTrain<span class="op">+</span>numVal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1"></a>testDS <span class="op">=</span> <span class="op">\</span></span>
<span id="cb79-2"><a href="#cb79-2"></a>  timeseries_dataset_from_array(</span>
<span id="cb79-3"><a href="#cb79-3"></a>    changes[:<span class="op">-</span>delay],</span>
<span id="cb79-4"><a href="#cb79-4"></a>    targets<span class="op">=</span>changes[delay:],</span>
<span id="cb79-5"><a href="#cb79-5"></a>    sequence_length<span class="op">=</span>seqLength,</span>
<span id="cb79-6"><a href="#cb79-6"></a>    start_index<span class="op">=</span>numTrain<span class="op">+</span>numVal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="converting-dataset-to-numpy-1" class="slide level2">
<h2>Converting <code>Dataset</code> to numpy</h2>
<p>The shape of our training set is now:</p>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1"></a>X_train <span class="op">=</span> np.concatenate(<span class="bu">list</span>(trainDS.<span class="bu">map</span>(<span class="kw">lambda</span> x, y: x)))</span>
<span id="cb80-2"><a href="#cb80-2"></a>X_train.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<pre><code>(220, 6, 7)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1"></a>Y_train <span class="op">=</span> np.concatenate(<span class="bu">list</span>(trainDS.<span class="bu">map</span>(<span class="kw">lambda</span> x, y: y)))</span>
<span id="cb82-2"><a href="#cb82-2"></a>Y_train.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">
<pre><code>(220, 7)</code></pre>
</div>
</div>
<p>Later, we need the targets as numpy arrays:</p>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1"></a>Y_train <span class="op">=</span> np.concatenate(<span class="bu">list</span>(trainDS.<span class="bu">map</span>(<span class="kw">lambda</span> x, y: y)))</span>
<span id="cb84-2"><a href="#cb84-2"></a>Y_val <span class="op">=</span> np.concatenate(<span class="bu">list</span>(valDS.<span class="bu">map</span>(<span class="kw">lambda</span> x, y: y)))</span>
<span id="cb84-3"><a href="#cb84-3"></a>Y_test <span class="op">=</span> np.concatenate(<span class="bu">list</span>(testDS.<span class="bu">map</span>(<span class="kw">lambda</span> x, y: y)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="a-dense-network-1" class="slide level2">
<h2>A dense network</h2>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1"></a>random.seed(<span class="dv">1</span>)</span>
<span id="cb85-2"><a href="#cb85-2"></a>modelDense <span class="op">=</span> Sequential([</span>
<span id="cb85-3"><a href="#cb85-3"></a>    Input(shape<span class="op">=</span>(seqLength, numTS)),</span>
<span id="cb85-4"><a href="#cb85-4"></a>    Flatten(),</span>
<span id="cb85-5"><a href="#cb85-5"></a>    Dense(<span class="dv">50</span>, activation<span class="op">=</span><span class="st">"leaky_relu"</span>),</span>
<span id="cb85-6"><a href="#cb85-6"></a>    Dense(<span class="dv">20</span>, activation<span class="op">=</span><span class="st">"leaky_relu"</span>),</span>
<span id="cb85-7"><a href="#cb85-7"></a>    Dense(numTS, activation<span class="op">=</span><span class="st">"linear"</span>)</span>
<span id="cb85-8"><a href="#cb85-8"></a>])</span>
<span id="cb85-9"><a href="#cb85-9"></a>modelDense.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">"mse"</span>, optimizer<span class="op">=</span><span class="st">"adam"</span>)</span>
<span id="cb85-10"><a href="#cb85-10"></a><span class="bu">print</span>(<span class="ss">f"This model has </span><span class="sc">{</span>modelDense<span class="sc">.</span>count_params()<span class="sc">}</span><span class="ss"> parameters."</span>)</span>
<span id="cb85-11"><a href="#cb85-11"></a></span>
<span id="cb85-12"><a href="#cb85-12"></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">50</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>, verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb85-13"><a href="#cb85-13"></a><span class="op">%</span>time hist <span class="op">=</span> modelDense.fit(trainDS, epochs<span class="op">=</span><span class="dv">1_000</span>, <span class="op">\</span></span>
<span id="cb85-14"><a href="#cb85-14"></a>  validation_data<span class="op">=</span>valDS, callbacks<span class="op">=</span>[es], verbose<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>This model has 3317 parameters.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Restoring model weights from the end of the best epoch: 90.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 140: early stopping</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: total: 1.7 s
Wall time: 8.04 s</code></pre>
</div>
</div>
</section>
<section id="plot-the-model-2" class="slide level2">
<h2>Plot the model</h2>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1"></a>plot_model(modelDense, show_shapes<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="rnns-and-time-series_files/figure-revealjs/cell-67-output-1.png" class="r-stretch"></section>
<section id="assess-the-fits-5" class="slide level2">
<h2>Assess the fits</h2>

<img data-src="rnns-and-time-series_files/figure-revealjs/cell-68-output-1.png" class="r-stretch"><div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1"></a>modelDense.evaluate(valDS, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<pre><code>1.4687895774841309</code></pre>
</div>
</div>
</section>
<section id="plotting-the-predictions-5" class="slide level2 smaller">
<h2>Plotting the predictions</h2>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="69">
<div class="cell-output cell-output-display">
<p><img data-src="rnns-and-time-series_files/figure-revealjs/cell-70-output-1.png"></p>
</div>
<div class="cell-output cell-output-display">
<p><img data-src="rnns-and-time-series_files/figure-revealjs/cell-70-output-2.png"></p>
</div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="70">
<div class="cell-output cell-output-display">
<p><img data-src="rnns-and-time-series_files/figure-revealjs/cell-71-output-1.png"></p>
</div>
<div class="cell-output cell-output-display">
<p><img data-src="rnns-and-time-series_files/figure-revealjs/cell-71-output-2.png"></p>
</div>
</div>
</div>
</div>
</section>
<section id="a-simplernn-layer-1" class="slide level2">
<h2>A <code>SimpleRNN</code> layer</h2>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1"></a>random.seed(<span class="dv">1</span>)</span>
<span id="cb93-2"><a href="#cb93-2"></a></span>
<span id="cb93-3"><a href="#cb93-3"></a>modelSimple <span class="op">=</span> Sequential([</span>
<span id="cb93-4"><a href="#cb93-4"></a>    SimpleRNN(<span class="dv">50</span>, input_shape<span class="op">=</span>(seqLength, numTS)),</span>
<span id="cb93-5"><a href="#cb93-5"></a>    Dense(numTS, activation<span class="op">=</span><span class="st">"linear"</span>)</span>
<span id="cb93-6"><a href="#cb93-6"></a>])</span>
<span id="cb93-7"><a href="#cb93-7"></a>modelSimple.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">"mse"</span>, optimizer<span class="op">=</span><span class="st">"adam"</span>)</span>
<span id="cb93-8"><a href="#cb93-8"></a><span class="bu">print</span>(<span class="ss">f"This model has </span><span class="sc">{</span>modelSimple<span class="sc">.</span>count_params()<span class="sc">}</span><span class="ss"> parameters."</span>)</span>
<span id="cb93-9"><a href="#cb93-9"></a></span>
<span id="cb93-10"><a href="#cb93-10"></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">50</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>, verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb93-11"><a href="#cb93-11"></a><span class="op">%</span>time hist <span class="op">=</span> modelSimple.fit(trainDS, epochs<span class="op">=</span><span class="dv">1_000</span>, <span class="op">\</span></span>
<span id="cb93-12"><a href="#cb93-12"></a>  validation_data<span class="op">=</span>valDS, callbacks<span class="op">=</span>[es], verbose<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>This model has 3257 parameters.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Restoring model weights from the end of the best epoch: 56.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 106: early stopping</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: total: 1.25 s
Wall time: 6.36 s</code></pre>
</div>
</div>
</section>
<section id="assess-the-fits-6" class="slide level2">
<h2>Assess the fits</h2>

<img data-src="rnns-and-time-series_files/figure-revealjs/cell-73-output-1.png" class="r-stretch"><div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1"></a>modelSimple.evaluate(valDS, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="72">
<pre><code>1.5159484148025513</code></pre>
</div>
</div>
</section>
<section id="plot-the-model-3" class="slide level2">
<h2>Plot the model</h2>
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1"></a>plot_model(modelSimple, show_shapes<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="rnns-and-time-series_files/figure-revealjs/cell-75-output-1.png" class="r-stretch"></section>
<section id="plotting-the-predictions-6" class="slide level2 smaller">
<h2>Plotting the predictions</h2>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="75">
<div class="cell-output cell-output-display">
<p><img data-src="rnns-and-time-series_files/figure-revealjs/cell-76-output-1.png"></p>
</div>
<div class="cell-output cell-output-display">
<p><img data-src="rnns-and-time-series_files/figure-revealjs/cell-76-output-2.png"></p>
</div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="76">
<div class="cell-output cell-output-display">
<p><img data-src="rnns-and-time-series_files/figure-revealjs/cell-77-output-1.png"></p>
</div>
<div class="cell-output cell-output-display">
<p><img data-src="rnns-and-time-series_files/figure-revealjs/cell-77-output-2.png"></p>
</div>
</div>
</div>
</div>
</section>
<section id="a-lstm-layer-1" class="slide level2">
<h2>A <code>LSTM</code> layer</h2>
<div class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1"></a>random.seed(<span class="dv">1</span>)</span>
<span id="cb101-2"><a href="#cb101-2"></a></span>
<span id="cb101-3"><a href="#cb101-3"></a>modelLSTM <span class="op">=</span> Sequential([</span>
<span id="cb101-4"><a href="#cb101-4"></a>    LSTM(<span class="dv">50</span>, input_shape<span class="op">=</span>(seqLength, numTS)),</span>
<span id="cb101-5"><a href="#cb101-5"></a>    Dense(numTS, activation<span class="op">=</span><span class="st">"linear"</span>)</span>
<span id="cb101-6"><a href="#cb101-6"></a>])</span>
<span id="cb101-7"><a href="#cb101-7"></a></span>
<span id="cb101-8"><a href="#cb101-8"></a>modelLSTM.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">"mse"</span>, optimizer<span class="op">=</span><span class="st">"adam"</span>)</span>
<span id="cb101-9"><a href="#cb101-9"></a></span>
<span id="cb101-10"><a href="#cb101-10"></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">50</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>, verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb101-11"><a href="#cb101-11"></a></span>
<span id="cb101-12"><a href="#cb101-12"></a><span class="op">%</span>time hist <span class="op">=</span> modelLSTM.fit(trainDS, epochs<span class="op">=</span><span class="dv">1_000</span>, <span class="op">\</span></span>
<span id="cb101-13"><a href="#cb101-13"></a>  validation_data<span class="op">=</span>valDS, callbacks<span class="op">=</span>[es], verbose<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Restoring model weights from the end of the best epoch: 58.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 108: early stopping</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: total: 1.88 s
Wall time: 7.36 s</code></pre>
</div>
</div>
</section>
<section id="assess-the-fits-7" class="slide level2">
<h2>Assess the fits</h2>

<img data-src="rnns-and-time-series_files/figure-revealjs/cell-79-output-1.png" class="r-stretch"><div class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1"></a>modelLSTM.evaluate(valDS, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="78">
<pre><code>1.3450944423675537</code></pre>
</div>
</div>
</section>
<section id="plotting-the-predictions-7" class="slide level2 smaller">
<h2>Plotting the predictions</h2>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="80">
<div class="cell-output cell-output-display">
<p><img data-src="rnns-and-time-series_files/figure-revealjs/cell-81-output-1.png"></p>
</div>
<div class="cell-output cell-output-display">
<p><img data-src="rnns-and-time-series_files/figure-revealjs/cell-81-output-2.png"></p>
</div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="81">
<div class="cell-output cell-output-display">
<p><img data-src="rnns-and-time-series_files/figure-revealjs/cell-82-output-1.png"></p>
</div>
<div class="cell-output cell-output-display">
<p><img data-src="rnns-and-time-series_files/figure-revealjs/cell-82-output-2.png"></p>
</div>
</div>
</div>
</div>
</section>
<section id="a-gru-layer-1" class="slide level2">
<h2>A <code>GRU</code> layer</h2>
<div class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1"></a>random.seed(<span class="dv">1</span>)</span>
<span id="cb107-2"><a href="#cb107-2"></a></span>
<span id="cb107-3"><a href="#cb107-3"></a>modelGRU <span class="op">=</span> Sequential([</span>
<span id="cb107-4"><a href="#cb107-4"></a>    GRU(<span class="dv">50</span>, input_shape<span class="op">=</span>(seqLength, numTS)),</span>
<span id="cb107-5"><a href="#cb107-5"></a>    Dense(numTS, activation<span class="op">=</span><span class="st">"linear"</span>)</span>
<span id="cb107-6"><a href="#cb107-6"></a>])</span>
<span id="cb107-7"><a href="#cb107-7"></a></span>
<span id="cb107-8"><a href="#cb107-8"></a>modelGRU.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">"mse"</span>, optimizer<span class="op">=</span><span class="st">"adam"</span>)</span>
<span id="cb107-9"><a href="#cb107-9"></a></span>
<span id="cb107-10"><a href="#cb107-10"></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">50</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>, verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb107-11"><a href="#cb107-11"></a></span>
<span id="cb107-12"><a href="#cb107-12"></a><span class="op">%</span>time hist <span class="op">=</span> modelGRU.fit(trainDS, epochs<span class="op">=</span><span class="dv">1_000</span>, <span class="op">\</span></span>
<span id="cb107-13"><a href="#cb107-13"></a>  validation_data<span class="op">=</span>valDS, callbacks<span class="op">=</span>[es], verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Restoring model weights from the end of the best epoch: 80.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 130: early stopping</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: total: 2.72 s
Wall time: 8.93 s</code></pre>
</div>
</div>
</section>
<section id="assess-the-fits-8" class="slide level2">
<h2>Assess the fits</h2>

<img data-src="rnns-and-time-series_files/figure-revealjs/cell-84-output-1.png" class="r-stretch"><div class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1"></a>modelGRU.evaluate(valDS, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="83">
<pre><code>1.3703243732452393</code></pre>
</div>
</div>
</section>
<section id="plotting-the-predictions-8" class="slide level2 smaller">
<h2>Plotting the predictions</h2>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="85">
<div class="cell-output cell-output-display">
<p><img data-src="rnns-and-time-series_files/figure-revealjs/cell-86-output-1.png"></p>
</div>
<div class="cell-output cell-output-display">
<p><img data-src="rnns-and-time-series_files/figure-revealjs/cell-86-output-2.png"></p>
</div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="86">
<div class="cell-output cell-output-display">
<p><img data-src="rnns-and-time-series_files/figure-revealjs/cell-87-output-1.png"></p>
</div>
<div class="cell-output cell-output-display">
<p><img data-src="rnns-and-time-series_files/figure-revealjs/cell-87-output-2.png"></p>
</div>
</div>
</div>
</div>
</section>
<section id="two-gru-layers-1" class="slide level2">
<h2>Two <code>GRU</code> layers</h2>
<div class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1"></a>random.seed(<span class="dv">1</span>)</span>
<span id="cb113-2"><a href="#cb113-2"></a></span>
<span id="cb113-3"><a href="#cb113-3"></a>modelTwoGRUs <span class="op">=</span> Sequential([</span>
<span id="cb113-4"><a href="#cb113-4"></a>    GRU(<span class="dv">50</span>, input_shape<span class="op">=</span>(seqLength, numTS), return_sequences<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb113-5"><a href="#cb113-5"></a>    GRU(<span class="dv">50</span>),</span>
<span id="cb113-6"><a href="#cb113-6"></a>    Dense(numTS, activation<span class="op">=</span><span class="st">"linear"</span>)</span>
<span id="cb113-7"><a href="#cb113-7"></a>])</span>
<span id="cb113-8"><a href="#cb113-8"></a></span>
<span id="cb113-9"><a href="#cb113-9"></a>modelTwoGRUs.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">"mse"</span>, optimizer<span class="op">=</span><span class="st">"adam"</span>)</span>
<span id="cb113-10"><a href="#cb113-10"></a></span>
<span id="cb113-11"><a href="#cb113-11"></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">50</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>, verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb113-12"><a href="#cb113-12"></a></span>
<span id="cb113-13"><a href="#cb113-13"></a><span class="op">%</span>time hist <span class="op">=</span> modelTwoGRUs.fit(trainDS, epochs<span class="op">=</span><span class="dv">1_000</span>, <span class="op">\</span></span>
<span id="cb113-14"><a href="#cb113-14"></a>  validation_data<span class="op">=</span>valDS, callbacks<span class="op">=</span>[es], verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Restoring model weights from the end of the best epoch: 40.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 90: early stopping</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: total: 2.08 s
Wall time: 7.64 s</code></pre>
</div>
</div>
</section>
<section id="assess-the-fits-9" class="slide level2">
<h2>Assess the fits</h2>

<img data-src="rnns-and-time-series_files/figure-revealjs/cell-89-output-1.png" class="r-stretch"><div class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1"></a>modelTwoGRUs.evaluate(valDS, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="88">
<pre><code>1.3668354749679565</code></pre>
</div>
</div>
</section>
<section id="plotting-the-predictions-9" class="slide level2 smaller">
<h2>Plotting the predictions</h2>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="90">
<div class="cell-output cell-output-display">
<p><img data-src="rnns-and-time-series_files/figure-revealjs/cell-91-output-1.png"></p>
</div>
<div class="cell-output cell-output-display">
<p><img data-src="rnns-and-time-series_files/figure-revealjs/cell-91-output-2.png"></p>
</div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="91">
<div class="cell-output cell-output-display">
<p><img data-src="rnns-and-time-series_files/figure-revealjs/cell-92-output-1.png"></p>
</div>
<div class="cell-output cell-output-display">
<p><img data-src="rnns-and-time-series_files/figure-revealjs/cell-92-output-2.png"></p>
</div>
</div>
</div>
</div>
</section>
<section id="compare-the-models-1" class="slide level2">
<h2>Compare the models</h2>
<div class="cell" data-execution_count="92">
<div class="cell-output cell-output-display" data-execution_count="91">

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Model</th>
      <th>MSE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>SimpleRNN</td>
      <td>1.515948</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Dense</td>
      <td>1.468790</td>
    </tr>
    <tr>
      <th>3</th>
      <td>GRU</td>
      <td>1.370324</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2 GRUs</td>
      <td>1.366835</td>
    </tr>
    <tr>
      <th>2</th>
      <td>LSTM</td>
      <td>1.345094</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>The network with two GRU layers is the best.</p>
<div class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1"></a>modelTwoGRUs.evaluate(testDS, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="92">
<pre><code>1.9474244117736816</code></pre>
</div>
</div>
</section>
<section id="test-set-1" class="slide level2">
<h2>Test set</h2>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="94">
<div class="cell-output cell-output-display">
<p><img data-src="rnns-and-time-series_files/figure-revealjs/cell-95-output-1.png"></p>
</div>
<div class="cell-output cell-output-display">
<p><img data-src="rnns-and-time-series_files/figure-revealjs/cell-95-output-2.png"></p>
</div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="95">
<div class="cell-output cell-output-display">
<p><img data-src="rnns-and-time-series_files/figure-revealjs/cell-96-output-1.png"></p>
</div>
<div class="cell-output cell-output-display">
<p><img data-src="rnns-and-time-series_files/figure-revealjs/cell-96-output-2.png"></p>
</div>
</div>
</div>
</div>
</section>
<section id="quiz" class="slide level2">
<h2>Quiz</h2>
<p>Say <span class="math inline">\(X\)</span> is a batch of time series with shape <span class="math inline">\((4,3,2)\)</span>.</p>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1"></a>X[<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<div class="cell" data-execution_count="98">
<div class="cell-output cell-output-display" data-execution_count="96">
<pre><code>0</code></pre>
</div>
</div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1"></a>X[<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<div class="cell" data-execution_count="100">
<div class="cell-output cell-output-error">
<pre><code>IndexError: index 2 is out of bounds for axis 2 with size 2</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1"></a>X[<span class="dv">1</span>].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<div class="cell" data-execution_count="102">
<div class="cell-output cell-output-display" data-execution_count="98">
<pre><code>(3, 2)</code></pre>
</div>
</div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1"></a>X[:,<span class="op">-</span><span class="dv">1</span>,:].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<div class="cell" data-execution_count="104">
<div class="cell-output cell-output-display" data-execution_count="99">
<pre><code>(4, 2)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1"></a>np.<span class="bu">max</span>(X, axis<span class="op">=</span><span class="dv">1</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<div class="cell" data-execution_count="106">
<div class="cell-output cell-output-display" data-execution_count="100">
<pre><code>array([[ 4,  5],
       [10, 11],
       [16, 17],
       [22, 23]])</code></pre>
</div>
</div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1"></a>X.median(axis<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<div class="cell" data-execution_count="108">
<div class="cell-output cell-output-error">
<pre><code>AttributeError: 'numpy.ndarray' object has no attribute 'median'</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="quiz-1" class="slide level2">
<h2>Quiz</h2>
<p>Given a batch of time series in <code>X</code>, how would you get get:</p>
<ol type="1">
<li>A <span class="math inline">\((b, n)\)</span>-shaped matrix which is the time series holding the point-wise average of the original <span class="math inline">\(m\)</span> time series’?</li>
<li>A <span class="math inline">\((b, n, 1)\)</span>-shaped tensor of the minimum of each time series?</li>
<li>A <span class="math inline">\((b,)\)</span>-shaped vector of the average of each observation?</li>
</ol>
</section></section>
<section>
<section id="simplernn" class="title-slide slide level1 center" data-background-image="unsw-yellow-shape.png" data-visibility="uncounted">
<h1>SimpleRNN</h1>

</section>
<section id="recurrence-relation" class="slide level2">
<h2>Recurrence relation</h2>
<p><br></p>
<blockquote>
<p>A recurrence relation is an equation that expresses each element of a sequence as a function of the preceding ones. More precisely, in the case where only the immediately preceding element is involved, a recurrence relation has the form</p>
<p><span class="math display">\[ u_n = \psi(n, u_{n-1}) \quad \text{ for } \quad n &gt; 0.\]</span></p>
</blockquote>
<p><br></p>
<p><strong>Example</strong>: Factorial <span class="math inline">\(n! = n (n-1)!\)</span> for <span class="math inline">\(n &gt; 0\)</span> given <span class="math inline">\(0! = 1\)</span>.</p>
<div class="footer">
<p>Source: Wikipedia, <a href="https://en.wikipedia.org/wiki/Recurrence_relation#Definition">Recurrence relation</a>.</p>
</div>
</section>
<section id="a-simplernn-cell." class="slide level2">
<h2>A SimpleRNN cell.</h2>

<img data-src="colah-LSTM3-SimpleRNN.png" class="r-stretch quarto-figure-center"><p class="caption">Diagram of a SimpleRNN cell.</p><p><br></p>
<p>All the outputs before the final one are often discarded.</p>
<div class="footer">
<p>Source: Christopher Olah (2015), <a href="http://colah.github.io/posts/2015-08-Understanding-LSTMs">Understanding LSTM Networks</a>, Colah’s Blog.</p>
</div>
</section>
<section id="simplernn-1" class="slide level2">
<h2>SimpleRNN</h2>
<p>Say each prediction is a vector of size <span class="math inline">\(d\)</span>, so <span class="math inline">\(\mathbf{y}_t \in \mathbb{R}^{1 \times d}\)</span>.</p>
<p>Then the main equation of a SimpleRNN, given <span class="math inline">\(\mathbf{y}_0 = \mathbf{0}\)</span>, is</p>
<p><span class="math display">\[ \mathbf{y}_t = \psi\bigl( \mathbf{x}_t \mathbf{W}_x + \mathbf{y}_{t-1} \mathbf{W}_y + \mathbf{b} \bigr) . \]</span></p>
<p>Here, <span class="math display">\[
\begin{aligned}
&amp;\mathbf{x}_t \in \mathbb{R}^{1 \times m}, \mathbf{W}_x \in \mathbb{R}^{m \times d}, \\
&amp;\mathbf{y}_{t-1} \in \mathbb{R}^{1 \times d}, \mathbf{W}_y \in \mathbb{R}^{d \times d}, \text{ and } \mathbf{b} \in \mathbb{R}^{d}.
\end{aligned}
\]</span></p>
</section>
<section id="simplernn-in-batches" class="slide level2">
<h2>SimpleRNN (in batches)</h2>
<p>Say we operate on batches of size <span class="math inline">\(b\)</span>, then <span class="math inline">\(\mathbf{Y}_t \in \mathbb{R}^{b \times d}\)</span>.</p>
<p>Then the main equation of a SimpleRNN, given <span class="math inline">\(\mathbf{Y}_0 = \mathbf{0}\)</span>, is</p>
<p><span class="math display">\[ \mathbf{Y}_t = \psi\bigl( \mathbf{X}_t \mathbf{W}_x + \mathbf{Y}_{t-1} \mathbf{W}_y + \mathbf{b} \bigr) . \]</span></p>
<p>Here, <span class="math display">\[
\begin{aligned}
&amp;\mathbf{X}_t \in \mathbb{R}^{b \times m}, \mathbf{W}_x \in \mathbb{R}^{m \times d}, \\
&amp;\mathbf{Y}_{t-1} \in \mathbb{R}^{b \times d}, \mathbf{W}_y \in \mathbb{R}^{d \times d}, \text{ and } \mathbf{b} \in \mathbb{R}^{d}.
\end{aligned}
\]</span></p>
<div class="fragment">
<div class="callout callout-note callout-captioned callout-style-default">
<div class="callout-body">
<div class="callout-caption">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>Remember, <span class="math inline">\(\mathbf{X} \in \mathbb{R}^{b \times n \times m}\)</span>, <span class="math inline">\(\mathbf{Y} \in \mathbb{R}^{b \times d}\)</span>, and <span class="math inline">\(\mathbf{X}_t\)</span> is equivalent to <code>X[:, t, :]</code>.</p>
</div>
</div>
</div>
</div>
</section>
<section id="simple-keras-demo" class="slide level2">
<h2>Simple Keras demo</h2>
<div class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1"></a>numObs <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb133-2"><a href="#cb133-2"></a>numTimeSteps <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb133-3"><a href="#cb133-3"></a>numTimeSeries <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb133-4"><a href="#cb133-4"></a></span>
<span id="cb133-5"><a href="#cb133-5"></a>X <span class="op">=</span> np.arange(numObs<span class="op">*</span>numTimeSteps<span class="op">*</span>numTimeSeries).astype(np.float32) <span class="op">\</span></span>
<span id="cb133-6"><a href="#cb133-6"></a>        .reshape([numObs, numTimeSteps, numTimeSeries])</span>
<span id="cb133-7"><a href="#cb133-7"></a></span>
<span id="cb133-8"><a href="#cb133-8"></a>outputSize <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb133-9"><a href="#cb133-9"></a>y <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="110">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1"></a>X[:<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="103">
<pre><code>array([[[ 0.,  1.],
        [ 2.,  3.],
        [ 4.,  5.]],

       [[ 6.,  7.],
        [ 8.,  9.],
        [10., 11.]]], dtype=float32)</code></pre>
</div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="111">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1"></a>X[<span class="dv">2</span>:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="104">
<pre><code>array([[[12., 13.],
        [14., 15.],
        [16., 17.]],

       [[18., 19.],
        [20., 21.],
        [22., 23.]]], dtype=float32)</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="keras-simplernn" class="slide level2">
<h2>Keras’ SimpleRNN</h2>
<p>As usual, the <code>SimpleRNN</code> is just a layer in Keras.</p>
<div class="cell" data-execution_count="112">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1"></a>random.seed(<span class="dv">1234</span>)</span>
<span id="cb138-2"><a href="#cb138-2"></a>model <span class="op">=</span> Sequential([</span>
<span id="cb138-3"><a href="#cb138-3"></a>  SimpleRNN(outputSize, activation<span class="op">=</span><span class="st">"sigmoid"</span>)</span>
<span id="cb138-4"><a href="#cb138-4"></a>])</span>
<span id="cb138-5"><a href="#cb138-5"></a>model.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">"binary_crossentropy"</span>, metrics<span class="op">=</span>[<span class="st">"accuracy"</span>])</span>
<span id="cb138-6"><a href="#cb138-6"></a></span>
<span id="cb138-7"><a href="#cb138-7"></a>hist <span class="op">=</span> model.fit(X, y, epochs<span class="op">=</span><span class="dv">500</span>, verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb138-8"><a href="#cb138-8"></a>model.evaluate(X, y, verbose<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="105">
<pre><code>[0.7038002014160156, 0.5]</code></pre>
</div>
</div>
<p>The predicted probabilities on the training set are:</p>
<div class="cell" data-execution_count="113">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1"></a>model.predict(X, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="106">
<pre><code>array([[0.6 ],
       [0.84],
       [0.95],
       [0.99]], dtype=float32)</code></pre>
</div>
</div>
</section>
<section id="simplernn-weights" class="slide level2">
<h2>SimpleRNN weights</h2>
<div class="cell" data-execution_count="114">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1"></a>model.get_weights()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="107">
<pre><code>[array([[-0.22],
        [ 0.49]], dtype=float32),
 array([[-1.5]], dtype=float32),
 array([-0.5], dtype=float32)]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="115">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1"></a><span class="kw">def</span> sigmoid(x):</span>
<span id="cb144-2"><a href="#cb144-2"></a>  <span class="cf">return</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="op">-</span>x))</span>
<span id="cb144-3"><a href="#cb144-3"></a></span>
<span id="cb144-4"><a href="#cb144-4"></a>W_x, W_y, b <span class="op">=</span> model.get_weights()</span>
<span id="cb144-5"><a href="#cb144-5"></a></span>
<span id="cb144-6"><a href="#cb144-6"></a>Y <span class="op">=</span> np.zeros((numObs, outputSize), dtype<span class="op">=</span>np.float32)</span>
<span id="cb144-7"><a href="#cb144-7"></a><span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(numTimeSteps):</span>
<span id="cb144-8"><a href="#cb144-8"></a>    X_t <span class="op">=</span> X[:, t, :]</span>
<span id="cb144-9"><a href="#cb144-9"></a>    z <span class="op">=</span> X_t <span class="op">@</span> W_x <span class="op">+</span> Y <span class="op">@</span> W_y <span class="op">+</span> b</span>
<span id="cb144-10"><a href="#cb144-10"></a>    Y <span class="op">=</span> sigmoid(z)</span>
<span id="cb144-11"><a href="#cb144-11"></a></span>
<span id="cb144-12"><a href="#cb144-12"></a>Y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="108">
<pre><code>array([[0.6 ],
       [0.84],
       [0.95],
       [0.99]], dtype=float32)</code></pre>
</div>
</div>
</section></section>
<section>
<section id="recurrent-neural-networks-1" class="title-slide slide level1 center" data-background-image="unsw-yellow-shape.png" data-visibility="uncounted">
<h1>Recurrent Neural Networks</h1>

</section>
<section id="input-of-an-rnn" class="slide level2 smaller">
<h2>Input of an RNN</h2>
<ul>
<li>Recurrent neural network (RNN) is used to handle input data that occurs in one-dimensional sequence.
<ul>
<li>Natural language data such as sentences.</li>
<li>Price data such as financial time series, stock prices.</li>
<li>Temperature data.</li>
<li>Time-stamped medical events.</li>
<li>Weekly sales.</li>
<li>Hourly electricity consumption.</li>
<li>Human activity pattern.</li>
</ul></li>
<li>We talk about time steps when discussing RNN, but it can be any steps in a sequence of ordered data.</li>
</ul>
</section>
<section id="applications" class="slide level2 smaller">
<h2>Applications</h2>
<ul>
<li>Forecasting: revenue forecast, weather forecast, predict disease rate from medical history, etc.</li>
<li>Classification: given a time series of the activities of a visitor on a website, classify whether the visitor is a bot or a human.</li>
<li>Event detection: given a continuous data stream, identify the occurrence of a specific event. Example: Detect utterances like “Hey Alexa” from an audio stream.</li>
<li>Anomaly detection: given a continuous data stream, detect anything unusual happening. This is typically an unsupervised learning problem. Example: Detect unusual activity on the corporate network.</li>
</ul>
</section>
<section id="recurrent-neural-network" class="slide level2">
<h2>Recurrent neural network</h2>
<p>For a single neuron, output of a recurrent layer is:</p>
<p><span class="math display">\[
\mathbf{Y}_t = \psi\bigl( \mathbf{X}_t \mathbf{W}_x + \mathbf{Y}_{t-1} \mathbf{W}_y + \mathbf{b} \bigr) .
\]</span></p>
<p>Densely connected neural networks and convnet have no memory, which means each input is processed independently with no state (memory) kept between inputs. The recurrent neuron has a form of memory because the output at step <span class="math inline">\(t\)</span> depends on all the inputs from the previous steps. We call the part of a neural network that preserves some state across time steps a <em>memory cell</em> or a <em>cell</em>.</p>
</section>
<section id="recurrent-neural-network-1" class="slide level2 smaller">
<h2>Recurrent neural network</h2>
<p>Note: the same weights are shared across the time steps of the recurrent network. A lot of resource will be required if these parameters are not shared. This also allows generalization when the model is used on a sequence of arbitrary length.</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Geron-recurrentneuronlayer-blur.png"></p>
<p></p><figcaption>One layer of recurrent neurons unrolled through time.</figcaption><p></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Geron-recurrentneurondeep-blur.png"></p>
<p></p><figcaption><em>Deep RNN</em> unrolled through time.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
<div class="footer">
<p>Source: Aurélien Géron (2019), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, Chapter 15.</p>
</div>
</section>
<section id="input-and-output-sequences" class="slide level2">
<h2>Input and output sequences</h2>

<img data-src="Geron-rnnType-blur.png" class="r-stretch quarto-figure-center"><p class="caption">Categories of recurrent neural networks: sequence to sequence, sequence to vector, vector to sequence, encoder-decoder network.</p><div class="footer">
<p>Source: Aurélien Géron (2019), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, Chapter 15.</p>
</div>
</section>
<section id="input-and-output-sequences-1" class="slide level2">
<h2>Input and output sequences</h2>
<ul>
<li>Sequence to sequence: Useful for predicting time series such as using prices over the last <span class="math inline">\(N\)</span> days to output the prices shifted one day into the future (i.e.&nbsp;from <span class="math inline">\(N-1\)</span> days ago to tomorrow.)</li>
<li>Sequence to vector: ignore all outputs in the previous time steps except for the last one. Example: give a sentiment score to a sequence of words corresponding to a movie review.</li>
</ul>
</section>
<section id="input-and-output-sequences-2" class="slide level2 smaller">
<h2>Input and output sequences</h2>
<ul>
<li>Vector to sequence: feed the network the same input vector over and over at each time step and let it output a sequence. Example: given that the input is an image, find a caption for it. The image is treated as an input vector (pixels in an image do not follow a sequence). The caption is a sequence of textual description of the image. A dataset containing images and their descriptions is the input of the RNN.</li>
<li>The Encoder-Decoder: The encoder is a sequence-to-vector network. The decoder is a vector-to-sequence network. Example: Feed the network a sequence in one language. Use the encoder to convert the sentence into a single vector representation. The decoder decodes this vector into the translation of the sentence in another language.</li>
</ul>
</section>
<section id="lstm-internals" class="slide level2">
<h2>LSTM internals</h2>
<p><img data-src="colah-LSTM3-chain.png" alt="Diagram of an LSTM cell."> <img data-src="colah-LSTM2-notation.png" alt="Notation for the diagram."></p>
<div class="footer">
<p>Source: Christopher Olah (2015), <a href="http://colah.github.io/posts/2015-08-Understanding-LSTMs">Understanding LSTM Networks</a>, Colah’s Blog.</p>
</div>
</section>
<section id="gru-internals" class="slide level2">
<h2>GRU internals</h2>

<img data-src="colah-LSTM3-var-GRU.png" class="r-stretch quarto-figure-center"><p class="caption">Diagram of a GRU cell.</p><p><br></p>
<div class="footer">
<p>Source: Christopher Olah (2015), <a href="http://colah.github.io/posts/2015-08-Understanding-LSTMs">Understanding LSTM Networks</a>, Colah’s Blog.</p>
</div>
</section></section>
<section>
<section id="rnns-cnns-for-time-series" class="title-slide slide level1 center" data-background-image="unsw-yellow-shape.png" data-visibility="uncounted">
<h1>RNNs &amp; CNNs For Time Series</h1>

</section>
<section id="the-temperature-in-jena-germany" class="slide level2">
<h2>The temperature in Jena, Germany</h2>
<p>Temperature recorded every 10 minutes over 2009-2016 (8 years), which gives 420,551 data points.</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="chollet-temperatureall-blur.png"></p>
<p></p><figcaption>All temperature data, yearly periodicity is observed.</figcaption><p></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="chollet-temperature10days-blur.png"></p>
<p></p><figcaption>10-day data shows some daily periodicity.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
<div class="footer">
<p>Source: François Chollet (2021), <em>Deep Learning with Python</em>, Second Edition, Figures 10.1 &amp; 10.2.</p>
</div>
</section>
<section id="a-temperature-forecasting-example" class="slide level2">
<h2>A temperature-forecasting example</h2>
<p>Given a few months of data, predict the average temperature for the next month. This is an easy problem due to the reliable year-scale periodicity of the data.</p>
<p>Given hourly temperature data of the previous 5 days, predict the temperature in 24 hours. This is a harder problem because on a daily scale, data is more chaotic.</p>
</section>
<section id="the-baseline-model" class="slide level2">
<h2>The baseline model</h2>
<p>Build a model for 24-hour temperature forecast: Use a baseline model to evaluate the performance of the models that we build.</p>
<p>For our forecast model, the baseline model is to set the temperature 24 hours from now to be equal to the temperature right now. The validation error (mean absolute error) of this model is then 2.44 degrees Celsius, and the test error is 2.62 degrees.</p>
</section>
<section id="a-24-hour-forecast" class="slide level2">
<h2>A 24-hour forecast</h2>
<p>Neither the densely connected network or the 1D convnet work well. Their validation errors are higher than the baseline model.</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="chollet-feedforwardresult-blur.png"></p>
<p></p><figcaption>Using a densely connected network.</figcaption><p></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="chollet-convoresult-blur.png"></p>
<p></p><figcaption>Using a 1D convolutional network.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
<div class="footer">
<p>Source: François Chollet (2021), <em>Deep Learning with Python</em>, Second Edition, Figures 10.3 &amp; 10.4.</p>
</div>
</section>
<section id="why-the-dense-model-doesnt-work" class="slide level2">
<h2>Why the dense model doesn’t work</h2>
<p>For the 2-layer densely connected neural network, even though a good solution technically exists where the neural network finds the baseline solution and improves on it, finding such solution in the hypothesis space of all possible 2-layer neural network with the configuration we defined is sometimes like finding a needle in the haystack. Good feature engineering and relevant network architecture is important in that case: you need to tell the model precisely what it should be looking for.</p>
</section>
<section id="why-the-cnn-doesnt-work" class="slide level2">
<h2>Why the CNN doesn’t work</h2>
<p>Order of data in the sequence (such as a time series) matters a lot. For temperature forecast, recent data is more informative for predicting the next day’s temperature.</p>
<p>Convnet is unable to preserve order. In the pooling layer such as max pooling, the max value from a grid is retrieved while discarding information about the exact location of the max value in the grid. By losing positional information, the network fails to capture information about the spatial or temporal relation between the inputs.</p>
</section>
<section id="going-forward-backwards-in-time" class="slide level2">
<h2>Going forward &amp; backwards in time</h2>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="chollet-10-11-blur.png"></p>
<p></p><figcaption>Using a dropout-regularised LSTM.</figcaption><p></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="chollet-10-13-blur.png"></p>
<p></p><figcaption>Using an LSTM on reversed sequences.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
<div class="footer">
<p>Source: François Chollet (2021), <em>Deep Learning with Python</em>, Second Edition, Figures 10.11 &amp; 10.13.</p>
</div>
</section>
<section id="why-the-backwards-direction-fails" class="slide level2">
<h2>Why the backwards direction fails</h2>
<blockquote>
<p>The reversed-order LSTM strongly underperforms even the common-sense baseline, indicating that in this case, chronological processing is important to the success of the approach. This makes perfect sense: the underlying LSTM layer will typically be better at remembering the recent past than the distant past, and naturally the more recent weather data points are more predictive than older data points for the problem (that’s what makes the common-sense baseline fairly strong). Thus the chronological version of the layer is bound to outperform the reversed-order version.</p>
</blockquote>
<div class="footer">
<p>Source: François Chollet (2021), <em>Deep Learning with Python</em>, Second Edition, Chapter 10.</p>
</div>
</section>
<section id="bidirectional-rnn" class="slide level2">
<h2>Bidirectional RNN</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="chollet-10-14-blur.png"></p>
<p></p><figcaption>Illustration of a bidirectional RNN.</figcaption><p></p>
</figure>
</div>
</div><div class="column" style="width:60%;">
<p>Wrap a normal RNN layer inside the <code>Bidirectional</code> layer to get Keras to go forward &amp; backwards in time.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="op">\</span></span>
<span id="cb146-2"><a href="#cb146-2"></a>    <span class="im">import</span> Bidirectional</span>
<span id="cb146-3"><a href="#cb146-3"></a></span>
<span id="cb146-4"><a href="#cb146-4"></a>inputs <span class="op">=</span> Input(shape<span class="op">=</span>inpShape)</span>
<span id="cb146-5"><a href="#cb146-5"></a>x <span class="op">=</span> Bidirectional(LSTM(<span class="dv">16</span>))(inputs)</span>
<span id="cb146-6"><a href="#cb146-6"></a>outputs <span class="op">=</span> Dense(<span class="dv">1</span>)(x)</span>
<span id="cb146-7"><a href="#cb146-7"></a>model <span class="op">=</span> Model(inputs, outputs) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="footer">
<p>Source: François Chollet (2021), <em>Deep Learning with Python</em>, Second Edition, Chapter 10.</p>
</div>
</section></section>
<section id="section" class="title-slide slide level1 center" data-visibility="uncounted">
<h1></h1>
<h2>
Glossary
</h2>
<ul>
<li>dimensions (tensor)</li>
<li>GRU</li>
<li>LSTM</li>
<li>rank (tensor)</li>
<li>recurrent neural networks</li>
<li>SimpleRNN</li>
</ul>
<script defer="">
    // Remove the highlight.js class for the 'compile', 'min', 'max'
    // as there's a bug where they are treated like the Python built-in
    // global functions but we only ever see it as methods like
    // 'model.compile()' or 'predictions.max()'
    buggyBuiltIns = ["compile", "min", "max", "round", "sum"];

    document.querySelectorAll('.bu').forEach((elem) => {
        if (buggyBuiltIns.includes(elem.innerHTML)) {
            elem.classList.remove('bu');
        }
    })

    var registerRevealCallbacks = function() {
        Reveal.on('overviewshown', event => {
            document.querySelector(".line.right").hidden = true;
        });
        Reveal.on('overviewhidden', event => {
            document.querySelector(".line.right").hidden = false;
        });
    };
</script>

<img src="unsw-logo.svg" class="slide-logo r-stretch"><div class="footer footer-default">
<p>Slides: <a href="https://pat-laub.github.io">Dr Patrick Laub</a> (<span class="citation" data-cites="PatrickLaub">@PatrickLaub</span>).</p>
</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="rnns-and-time-series_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="rnns-and-time-series_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="rnns-and-time-series_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="rnns-and-time-series_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="rnns-and-time-series_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="rnns-and-time-series_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="rnns-and-time-series_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="rnns-and-time-series_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="rnns-and-time-series_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="rnns-and-time-series_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="rnns-and-time-series_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': false,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true,"boardmarkerWidth":6,"grid":false,"background":["rgba(255,255,255,0.0)","https://github.com/rajgoel/reveal.js-plugins/raw/master/chalkboard/img/blackboard.png"]},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.2,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        target: function(trigger) {
          return trigger.previousElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto-reveal',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    <script>registerRevealCallbacks();</script>
    

</body></html>