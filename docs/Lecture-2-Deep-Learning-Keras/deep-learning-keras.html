<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Patrick Laub">

<title>AI for Actuaries - Deep Learning with Keras</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../Lecture-2-Deep-Learning-Keras/project.html" rel="next">
<link href="../Lecture-1-Artificial-Intelligence/python.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Lecture-2-Deep-Learning-Keras/deep-learning-keras.html">Module 2</a></li><li class="breadcrumb-item"><a href="../Lecture-2-Deep-Learning-Keras/deep-learning-keras.html">Deep Learning with Keras</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">AI for Actuaries</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Module 1</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-1-Artificial-Intelligence/course-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-1-Artificial-Intelligence/python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Module 2</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-2-Deep-Learning-Keras/deep-learning-keras.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Deep Learning with Keras</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-2-Deep-Learning-Keras/project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Project Details</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Module 3</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-3-Tabular-Data/categorical-variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Categorical Variables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-3-Tabular-Data/classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Classification</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Module 4</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-4-Computer-Vision/computer-vision.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Computer Vision</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Module 5</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-5-Natural-Language-Processing/natural-language-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Natural Language Processing</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Module 6</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-6-Uncertainty-Quantification/uncertainty-quantification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Uncertainty Quantification</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Module 7</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-7-Recurrent-Neural-Networks-And-Time-Series/rnns-and-time-series.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Recurrent Neural Networks</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">
 <span class="menu-text">Module 8</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-8-Generative-Networks/generative-networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generative Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-8-Generative-Networks/gans.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generative Adversarial Networks</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">
 <span class="menu-text">Module 9</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-9-Advanced-Topics/interpretability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interpretability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lecture-9-Advanced-Topics/exam-revision.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Examinable Topics for Revision</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#lecture-outline" id="toc-lecture-outline" class="nav-link active" data-scroll-target="#lecture-outline">Lecture Outline</a></li>
  <li><a href="#deep-learning" id="toc-deep-learning" class="nav-link" data-scroll-target="#deep-learning">Deep Learning</a>
  <ul class="collapse">
  <li><a href="#how-do-real-neurons-work" id="toc-how-do-real-neurons-work" class="nav-link" data-scroll-target="#how-do-real-neurons-work">How do real neurons work?</a></li>
  <li><a href="#a-neuron-firing" id="toc-a-neuron-firing" class="nav-link" data-scroll-target="#a-neuron-firing">A neuron ‘firing’</a></li>
  <li><a href="#an-artificial-neuron" id="toc-an-artificial-neuron" class="nav-link" data-scroll-target="#an-artificial-neuron">An artificial neuron</a></li>
  <li><a href="#one-neuron" id="toc-one-neuron" class="nav-link" data-scroll-target="#one-neuron">One neuron</a></li>
  <li><a href="#one-neuron-with-bias" id="toc-one-neuron-with-bias" class="nav-link" data-scroll-target="#one-neuron-with-bias">One neuron with bias</a></li>
  <li><a href="#a-basic-neural-network" id="toc-a-basic-neural-network" class="nav-link" data-scroll-target="#a-basic-neural-network">A basic neural network</a></li>
  <li><a href="#step-function-activation" id="toc-step-function-activation" class="nav-link" data-scroll-target="#step-function-activation">Step-function activation</a>
  <ul class="collapse">
  <li><a href="#perceptrons" id="toc-perceptrons" class="nav-link" data-scroll-target="#perceptrons">Perceptrons</a></li>
  <li><a href="#modern-neural-network" id="toc-modern-neural-network" class="nav-link" data-scroll-target="#modern-neural-network">Modern neural network</a></li>
  </ul></li>
  <li><a href="#try-different-activation-functions" id="toc-try-different-activation-functions" class="nav-link" data-scroll-target="#try-different-activation-functions">Try different activation functions</a></li>
  <li><a href="#flexible" id="toc-flexible" class="nav-link" data-scroll-target="#flexible">Flexible</a></li>
  <li><a href="#feature-engineering" id="toc-feature-engineering" class="nav-link" data-scroll-target="#feature-engineering">Feature engineering</a></li>
  <li><a href="#the-deep-learning-hammer" id="toc-the-deep-learning-hammer" class="nav-link" data-scroll-target="#the-deep-learning-hammer">The deep learning hammer</a></li>
  <li><a href="#quiz" id="toc-quiz" class="nav-link" data-scroll-target="#quiz">Quiz</a></li>
  </ul></li>
  <li><a href="#california-house-price-prediction" id="toc-california-house-price-prediction" class="nav-link" data-scroll-target="#california-house-price-prediction">California House Price Prediction</a>
  <ul class="collapse">
  <li><a href="#import-the-data" id="toc-import-the-data" class="nav-link" data-scroll-target="#import-the-data">Import the data</a></li>
  <li><a href="#what-is-the-target" id="toc-what-is-the-target" class="nav-link" data-scroll-target="#what-is-the-target">What is the target?</a></li>
  <li><a href="#the-dataset" id="toc-the-dataset" class="nav-link" data-scroll-target="#the-dataset">The dataset</a></li>
  <li><a href="#columns" id="toc-columns" class="nav-link" data-scroll-target="#columns">Columns</a></li>
  <li><a href="#an-entire-ml-project" id="toc-an-entire-ml-project" class="nav-link" data-scroll-target="#an-entire-ml-project">An entire ML project</a></li>
  <li><a href="#questions-to-answer-in-ml-project" id="toc-questions-to-answer-in-ml-project" class="nav-link" data-scroll-target="#questions-to-answer-in-ml-project">Questions to answer in ML project</a></li>
  <li><a href="#set-aside-a-fraction-for-a-test-set" id="toc-set-aside-a-fraction-for-a-test-set" class="nav-link" data-scroll-target="#set-aside-a-fraction-for-a-test-set">Set aside a fraction for a test set</a></li>
  <li><a href="#basic-ml-workflow" id="toc-basic-ml-workflow" class="nav-link" data-scroll-target="#basic-ml-workflow">Basic ML workflow</a></li>
  <li><a href="#split-three-ways" id="toc-split-three-ways" class="nav-link" data-scroll-target="#split-three-ways">Split three ways</a></li>
  <li><a href="#why-not-use-test-set-for-both" id="toc-why-not-use-test-set-for-both" class="nav-link" data-scroll-target="#why-not-use-test-set-for-both">Why not use test set for both?</a></li>
  </ul></li>
  <li><a href="#eda-baseline-model" id="toc-eda-baseline-model" class="nav-link" data-scroll-target="#eda-baseline-model">EDA &amp; Baseline Model</a>
  <ul class="collapse">
  <li><a href="#the-training-set" id="toc-the-training-set" class="nav-link" data-scroll-target="#the-training-set">The training set</a></li>
  <li><a href="#location" id="toc-location" class="nav-link" data-scroll-target="#location">Location</a></li>
  <li><a href="#location-2" id="toc-location-2" class="nav-link" data-scroll-target="#location-2">Location #2</a></li>
  <li><a href="#features" id="toc-features" class="nav-link" data-scroll-target="#features">Features</a></li>
  <li><a href="#linear-regression" id="toc-linear-regression" class="nav-link" data-scroll-target="#linear-regression">Linear Regression</a></li>
  <li><a href="#make-some-predictions" id="toc-make-some-predictions" class="nav-link" data-scroll-target="#make-some-predictions">Make some predictions</a></li>
  <li><a href="#plot-the-predictions" id="toc-plot-the-predictions" class="nav-link" data-scroll-target="#plot-the-predictions">Plot the predictions</a></li>
  <li><a href="#calculate-mean-squared-error" id="toc-calculate-mean-squared-error" class="nav-link" data-scroll-target="#calculate-mean-squared-error">Calculate mean squared error</a></li>
  <li><a href="#using-mean_squared_error" id="toc-using-mean_squared_error" class="nav-link" data-scroll-target="#using-mean_squared_error">Using <code>mean_squared_error</code></a></li>
  </ul></li>
  <li><a href="#our-first-neural-network" id="toc-our-first-neural-network" class="nav-link" data-scroll-target="#our-first-neural-network">Our First Neural Network</a>
  <ul class="collapse">
  <li><a href="#what-are-keras-and-tensorflow" id="toc-what-are-keras-and-tensorflow" class="nav-link" data-scroll-target="#what-are-keras-and-tensorflow">What are Keras and TensorFlow?</a></li>
  <li><a href="#create-a-keras-ann-model" id="toc-create-a-keras-ann-model" class="nav-link" data-scroll-target="#create-a-keras-ann-model">Create a Keras ANN model</a></li>
  <li><a href="#inspect-the-model" id="toc-inspect-the-model" class="nav-link" data-scroll-target="#inspect-the-model">Inspect the model</a></li>
  <li><a href="#the-model-is-initialised-randomly" id="toc-the-model-is-initialised-randomly" class="nav-link" data-scroll-target="#the-model-is-initialised-randomly">The model is initialised randomly</a></li>
  <li><a href="#controlling-the-randomness" id="toc-controlling-the-randomness" class="nav-link" data-scroll-target="#controlling-the-randomness">Controlling the randomness</a></li>
  <li><a href="#fit-the-model" id="toc-fit-the-model" class="nav-link" data-scroll-target="#fit-the-model">Fit the model</a></li>
  <li><a href="#make-predictions" id="toc-make-predictions" class="nav-link" data-scroll-target="#make-predictions">Make predictions</a></li>
  <li><a href="#plot-the-predictions-1" id="toc-plot-the-predictions-1" class="nav-link" data-scroll-target="#plot-the-predictions-1">Plot the predictions</a></li>
  <li><a href="#assess-the-model" id="toc-assess-the-model" class="nav-link" data-scroll-target="#assess-the-model">Assess the model</a></li>
  </ul></li>
  <li><a href="#force-positive-predictions" id="toc-force-positive-predictions" class="nav-link" data-scroll-target="#force-positive-predictions">Force positive predictions</a>
  <ul class="collapse">
  <li><a href="#try-running-for-longer" id="toc-try-running-for-longer" class="nav-link" data-scroll-target="#try-running-for-longer">Try running for longer</a></li>
  <li><a href="#loss-curve" id="toc-loss-curve" class="nav-link" data-scroll-target="#loss-curve">Loss curve</a></li>
  <li><a href="#loss-curve-1" id="toc-loss-curve-1" class="nav-link" data-scroll-target="#loss-curve-1">Loss curve</a></li>
  <li><a href="#predictions" id="toc-predictions" class="nav-link" data-scroll-target="#predictions">Predictions</a></li>
  <li><a href="#try-different-activation-functions-1" id="toc-try-different-activation-functions-1" class="nav-link" data-scroll-target="#try-different-activation-functions-1">Try different activation functions</a></li>
  <li><a href="#enforce-positive-outputs-relu" id="toc-enforce-positive-outputs-relu" class="nav-link" data-scroll-target="#enforce-positive-outputs-relu">Enforce positive outputs (ReLU)</a></li>
  <li><a href="#plot-the-predictions-2" id="toc-plot-the-predictions-2" class="nav-link" data-scroll-target="#plot-the-predictions-2">Plot the predictions</a></li>
  <li><a href="#enforce-positive-outputs-mathrmex" id="toc-enforce-positive-outputs-mathrmex" class="nav-link" data-scroll-target="#enforce-positive-outputs-mathrmex">Enforce positive outputs (<span class="math inline">\mathrm{e}^{\,x}</span>)</a></li>
  </ul></li>
  <li><a href="#preprocessing" id="toc-preprocessing" class="nav-link" data-scroll-target="#preprocessing">Preprocessing</a>
  <ul class="collapse">
  <li><a href="#re-scaling-the-inputs" id="toc-re-scaling-the-inputs" class="nav-link" data-scroll-target="#re-scaling-the-inputs">Re-scaling the inputs</a></li>
  <li><a href="#same-model-with-scaled-inputs" id="toc-same-model-with-scaled-inputs" class="nav-link" data-scroll-target="#same-model-with-scaled-inputs">Same model with scaled inputs</a></li>
  <li><a href="#loss-curve-2" id="toc-loss-curve-2" class="nav-link" data-scroll-target="#loss-curve-2">Loss curve</a></li>
  <li><a href="#loss-curve-3" id="toc-loss-curve-3" class="nav-link" data-scroll-target="#loss-curve-3">Loss curve</a></li>
  <li><a href="#predictions-1" id="toc-predictions-1" class="nav-link" data-scroll-target="#predictions-1">Predictions</a></li>
  <li><a href="#comparing-mse-smaller-is-better" id="toc-comparing-mse-smaller-is-better" class="nav-link" data-scroll-target="#comparing-mse-smaller-is-better">Comparing MSE (smaller is better)</a></li>
  <li><a href="#comparing-models-train" id="toc-comparing-models-train" class="nav-link" data-scroll-target="#comparing-models-train">Comparing models (train)</a></li>
  <li><a href="#comparing-models-validation" id="toc-comparing-models-validation" class="nav-link" data-scroll-target="#comparing-models-validation">Comparing models (validation)</a></li>
  </ul></li>
  <li><a href="#early-stopping" id="toc-early-stopping" class="nav-link" data-scroll-target="#early-stopping">Early Stopping</a>
  <ul class="collapse">
  <li><a href="#choosing-when-to-stop-training" id="toc-choosing-when-to-stop-training" class="nav-link" data-scroll-target="#choosing-when-to-stop-training">Choosing when to stop training</a></li>
  <li><a href="#try-early-stopping" id="toc-try-early-stopping" class="nav-link" data-scroll-target="#try-early-stopping">Try early stopping</a></li>
  <li><a href="#loss-curve-4" id="toc-loss-curve-4" class="nav-link" data-scroll-target="#loss-curve-4">Loss curve</a></li>
  <li><a href="#loss-curve-ii" id="toc-loss-curve-ii" class="nav-link" data-scroll-target="#loss-curve-ii">Loss curve II</a></li>
  <li><a href="#predictions-2" id="toc-predictions-2" class="nav-link" data-scroll-target="#predictions-2">Predictions</a></li>
  <li><a href="#comparing-models-validation-1" id="toc-comparing-models-validation-1" class="nav-link" data-scroll-target="#comparing-models-validation-1">Comparing models (validation)</a></li>
  <li><a href="#the-test-set" id="toc-the-test-set" class="nav-link" data-scroll-target="#the-test-set">The test set</a></li>
  <li><a href="#another-useful-callback" id="toc-another-useful-callback" class="nav-link" data-scroll-target="#another-useful-callback">Another useful callback</a></li>
  </ul></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2"></a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="deep-learning-keras.slides.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Lecture-2-Deep-Learning-Keras/deep-learning-keras.html">Module 2</a></li><li class="breadcrumb-item"><a href="../Lecture-2-Deep-Learning-Keras/deep-learning-keras.html">Deep Learning with Keras</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Deep Learning with Keras</h1>
<p class="subtitle lead">ACTL3143 &amp; ACTL5111 Deep Learning for Actuaries</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Patrick Laub </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="lecture-outline" class="level2">
<h2 class="anchored" data-anchor-id="lecture-outline">Lecture Outline</h2>
<ul>
<li>Neural networks</li>
<li>Regression demo with Keras</li>
</ul>
</section>
<section id="deep-learning" class="level1" data-background-size="85%">
<h1 data-background-size="85%">Deep Learning</h1>
<section id="how-do-real-neurons-work" class="level2">
<h2 class="anchored" data-anchor-id="how-do-real-neurons-work">How do real neurons work?</h2>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/6qS83wD29PY" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</section>
<section id="a-neuron-firing" class="level2">
<h2 class="anchored" data-anchor-id="a-neuron-firing">A neuron ‘firing’</h2>
<p>Similar to a biological neuron, an artificial neuron ‘fires’ when the combined input information exceeds a certain threshold. This activation can be seen as a step function. The difference is that the artificial neuron uses mathematical rules (e.g.&nbsp;weighted sum) to ‘fire’ whereas ‘firing’ in the biological neurons is far more complex and dynamic.</p>
<div id="b73c7f08" class="cell" data-execution_count="2">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-3-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="an-artificial-neuron" class="level2">
<h2 class="anchored" data-anchor-id="an-artificial-neuron">An artificial neuron</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="single-neuron.png" class="img-fluid figure-img"></p>
<figcaption>A neuron in a neural network with a ReLU activation.</figcaption>
</figure>
</div>
<p>The figure shows how we first compute the weighted sum of inputs, and then evaluate the summation using the step function. If the weighted sum is greater than the pre-set threshold, the neuron `fires’.</p>
<div class="footer">
<p>Source: Marcus Lautier (2022).</p>
</div>
</section>
<section id="one-neuron" class="level2">
<h2 class="anchored" data-anchor-id="one-neuron">One neuron</h2>
<div class="columns">
<div class="column" style="width:55%;">
<p><span class="math display"> \begin{aligned}
  z~=~&amp;x_1 \times w_1 + \\
    &amp;x_2 \times w_2 + \\
    &amp;x_3 \times w_3 .
  \end{aligned}
</span></p>
<p><span class="math display">
  a = \begin{cases}
    z &amp; \text{if } z &gt; 0 \\
    0 &amp; \text{if } z \leq 0
    \end{cases}
</span></p>
<p>Here, <span class="math inline">x_1</span>, <span class="math inline">x_2</span>, <span class="math inline">x_3</span> is just some fixed data.</p>
</div><div class="column" style="width:45%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="single-neuron.png" class="img-fluid figure-img"></p>
<figcaption>A neuron in a neural network with a ReLU activation.</figcaption>
</figure>
</div>
</div>
</div>
<p>The weights <span class="math inline">w_1</span>, <span class="math inline">w_2</span>, <span class="math inline">w_3</span> should be ‘learned’.</p>
<div class="footer">
<p>Source: Marcus Lautier (2022).</p>
</div>
</section>
<section id="one-neuron-with-bias" class="level2">
<h2 class="anchored" data-anchor-id="one-neuron-with-bias">One neuron with bias</h2>
<p>The bias is a constant term added to the product of inputs and weights. It helps in shifting the entire activation function to either the negative or positive side. This shifting can either accelerate or delay the activation. For example, if the bias is negative, it will shift the entire curve to the right, making the activation harder. This is similar to delaying the activation.</p>
<div class="columns">
<div class="column" style="width:55%;">
<p><span class="math display"> \begin{aligned}
  z~=~&amp;x_1 \times w_1 + \\
    &amp;x_2 \times w_2 + \\
    &amp;x_3 \times w_3 + b .
  \end{aligned}
</span></p>
<p><span class="math display">
  a = \begin{cases}
    z &amp; \text{if } z &gt; 0 \\
    0 &amp; \text{if } z \leq 0
    \end{cases}
</span></p>
<p>The weights <span class="math inline">w_1</span>, <span class="math inline">w_2</span>, <span class="math inline">w_3</span> and bias <span class="math inline">b</span> should be ‘learned’.</p>
</div><div class="column" style="width:45%;">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Bias = -4</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">0</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">4</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div id="c3798f0f" class="cell" data-execution_count="3">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-4-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div id="1b7460ab" class="cell" data-execution_count="4">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-5-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div id="0a900434" class="cell" data-execution_count="5">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-6-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="a-basic-neural-network" class="level2">
<h2 class="anchored" data-anchor-id="a-basic-neural-network">A basic neural network</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="basic-neural-network.png" class="img-fluid figure-img"></p>
<figcaption>A basic fully-connected/dense network.</figcaption>
</figure>
</div>
<p>This neural network consists of an input layer with 2 neurons (<span class="math inline">x_1, x_2</span>), an output layer with 3 neurons, and 1 hidden layer with 4 neurons. Since every neuron is linked to every other neuron, this is called a fully connected neural network. Since we have 2 inputs and 1 bias in the input layer, each neuron in the hidden layer has 2+1=3 parameters to learn. Similarly, there are 4 neurons and 1 bias in the hidden layer. Hence, each neuron in the output layer has 4+1=5 parameters to learn.</p>
<div class="footer">
<p>Source: Marcus Lautier (2022).</p>
</div>
</section>
<section id="step-function-activation" class="level2">
<h2 class="anchored" data-anchor-id="step-function-activation">Step-function activation</h2>
<section id="perceptrons" class="level3">
<h3 class="anchored" data-anchor-id="perceptrons">Perceptrons</h3>
<p>Brains and computers are binary, so make a perceptron with binary data. Seemed reasonable, impossible to train.</p>
</section>
<section id="modern-neural-network" class="level3">
<h3 class="anchored" data-anchor-id="modern-neural-network">Modern neural network</h3>
<p>Replace binary state with continuous state. Still rather slow to train.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>It’s a neur<strong>al</strong> network made of neur<strong>on</strong>s, not a “neuron network”.</p>
</div>
</div>
</section>
</section>
<section id="try-different-activation-functions" class="level2">
<h2 class="anchored" data-anchor-id="try-different-activation-functions">Try different activation functions</h2>
<div id="b74fc0e5" class="cell" data-execution_count="6">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-7-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Activation functions are essential for a neural network design. They provide the mathematical rule for ‘firing’ the neuron. There are many activation functions, and the choice of the activation function depends on the problem we are trying to solve. Note: If we use the ‘linear’ activation function at every neuron, then the regression learning problem becomes a simple linear regression. But if we use ‘ReLu’, ‘tanh’, or any other non-linear function, then, we can introduce non-linearity into the model so that the model can learn complex non-linear patterns in the data. There are activation functions in both the hidden layers and the output layer. The activation function in the hidden layer controls how the neural network learns complex non-linear patterns in the training data. The choice of activation function in the output layer determines the type of predictions we get.</p>
</section>
<section id="flexible" class="level2">
<h2 class="anchored" data-anchor-id="flexible">Flexible</h2>
<blockquote class="blockquote">
<p>One can show that an MLP is a <strong>universal approximator</strong>, meaning it can model any suitably smooth function, given enough hidden units, to any desired level of accuracy (Hornik 1991). One can either make the model be “wide” or “deep”; the latter has some advantages…</p>
</blockquote>
<div class="footer">
<p>Source: Murphy (2012), Machine Learning: A Probabilistic Perspective, 1st Ed, p.&nbsp;566.</p>
</div>
</section>
<section id="feature-engineering" class="level2">
<h2 class="anchored" data-anchor-id="feature-engineering">Feature engineering</h2>
<div class="columns">
<div class="column" style="width:55%;">
<p><img src="feature-engineering.png" class="img-fluid"></p>
</div><div class="column" style="width:45%;">
<p><img src="facial-recognition.jpeg" class="img-fluid"> <img src="modelling-ratio.png" class="img-fluid"></p>
</div>
</div>
<p>A major part of traditional machine learning (TML) involves conducting feature engineering to extract relevant features manually. In contrast, representational learning does not involve heavy manual feature engineering, rather, it learns relevant features automatically from data during the task. Therefore, the effort spent on feature engineering in representational learning is minimal compared to TML.</p>
<div class="footer">
<p>Sources: Marcus Lautier (2022) &amp; Fenjiro (2019), <a href="https://medium.com/@fenjiro/face-id-deep-learning-for-face-recognition-324b50d916d1"><em>Face Id: Deep Learning for Face Recognition</em></a>, Medium.</p>
</div>
</section>
<section id="the-deep-learning-hammer" class="level2">
<h2 class="anchored" data-anchor-id="the-deep-learning-hammer">The deep learning hammer</h2>
<p>Deep learning is not always the answer!</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data-science-map.png" class="img-fluid figure-img"></p>
<figcaption>The map of data science.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Serge Masis (2022), <a href="https://www.serg.ai">LinkedIn post</a>.</p>
</div>
</section>
<section id="quiz" class="level2">
<h2 class="anchored" data-anchor-id="quiz">Quiz</h2>
<p>In this ANN, how many of the following are there:</p>
<div class="columns">
<div class="column" style="width:32%;">
<ul>
<li>features,</li>
<li>targets,</li>
<li>weights,</li>
<li>biases, and</li>
<li>parameters?</li>
</ul>
<p>What is the depth?</p>
</div><div class="column" style="width:68%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="neural-network-circles.png" class="img-fluid figure-img"></p>
<figcaption>An artificial neural network.</figcaption>
</figure>
</div>
</div>
</div>
<p>There are three inputs, hence, three features. There is one neuron in the output layer, hence, one target. There are <span class="math inline">3 \times 4 + 4 \times 4 + 4\times 1 = 32</span> arrows, hence, there are 32 weights in total. Since there is 1 bias for each neuron, there are 9 biases in total. The number of total parameters to learn equals to the sum of weights and biases, hence, there are <span class="math inline">32+9=41</span> parameters in total.</p>
<div class="footer">
<p>Source: Dertat (2017), <a href="https://towardsdatascience.com/applied-deep-learning-part-1-artificial-neural-networks-d7834f67a4f6"><em>Applied Deep Learning - Part 1: Artificial Neural Networks</em></a>, Medium.</p>
</div>
</section>
</section>
<section id="california-house-price-prediction" class="level1" data-visibility="uncounted">
<h1 data-visibility="uncounted">California House Price Prediction</h1>
<section id="import-the-data" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="import-the-data">Import the data</h2>
<div id="10d672bd" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="annotated-cell-1"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-1-1" class="code-annotation-target"><a href="#annotated-cell-1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.datasets <span class="im">import</span> fetch_california_housing</span>
<span id="annotated-cell-1-2"><a href="#annotated-cell-1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-1-3"><a href="#annotated-cell-1-3" aria-hidden="true" tabindex="-1"></a>features, target <span class="op">=</span> fetch_california_housing(</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-1-4" class="code-annotation-target"><a href="#annotated-cell-1-4" aria-hidden="true" tabindex="-1"></a>    as_frame<span class="op">=</span><span class="va">True</span>, return_X_y<span class="op">=</span><span class="va">True</span>)</span>
<span id="annotated-cell-1-5"><a href="#annotated-cell-1-5" aria-hidden="true" tabindex="-1"></a>features                                                                        </span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-1" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="1" data-code-annotation="1">Imports California house prices from <code>sklearn.datasets</code> library</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="4" data-code-annotation="2">Assigns features and target from the dataset to two variables ‘features’ and ‘target’ and returns two separate data frames. The command <code>return_X_y=True</code> ensures that there will be two separate data frames, one for the features and the other for the target</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">MedInc</th>
<th data-quarto-table-cell-role="th">HouseAge</th>
<th data-quarto-table-cell-role="th">AveRooms</th>
<th data-quarto-table-cell-role="th">AveBedrms</th>
<th data-quarto-table-cell-role="th">Population</th>
<th data-quarto-table-cell-role="th">AveOccup</th>
<th data-quarto-table-cell-role="th">Latitude</th>
<th data-quarto-table-cell-role="th">Longitude</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>8.3252</td>
<td>41.0</td>
<td>6.984127</td>
<td>1.023810</td>
<td>322.0</td>
<td>2.555556</td>
<td>37.88</td>
<td>-122.23</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>8.3014</td>
<td>21.0</td>
<td>6.238137</td>
<td>0.971880</td>
<td>2401.0</td>
<td>2.109842</td>
<td>37.86</td>
<td>-122.22</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>7.2574</td>
<td>52.0</td>
<td>8.288136</td>
<td>1.073446</td>
<td>496.0</td>
<td>2.802260</td>
<td>37.85</td>
<td>-122.24</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20637</td>
<td>1.7000</td>
<td>17.0</td>
<td>5.205543</td>
<td>1.120092</td>
<td>1007.0</td>
<td>2.325635</td>
<td>39.43</td>
<td>-121.22</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20638</td>
<td>1.8672</td>
<td>18.0</td>
<td>5.329513</td>
<td>1.171920</td>
<td>741.0</td>
<td>2.123209</td>
<td>39.43</td>
<td>-121.32</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20639</td>
<td>2.3886</td>
<td>16.0</td>
<td>5.254717</td>
<td>1.162264</td>
<td>1387.0</td>
<td>2.616981</td>
<td>39.37</td>
<td>-121.24</td>
</tr>
</tbody>
</table>

<p>20640 rows × 8 columns</p>
</div>
</div>
</div>
</section>
<section id="what-is-the-target" class="level2">
<h2 class="anchored" data-anchor-id="what-is-the-target">What is the target?</h2>
<div id="08efbd0b" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>target</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>0        4.526
1        3.585
2        3.521
         ...  
20637    0.923
20638    0.847
20639    0.894
Name: MedHouseVal, Length: 20640, dtype: float64</code></pre>
</div>
</div>
</section>
<section id="the-dataset" class="level2">
<h2 class="anchored" data-anchor-id="the-dataset">The dataset</h2>
<blockquote class="blockquote">
<p>The target variable is the median house value for California districts, expressed in hundreds of thousands of dollars ($100,000).</p>
<p>This dataset was derived from the 1990 U.S. census, using one row per census block group. A block group is the smallest geographical unit for which the U.S. Census Bureau publishes sample data (a block group typically has a population of 600 to 3,000 people).</p>
</blockquote>
<div class="footer">
<p>Source: <a href="https://scikit-learn.org/stable/datasets/real_world.html#california-housing-dataset">Scikit-learn documentation</a>.</p>
</div>
</section>
<section id="columns" class="level2">
<h2 class="anchored" data-anchor-id="columns">Columns</h2>
<ul>
<li><code>MedInc</code> median income in block group</li>
<li><code>HouseAge</code> median house age in block group</li>
<li><code>AveRooms</code> average number of rooms per household</li>
<li><code>AveBedrms</code> average # of bedrooms per household</li>
<li><code>Population</code> block group population</li>
<li><code>AveOccup</code> average number of household members</li>
<li><code>Latitude</code> block group latitude</li>
<li><code>Longitude</code> block group longitude</li>
</ul>
<div class="footer">
<p>Source: <a href="https://scikit-learn.org/stable/datasets/real_world.html#california-housing-dataset">Scikit-learn documentation</a>.</p>
</div>
</section>
<section id="an-entire-ml-project" class="level2">
<h2 class="anchored" data-anchor-id="an-entire-ml-project">An entire ML project</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ml-lifecycle.png" class="img-fluid figure-img"></p>
<figcaption>ML life cycle</figcaption>
</figure>
</div>
<p>The course focuses more on the modelling part of the life cycle.</p>
<div class="footer">
<p>Source: Actuaries Institute, <a href="https://dodatabetter.com.au/wp-content/uploads/2023/02/Advantage-Graph_1.mp4">Do Data Better</a>.</p>
</div>
</section>
<section id="questions-to-answer-in-ml-project" class="level2">
<h2 class="anchored" data-anchor-id="questions-to-answer-in-ml-project">Questions to answer in ML project</h2>
<p>You fit a few models to the training set, then ask:</p>
<ol type="1">
<li><strong>(Selection)</strong> Which of these models is the best?</li>
<li><strong>(Future Performance)</strong> How good should we expect the final model to be on unseen data?</li>
</ol>
</section>
<section id="set-aside-a-fraction-for-a-test-set" class="level2">
<h2 class="anchored" data-anchor-id="set-aside-a-fraction-for-a-test-set">Set aside a fraction for a test set</h2>
<div id="c05e9aaf" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="annotated-cell-3"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-3-1" class="code-annotation-target"><a href="#annotated-cell-3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="annotated-cell-3-2"><a href="#annotated-cell-3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-3-3"><a href="#annotated-cell-3-3" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="annotated-cell-3-4"><a href="#annotated-cell-3-4" aria-hidden="true" tabindex="-1"></a>    features, target, random_state<span class="op">=</span><span class="dv">42</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-3-5" class="code-annotation-target"><a href="#annotated-cell-3-5" aria-hidden="true" tabindex="-1"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-3" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="1" data-code-annotation="1">Imports <code>train_test_split</code> class from <code>sklearn.model_selection</code> library</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="5" data-code-annotation="2">Splits the dataset into train and the test sets</span>
</dd>
</dl>
</div>
</div>
<p>First, we split the data into the train set and the test set using a random selection. By defining the random state, using the <code>random_state=42</code> command, we can ensure that the split is reproducible. We set aside the test data, assuming it represents new, unseen data. Then, we fit many models on the train data and select the one with the lowest train error. Thereafter we assess the performance of that model using the unseen test data.</p>
<div class="columns">
<div class="column" style="width:70%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heaton-train-test-split.png" class="img-fluid figure-img"></p>
<figcaption>Illustration of a typical training/test split.</figcaption>
</figure>
</div>
<div class="smaller">
<p>Note: Compare <code>X_</code>/<code>y_</code> names, capitals &amp; lowercase.</p>
</div>
</div><div class="column" style="width:30%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="scikit-learn-what-is-my-purpose.png" class="img-fluid figure-img"></p>
<figcaption>Our use of sklearn.</figcaption>
</figure>
</div>
</div>
</div>
<div class="footer">
<p>Adapted from: Heaton (2022), <a href="https://github.com/jeffheaton/t81_558_deep_learning/blob/e4bdc124b0c45b592d9bdbed0d2ef6c63c0245d6/t81_558_class_02_1_python_pandas.ipynb">Applications of Deep Learning</a>, Part 2.1: Introduction to Pandas, and <a href="https://journeys.dartmouth.edu/folklorearchive/2020/06/03/purpose-of-scikit-learn-is-to-split-the-data/">this random site</a>.</p>
</div>
</section>
<section id="basic-ml-workflow" class="level2">
<h2 class="anchored" data-anchor-id="basic-ml-workflow">Basic ML workflow</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="wiki-ML_dataset_training_validation_test_sets.png" class="img-fluid figure-img"></p>
<figcaption>Splitting the data.</figcaption>
</figure>
</div>
<ol type="1">
<li>For each model, fit it to the <em>training set</em>.</li>
<li>Compute the error for each model on the <em>validation set</em>.</li>
<li>Select the model with the lowest validation error.</li>
<li>Compute the error of the final model on the <em>test set</em>.</li>
</ol>
<div class="footer">
<p>Source: <a href="https://commons.wikimedia.org/wiki/File:ML_dataset_training_validation_test_sets.png#filelinks">Wikipedia</a>.</p>
</div>
</section>
<section id="split-three-ways" class="level2">
<h2 class="anchored" data-anchor-id="split-three-ways">Split three ways</h2>
<div id="126de40a" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="annotated-cell-4"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-4-1"><a href="#annotated-cell-4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Thanks https://datascience.stackexchange.com/a/15136</span></span>
<span id="annotated-cell-4-2"><a href="#annotated-cell-4-2" aria-hidden="true" tabindex="-1"></a>X_main, X_test, y_main, y_test <span class="op">=</span> train_test_split(</span>
<span id="annotated-cell-4-3"><a href="#annotated-cell-4-3" aria-hidden="true" tabindex="-1"></a>    features, target, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">1</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-4-4" class="code-annotation-target"><a href="#annotated-cell-4-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="annotated-cell-4-5"><a href="#annotated-cell-4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-4-6"><a href="#annotated-cell-4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># As 0.25 x 0.8 = 0.2</span></span>
<span id="annotated-cell-4-7"><a href="#annotated-cell-4-7" aria-hidden="true" tabindex="-1"></a>X_train, X_val, y_train, y_val <span class="op">=</span> train_test_split(</span>
<span id="annotated-cell-4-8"><a href="#annotated-cell-4-8" aria-hidden="true" tabindex="-1"></a>    X_main, y_main, test_size<span class="op">=</span><span class="fl">0.25</span>, random_state<span class="op">=</span><span class="dv">1</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-4-9" class="code-annotation-target"><a href="#annotated-cell-4-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="annotated-cell-4-10"><a href="#annotated-cell-4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-4-11"><a href="#annotated-cell-4-11" aria-hidden="true" tabindex="-1"></a>X_train.shape, X_val.shape, X_test.shape</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-4" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="4" data-code-annotation="1">Splits the entire dataset into two parts. Sets aside <span class="math inline">20\%</span> of the data as the test set.</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="9" data-code-annotation="2">Splits the first <span class="math inline">80\%</span> of the data (<code>X_main</code> and <code>y_main</code>) further into train and validation sets. Sets aside <span class="math inline">25\%</span> as the validation set</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>((12384, 8), (4128, 8), (4128, 8))</code></pre>
</div>
</div>
<p>This results in <span class="math inline">60:20:20</span> three way split. While this is not a strict rule, it is widely used.</p>
</section>
<section id="why-not-use-test-set-for-both" class="level2">
<h2 class="anchored" data-anchor-id="why-not-use-test-set-for-both">Why not use test set for both?</h2>
<p><em>Thought experiment</em>: have <span class="math inline">m</span> classifiers: <span class="math inline">f_1(\mathbf{x})</span>, <span class="math inline">\dots</span>, <span class="math inline">f_m(\mathbf{x})</span>.</p>
<p>They are just as good as each other in the long run <span class="math display">
\mathbb{P}(\, f_i(\mathbf{X}) = Y \,)\ =\ 90\% , \quad \text{for } i=1,\dots,m .
</span></p>
<div class="columns">
<div class="column" style="width:40%;">
<p>Evaluate each model on the test set, some will be better than others.</p>
</div><div class="column" style="width:60%;">
<div id="abf6681b" class="cell" data-execution_count="11">
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_13650/4029235944.py:7: UserWarning: 

`distplot` is a deprecated function and will be removed in seaborn v0.14.0.

Please adapt your code to use either `displot` (a figure-level function with
similar flexibility) or `histplot` (an axes-level function for histograms).

For a guide to updating your code to use the new functions, please see
https://gist.github.com/mwaskom/de44147ed2974457ad6372750bbe5751

  seaborn.distplot(x)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-12-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>Take the best, you’d think it has <span class="math inline">\approx 98\%</span> accuracy!</p>
<p>Using the same dataset for both validating and testing purposes can result in a data leakage. The information from supposedly ‘unseen’ data is now used by the model during its tuning. This results in a situation where the model is now ‘learning’ from the test data, and it could lead to overly optimistic results in the model evaluation stage.</p>
</section>
</section>
<section id="eda-baseline-model" class="level1" data-background-image="unsw-yellow-shape.png" data-visibility="uncounted">
<h1 data-background-image="unsw-yellow-shape.png" data-visibility="uncounted">EDA &amp; Baseline Model</h1>
<section id="the-training-set" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="the-training-set">The training set</h2>
<div id="e2a8a13a" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>X_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">MedInc</th>
<th data-quarto-table-cell-role="th">HouseAge</th>
<th data-quarto-table-cell-role="th">AveRooms</th>
<th data-quarto-table-cell-role="th">AveBedrms</th>
<th data-quarto-table-cell-role="th">Population</th>
<th data-quarto-table-cell-role="th">AveOccup</th>
<th data-quarto-table-cell-role="th">Latitude</th>
<th data-quarto-table-cell-role="th">Longitude</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">9107</td>
<td>4.1573</td>
<td>19.0</td>
<td>6.162630</td>
<td>1.048443</td>
<td>1677.0</td>
<td>2.901384</td>
<td>34.63</td>
<td>-118.18</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13999</td>
<td>0.4999</td>
<td>10.0</td>
<td>6.740000</td>
<td>2.040000</td>
<td>108.0</td>
<td>2.160000</td>
<td>34.69</td>
<td>-116.90</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5610</td>
<td>2.0458</td>
<td>27.0</td>
<td>3.619048</td>
<td>1.062771</td>
<td>1723.0</td>
<td>3.729437</td>
<td>33.78</td>
<td>-118.26</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8539</td>
<td>4.0727</td>
<td>18.0</td>
<td>3.957845</td>
<td>1.079625</td>
<td>2276.0</td>
<td>2.665105</td>
<td>33.90</td>
<td>-118.36</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2155</td>
<td>2.3190</td>
<td>41.0</td>
<td>5.366265</td>
<td>1.113253</td>
<td>1129.0</td>
<td>2.720482</td>
<td>36.78</td>
<td>-119.79</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13351</td>
<td>5.5632</td>
<td>9.0</td>
<td>7.241087</td>
<td>0.996604</td>
<td>2280.0</td>
<td>3.870968</td>
<td>34.02</td>
<td>-117.62</td>
</tr>
</tbody>
</table>

<p>12384 rows × 8 columns</p>
</div>
</div>
</div>
</section>
<section id="location" class="level2">
<h2 class="anchored" data-anchor-id="location">Location</h2>
<p>Python’s <code>matplotlib</code> package <span class="math inline">\approx</span> R’s basic <code>plot</code>s.</p>
<div id="62935d82" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(features[<span class="st">"Longitude"</span>], features[<span class="st">"Latitude"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-14-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="location-2" class="level2">
<h2 class="anchored" data-anchor-id="location-2">Location #2</h2>
<p>Python’s <code>seaborn</code> package <span class="math inline">\approx</span> R’s <code>ggplot2</code>.</p>
<div id="a0d20097" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span><span class="st">"Longitude"</span>, y<span class="op">=</span><span class="st">"Latitude"</span>, data<span class="op">=</span>features)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-15-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="features" class="level2">
<h2 class="anchored" data-anchor-id="features">Features</h2>
<div id="7b38ae0d" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">list</span>(features.columns))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['MedInc', 'HouseAge', 'AveRooms', 'AveBedrms', 'Population', 'AveOccup', 'Latitude', 'Longitude']</code></pre>
</div>
</div>
<p>How many?</p>
<div id="b186dc06" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>num_features <span class="op">=</span> <span class="bu">len</span>(features.columns)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>num_features</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>8</code></pre>
</div>
</div>
<p>Or</p>
<div id="34576fe8" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>num_features <span class="op">=</span> features.shape[<span class="dv">1</span>]</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>features.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>(20640, 8)</code></pre>
</div>
</div>
</section>
<section id="linear-regression" class="level2">
<h2 class="anchored" data-anchor-id="linear-regression">Linear Regression</h2>
<p><span class="math display"> \hat{y} = w_0 + \sum_{i=1}^N w_i x_i .</span></p>
<div id="6193ba32" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="annotated-cell-11"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-11-1" class="code-annotation-target"><a href="#annotated-cell-11-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="annotated-cell-11-2"><a href="#annotated-cell-11-2" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-11-3" class="code-annotation-target"><a href="#annotated-cell-11-3" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> LinearRegression()</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-11-4" class="code-annotation-target"><a href="#annotated-cell-11-4" aria-hidden="true" tabindex="-1"></a>lr.fit(X_train, y_train)<span class="op">;</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-11" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="1" data-code-annotation="1">Imports the <code>LinearRegression</code> class from the <code>sklearn.linear_model</code> module</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="3" data-code-annotation="2">Defines the object <code>lr</code> which represents the linear regression function</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="4" data-code-annotation="3">Fits a linear regression model using train data. <code>lr.fit</code> computes the coefficients of the regression model</span>
</dd>
</dl>
</div>
</div>
<p>The <span class="math inline">w_0</span> is in <code>lr.intercept_</code> and the others are in</p>
<div id="a028ca6f" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lr.coef_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[ 4.34267965e-01  9.88284781e-03 -9.39592954e-02  5.86373944e-01
 -1.58360948e-06 -3.59968968e-03 -4.26013498e-01 -4.41779336e-01]</code></pre>
</div>
</div>
</section>
<section id="make-some-predictions" class="level2">
<h2 class="anchored" data-anchor-id="make-some-predictions">Make some predictions</h2>
<div id="cc6fa2bd" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>X_train.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">MedInc</th>
<th data-quarto-table-cell-role="th">HouseAge</th>
<th data-quarto-table-cell-role="th">AveRooms</th>
<th data-quarto-table-cell-role="th">AveBedrms</th>
<th data-quarto-table-cell-role="th">Population</th>
<th data-quarto-table-cell-role="th">AveOccup</th>
<th data-quarto-table-cell-role="th">Latitude</th>
<th data-quarto-table-cell-role="th">Longitude</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">9107</td>
<td>4.1573</td>
<td>19.0</td>
<td>6.162630</td>
<td>1.048443</td>
<td>1677.0</td>
<td>2.901384</td>
<td>34.63</td>
<td>-118.18</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13999</td>
<td>0.4999</td>
<td>10.0</td>
<td>6.740000</td>
<td>2.040000</td>
<td>108.0</td>
<td>2.160000</td>
<td>34.69</td>
<td>-116.90</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5610</td>
<td>2.0458</td>
<td>27.0</td>
<td>3.619048</td>
<td>1.062771</td>
<td>1723.0</td>
<td>3.729437</td>
<td>33.78</td>
<td>-118.26</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><code>X_train.head(3)</code> returns the first three rows of the dataset <i>X_train</i>.</p>
<div id="4907d915" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> lr.predict(X_train.head(<span class="dv">3</span>))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>y_pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>array([1.81699287, 0.0810446 , 1.62089363])</code></pre>
</div>
</div>
<p><code>lr.predict(X_train.head(3))</code> returns the predictions for the first three rows of the dataset <i>X_train</i>.</p>
<p>We can manually calculate predictions using the linear regression model to verify the output of the <code>lr.predict()</code> function. In the following code, we first define <span class="math inline">w_0</span> as the intercept of the <code>lr</code> function (initial value for the prediction calculation), and then keep on adding the <span class="math inline">w_i \times x_i</span> terms</p>
<div id="ceb72a00" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="annotated-cell-15"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-15-1" class="code-annotation-target"><a href="#annotated-cell-15-1" aria-hidden="true" tabindex="-1"></a>prediction <span class="op">=</span> lr.intercept_</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-15-2" class="code-annotation-target"><a href="#annotated-cell-15-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> w_i, x_i <span class="kw">in</span> <span class="bu">zip</span>(lr.coef_, X_train.iloc[<span class="dv">0</span>]):</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-15-3" class="code-annotation-target"><a href="#annotated-cell-15-3" aria-hidden="true" tabindex="-1"></a>    prediction <span class="op">+=</span> w_i <span class="op">*</span> x_i</span>
<span id="annotated-cell-15-4"><a href="#annotated-cell-15-4" aria-hidden="true" tabindex="-1"></a>prediction                                              </span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-15" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="1" data-code-annotation="1">Specifies the value of the intercept from the fitted regression as <code>prediction</code></span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="2" data-code-annotation="2">Iterates over the first observation from the train data (<code>X_train</code>) and the corresponding weight coefficients from the fitted linear regression</span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="3" data-code-annotation="3">Updates the prediction value</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>1.8169928680677785</code></pre>
</div>
</div>
</section>
<section id="plot-the-predictions" class="level2">
<h2 class="anchored" data-anchor-id="plot-the-predictions">Plot the predictions</h2>
<div class="columns">
<div class="column">
<div id="4151ec11" class="cell" data-execution_count="24">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-25-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div><div class="column">
<div id="1f622c83" class="cell" data-execution_count="25">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-26-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>We can see how both plots have a dispersion to either sides of the fitted line.</p>
</section>
<section id="calculate-mean-squared-error" class="level2">
<h2 class="anchored" data-anchor-id="calculate-mean-squared-error">Calculate mean squared error</h2>
<div id="b04bd142" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> lr.predict(X_train)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">"Predictions"</span>: y_pred, <span class="st">"True values"</span>: y_train})</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"Squared Error"</span>] <span class="op">=</span> (df[<span class="st">"Predictions"</span>] <span class="op">-</span> df[<span class="st">"True values"</span>]) <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Predictions</th>
<th data-quarto-table-cell-role="th">True values</th>
<th data-quarto-table-cell-role="th">Squared Error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">9107</td>
<td>1.816993</td>
<td>2.281</td>
<td>0.215303</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13999</td>
<td>0.081045</td>
<td>0.550</td>
<td>0.219919</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5610</td>
<td>1.620894</td>
<td>1.745</td>
<td>0.015402</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13533</td>
<td>1.168949</td>
<td>1.199</td>
<td>0.000903</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="9a49d890" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"Squared Error"</span>].mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>0.5291948207479792</code></pre>
</div>
</div>
</section>
<section id="using-mean_squared_error" class="level2">
<h2 class="anchored" data-anchor-id="using-mean_squared_error">Using <code>mean_squared_error</code></h2>
<div id="932707e4" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"Squared Error"</span>].mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>0.5291948207479792</code></pre>
</div>
</div>
<p>We can compute the mean squared error to evaluate, on average, the accuracy of the predictions. To do this, we first create a data frame using pandas <code>DataFrame</code> function. It will have two columns, one with the predicted values and the other with the actual values. Next, we add another column to the same data frame using <code>df["Squared Error"]</code> that computes and stores the squared error for each row. Using the function <code>df["Squared Error"].mean()</code>, we extract the column ‘Squared Error’ from the data frame ‘df’ and calculate the ‘mean’.</p>
<div id="9b308d0f" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error <span class="im">as</span> mse</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>mse(y_train, y_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>0.5291948207479792</code></pre>
</div>
</div>
<p>We can also use the function <code>mean_squared_error</code> from <code>sklearn.metrics</code> library to calculate the same.</p>
<p>Store the results in a dictionary:</p>
<div id="a988bd85" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>mse_lr_train <span class="op">=</span> mse(y_train, lr.predict(X_train))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>mse_lr_val <span class="op">=</span> mse(y_val, lr.predict(X_val))</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>mse_train <span class="op">=</span> {<span class="st">"Linear Regression"</span>: mse_lr_train}</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>mse_val <span class="op">=</span> {<span class="st">"Linear Regression"</span>: mse_lr_val}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Storing results in data structures like dictionaries is a good practice that can help in managing and handling data efficiently.</p>
</section>
</section>
<section id="our-first-neural-network" class="level1" data-visibility="uncounted">
<h1 data-visibility="uncounted">Our First Neural Network</h1>
<section id="what-are-keras-and-tensorflow" class="level2">
<h2 class="anchored" data-anchor-id="what-are-keras-and-tensorflow">What are Keras and TensorFlow?</h2>
<p>Keras is common way of specifying, training, and using neural networks. It gives a simple interface to <em>various backend</em> libraries, including Tensorflow.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Geron-mls2_1010.png" class="img-fluid figure-img"></p>
<figcaption>Keras as a independent interface, and Keras as part of Tensorflow.</figcaption>
</figure>
</div>
<div class="footer">
<p>Source: Aurélien Géron (2019), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, Figure 10-10.</p>
</div>
</section>
<section id="create-a-keras-ann-model" class="level2">
<h2 class="anchored" data-anchor-id="create-a-keras-ann-model">Create a Keras ANN model</h2>
<p>Decide on the architecture: a simple fully-connected network with one hidden layer with 30 neurons.</p>
<p>Create the model:</p>
<div id="23af5f7d" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="annotated-cell-21"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-21" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-21-1" class="code-annotation-target"><a href="#annotated-cell-21-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.models <span class="im">import</span> Sequential</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-21" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-21-2" class="code-annotation-target"><a href="#annotated-cell-21-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.layers <span class="im">import</span> Dense, Input</span>
<span id="annotated-cell-21-3"><a href="#annotated-cell-21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-21-4"><a href="#annotated-cell-21-4" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential(</span>
<span id="annotated-cell-21-5"><a href="#annotated-cell-21-5" aria-hidden="true" tabindex="-1"></a>    [Input((num_features,)),</span>
<span id="annotated-cell-21-6"><a href="#annotated-cell-21-6" aria-hidden="true" tabindex="-1"></a>     Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"relu"</span>),</span>
<span id="annotated-cell-21-7"><a href="#annotated-cell-21-7" aria-hidden="true" tabindex="-1"></a>     Dense(<span class="dv">1</span>)]</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-21" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-21-8" class="code-annotation-target"><a href="#annotated-cell-21-8" aria-hidden="true" tabindex="-1"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-21" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-21" data-code-lines="1" data-code-annotation="1">Imports <code>Sequential</code> from <code>keras.models</code></span>
</dd>
<dt data-target-cell="annotated-cell-21" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-21" data-code-lines="2" data-code-annotation="2">Imports <code>Dense</code> from <code>keras.layers</code></span>
</dd>
<dt data-target-cell="annotated-cell-21" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-21" data-code-lines="8" data-code-annotation="3">Defines the model architecture using <code>Sequential()</code> function</span>
</dd>
</dl>
</div>
</div>
<p>This neural network architecture includes one hidden layer with 30 neurons and an output layer with 1 neuron. While there is an activation function specified (<code>relu</code>) for the hidden layer, there is no activation function specified for the output layer. In situations where there is no specification, the output layer assumes a <code>linear</code> activation.</p>
</section>
<section id="inspect-the-model" class="level2">
<h2 class="anchored" data-anchor-id="inspect-the-model">Inspect the model</h2>
<div id="0e518977" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>model.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Model: "sequential"</span>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> Layer (type)                    </span>┃<span style="font-weight: bold"> Output Shape              </span>┃<span style="font-weight: bold">    Param # </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━┩
│ dense (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                   │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">30</span>)                │        <span style="color: #00af00; text-decoration-color: #00af00">270</span> │
├─────────────────────────────────┼───────────────────────────┼────────────┤
│ dense_1 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                 │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">1</span>)                 │         <span style="color: #00af00; text-decoration-color: #00af00">31</span> │
└─────────────────────────────────┴───────────────────────────┴────────────┘
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Total params: </span><span style="color: #00af00; text-decoration-color: #00af00">301</span> (1.18 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">301</span> (1.18 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Non-trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">0</span> (0.00 B)
</pre>
</div>
</div>
</section>
<section id="the-model-is-initialised-randomly" class="level2">
<h2 class="anchored" data-anchor-id="the-model-is-initialised-randomly">The model is initialised randomly</h2>
<div id="5093719c" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential([Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"relu"</span>), Dense(<span class="dv">1</span>)])</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>model.predict(X_val.head(<span class="dv">3</span>), verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>array([[-737.19183],
       [-446.8675 ],
       [ -20.18185]], dtype=float32)</code></pre>
</div>
</div>
<div id="52abb6b9" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential([Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"relu"</span>), Dense(<span class="dv">1</span>)])</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>model.predict(X_val.head(<span class="dv">3</span>), verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>array([[-566.09283 ],
       [-336.90277 ],
       [ -35.532364]], dtype=float32)</code></pre>
</div>
</div>
<p>We can see how rerunning the same code with the same input data results in significantly different predictions. This is due to the random initialization.</p>
</section>
<section id="controlling-the-randomness" class="level2">
<h2 class="anchored" data-anchor-id="controlling-the-randomness">Controlling the randomness</h2>
<div id="21979aa0" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1"></a><span class="im">import</span> random</span>
<span id="cb33-2"><a href="#cb33-2"></a></span>
<span id="cb33-3"><a href="#cb33-3"></a>random.seed(<span class="dv">123</span>)</span>
<span id="cb33-4"><a href="#cb33-4"></a></span>
<span id="cb33-5"><a href="#cb33-5"></a>model <span class="op">=</span> Sequential([Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"relu"</span>), Dense(<span class="dv">1</span>)])</span>
<span id="cb33-6"><a href="#cb33-6"></a></span>
<span id="cb33-7"><a href="#cb33-7"></a>display(model.predict(X_val.head(<span class="dv">3</span>), verbose<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb33-8"><a href="#cb33-8"></a></span>
<span id="cb33-9"><a href="#cb33-9"></a>random.seed(<span class="dv">123</span>)</span>
<span id="cb33-10"><a href="#cb33-10"></a>model <span class="op">=</span> Sequential([Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"relu"</span>), Dense(<span class="dv">1</span>)])</span>
<span id="cb33-11"><a href="#cb33-11"></a></span>
<span id="cb33-12"><a href="#cb33-12"></a>display(model.predict(X_val.head(<span class="dv">3</span>), verbose<span class="op">=</span><span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([[-513.13403 ],
       [-302.182   ],
       [ -17.794556]], dtype=float32)</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>array([[-513.13403 ],
       [-302.182   ],
       [ -17.794556]], dtype=float32)</code></pre>
</div>
</div>
<p>By setting the seed, we can control for the randomness.</p>
</section>
<section id="fit-the-model" class="level2">
<h2 class="anchored" data-anchor-id="fit-the-model">Fit the model</h2>
<div id="ef218a8d" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">123</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential([</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"relu"</span>),</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    Dense(<span class="dv">1</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(<span class="st">"adam"</span>, <span class="st">"mse"</span>)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>time hist <span class="op">=</span> model.fit(X_train, y_train, epochs<span class="op">=</span><span class="dv">5</span>, verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>hist.history[<span class="st">"loss"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 2.91 s, sys: 16.2 ms, total: 2.92 s
Wall time: 2.92 s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>[1294.4464111328125,
 2.6999993324279785,
 1.6647465229034424,
 1.4132969379425049,
 1.031407356262207]</code></pre>
</div>
</div>
<p>The above code explains how we would fit a basic neural network. First, we define the seed for reproducibility. Next, we define the architecture of the model. Thereafter, we compile the model. Compiling involves giving instructions on how we want the model to be trained. At the least, we must define the optimizer and loss function. The optimizer explains how the model should learn (how the model should update the weights), and the loss function states the objective that the model needs to optimize. In the above code, we use <code>adam</code> as the optimizer and <code>mse</code> (mean squared error) as the loss function. After compilation, we fit the model. The <code>fit()</code> function takes in the training data, and runs the entire dataset through 5 epochs before training completes. What this means is that the model is run through the entire dataset 5 times. Suppose we start the training process with the random initialization, run the model through the entire data, calculate the <code>mse</code> (after 1 epoch), and update the weights using the <code>adam</code> optimizer. Then we run the model through the entire dataset once again with the updated weights, to calculate the <code>mse</code> at the end of the second epoch. Likewise, we would run the model 5 times before the training completes. <code>hist.history()</code> function returns the calculate <code>mse</code> at each step.</p>
<p><br></p>
<p><code>%time</code> command computes and prints the amount of time spend on training. By setting <code>verbose=False</code> we can avoid printing of intermediate results during training. Setting <code>verbose=True</code> is useful when we want to observe how the neural network is training.</p>
</section>
<section id="make-predictions" class="level2">
<h2 class="anchored" data-anchor-id="make-predictions">Make predictions</h2>
<div id="3fb3f584" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_train[:<span class="dv">3</span>], verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>y_pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>array([[ 1.8308794],
       [-0.3535612],
       [ 1.0657732]], dtype=float32)</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>.predict</code> gives us a ‘matrix’ not a ‘vector’. Calling <code>.flatten()</code> will convert it to a ‘vector’.</p>
<div id="40435f6d" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Original shape: </span><span class="sc">{</span>y_pred<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> y_pred.flatten()</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Flattened shape: </span><span class="sc">{</span>y_pred<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>y_pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Original shape: (3, 1)
Flattened shape: (3,)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>array([ 1.8308794, -0.3535612,  1.0657732], dtype=float32)</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="plot-the-predictions-1" class="level2">
<h2 class="anchored" data-anchor-id="plot-the-predictions-1">Plot the predictions</h2>
<div class="columns">
<div class="column">
<div id="cf046dec" class="cell" data-execution_count="41">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-42-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div><div class="column">
<div id="6b9515d2" class="cell" data-execution_count="42">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-43-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>One problem with the predictions is that lots of predictions include negative values, which is unrealistic for house prices. We might have to rethink the activation function in the output layer.</p>
</section>
<section id="assess-the-model" class="level2">
<h2 class="anchored" data-anchor-id="assess-the-model">Assess the model</h2>
<div id="60497328" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_val, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>mse(y_val, y_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>0.8456477940379458</code></pre>
</div>
</div>
<div id="618413ba" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>mse_train[<span class="st">"Basic ANN"</span>] <span class="op">=</span> mse(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    y_train, model.predict(X_train, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>mse_val[<span class="st">"Basic ANN"</span>] <span class="op">=</span> mse(y_val, model.predict(X_val, verbose<span class="op">=</span><span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Some predictions are negative:</p>
<div id="b7cf813c" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_val, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>y_pred.<span class="bu">min</span>(), y_pred.<span class="bu">max</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>(-6.280052, 10.888557)</code></pre>
</div>
</div>
<div id="f8fc490d" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>y_val.<span class="bu">min</span>(), y_val.<span class="bu">max</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>(0.225, 5.00001)</code></pre>
</div>
</div>
</section>
</section>
<section id="force-positive-predictions" class="level1" data-visibility="uncounted">
<h1 data-visibility="uncounted">Force positive predictions</h1>
<section id="try-running-for-longer" class="level2">
<h2 class="anchored" data-anchor-id="try-running-for-longer">Try running for longer</h2>
<div id="5854fbb8" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">123</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential([</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"relu"</span>),</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    Dense(<span class="dv">1</span>)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(<span class="st">"adam"</span>, <span class="st">"mse"</span>)</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>time hist <span class="op">=</span> model.fit(X_train, y_train, <span class="op">\</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span><span class="dv">50</span>, verbose<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 29.1 s, sys: 51.2 ms, total: 29.2 s
Wall time: 29.2 s</code></pre>
</div>
</div>
<p>We will train the same neural network architecture with more epochs (<code>epochs=50</code>) to see if the results improve.</p>
</section>
<section id="loss-curve" class="level2">
<h2 class="anchored" data-anchor-id="loss-curve">Loss curve</h2>
<div id="50fda511" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>plt.plot(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">51</span>), hist.history[<span class="st">"loss"</span>])</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Epoch"</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"MSE"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-50-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The loss curve experiences a sudden drop even before finishing 5 epochs and remains consistently low. This indicates that increasing the number of epochs from 5 to 50 does not significantly increase the accuracy.</p>
</section>
<section id="loss-curve-1" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="loss-curve-1">Loss curve</h2>
<div id="03fddc0d" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>plt.plot(<span class="bu">range</span>(<span class="dv">2</span>, <span class="dv">51</span>), hist.history[<span class="st">"loss"</span>][<span class="dv">1</span>:])</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Epoch"</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"MSE"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-51-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The above code filters out the MSE value from the first epoch. It plots the vector of MSE values starting from the 2nd epoch. By doing so, we can observe the fluctuations in the MSE values across different epochs more clearly. Results show that the model does not benefit from increasing the epochs.</p>
</section>
<section id="predictions" class="level2">
<h2 class="anchored" data-anchor-id="predictions">Predictions</h2>
<div id="c330c5f0" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_val, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Min prediction: </span><span class="sc">{</span>y_pred<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Max prediction: </span><span class="sc">{</span>y_pred<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Min prediction: -18.77
Max prediction: 7.70</code></pre>
</div>
</div>
<div class="columns">
<div class="column">
<div id="067bb9b4" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>plt.scatter(y_pred, y_val)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Predictions"</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"True values"</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>add_diagonal_line()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="margin-top: 1em;">
<div id="75021053" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>mse_train[<span class="st">"Long run ANN"</span>] <span class="op">=</span> mse(</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    y_train, model.predict(X_train, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>mse_val[<span class="st">"Long run ANN"</span>] <span class="op">=</span> mse(y_val, model.predict(X_val, verbose<span class="op">=</span><span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div><div class="column">
<div style="position: relative; top: -3em;">
<div id="93ace4a4" class="cell" data-execution_count="54">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-55-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="try-different-activation-functions-1" class="level2">
<h2 class="anchored" data-anchor-id="try-different-activation-functions-1">Try different activation functions</h2>
<div id="9fa17d36" class="cell" data-execution_count="55">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-56-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We should be mindful when selecting the activation function. Both <code>tanh</code> and <code>sigmoid</code> functions restrict the output values to the range of [0,1]. This is not sensible for house price modelling. <code>relu</code> does not have that problem. Also, <code>relu</code> ensures the output is positive which is realistic for house prices.</p>
</section>
<section id="enforce-positive-outputs-relu" class="level2">
<h2 class="anchored" data-anchor-id="enforce-positive-outputs-relu">Enforce positive outputs (ReLU)</h2>
<div id="426949b7" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">123</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential([</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"relu"</span>),</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"relu"</span>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(<span class="st">"adam"</span>, <span class="st">"mse"</span>)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>time hist <span class="op">=</span> model.fit(X_train, y_train, epochs<span class="op">=</span><span class="dv">50</span>, <span class="op">\</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>losses <span class="op">=</span> np.<span class="bu">round</span>(hist.history[<span class="st">"loss"</span>], <span class="dv">2</span>)</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(losses[:<span class="dv">5</span>], <span class="st">"..."</span>, losses[<span class="op">-</span><span class="dv">5</span>:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 29.2 s, sys: 13 ms, total: 29.2 s
Wall time: 29.2 s
[5.65 5.64 5.64 5.64 5.64] ... [5.64 5.64 5.64 5.64 5.64]</code></pre>
</div>
</div>
</section>
<section id="plot-the-predictions-2" class="level2">
<h2 class="anchored" data-anchor-id="plot-the-predictions-2">Plot the predictions</h2>
<div class="columns">
<div class="column">
<div id="ff3b50a8" class="cell" data-execution_count="58">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-59-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div><div class="column">
<div id="e5077c73" class="cell" data-execution_count="59">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-60-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>Plots illustrate how all the outputs were stuck at zero. Irrespective of how many epochs we run, the output would always be zero.</p>
</section>
<section id="enforce-positive-outputs-mathrmex" class="level2">
<h2 class="anchored" data-anchor-id="enforce-positive-outputs-mathrmex">Enforce positive outputs (<span class="math inline">\mathrm{e}^{\,x}</span>)</h2>
<div id="0bb01013" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1"></a>random.seed(<span class="dv">123</span>)</span>
<span id="cb61-2"><a href="#cb61-2"></a></span>
<span id="cb61-3"><a href="#cb61-3"></a>model <span class="op">=</span> Sequential([</span>
<span id="cb61-4"><a href="#cb61-4"></a>    Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"relu"</span>),</span>
<span id="cb61-5"><a href="#cb61-5"></a>    Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"exponential"</span>)</span>
<span id="cb61-6"><a href="#cb61-6"></a>])</span>
<span id="cb61-7"><a href="#cb61-7"></a></span>
<span id="cb61-8"><a href="#cb61-8"></a>model.<span class="bu">compile</span>(<span class="st">"adam"</span>, <span class="st">"mse"</span>)</span>
<span id="cb61-9"><a href="#cb61-9"></a></span>
<span id="cb61-10"><a href="#cb61-10"></a><span class="op">%</span>time hist <span class="op">=</span> model.fit(X_train, y_train, epochs<span class="op">=</span><span class="dv">5</span>, verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb61-11"><a href="#cb61-11"></a></span>
<span id="cb61-12"><a href="#cb61-12"></a>losses <span class="op">=</span> hist.history[<span class="st">"loss"</span>]</span>
<span id="cb61-13"><a href="#cb61-13"></a><span class="bu">print</span>(losses)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 2.87 s, sys: 865 µs, total: 2.87 s
Wall time: 2.87 s
[25.2047176361084, 5.639228820800781, 5.653268814086914, 5.639529705047607, 5.6393961906433105]</code></pre>
</div>
</div>
<p>Training the model again with an exponential activation function will give <code>nan</code> values. This is because the results then can explode easily.</p>
</section>
</section>
<section id="preprocessing" class="level1" data-visibility="uncounted">
<h1 data-visibility="uncounted">Preprocessing</h1>
<section id="re-scaling-the-inputs" class="level2">
<h2 class="anchored" data-anchor-id="re-scaling-the-inputs">Re-scaling the inputs</h2>
<div id="ee0ffda5" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, MinMaxScaler</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>scaler.fit(X_train)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>X_train_sc <span class="op">=</span> scaler.transform(X_train)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>X_val_sc <span class="op">=</span> scaler.transform(X_val)</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>X_test_sc <span class="op">=</span> scaler.transform(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note: We apply both the <code>fit</code> and <code>transform</code> operations on the train data. However, we only apply <code>transform</code> on the validation and test data.</p>
<div class="columns">
<div class="column">
<div id="44f661f0" class="cell" data-output-location="default" data-execution_count="63">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>plt.hist(X_train.iloc[:, <span class="dv">0</span>])</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>plt.hist(X_train_sc[:, <span class="dv">0</span>])</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">"Original"</span>, <span class="st">"Scaled"</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column">
<div id="cf53de3a" class="cell" data-execution_count="64">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-65-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>We can see how the original values for the input varied between 0 and 10, and how the scaled input values are now between -2 and 2.5. Neural networks prefer if the inputs range between -1 and 1.</p>
</section>
<section id="same-model-with-scaled-inputs" class="level2">
<h2 class="anchored" data-anchor-id="same-model-with-scaled-inputs">Same model with scaled inputs</h2>
<div id="78e2e852" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1"></a>random.seed(<span class="dv">123</span>)</span>
<span id="cb65-2"><a href="#cb65-2"></a></span>
<span id="cb65-3"><a href="#cb65-3"></a>model <span class="op">=</span> Sequential([</span>
<span id="cb65-4"><a href="#cb65-4"></a>    Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"relu"</span>),</span>
<span id="cb65-5"><a href="#cb65-5"></a>    Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"exponential"</span>)</span>
<span id="cb65-6"><a href="#cb65-6"></a>])</span>
<span id="cb65-7"><a href="#cb65-7"></a></span>
<span id="cb65-8"><a href="#cb65-8"></a>model.<span class="bu">compile</span>(<span class="st">"adam"</span>, <span class="st">"mse"</span>)</span>
<span id="cb65-9"><a href="#cb65-9"></a></span>
<span id="cb65-10"><a href="#cb65-10"></a><span class="op">%</span>time hist <span class="op">=</span> model.fit( <span class="op">\</span></span>
<span id="cb65-11"><a href="#cb65-11"></a>    X_train_sc, <span class="op">\</span></span>
<span id="cb65-12"><a href="#cb65-12"></a>    y_train, <span class="op">\</span></span>
<span id="cb65-13"><a href="#cb65-13"></a>    epochs<span class="op">=</span><span class="dv">50</span>, <span class="op">\</span></span>
<span id="cb65-14"><a href="#cb65-14"></a>    verbose<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 28.1 s, sys: 12.9 ms, total: 28.1 s
Wall time: 28.1 s</code></pre>
</div>
</div>
</section>
<section id="loss-curve-2" class="level2">
<h2 class="anchored" data-anchor-id="loss-curve-2">Loss curve</h2>
<div id="e6671f28" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>plt.plot(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">51</span>), hist.history[<span class="st">"loss"</span>])</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Epoch"</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"MSE"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-67-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="loss-curve-3" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="loss-curve-3">Loss curve</h2>
<div id="16ec8752" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>plt.plot(<span class="bu">range</span>(<span class="dv">2</span>, <span class="dv">51</span>), hist.history[<span class="st">"loss"</span>][<span class="dv">1</span>:])</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Epoch"</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"MSE"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-68-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="predictions-1" class="level2">
<h2 class="anchored" data-anchor-id="predictions-1">Predictions</h2>
<div id="2520b2b2" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_val_sc, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Min prediction: </span><span class="sc">{</span>y_pred<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Max prediction: </span><span class="sc">{</span>y_pred<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Min prediction: 0.00
Max prediction: 8.58</code></pre>
</div>
</div>
<div class="columns">
<div class="column">
<div id="0ba2279e" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>plt.scatter(y_pred, y_val)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Predictions"</span>)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"True values"</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>add_diagonal_line()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="margin-top: 1em;">
<div id="3420f506" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>mse_train[<span class="st">"Exp ANN"</span>] <span class="op">=</span> mse(</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>    y_train, model.predict(X_train_sc, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>mse_val[<span class="st">"Exp ANN"</span>] <span class="op">=</span> mse(y_val, model.predict(X_val_sc, verbose<span class="op">=</span><span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div><div class="column">
<div style="position: relative; top: -3em;">
<div id="f0e135fc" class="cell" data-execution_count="71">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-72-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Now the predictions are always non-negative.</p>
</section>
<section id="comparing-mse-smaller-is-better" class="level2">
<h2 class="anchored" data-anchor-id="comparing-mse-smaller-is-better">Comparing MSE (smaller is better)</h2>
<p>On training data:</p>
<div id="321491b9" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>mse_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="69">
<pre><code>{'Linear Regression': 0.5291948207479792,
 'Basic ANN': 1.0832468030855924,
 'Long run ANN': 0.7799112197400799,
 'Exp ANN': 0.3280935061435783}</code></pre>
</div>
</div>
<p>On validation data (expect <em>worse</em>, i.e.&nbsp;bigger):</p>
<div id="9d75d846" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>mse_val</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="70">
<pre><code>{'Linear Regression': 0.5059420205381367,
 'Basic ANN': 0.8456477940379458,
 'Long run ANN': 0.7851678744241668,
 'Exp ANN': 0.3301015952055857}</code></pre>
</div>
</div>
<p>Note: The error on the validation set is usually higher than the training set.</p>
</section>
<section id="comparing-models-train" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="comparing-models-train">Comparing models (train)</h2>
<div id="819e0d60" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>train_results <span class="op">=</span> pd.DataFrame(</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"Model"</span>: mse_train.keys(), <span class="st">"MSE"</span>: mse_train.values()}</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>train_results.sort_values(<span class="st">"MSE"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Model</th>
<th data-quarto-table-cell-role="th">MSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>Basic ANN</td>
<td>1.083247</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>Long run ANN</td>
<td>0.779911</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Linear Regression</td>
<td>0.529195</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Exp ANN</td>
<td>0.328094</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="comparing-models-validation" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="comparing-models-validation">Comparing models (validation)</h2>
<div id="03c714f1" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>val_results <span class="op">=</span> pd.DataFrame(</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"Model"</span>: mse_val.keys(), <span class="st">"MSE"</span>: mse_val.values()}</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>val_results.sort_values(<span class="st">"MSE"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="72">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Model</th>
<th data-quarto-table-cell-role="th">MSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>Basic ANN</td>
<td>0.845648</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>Long run ANN</td>
<td>0.785168</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Linear Regression</td>
<td>0.505942</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Exp ANN</td>
<td>0.330102</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="early-stopping" class="level1" data-visibility="uncounted">
<h1 data-visibility="uncounted">Early Stopping</h1>
<section id="choosing-when-to-stop-training" class="level2">
<h2 class="anchored" data-anchor-id="choosing-when-to-stop-training">Choosing when to stop training</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heaton-error-over-time.png" class="img-fluid figure-img"></p>
<figcaption>Illustrative loss curves over time.</figcaption>
</figure>
</div>
<p>Early stopping can be seen as a regularization technique to avoid overfitting. The plot shows that both training error and validation error decrease at the beginning of training process. However, after a while, validation error starts to increase while training error keeps on decreasing. This is an indication of overfitting. Overfitting leads to poor performance on the unseen data, which is seen here through the gradual increase of validation error. Early stopping can track the model’s performance through the training process and stop the training at the right time.</p>
<div class="footer">
<p>Source: Heaton (2022), <a href="https://github.com/jeffheaton/t81_558_deep_learning/blob/master/t81_558_class_03_4_early_stop.ipynb">Applications of Deep Learning</a>, Part 3.4: Early Stopping.</p>
</div>
</section>
<section id="try-early-stopping" class="level2">
<h2 class="anchored" data-anchor-id="try-early-stopping">Try early stopping</h2>
<p>Hinton calls it a “beautiful free lunch”</p>
<div id="a7914e00" class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="annotated-cell-47"><pre class="sourceCode numberSource python code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-47" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-47-1" class="code-annotation-target"><a href="#annotated-cell-47-1"></a><span class="im">from</span> keras.callbacks <span class="im">import</span> EarlyStopping</span>
<span id="annotated-cell-47-2"><a href="#annotated-cell-47-2"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-47" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-47-3" class="code-annotation-target"><a href="#annotated-cell-47-3"></a>random.seed(<span class="dv">123</span>)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-47" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-47-4" class="code-annotation-target"><a href="#annotated-cell-47-4"></a>model <span class="op">=</span> Sequential([</span>
<span id="annotated-cell-47-5"><a href="#annotated-cell-47-5"></a>    Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"relu"</span>),</span>
<span id="annotated-cell-47-6"><a href="#annotated-cell-47-6"></a>    Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"exponential"</span>)</span>
<span id="annotated-cell-47-7"><a href="#annotated-cell-47-7"></a>])</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-47" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-47-8" class="code-annotation-target"><a href="#annotated-cell-47-8"></a>model.<span class="bu">compile</span>(<span class="st">"adam"</span>, <span class="st">"mse"</span>)</span>
<span id="annotated-cell-47-9"><a href="#annotated-cell-47-9"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-47" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-47-10" class="code-annotation-target"><a href="#annotated-cell-47-10"></a>es <span class="op">=</span> EarlyStopping(restore_best_weights<span class="op">=</span><span class="va">True</span>, patience<span class="op">=</span><span class="dv">15</span>)</span>
<span id="annotated-cell-47-11"><a href="#annotated-cell-47-11"></a></span>
<span id="annotated-cell-47-12"><a href="#annotated-cell-47-12"></a><span class="op">%</span>time hist <span class="op">=</span> model.fit(X_train_sc, y_train, epochs<span class="op">=</span><span class="dv">1_000</span>, <span class="op">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-47" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-47-13" class="code-annotation-target"><a href="#annotated-cell-47-13"></a>    callbacks<span class="op">=</span>[es], validation_data<span class="op">=</span>(X_val_sc, y_val), verbose<span class="op">=</span><span class="va">False</span>)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-47" data-target-annotation="7" onclick="event.preventDefault();">7</a><span id="annotated-cell-47-14" class="code-annotation-target"><a href="#annotated-cell-47-14"></a><span class="bu">print</span>(<span class="ss">f"Keeping model at epoch #</span><span class="sc">{</span><span class="bu">len</span>(hist.history[<span class="st">'loss'</span>])<span class="op">-</span><span class="dv">10</span><span class="sc">}</span><span class="ss">."</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-47" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-47" data-code-lines="1" data-code-annotation="1">Imports <code>EarlyStopping</code> from <code>keras.callbacks</code></span>
</dd>
<dt data-target-cell="annotated-cell-47" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-47" data-code-lines="3" data-code-annotation="2">Sets the random seed</span>
</dd>
<dt data-target-cell="annotated-cell-47" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-47" data-code-lines="4,5,6,7" data-code-annotation="3">Constructs the sequential model</span>
</dd>
<dt data-target-cell="annotated-cell-47" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-47" data-code-lines="8" data-code-annotation="4">Configures the training process with optimiser and loss function</span>
</dd>
<dt data-target-cell="annotated-cell-47" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-47" data-code-lines="10" data-code-annotation="5">Defines the early stopping object. Here, the <code>patience</code> parameter tells how many epochs the neural network has to wait without no improvement before the process stops. <code>patience=15</code> indicates that the neural network will wait for 15 epochs without any improvement before it stops training. <code>restore_best_weights=True</code> ensures that model’s weights will be restored to the best model, i.e., the model we saw before 15 epochs</span>
</dd>
<dt data-target-cell="annotated-cell-47" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-47" data-code-lines="13" data-code-annotation="6">Fits the model with early stopping object passed in</span>
</dd>
<dt data-target-cell="annotated-cell-47" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-47" data-code-lines="14" data-code-annotation="7">Prints the outs</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 1min 19s, sys: 15.5 ms, total: 1min 19s
Wall time: 1min 19s
Keeping model at epoch #101.</code></pre>
</div>
</div>
</section>
<section id="loss-curve-4" class="level2">
<h2 class="anchored" data-anchor-id="loss-curve-4">Loss curve</h2>
<div id="b0db721a" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>plt.plot(hist.history[<span class="st">"loss"</span>])</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>plt.plot(hist.history[<span class="st">"val_loss"</span>])</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">"Training"</span>, <span class="st">"Validation"</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-78-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="loss-curve-ii" class="level2">
<h2 class="anchored" data-anchor-id="loss-curve-ii">Loss curve II</h2>
<div id="df48aae3" class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>plt.plot(hist.history[<span class="st">"loss"</span>])</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>plt.plot(hist.history[<span class="st">"val_loss"</span>])</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="dv">8</span>])</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">"Training"</span>, <span class="st">"Validation"</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-79-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="predictions-2" class="level2">
<h2 class="anchored" data-anchor-id="predictions-2">Predictions</h2>
<div class="columns">
<div class="column">
<div id="2b441fe7" class="cell" data-execution_count="80">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-81-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div><div class="column">
<div id="47a9e6f7" class="cell" data-execution_count="81">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-keras_files/figure-html/cell-82-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="comparing-models-validation-1" class="level2" data-visibility="uncounted">
<h2 data-visibility="uncounted" class="anchored" data-anchor-id="comparing-models-validation-1">Comparing models (validation)</h2>
<div id="bce7c53e" class="cell" data-execution_count="84">
<div class="cell-output cell-output-display" data-execution_count="81">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Model</th>
<th data-quarto-table-cell-role="th">MSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>Basic ANN</td>
<td>0.845648</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>Long run ANN</td>
<td>0.785168</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Linear Regression</td>
<td>0.505942</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Exp ANN</td>
<td>0.330102</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Early stop ANN</td>
<td>0.294328</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>MSE error on the validation set has improved from the ANN model without early stopping (0.354653) to the one with early stopping (0.326440).</p>
</section>
<section id="the-test-set" class="level2">
<h2 class="anchored" data-anchor-id="the-test-set">The test set</h2>
<p>Evaluate <em>only the final/selected model</em> on the test set.</p>
<div id="9fffe12f" class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>mse(y_test, model.predict(X_test_sc, verbose<span class="op">=</span><span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="82">
<pre><code>0.3123165514245335</code></pre>
</div>
</div>
<div id="f0a1d68e" class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>model.evaluate(X_test_sc, y_test, verbose<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="83">
<pre><code>0.31231650710105896</code></pre>
</div>
</div>
<p>Evaluating the model on the unseen test set provides an unbiased view on how the model will perform. Since we configured the model to track ‘mse’ as the loss function, we can simply use <code>model.evaluate()</code> function on the test set and get the same answer.</p>
</section>
<section id="another-useful-callback" class="level2">
<h2 class="anchored" data-anchor-id="another-useful-callback">Another useful callback</h2>
<div id="f2381b23" class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="annotated-cell-52"><pre class="sourceCode python code-annotation-code code-with-copy"><code class="sourceCode python"><span id="annotated-cell-52-1"><a href="#annotated-cell-52-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="annotated-cell-52-2"><a href="#annotated-cell-52-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.callbacks <span class="im">import</span> ModelCheckpoint</span>
<span id="annotated-cell-52-3"><a href="#annotated-cell-52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-52-4"><a href="#annotated-cell-52-4" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">123</span>)</span>
<span id="annotated-cell-52-5"><a href="#annotated-cell-52-5" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential(</span>
<span id="annotated-cell-52-6"><a href="#annotated-cell-52-6" aria-hidden="true" tabindex="-1"></a>    [Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"relu"</span>), Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"exponential"</span>)]</span>
<span id="annotated-cell-52-7"><a href="#annotated-cell-52-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="annotated-cell-52-8"><a href="#annotated-cell-52-8" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(<span class="st">"adam"</span>, <span class="st">"mse"</span>)</span>
<span id="annotated-cell-52-9"><a href="#annotated-cell-52-9" aria-hidden="true" tabindex="-1"></a>mc <span class="op">=</span> ModelCheckpoint(</span>
<span id="annotated-cell-52-10"><a href="#annotated-cell-52-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"best-model.keras"</span>, monitor<span class="op">=</span><span class="st">"val_loss"</span>, save_best_only<span class="op">=</span><span class="va">True</span></span>
<span id="annotated-cell-52-11"><a href="#annotated-cell-52-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="annotated-cell-52-12"><a href="#annotated-cell-52-12" aria-hidden="true" tabindex="-1"></a>es <span class="op">=</span> EarlyStopping(restore_best_weights<span class="op">=</span><span class="va">True</span>, patience<span class="op">=</span><span class="dv">5</span>)</span>
<span id="annotated-cell-52-13"><a href="#annotated-cell-52-13" aria-hidden="true" tabindex="-1"></a>hist <span class="op">=</span> model.fit(</span>
<span id="annotated-cell-52-14"><a href="#annotated-cell-52-14" aria-hidden="true" tabindex="-1"></a>    X_train_sc,</span>
<span id="annotated-cell-52-15"><a href="#annotated-cell-52-15" aria-hidden="true" tabindex="-1"></a>    y_train,</span>
<span id="annotated-cell-52-16"><a href="#annotated-cell-52-16" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span><span class="dv">100</span>,</span>
<span id="annotated-cell-52-17"><a href="#annotated-cell-52-17" aria-hidden="true" tabindex="-1"></a>    validation_split<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="annotated-cell-52-18"><a href="#annotated-cell-52-18" aria-hidden="true" tabindex="-1"></a>    callbacks<span class="op">=</span>[mc, es],</span>
<span id="annotated-cell-52-19"><a href="#annotated-cell-52-19" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="annotated-cell-52-20"><a href="#annotated-cell-52-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="annotated-cell-52-21"><a href="#annotated-cell-52-21" aria-hidden="true" tabindex="-1"></a>Path(<span class="st">"best-model.keras"</span>).stat().st_size</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="84">
<pre><code>19195</code></pre>
</div>
</div>
<p><code>ModelCheckpoint</code> is also another useful <code>callback</code> function that can be used to save the model at some intervals during training. This is useful when training large datasets. If the training process gets interrupted at some point, last saved set of weights from model checkpoints can be used to resume the training process instead of starting from the beginning.</p>
</section>
</section>
<section id="section-2" class="level1 smaller" data-visibility="uncounted">
<h1 class="smaller" data-visibility="uncounted"></h1>
<h2 class="anchored" data-anchor-id="section-2">
Glossary
</h2>
<div class="columns">
<div class="column">
<ul>
<li>activations, activation function</li>
<li>artificial neural network</li>
<li>biases (in neurons)</li>
<li>callbacks</li>
<li>classification problem</li>
<li>cost/loss function</li>
<li>deep network, network depth</li>
<li>dense or fully-connected layer</li>
<li>early stopping</li>
<li>epoch</li>
<li>feed-forward neural network</li>
<li>Keras, Tensorflow, PyTorch</li>
</ul>
</div><div class="column">
<ul>
<li>labelled/unlabelled data</li>
<li>machine learning</li>
<li>matplotlib, seaborn</li>
<li>neural network architecture</li>
<li>perceptron</li>
<li>ReLU</li>
<li>representation learning</li>
<li>sigmoid activation function</li>
<li>targets</li>
<li>training/test split</li>
<li>weights (in a neuron)</li>
<li>validation set</li>
</ul>
</div>
</div>
<script defer="">
    // Remove the highlight.js class for the 'compile', 'min', 'max'
    // as there's a bug where they are treated like the Python built-in
    // global functions but we only ever see it as methods like
    // 'model.compile()' or 'predictions.max()'
    buggyBuiltIns = ["compile", "min", "max", "round", "sum"];

    document.querySelectorAll('.bu').forEach((elem) => {
        if (buggyBuiltIns.includes(elem.innerHTML)) {
            elem.classList.remove('bu');
        }
    })
</script>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../Lecture-1-Artificial-Intelligence/python.html" class="pagination-link  aria-label=" python"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Python</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../Lecture-2-Deep-Learning-Keras/project.html" class="pagination-link" aria-label="Project Details">
        <span class="nav-page-text">Project Details</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>