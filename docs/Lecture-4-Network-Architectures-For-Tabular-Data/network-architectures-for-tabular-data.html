<!DOCTYPE html>
<html lang="en"><head>
<script src="network-architectures-for-tabular-data_files/libs/clipboard/clipboard.min.js"></script>
<script src="network-architectures-for-tabular-data_files/libs/quarto-html/tabby.min.js"></script>
<script src="network-architectures-for-tabular-data_files/libs/quarto-html/popper.min.js"></script>
<script src="network-architectures-for-tabular-data_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="network-architectures-for-tabular-data_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="network-architectures-for-tabular-data_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="network-architectures-for-tabular-data_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.1.251">

  <meta name="author" content="Dr Patrick Laub">
  <title>Network Architectures for Tabular Data</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="network-architectures-for-tabular-data_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="network-architectures-for-tabular-data_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #1f1c1b;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #1f1c1b; } /* Normal */
    code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
    code span.an { color: #ca60ca; } /* Annotation */
    code span.at { color: #0057ae; } /* Attribute */
    code span.bn { color: #b08000; } /* BaseN */
    code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
    code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #924c9d; } /* Char */
    code span.cn { color: #aa5500; } /* Constant */
    code span.co { color: #898887; } /* Comment */
    code span.cv { color: #0095ff; } /* CommentVar */
    code span.do { color: #607880; } /* Documentation */
    code span.dt { color: #0057ae; } /* DataType */
    code span.dv { color: #b08000; } /* DecVal */
    code span.er { color: #bf0303; text-decoration: underline; } /* Error */
    code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
    code span.fl { color: #b08000; } /* Float */
    code span.fu { color: #644a9b; } /* Function */
    code span.im { color: #ff5500; } /* Import */
    code span.in { color: #b08000; } /* Information */
    code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
    code span.op { color: #ca60ca; } /* Operator */
    code span.ot { color: #006e28; } /* Other */
    code span.pp { color: #006e28; } /* Preprocessor */
    code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
    code span.sc { color: #3daee9; } /* SpecialChar */
    code span.ss { color: #ff5500; } /* SpecialString */
    code span.st { color: #bf0303; } /* String */
    code span.va { color: #0057ae; } /* Variable */
    code span.vs { color: #bf0303; } /* VerbatimString */
    code span.wa { color: #bf0303; } /* Warning */
  </style>
  <link rel="stylesheet" href="network-architectures-for-tabular-data_files/libs/revealjs/dist/theme/quarto.css" id="theme">
  <link href="network-architectures-for-tabular-data_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="network-architectures-for-tabular-data_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="network-architectures-for-tabular-data_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="network-architectures-for-tabular-data_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="network-architectures-for-tabular-data_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="network-architectures-for-tabular-data_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-captioned.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-captioned) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-captioned.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-captioned .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-captioned .callout-caption  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-captioned.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-captioned.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-caption {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-caption {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-caption {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-captioned .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-captioned .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-captioned) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-caption {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-caption {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-caption {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-caption {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-caption {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
</head>
<body class="quarto-light">
<div class="line right"></div>
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="unsw-yellow-shape.png" data-background-size="contain !important" class="center">
  <h1 class="title">Network Architectures for Tabular Data</h1>
  <p class="subtitle">ACTL3143/5111: Deep Learning for Actuaries</p>
  <p class="author">Dr Patrick Laub</p>
  <p class="date">Week 4</p>
</section>

<section id="lecture-outline" class="slide level2">
<h2>Lecture outline</h2>
<p><br></p>
<div class="columns">
<div class="column">
<ul>
<li>Project draft &amp; StoryWall</li>
<li>Entity embeddings</li>
<li>Keras Functional API</li>
<li>Keras eager execution</li>
</ul>
</div><div class="column">
<ul>
<li>Regularisation</li>
<li>Combining models</li>
<li>Tutorial: Git &amp; GitHub</li>
</ul>
</div>
</div>
<p><br></p>
<p><strong>Next week</strong>: Jacky Poon guest lecture on <em>Tuesday 13:00</em>.</p>
</section>
<section id="load-packages" class="slide level2" data-visibility="uncounted">
<h2>Load packages</h2>
<p><br></p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="im">from</span> tensorflow.keras.models <span class="im">import</span> Sequential</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Dense</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="im">from</span> tensorflow.keras.callbacks <span class="im">import</span> EarlyStopping</span>
<span id="cb1-10"><a href="#cb1-10"></a></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder, StandardScaler</span>
<span id="cb1-13"><a href="#cb1-13"></a></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="op">%</span>load_ext watermark</span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="op">%</span>watermark <span class="op">-</span>p numpy,pandas,sklearn,tensorflow</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>numpy     : 1.21.5
pandas    : 1.4.4
sklearn   : 1.1.1
tensorflow: 2.8.0
</code></pre>
</div>
</div>
</section>
<section>
<section id="project-and-storywall" class="title-slide slide level1 center" data-background-image="unsw-yellow-shape.png" data-visibility="uncounted">
<h1>Project and StoryWall</h1>

</section>
<section id="project-draft-10" class="slide level2">
<h2>Project draft (10%)</h2>
<p>Draft should show that you have:</p>
<ul>
<li>specified your supervised learning problem,</li>
<li>collected and cleaned the data,</li>
<li>performed a basic exploratory data analysis,</li>
<li>create a simple (non-deep learning) benchmark model.</li>
</ul>
<p>Email me a PDF by <strong>noon on July 1</strong>, no late submissions.</p>
<div class="callout callout-tip callout-captioned callout-style-default">
<div class="callout-body">
<div class="callout-caption">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Tip</strong></p>
</div>
<div class="callout-content">
<p>Later in the project you will fit two different deep learning architectures. Consider the <em>wide &amp; deep</em> architecture from later in this lecture.</p>
</div>
</div>
</div>
</section>
<section id="storywall-3-stroke-prediction" class="slide level2 smaller">
<h2>StoryWall #3 Stroke Prediction</h2>
<p>Dataset source: <a href="https://www.kaggle.com/datasets/fedesoriano/stroke-prediction-dataset">Kaggle Stroke Prediction Dataset</a>.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">"stroke.csv"</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a>data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>gender</th>
      <th>age</th>
      <th>hypertension</th>
      <th>heart_disease</th>
      <th>ever_married</th>
      <th>work_type</th>
      <th>Residence_type</th>
      <th>avg_glucose_level</th>
      <th>bmi</th>
      <th>smoking_status</th>
      <th>stroke</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>9046</td>
      <td>Male</td>
      <td>67.0</td>
      <td>0</td>
      <td>1</td>
      <td>Yes</td>
      <td>Private</td>
      <td>Urban</td>
      <td>228.69</td>
      <td>36.6</td>
      <td>formerly smoked</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>51676</td>
      <td>Female</td>
      <td>61.0</td>
      <td>0</td>
      <td>0</td>
      <td>Yes</td>
      <td>Self-employed</td>
      <td>Rural</td>
      <td>202.21</td>
      <td>NaN</td>
      <td>never smoked</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>31112</td>
      <td>Male</td>
      <td>80.0</td>
      <td>0</td>
      <td>1</td>
      <td>Yes</td>
      <td>Private</td>
      <td>Rural</td>
      <td>105.92</td>
      <td>32.5</td>
      <td>never smoked</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>60182</td>
      <td>Female</td>
      <td>49.0</td>
      <td>0</td>
      <td>0</td>
      <td>Yes</td>
      <td>Private</td>
      <td>Urban</td>
      <td>171.23</td>
      <td>34.4</td>
      <td>smokes</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1665</td>
      <td>Female</td>
      <td>79.0</td>
      <td>1</td>
      <td>0</td>
      <td>Yes</td>
      <td>Self-employed</td>
      <td>Rural</td>
      <td>174.12</td>
      <td>24.0</td>
      <td>never smoked</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="split-the-data" class="slide level2">
<h2>Split the data</h2>
<p>First, look for missing values.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a>numberMissing <span class="op">=</span> data.isna().<span class="bu">sum</span>()</span>
<span id="cb4-2"><a href="#cb4-2"></a>numberMissing[numberMissing <span class="op">&gt;</span> <span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>bmi    201
dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a>features <span class="op">=</span> data.drop([<span class="st">"id"</span>, <span class="st">"stroke"</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb6-2"><a href="#cb6-2"></a>target <span class="op">=</span> data[<span class="st">"stroke"</span>]</span>
<span id="cb6-3"><a href="#cb6-3"></a></span>
<span id="cb6-4"><a href="#cb6-4"></a>X_main, X_test, y_main, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb6-5"><a href="#cb6-5"></a>    features, target, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">7</span>)</span>
<span id="cb6-6"><a href="#cb6-6"></a>X_train, X_val, y_train, y_val <span class="op">=</span> train_test_split(</span>
<span id="cb6-7"><a href="#cb6-7"></a>    X_main, y_main, test_size<span class="op">=</span><span class="fl">0.25</span>, random_state<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb6-8"><a href="#cb6-8"></a></span>
<span id="cb6-9"><a href="#cb6-9"></a>X_train.shape, X_val.shape, X_test.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>((3066, 10), (1022, 10), (1022, 10))</code></pre>
</div>
</div>
</section>
<section id="what-values-do-we-see-in-the-data" class="slide level2">
<h2>What values do we see in the data?</h2>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a>X_train[<span class="st">"gender"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>Female    1802
Male      1264
Name: gender, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a>X_train[<span class="st">"ever_married"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>Yes    2007
No     1059
Name: ever_married, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a>X_train[<span class="st">"Residence_type"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>Urban    1536
Rural    1530
Name: Residence_type, dtype: int64</code></pre>
</div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a>X_train[<span class="st">"work_type"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>Private          1754
Self-employed     490
children          419
Govt_job          390
Never_worked       13
Name: work_type, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a>X_train[<span class="st">"smoking_status"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>never smoked       1130
Unknown             944
formerly smoked     522
smokes              470
Name: smoking_status, dtype: int64</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="preprocess-the-columns-individually" class="slide level2">
<h2>Preprocess the columns individually</h2>
<div class="smaller">
<p>Take categorical columns <span class="math inline">\(\hookrightarrow\)</span> one-hot vectors, binary columns <span class="math inline">\(\hookrightarrow\)</span> do nothing, continuous columns <span class="math inline">\(\hookrightarrow\)</span> impute NaNs &amp; standardise.</p>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> make_column_transformer</span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline</span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> SimpleImputer</span>
<span id="cb18-4"><a href="#cb18-4"></a></span>
<span id="cb18-5"><a href="#cb18-5"></a>catVars <span class="op">=</span>  [<span class="st">"gender"</span>, <span class="st">"ever_married"</span>, <span class="st">"Residence_type"</span>,</span>
<span id="cb18-6"><a href="#cb18-6"></a>    <span class="st">"work_type"</span>, <span class="st">"smoking_status"</span>]</span>
<span id="cb18-7"><a href="#cb18-7"></a></span>
<span id="cb18-8"><a href="#cb18-8"></a>ct <span class="op">=</span> make_column_transformer(</span>
<span id="cb18-9"><a href="#cb18-9"></a>  (OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">"ignore"</span>), catVars),</span>
<span id="cb18-10"><a href="#cb18-10"></a>  (<span class="st">"passthrough"</span>, [<span class="st">"hypertension"</span>, <span class="st">"heart_disease"</span>]),</span>
<span id="cb18-11"><a href="#cb18-11"></a>  remainder<span class="op">=</span>make_pipeline(SimpleImputer(), StandardScaler())</span>
<span id="cb18-12"><a href="#cb18-12"></a>)</span>
<span id="cb18-13"><a href="#cb18-13"></a></span>
<span id="cb18-14"><a href="#cb18-14"></a>X_train_ct <span class="op">=</span> ct.fit_transform(X_train)</span>
<span id="cb18-15"><a href="#cb18-15"></a>X_val_ct <span class="op">=</span> ct.transform(X_val)<span class="op">;</span> X_test_ct <span class="op">=</span> ct.transform(X_test)</span>
<span id="cb18-16"><a href="#cb18-16"></a></span>
<span id="cb18-17"><a href="#cb18-17"></a>numNANs <span class="op">=</span> np.<span class="bu">sum</span>(np.isnan(X_train_ct)) <span class="op">+</span> np.<span class="bu">sum</span>(np.isnan(X_val_ct)) <span class="op">+</span> np.<span class="bu">sum</span>(np.isnan(X_test_ct))</span>
<span id="cb18-18"><a href="#cb18-18"></a><span class="bu">print</span>(<span class="ss">f"The training set has shape </span><span class="sc">{</span>X_train_ct<span class="sc">.</span>shape<span class="sc">}</span><span class="ss"> &amp; there are now </span><span class="sc">{</span>numNANs<span class="sc">}</span><span class="ss"> NANs in the data."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The training set has shape (3066, 20) &amp; there are now 0 NANs in the data.</code></pre>
</div>
</div>
</section>
<section id="handling-unseen-categories" class="slide level2">
<h2>Handling unseen categories</h2>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a>X_train[<span class="st">"gender"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>Female    1802
Male      1264
Name: gender, dtype: int64</code></pre>
</div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a>X_val[<span class="st">"gender"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>Female    615
Male      406
Other       1
Name: gender, dtype: int64</code></pre>
</div>
</div>
</div>
</div>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1"></a>ind <span class="op">=</span> np.argmax(X_val[<span class="st">"gender"</span>] <span class="op">==</span> <span class="st">"Other"</span>)</span>
<span id="cb24-2"><a href="#cb24-2"></a>X_val.iloc[ind<span class="op">-</span><span class="dv">1</span>:ind<span class="op">+</span><span class="dv">3</span>][[<span class="st">"gender"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gender</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>4970</th>
      <td>Male</td>
    </tr>
    <tr>
      <th>3116</th>
      <td>Other</td>
    </tr>
    <tr>
      <th>4140</th>
      <td>Male</td>
    </tr>
    <tr>
      <th>2505</th>
      <td>Female</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1"></a>X_val_ct[ind<span class="op">-</span><span class="dv">1</span>:ind<span class="op">+</span><span class="dv">3</span>,:<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>array([[0., 1.],
       [0., 0.],
       [0., 1.],
       [1., 0.]])</code></pre>
</div>
</div>
<div class="callout callout-note callout-captioned callout-style-default">
<div class="callout-body">
<div class="callout-caption">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>Note, when you pass a DataFrame to <code>sklearn</code>, it gives you back a <code>numpy</code> array.</p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="setup-a-binary-classification-model" class="slide level2">
<h2>Setup a binary classification model</h2>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1"></a><span class="kw">def</span> create_model(seed<span class="op">=</span><span class="dv">42</span>):</span>
<span id="cb27-2"><a href="#cb27-2"></a>    tf.random.set_seed(seed)</span>
<span id="cb27-3"><a href="#cb27-3"></a>    model <span class="op">=</span> Sequential()</span>
<span id="cb27-4"><a href="#cb27-4"></a>    model.add(Dense(<span class="dv">32</span>, <span class="st">"leaky_relu"</span>, input_shape<span class="op">=</span>X_train_ct.shape[<span class="dv">1</span>:]))</span>
<span id="cb27-5"><a href="#cb27-5"></a>    model.add(Dense(<span class="dv">16</span>, <span class="st">"leaky_relu"</span>))</span>
<span id="cb27-6"><a href="#cb27-6"></a>    model.add(Dense(<span class="dv">1</span>, <span class="st">"sigmoid"</span>))</span>
<span id="cb27-7"><a href="#cb27-7"></a>    <span class="cf">return</span> model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a>model <span class="op">=</span> create_model()</span>
<span id="cb28-2"><a href="#cb28-2"></a>model.summary(print_fn<span class="op">=</span>skip_empty)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model: "sequential"
_________________________________________________________________
Layer (type)                Output Shape              Param #
=================================================================
dense (Dense)               (None, 32)                672
dense_1 (Dense)             (None, 16)                528
dense_2 (Dense)             (None, 1)                 17
=================================================================
Total params: 1,217
Trainable params: 1,217
Non-trainable params: 0
_________________________________________________________________</code></pre>
</div>
</div>
</section>
<section id="add-metrics-compile-and-fit" class="slide level2">
<h2>Add metrics, compile, and fit</h2>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1"></a>model <span class="op">=</span> create_model()</span>
<span id="cb30-2"><a href="#cb30-2"></a></span>
<span id="cb30-3"><a href="#cb30-3"></a>pr_auc <span class="op">=</span> tf.keras.metrics.AUC(curve<span class="op">=</span><span class="st">"PR"</span>, name<span class="op">=</span><span class="st">"pr_auc"</span>)</span>
<span id="cb30-4"><a href="#cb30-4"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span><span class="st">"adam"</span>, loss<span class="op">=</span><span class="st">"BinaryCrossentropy"</span>,</span>
<span id="cb30-5"><a href="#cb30-5"></a>    metrics<span class="op">=</span>[<span class="st">"accuracy"</span>, <span class="st">"AUC"</span>, pr_auc])</span>
<span id="cb30-6"><a href="#cb30-6"></a></span>
<span id="cb30-7"><a href="#cb30-7"></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">50</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb30-8"><a href="#cb30-8"></a>    monitor<span class="op">=</span><span class="st">"val_pr_auc"</span>, verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb30-9"><a href="#cb30-9"></a>model.fit(X_train_ct, y_train, callbacks<span class="op">=</span>[es], epochs<span class="op">=</span><span class="dv">1_000</span>, verbose<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb30-10"><a href="#cb30-10"></a>  validation_data<span class="op">=</span>(X_val_ct, y_val))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Restoring model weights from the end of the best epoch: 25.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 75: early stopping</code></pre>
</div>
</div>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1"></a>model.evaluate(X_val_ct, y_val, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>[0.14575688540935516,
 0.9579256176948547,
 0.821088433265686,
 0.14309996366500854]</code></pre>
</div>
</div>
</div><div class="column">

</div>
</div>
</section>
<section id="try-overweighting-the-minority-class" class="slide level2">
<h2>Try overweighting the minority class</h2>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1"></a>model <span class="op">=</span> create_model()</span>
<span id="cb35-2"><a href="#cb35-2"></a></span>
<span id="cb35-3"><a href="#cb35-3"></a>pr_auc <span class="op">=</span> tf.keras.metrics.AUC(curve<span class="op">=</span><span class="st">"PR"</span>, name<span class="op">=</span><span class="st">"pr_auc"</span>)</span>
<span id="cb35-4"><a href="#cb35-4"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span><span class="st">"adam"</span>, loss<span class="op">=</span><span class="st">"BinaryCrossentropy"</span>,</span>
<span id="cb35-5"><a href="#cb35-5"></a>    metrics<span class="op">=</span>[<span class="st">"accuracy"</span>, <span class="st">"AUC"</span>, pr_auc])</span>
<span id="cb35-6"><a href="#cb35-6"></a></span>
<span id="cb35-7"><a href="#cb35-7"></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">50</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb35-8"><a href="#cb35-8"></a>    monitor<span class="op">=</span><span class="st">"val_pr_auc"</span>, verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb35-9"><a href="#cb35-9"></a>model.fit(X_train_ct, y_train, callbacks<span class="op">=</span>[es], epochs<span class="op">=</span><span class="dv">1_000</span>, verbose<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb35-10"><a href="#cb35-10"></a>  validation_data<span class="op">=</span>(X_val_ct, y_val), class_weight<span class="op">=</span>{<span class="dv">0</span>: <span class="dv">1</span>, <span class="dv">1</span>: <span class="dv">10</span>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Restoring model weights from the end of the best epoch: 18.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 68: early stopping</code></pre>
</div>
</div>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1"></a>model.evaluate(X_val_ct, y_val, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>[0.41032886505126953,
 0.7602739930152893,
 0.8253644704818726,
 0.15171976387500763]</code></pre>
</div>
</div>
</div><div class="column">
<div class="fragment">
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1"></a>model.evaluate(X_test_ct, y_test, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>[0.4278854727745056,
 0.7583170533180237,
 0.8078189492225647,
 0.17001575231552124]</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="classification-metrics" class="slide level2 smaller">
<h2>Classification Metrics</h2>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix, RocCurveDisplay, PrecisionRecallDisplay</span>
<span id="cb42-2"><a href="#cb42-2"></a>y_pred <span class="op">=</span> model.predict(X_test_ct)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1"></a>RocCurveDisplay.from_predictions(y_test, y_pred, name<span class="op">=</span><span class="st">""</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img data-src="network-architectures-for-tabular-data_files/figure-revealjs/cell-25-output-1.png"></p>
</div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1"></a>PrecisionRecallDisplay.from_predictions(y_test, y_pred, name<span class="op">=</span><span class="st">""</span>)<span class="op">;</span> plt.legend(loc<span class="op">=</span><span class="st">"upper right"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img data-src="network-architectures-for-tabular-data_files/figure-revealjs/cell-26-output-1.png"></p>
</div>
</div>
</div>
</div>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1"></a>y_pred_stroke <span class="op">=</span> y_pred <span class="op">&gt;</span> <span class="fl">0.5</span></span>
<span id="cb45-2"><a href="#cb45-2"></a>confusion_matrix(y_test, y_pred_stroke)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>array([[736, 236],
       [ 11,  39]])</code></pre>
</div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1"></a>y_pred_stroke <span class="op">=</span> y_pred <span class="op">&gt;</span> <span class="fl">0.3</span></span>
<span id="cb47-2"><a href="#cb47-2"></a>confusion_matrix(y_test, y_pred_stroke)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>array([[623, 349],
       [  8,  42]])</code></pre>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="ordinal-variables" class="title-slide slide level1 center" data-background-image="unsw-yellow-shape.png" data-visibility="uncounted">
<h1>Ordinal Variables</h1>

</section>
<section id="french-motor-dataset" class="slide level2">
<h2>French motor dataset</h2>
<p>Previously, we used <code>pd.get_dummies</code> to deal with the categorical variables.</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1"></a>freq <span class="op">=</span> pd.read_csv(<span class="st">"french-motor.csv"</span>).drop(<span class="st">"IDpol"</span>, axis<span class="op">=</span><span class="dv">1</span>).head(<span class="dv">25_000</span>)</span>
<span id="cb49-2"><a href="#cb49-2"></a>freq.sample(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ClaimNb</th>
      <th>Exposure</th>
      <th>Area</th>
      <th>VehPower</th>
      <th>VehAge</th>
      <th>DrivAge</th>
      <th>BonusMalus</th>
      <th>VehBrand</th>
      <th>VehGas</th>
      <th>Density</th>
      <th>Region</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>20000</th>
      <td>0.0</td>
      <td>1.00</td>
      <td>C</td>
      <td>5.0</td>
      <td>12.0</td>
      <td>29.0</td>
      <td>54.0</td>
      <td>B4</td>
      <td>Regular</td>
      <td>114.0</td>
      <td>R24</td>
    </tr>
    <tr>
      <th>5515</th>
      <td>1.0</td>
      <td>0.49</td>
      <td>C</td>
      <td>7.0</td>
      <td>14.0</td>
      <td>48.0</td>
      <td>50.0</td>
      <td>B1</td>
      <td>Regular</td>
      <td>307.0</td>
      <td>R24</td>
    </tr>
    <tr>
      <th>966</th>
      <td>1.0</td>
      <td>0.62</td>
      <td>D</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>69.0</td>
      <td>50.0</td>
      <td>B12</td>
      <td>Regular</td>
      <td>818.0</td>
      <td>R31</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb50-2"><a href="#cb50-2"></a>  freq.drop(<span class="st">"ClaimNb"</span>, axis<span class="op">=</span><span class="dv">1</span>), freq[<span class="st">"ClaimNb"</span>], random_state<span class="op">=</span><span class="dv">2022</span>)</span>
<span id="cb50-3"><a href="#cb50-3"></a></span>
<span id="cb50-4"><a href="#cb50-4"></a>X_train <span class="op">=</span> X_train.reset_index(drop<span class="op">=</span><span class="va">True</span>) <span class="co"># Index starts at 0 again.</span></span>
<span id="cb50-5"><a href="#cb50-5"></a>X_test <span class="op">=</span> X_test.reset_index(drop<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="what-values-do-we-see-in-the-data-1" class="slide level2">
<h2>What values do we see in the data?</h2>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell quarto-layout-cell" data-execution_count="31" style="flex-basis: 50.0%;justify-content: center;">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1"></a>X_train[<span class="st">"Area"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>C    5514
D    4081
A    3522
E    2769
B    2385
F     479
Name: Area, dtype: int64</code></pre>
</div>
</div>
<div class="cell quarto-layout-cell" data-execution_count="32" style="flex-basis: 50.0%;justify-content: center;">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1"></a>X_train[<span class="st">"VehBrand"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>B1     5036
B2     4887
B12    3716
       ... 
B13     331
B11     284
B14     149
Name: VehBrand, Length: 11, dtype: int64</code></pre>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell quarto-layout-cell" data-execution_count="33" style="flex-basis: 50.0%;justify-content: center;">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1"></a>X_train[<span class="st">"VehGas"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>Regular    10744
Diesel      8006
Name: VehGas, dtype: int64</code></pre>
</div>
</div>
<div class="cell quarto-layout-cell" data-execution_count="34" style="flex-basis: 50.0%;justify-content: center;">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1"></a>X_train[<span class="st">"Region"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>R24    6520
R82    2082
R11    1925
       ... 
R83      80
R42      49
R43      26
Name: Region, Length: 22, dtype: int64</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="ordinal-binary-categories-are-easy" class="slide level2">
<h2>Ordinal &amp; binary categories are easy</h2>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OrdinalEncoder</span>
<span id="cb59-2"><a href="#cb59-2"></a>oe <span class="op">=</span> OrdinalEncoder()</span>
<span id="cb59-3"><a href="#cb59-3"></a>oe.fit(X_train[[<span class="st">"Area"</span>, <span class="st">"VehGas"</span>]])</span>
<span id="cb59-4"><a href="#cb59-4"></a>oe.categories_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>[array(['A', 'B', 'C', 'D', 'E', 'F'], dtype=object),
 array(['Diesel', 'Regular'], dtype=object)]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1"></a><span class="cf">for</span> i, area <span class="kw">in</span> <span class="bu">enumerate</span>(oe.categories_[<span class="dv">0</span>]):</span>
<span id="cb61-2"><a href="#cb61-2"></a>    <span class="bu">print</span>(<span class="ss">f"The Area value </span><span class="sc">{</span>area<span class="sc">}</span><span class="ss"> gets turned into </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The Area value A gets turned into 0.
The Area value B gets turned into 1.
The Area value C gets turned into 2.
The Area value D gets turned into 3.
The Area value E gets turned into 4.
The Area value F gets turned into 5.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1"></a><span class="cf">for</span> i, gas <span class="kw">in</span> <span class="bu">enumerate</span>(oe.categories_[<span class="dv">1</span>]):</span>
<span id="cb63-2"><a href="#cb63-2"></a>    <span class="bu">print</span>(<span class="ss">f"The VehGas value </span><span class="sc">{</span>gas<span class="sc">}</span><span class="ss"> gets turned into </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The VehGas value Diesel gets turned into 0.
The VehGas value Regular gets turned into 1.</code></pre>
</div>
</div>
</section>
<section id="ordinal-encoded-values" class="slide level2">
<h2>Ordinal encoded values</h2>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1"></a>X_train_ord <span class="op">=</span> oe.transform(X_train[[<span class="st">"Area"</span>, <span class="st">"VehGas"</span>]])</span>
<span id="cb65-2"><a href="#cb65-2"></a>X_test_ord <span class="op">=</span> oe.transform(X_test[[<span class="st">"Area"</span>, <span class="st">"VehGas"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1"></a>X_train[[<span class="st">"Area"</span>, <span class="st">"VehGas"</span>]].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Area</th>
      <th>VehGas</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>D</td>
      <td>Diesel</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A</td>
      <td>Regular</td>
    </tr>
    <tr>
      <th>2</th>
      <td>D</td>
      <td>Diesel</td>
    </tr>
    <tr>
      <th>3</th>
      <td>C</td>
      <td>Regular</td>
    </tr>
    <tr>
      <th>4</th>
      <td>C</td>
      <td>Regular</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1"></a>X_train_ord_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Area</th>
      <th>VehGas</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="train-on-ordinal-encoded-values" class="slide level2">
<h2>Train on ordinal encoded values</h2>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1"></a>tf.random.set_seed(<span class="dv">12</span>)</span>
<span id="cb68-2"><a href="#cb68-2"></a>model <span class="op">=</span> Sequential([</span>
<span id="cb68-3"><a href="#cb68-3"></a>  Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"exponential"</span>)</span>
<span id="cb68-4"><a href="#cb68-4"></a>])</span>
<span id="cb68-5"><a href="#cb68-5"></a></span>
<span id="cb68-6"><a href="#cb68-6"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span><span class="st">"adam"</span>, loss<span class="op">=</span><span class="st">"poisson"</span>)</span>
<span id="cb68-7"><a href="#cb68-7"></a></span>
<span id="cb68-8"><a href="#cb68-8"></a>es <span class="op">=</span> EarlyStopping(verbose<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb68-9"><a href="#cb68-9"></a>hist <span class="op">=</span> model.fit(X_train_ord, y_train, epochs<span class="op">=</span><span class="dv">100</span>, verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb68-10"><a href="#cb68-10"></a>    validation_split<span class="op">=</span><span class="fl">0.2</span>, callbacks<span class="op">=</span>[es])</span>
<span id="cb68-11"><a href="#cb68-11"></a>hist.history[<span class="st">"val_loss"</span>][<span class="op">-</span><span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 2: early stopping</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>0.8077167868614197</code></pre>
</div>
</div>
<p><br></p>
<p>What about adding the continuous variables back in? Use a sklearn <em>column transformer</em> for that.</p>
</section>
<section id="preprocess-ordinal-continuous" class="slide level2">
<h2>Preprocess ordinal &amp; continuous</h2>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1"></a>ct <span class="op">=</span> make_column_transformer(</span>
<span id="cb71-2"><a href="#cb71-2"></a>  (OrdinalEncoder(), [<span class="st">"Area"</span>, <span class="st">"VehGas"</span>]),</span>
<span id="cb71-3"><a href="#cb71-3"></a>  (<span class="st">"drop"</span>, [<span class="st">"VehBrand"</span>, <span class="st">"Region"</span>]),</span>
<span id="cb71-4"><a href="#cb71-4"></a>  remainder<span class="op">=</span>StandardScaler()</span>
<span id="cb71-5"><a href="#cb71-5"></a>)</span>
<span id="cb71-6"><a href="#cb71-6"></a>X_train_ct <span class="op">=</span> ct.fit_transform(X_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1"></a>X_train.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Exposure</th>
      <th>Area</th>
      <th>VehPower</th>
      <th>VehAge</th>
      <th>DrivAge</th>
      <th>BonusMalus</th>
      <th>VehBrand</th>
      <th>VehGas</th>
      <th>Density</th>
      <th>Region</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.00</td>
      <td>D</td>
      <td>6.0</td>
      <td>9.0</td>
      <td>37.0</td>
      <td>50.0</td>
      <td>B3</td>
      <td>Diesel</td>
      <td>1313.0</td>
      <td>R24</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.00</td>
      <td>A</td>
      <td>7.0</td>
      <td>10.0</td>
      <td>44.0</td>
      <td>50.0</td>
      <td>B1</td>
      <td>Regular</td>
      <td>18.0</td>
      <td>R26</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.21</td>
      <td>D</td>
      <td>6.0</td>
      <td>0.0</td>
      <td>30.0</td>
      <td>53.0</td>
      <td>B12</td>
      <td>Diesel</td>
      <td>804.0</td>
      <td>R53</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1"></a>X_train_ct_df.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Area</th>
      <th>VehGas</th>
      <th>Exposure</th>
      <th>VehPower</th>
      <th>VehAge</th>
      <th>DrivAge</th>
      <th>BonusMalus</th>
      <th>Density</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3.0</td>
      <td>0.0</td>
      <td>1.131364</td>
      <td>-0.168778</td>
      <td>0.385190</td>
      <td>-0.520836</td>
      <td>-0.636750</td>
      <td>-0.063352</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.131364</td>
      <td>0.362283</td>
      <td>0.559373</td>
      <td>-0.042160</td>
      <td>-0.636750</td>
      <td>-0.393387</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>0.0</td>
      <td>-0.986715</td>
      <td>-0.168778</td>
      <td>-1.182454</td>
      <td>-0.999512</td>
      <td>-0.460534</td>
      <td>-0.193072</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="categorical-variables-entity-embeddings" class="title-slide slide level1 center" data-background-image="unsw-yellow-shape.png" data-visibility="uncounted">
<h1>Categorical Variables &amp; Entity Embeddings</h1>

</section>
<section id="entity-embeddings" class="slide level2">
<h2>Entity embeddings</h2>

<img data-src="Geron-mls2_1304-blur.png" class="r-stretch quarto-figure-center"><p class="caption">Embeddings will gradually improve during training.</p><div class="footer">
<p>Source: Aurélien Géron (2019), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, Figure 13-4 (<strong>redacted</strong>).</p>
</div>
</section>
<section id="pass-categorical-variables-to-keras" class="slide level2">
<h2>Pass categorical variables to Keras</h2>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1"></a>oe <span class="op">=</span> OrdinalEncoder()</span>
<span id="cb74-2"><a href="#cb74-2"></a>X_train_reg <span class="op">=</span> oe.fit_transform(X_train[[<span class="st">"Region"</span>]])</span>
<span id="cb74-3"><a href="#cb74-3"></a>X_test_reg <span class="op">=</span> oe.transform(X_test[[<span class="st">"Region"</span>]])</span>
<span id="cb74-4"><a href="#cb74-4"></a></span>
<span id="cb74-5"><a href="#cb74-5"></a><span class="cf">for</span> i, reg <span class="kw">in</span> <span class="bu">enumerate</span>(oe.categories_[<span class="dv">0</span>][:<span class="dv">3</span>]):</span>
<span id="cb74-6"><a href="#cb74-6"></a>  <span class="bu">print</span>(<span class="ss">f"The Region value </span><span class="sc">{</span>reg<span class="sc">}</span><span class="ss"> gets turned into </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The Region value R11 gets turned into 0.
The Region value R21 gets turned into 1.
The Region value R22 gets turned into 2.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Embedding</span>
<span id="cb76-2"><a href="#cb76-2"></a>NUM_REGIONS <span class="op">=</span> <span class="bu">len</span>(np.unique(X_train[[<span class="st">"Region"</span>]]))</span>
<span id="cb76-3"><a href="#cb76-3"></a></span>
<span id="cb76-4"><a href="#cb76-4"></a>tf.random.set_seed(<span class="dv">12</span>)</span>
<span id="cb76-5"><a href="#cb76-5"></a>model <span class="op">=</span> Sequential([</span>
<span id="cb76-6"><a href="#cb76-6"></a>  Embedding(input_dim<span class="op">=</span>NUM_REGIONS, output_dim<span class="op">=</span><span class="dv">2</span>),</span>
<span id="cb76-7"><a href="#cb76-7"></a>  Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"exponential"</span>)</span>
<span id="cb76-8"><a href="#cb76-8"></a>])</span>
<span id="cb76-9"><a href="#cb76-9"></a></span>
<span id="cb76-10"><a href="#cb76-10"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span><span class="st">"adam"</span>, loss<span class="op">=</span><span class="st">"poisson"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fitting-that-model" class="slide level2">
<h2>Fitting that model</h2>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1"></a>es <span class="op">=</span> EarlyStopping(verbose<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb77-2"><a href="#cb77-2"></a>hist <span class="op">=</span> model.fit(X_train_reg, y_train, epochs<span class="op">=</span><span class="dv">100</span>, verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb77-3"><a href="#cb77-3"></a>    validation_split<span class="op">=</span><span class="fl">0.2</span>, callbacks<span class="op">=</span>[es])</span>
<span id="cb77-4"><a href="#cb77-4"></a>hist.history[<span class="st">"val_loss"</span>][<span class="op">-</span><span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 2: early stopping</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>0.7615119814872742</code></pre>
</div>
</div>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1"></a>model.layers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<pre><code>[&lt;keras.layers.embeddings.Embedding at 0x163dbde50&gt;,
 &lt;keras.layers.core.dense.Dense at 0x163a9e1c0&gt;]</code></pre>
</div>
</div>
</section>
<section id="keras-embedding-layer" class="slide level2">
<h2>Keras’ Embedding Layer</h2>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1"></a>model.layers[<span class="dv">0</span>].get_weights()[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>array([[ 0.08, -0.1 ],
       [-0.03,  0.02],
       [-0.02,  0.02],
       [ 0.11, -0.07],
       [ 0.28, -0.35],
       [ 0.24, -0.22],
       [ 0.21, -0.25],
       [-0.08,  0.14],
       [ 0.39, -0.32],
       [-0.02, -0.03],
       [ 0.05, -0.1 ],
       [ 0.44, -0.38],
       [ 0.22, -0.25],
       [ 0.37, -0.43],
       [-0.07,  0.02],
       [-0.05,  0.07],
       [ 0.17, -0.26],
       [ 0.33, -0.32],
       [ 0.16, -0.11],
       [-0.07,  0.03],
       [-0.04,  0.07],
       [-0.16,  0.06]], dtype=float32)</code></pre>
</div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1"></a>X_train[<span class="st">"Region"</span>].head(<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>0    R24
1    R26
2    R53
3    R52
Name: Region, dtype: object</code></pre>
</div>
</div>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1"></a>X_train_reg[:<span class="dv">4</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>array([[ 4.],
       [ 6.],
       [12.],
       [11.]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1"></a>model.layers[<span class="dv">0</span>](X_train_reg[:<span class="dv">4</span>]).numpy().squeeze()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>array([[ 0.28, -0.35],
       [ 0.21, -0.25],
       [ 0.22, -0.25],
       [ 0.44, -0.38]], dtype=float32)</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="the-learned-embeddings" class="slide level2">
<h2>The learned embeddings</h2>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1"></a>points <span class="op">=</span> model.layers[<span class="dv">0</span>].get_weights()[<span class="dv">0</span>]</span>
<span id="cb90-2"><a href="#cb90-2"></a>plt.scatter(points[:,<span class="dv">0</span>], points[:,<span class="dv">1</span>])</span>
<span id="cb90-3"><a href="#cb90-3"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(NUM_REGIONS):</span>
<span id="cb90-4"><a href="#cb90-4"></a>  plt.text(points[i,<span class="dv">0</span>]<span class="op">+</span><span class="fl">0.01</span>, points[i,<span class="dv">1</span>] , s<span class="op">=</span>oe.categories_[<span class="dv">0</span>][i])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="network-architectures-for-tabular-data_files/figure-revealjs/cell-56-output-1.png" class="r-stretch"></section>
<section id="embeddings-other-inputs" class="slide level2">
<h2>Embeddings &amp; other inputs</h2>

<img data-src="nn-with-entity-embedding-diagram.png" class="r-stretch quarto-figure-center"><p class="caption">Illustration of a neural network with both continuous and categorical inputs.</p><p>We can’t do this with Sequential models…</p>
<div class="footer">
<p>Source: LotusLabs Blog, <a href="https://www.lotuslabs.ai/accurate-insurance-claims-prediction-with-deep-learning/">Accurate insurance claims prediction with Deep Learning</a>.</p>
</div>
</section></section>
<section>
<section id="keras-functional-api" class="title-slide slide level1 center" data-background-image="unsw-yellow-shape.png" data-visibility="uncounted">
<h1>Keras’ Functional API</h1>

</section>
<section id="converting-sequential-models" class="slide level2">
<h2>Converting Sequential models</h2>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1"></a><span class="im">from</span> tensorflow.keras.models <span class="im">import</span> Model</span>
<span id="cb91-2"><a href="#cb91-2"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Input</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1"></a>tf.random.set_seed(<span class="dv">12</span>)</span>
<span id="cb92-2"><a href="#cb92-2"></a></span>
<span id="cb92-3"><a href="#cb92-3"></a>model <span class="op">=</span> Sequential([</span>
<span id="cb92-4"><a href="#cb92-4"></a>  Dense(<span class="dv">30</span>, <span class="st">"relu"</span>),</span>
<span id="cb92-5"><a href="#cb92-5"></a>  Dense(<span class="dv">1</span>, <span class="st">"exponential"</span>)</span>
<span id="cb92-6"><a href="#cb92-6"></a>])</span>
<span id="cb92-7"><a href="#cb92-7"></a></span>
<span id="cb92-8"><a href="#cb92-8"></a>model.<span class="bu">compile</span>(</span>
<span id="cb92-9"><a href="#cb92-9"></a>  optimizer<span class="op">=</span><span class="st">"adam"</span>,</span>
<span id="cb92-10"><a href="#cb92-10"></a>  loss<span class="op">=</span><span class="st">"poisson"</span>)</span>
<span id="cb92-11"><a href="#cb92-11"></a></span>
<span id="cb92-12"><a href="#cb92-12"></a>hist <span class="op">=</span> model.fit(</span>
<span id="cb92-13"><a href="#cb92-13"></a>  X_train_ord, y_train,</span>
<span id="cb92-14"><a href="#cb92-14"></a>  epochs<span class="op">=</span><span class="dv">1</span>, verbose<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb92-15"><a href="#cb92-15"></a>  validation_split<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb92-16"><a href="#cb92-16"></a>hist.history[<span class="st">"val_loss"</span>][<span class="op">-</span><span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>0.7956936359405518</code></pre>
</div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1"></a>tf.random.set_seed(<span class="dv">12</span>)</span>
<span id="cb94-2"><a href="#cb94-2"></a></span>
<span id="cb94-3"><a href="#cb94-3"></a>inputs <span class="op">=</span> Input(shape<span class="op">=</span>(<span class="dv">2</span>,))</span>
<span id="cb94-4"><a href="#cb94-4"></a>x <span class="op">=</span> Dense(<span class="dv">30</span>, <span class="st">"relu"</span>)(inputs)</span>
<span id="cb94-5"><a href="#cb94-5"></a>out <span class="op">=</span> Dense(<span class="dv">1</span>, <span class="st">"exponential"</span>)(x)</span>
<span id="cb94-6"><a href="#cb94-6"></a>model <span class="op">=</span> Model(inputs, out)</span>
<span id="cb94-7"><a href="#cb94-7"></a></span>
<span id="cb94-8"><a href="#cb94-8"></a>model.<span class="bu">compile</span>(</span>
<span id="cb94-9"><a href="#cb94-9"></a>  optimizer<span class="op">=</span><span class="st">"adam"</span>,</span>
<span id="cb94-10"><a href="#cb94-10"></a>  loss<span class="op">=</span><span class="st">"poisson"</span>)</span>
<span id="cb94-11"><a href="#cb94-11"></a></span>
<span id="cb94-12"><a href="#cb94-12"></a>hist <span class="op">=</span> model.fit(</span>
<span id="cb94-13"><a href="#cb94-13"></a>  X_train_ord, y_train,</span>
<span id="cb94-14"><a href="#cb94-14"></a>  epochs<span class="op">=</span><span class="dv">1</span>, verbose<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb94-15"><a href="#cb94-15"></a>  validation_split<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb94-16"><a href="#cb94-16"></a>hist.history[<span class="st">"val_loss"</span>][<span class="op">-</span><span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>0.7956936359405518</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="one-length-tuples" class="slide level2">
<h2>One-length tuples</h2>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1"></a>usingBracketsInMath <span class="op">=</span> (<span class="dv">2</span> <span class="op">+</span> <span class="dv">4</span>) <span class="op">*</span> <span class="dv">3</span></span>
<span id="cb96-2"><a href="#cb96-2"></a>usingBracketsToSimplify <span class="op">=</span> (<span class="dv">1</span> <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1"></a>failureOfATuple <span class="op">=</span> (<span class="st">"Snowy"</span>)</span>
<span id="cb97-2"><a href="#cb97-2"></a><span class="bu">type</span>(failureOfATuple)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>str</code></pre>
</div>
</div>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1"></a>happySoloTuple <span class="op">=</span> (<span class="st">"Snowy"</span>,)</span>
<span id="cb99-2"><a href="#cb99-2"></a><span class="bu">type</span>(happySoloTuple)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<pre><code>tuple</code></pre>
</div>
</div>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1"></a>cheekySoloList <span class="op">=</span> [<span class="st">"Snowy"</span>]</span>
<span id="cb101-2"><a href="#cb101-2"></a><span class="bu">type</span>(cheekySoloList)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">
<pre><code>list</code></pre>
</div>
</div>
</section>
<section id="wide-deep-network" class="slide level2">
<h2>Wide &amp; Deep network</h2>
<div class="columns">
<div class="column" style="width:45%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Geron-mls2_1014-blur.png"></p>
<p></p><figcaption>An illustration of the wide &amp; deep network architecture.</figcaption><p></p>
</figure>
</div>
</div><div class="column" style="width:55%;">
<p>Add a <em>skip connection</em> from input to output layers.</p>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="op">\</span></span>
<span id="cb103-2"><a href="#cb103-2"></a>    <span class="im">import</span> Concatenate</span>
<span id="cb103-3"><a href="#cb103-3"></a></span>
<span id="cb103-4"><a href="#cb103-4"></a>inp <span class="op">=</span> Input(shape<span class="op">=</span>X_train.shape[<span class="dv">1</span>:])</span>
<span id="cb103-5"><a href="#cb103-5"></a>hidden1 <span class="op">=</span> Dense(<span class="dv">30</span>, <span class="st">"relu"</span>)(inp)</span>
<span id="cb103-6"><a href="#cb103-6"></a>hidden2 <span class="op">=</span> Dense(<span class="dv">30</span>, <span class="st">"relu"</span>)(hidden1)</span>
<span id="cb103-7"><a href="#cb103-7"></a>concat <span class="op">=</span> Concatenate()(</span>
<span id="cb103-8"><a href="#cb103-8"></a>  [inp, hidden2])</span>
<span id="cb103-9"><a href="#cb103-9"></a>output <span class="op">=</span> Dense(<span class="dv">1</span>)(concat)</span>
<span id="cb103-10"><a href="#cb103-10"></a>model <span class="op">=</span> Model(</span>
<span id="cb103-11"><a href="#cb103-11"></a>    inputs<span class="op">=</span>[inp],</span>
<span id="cb103-12"><a href="#cb103-12"></a>    outputs<span class="op">=</span>[output])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="footer">
<p>Sources: Aurélien Géron (2019), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, Figure 10-14 (<strong>redacted</strong>) &amp; code snippet.</p>
</div>
</section>
<section id="naming-the-layers" class="slide level2">
<h2>Naming the layers</h2>
<p><br></p>
<p>For complex networks, it is often useful to give meaningul names to the layers.</p>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1"></a>input_ <span class="op">=</span> Input(shape<span class="op">=</span>X_train.shape[<span class="dv">1</span>:], name<span class="op">=</span><span class="st">"input"</span>)</span>
<span id="cb104-2"><a href="#cb104-2"></a>hidden1 <span class="op">=</span> Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"relu"</span>, name<span class="op">=</span><span class="st">"hidden1"</span>)(input_)</span>
<span id="cb104-3"><a href="#cb104-3"></a>hidden2 <span class="op">=</span> Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"relu"</span>, name<span class="op">=</span><span class="st">"hidden2"</span>)(hidden1)</span>
<span id="cb104-4"><a href="#cb104-4"></a>concat <span class="op">=</span> Concatenate(name<span class="op">=</span><span class="st">"combined"</span>)([input_, hidden2])</span>
<span id="cb104-5"><a href="#cb104-5"></a>output <span class="op">=</span> Dense(<span class="dv">1</span>, name<span class="op">=</span><span class="st">"output"</span>)(concat)</span>
<span id="cb104-6"><a href="#cb104-6"></a>model <span class="op">=</span> Model(inputs<span class="op">=</span>[input_], outputs<span class="op">=</span>[output])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="inspecting-a-complex-model" class="slide level2">
<h2>Inspecting a complex model</h2>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1"></a><span class="im">from</span> tensorflow.keras.utils <span class="im">import</span> plot_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="columns">
<div class="column" style="width:30%;">
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1"></a>plot_model(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="66">
<p><img data-src="network-architectures-for-tabular-data_files/figure-revealjs/cell-67-output-1.png"></p>
</div>
</div>
</div><div class="column" style="width:70%;">
<div class="smaller">
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1"></a>model.summary(print_fn<span class="op">=</span>skip_empty, line_length<span class="op">=</span><span class="dv">75</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model: "model_2"
___________________________________________________________________________
Layer (type)           Output Shape     Param #  Connected to
===========================================================================
input (InputLayer)     [(None, 10)]     0        []
hidden1 (Dense)        (None, 30)       330      ['input[0][0]']
hidden2 (Dense)        (None, 30)       930      ['hidden1[0][0]']
combined (Concatenate)  (None, 40)      0        ['input[0][0]',
'hidden2[0][0]']
output (Dense)         (None, 1)        41       ['combined[0][0]']
===========================================================================
Total params: 1,301
Trainable params: 1,301
Non-trainable params: 0
___________________________________________________________________________</code></pre>
</div>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="french-motor-dataset-with-embeddings" class="title-slide slide level1 center" data-background-image="unsw-yellow-shape.png" data-visibility="uncounted">
<h1>French Motor Dataset with Embeddings</h1>

</section>
<section id="the-desired-architecture" class="slide level2">
<h2>The desired architecture</h2>

<img data-src="nn-with-entity-embedding-diagram.png" class="r-stretch quarto-figure-center"><p class="caption">Illustration of a neural network with both continuous and categorical inputs.</p><div class="footer">
<p>Source: LotusLabs Blog, <a href="https://www.lotuslabs.ai/accurate-insurance-claims-prediction-with-deep-learning/">Accurate insurance claims prediction with Deep Learning</a>.</p>
</div>
</section>
<section id="preprocess-all-french-motor-inputs" class="slide level2">
<h2>Preprocess all French motor inputs</h2>
<p>Transform the categorical variables to integers:</p>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1"></a>NUM_BRANDS, NUM_REGIONS <span class="op">=</span> X_train.nunique()[[<span class="st">"VehBrand"</span>, <span class="st">"Region"</span>]]</span>
<span id="cb109-2"><a href="#cb109-2"></a></span>
<span id="cb109-3"><a href="#cb109-3"></a>ct <span class="op">=</span> make_column_transformer(</span>
<span id="cb109-4"><a href="#cb109-4"></a>  (OrdinalEncoder(), [<span class="st">"VehBrand"</span>, <span class="st">"Region"</span>, <span class="st">"Area"</span>, <span class="st">"VehGas"</span>]),</span>
<span id="cb109-5"><a href="#cb109-5"></a>  remainder<span class="op">=</span>StandardScaler()</span>
<span id="cb109-6"><a href="#cb109-6"></a>)</span>
<span id="cb109-7"><a href="#cb109-7"></a>X_train_ct <span class="op">=</span> ct.fit_transform(X_train)</span>
<span id="cb109-8"><a href="#cb109-8"></a>X_test_ct <span class="op">=</span> ct.transform(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Split the brand and region data apart from the rest:</p>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1"></a>X_train_brand <span class="op">=</span> X_train_ct[:,<span class="dv">0</span>]<span class="op">;</span> X_test_brand <span class="op">=</span> X_test_ct[:,<span class="dv">0</span>]</span>
<span id="cb110-2"><a href="#cb110-2"></a>X_train_region <span class="op">=</span> X_train_ct[:,<span class="dv">1</span>]<span class="op">;</span> X_test_region <span class="op">=</span> X_test_ct[:,<span class="dv">1</span>]</span>
<span id="cb110-3"><a href="#cb110-3"></a>X_train_rest <span class="op">=</span> X_train_ct[:,<span class="dv">2</span>:]<span class="op">;</span> X_test_rest <span class="op">=</span> X_test_ct[:,<span class="dv">2</span>:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="organise-the-inputs" class="slide level2">
<h2>Organise the inputs</h2>
<p>Make a Keras <code>Input</code> for: vehicle brand, region, &amp; others.</p>
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1"></a>vehBrand <span class="op">=</span> Input(shape<span class="op">=</span>(<span class="dv">1</span>,), name<span class="op">=</span><span class="st">"vehBrand"</span>)</span>
<span id="cb111-2"><a href="#cb111-2"></a>region <span class="op">=</span> Input(shape<span class="op">=</span>(<span class="dv">1</span>,), name<span class="op">=</span><span class="st">"region"</span>)</span>
<span id="cb111-3"><a href="#cb111-3"></a>otherInputs <span class="op">=</span> Input(shape<span class="op">=</span>X_train_rest.shape[<span class="dv">1</span>:], name<span class="op">=</span><span class="st">"otherInputs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create embeddings and join them with the other inputs.</p>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Reshape</span>
<span id="cb112-2"><a href="#cb112-2"></a></span>
<span id="cb112-3"><a href="#cb112-3"></a>tf.random.set_seed(<span class="dv">1337</span>)</span>
<span id="cb112-4"><a href="#cb112-4"></a>vehBrandEE <span class="op">=</span> Embedding(input_dim<span class="op">=</span>NUM_BRANDS, output_dim<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb112-5"><a href="#cb112-5"></a>    name<span class="op">=</span><span class="st">"vehBrandEE"</span>)(vehBrand)</span>
<span id="cb112-6"><a href="#cb112-6"></a>vehBrandEE <span class="op">=</span> Reshape(target_shape<span class="op">=</span>(<span class="dv">2</span>,))(vehBrandEE)</span>
<span id="cb112-7"><a href="#cb112-7"></a></span>
<span id="cb112-8"><a href="#cb112-8"></a>regionEE <span class="op">=</span> Embedding(input_dim<span class="op">=</span>NUM_REGIONS, output_dim<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb112-9"><a href="#cb112-9"></a>    name<span class="op">=</span><span class="st">"regionEE"</span>)(region)</span>
<span id="cb112-10"><a href="#cb112-10"></a>regionEE <span class="op">=</span> Reshape(target_shape<span class="op">=</span>(<span class="dv">2</span>,))(regionEE)</span>
<span id="cb112-11"><a href="#cb112-11"></a></span>
<span id="cb112-12"><a href="#cb112-12"></a>x <span class="op">=</span> Concatenate(name<span class="op">=</span><span class="st">"combined"</span>)([vehBrandEE, regionEE, otherInputs])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="complete-the-model-and-fit-it" class="slide level2">
<h2>Complete the model and fit it</h2>
<p>Feed the combined embeddings &amp; continuous inputs to some normal dense layers.</p>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1"></a>x <span class="op">=</span> Dense(<span class="dv">30</span>, <span class="st">"relu"</span>, name<span class="op">=</span><span class="st">"hidden"</span>)(x)</span>
<span id="cb113-2"><a href="#cb113-2"></a>out <span class="op">=</span> Dense(<span class="dv">1</span>, <span class="st">"exponential"</span>, name<span class="op">=</span><span class="st">"out"</span>)(x)</span>
<span id="cb113-3"><a href="#cb113-3"></a></span>
<span id="cb113-4"><a href="#cb113-4"></a>model <span class="op">=</span> Model([vehBrand, region, otherInputs], out)</span>
<span id="cb113-5"><a href="#cb113-5"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span><span class="st">"adam"</span>, loss<span class="op">=</span><span class="st">"poisson"</span>)</span>
<span id="cb113-6"><a href="#cb113-6"></a></span>
<span id="cb113-7"><a href="#cb113-7"></a>hist <span class="op">=</span> model.fit((X_train_brand, X_train_region, X_train_rest),</span>
<span id="cb113-8"><a href="#cb113-8"></a>    y_train, epochs<span class="op">=</span><span class="dv">100</span>, verbose<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb113-9"><a href="#cb113-9"></a>    callbacks<span class="op">=</span>[EarlyStopping(patience<span class="op">=</span><span class="dv">5</span>)], validation_split<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb113-10"><a href="#cb113-10"></a>np.<span class="bu">min</span>(hist.history[<span class="st">"val_loss"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="72">
<pre><code>0.6861889958381653</code></pre>
</div>
</div>
</section>
<section id="plotting-this-model" class="slide level2">
<h2>Plotting this model</h2>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1"></a>plot_model(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="network-architectures-for-tabular-data_files/figure-revealjs/cell-74-output-1.png" class="r-stretch"></section>
<section id="why-we-need-to-reshape" class="slide level2">
<h2>Why we need to reshape</h2>
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1"></a>plot_model(model, layer_range<span class="op">=</span>(<span class="st">""</span>, <span class="st">"combined"</span>), show_shapes<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="network-architectures-for-tabular-data_files/figure-revealjs/cell-75-output-1.png" class="r-stretch"></section>
<section id="just-slicing-up-one-input" class="slide level2">
<h2>Just slicing up one <code>Input</code></h2>
<div class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1"></a>tf.random.set_seed(<span class="dv">1337</span>)</span>
<span id="cb117-2"><a href="#cb117-2"></a>inputs <span class="op">=</span> Input(shape<span class="op">=</span>(X_train_ct.shape[<span class="dv">1</span>],))</span>
<span id="cb117-3"><a href="#cb117-3"></a></span>
<span id="cb117-4"><a href="#cb117-4"></a>vehBrandEE <span class="op">=</span> Embedding(input_dim<span class="op">=</span>NUM_BRANDS, output_dim<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb117-5"><a href="#cb117-5"></a>    name<span class="op">=</span><span class="st">"vehBrandEE"</span>)(inputs[:,<span class="dv">0</span>])</span>
<span id="cb117-6"><a href="#cb117-6"></a>regionEE <span class="op">=</span> Embedding(input_dim<span class="op">=</span>NUM_REGIONS, output_dim<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb117-7"><a href="#cb117-7"></a>    name<span class="op">=</span><span class="st">"regionEE"</span>)(inputs[:,<span class="dv">1</span>])</span>
<span id="cb117-8"><a href="#cb117-8"></a></span>
<span id="cb117-9"><a href="#cb117-9"></a>x <span class="op">=</span> Concatenate(name<span class="op">=</span><span class="st">"combined"</span>)([vehBrandEE, regionEE, inputs[:,<span class="dv">2</span>:]])</span>
<span id="cb117-10"><a href="#cb117-10"></a>x <span class="op">=</span> Dense(<span class="dv">30</span>, <span class="st">"relu"</span>, name<span class="op">=</span><span class="st">"hidden"</span>)(x)</span>
<span id="cb117-11"><a href="#cb117-11"></a>out <span class="op">=</span> Dense(<span class="dv">1</span>, <span class="st">"exponential"</span>, name<span class="op">=</span><span class="st">"out"</span>)(x)</span>
<span id="cb117-12"><a href="#cb117-12"></a></span>
<span id="cb117-13"><a href="#cb117-13"></a>model <span class="op">=</span> Model(inputs, out)</span>
<span id="cb117-14"><a href="#cb117-14"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span><span class="st">"adam"</span>, loss<span class="op">=</span><span class="st">"poisson"</span>)</span>
<span id="cb117-15"><a href="#cb117-15"></a></span>
<span id="cb117-16"><a href="#cb117-16"></a>hist <span class="op">=</span> model.fit(X_train_ct, y_train, epochs<span class="op">=</span><span class="dv">100</span>, verbose<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb117-17"><a href="#cb117-17"></a>    callbacks<span class="op">=</span>[EarlyStopping(patience<span class="op">=</span><span class="dv">5</span>)], validation_split<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb117-18"><a href="#cb117-18"></a>np.<span class="bu">min</span>(hist.history[<span class="st">"val_loss"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="75">
<pre><code>0.6861889958381653</code></pre>
</div>
</div>
</section>
<section id="plotting-this-model-1" class="slide level2">
<h2>Plotting this model</h2>
<div class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1"></a>plot_model(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="network-architectures-for-tabular-data_files/figure-revealjs/cell-77-output-1.png" class="r-stretch"></section>
<section id="plotting-this-model-2" class="slide level2" data-visibility="uncounted">
<h2>Plotting this model</h2>
<div class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1"></a>plot_model(model, show_shapes<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="network-architectures-for-tabular-data_files/figure-revealjs/cell-78-output-1.png" class="r-stretch"></section></section>
<section>
<section id="scale-by-exposure" class="title-slide slide level1 center" data-background-image="unsw-yellow-shape.png" data-visibility="uncounted">
<h1>Scale By Exposure</h1>

</section>
<section id="two-different-models" class="slide level2">
<h2>Two different models</h2>
<p>Have <span class="math inline">\(\{ (\mathbf{x}_i, y_i) \}_{i=1, \dots, n}\)</span> for <span class="math inline">\(\mathbf{x}_i \in \mathbb{R}^{47}\)</span> and <span class="math inline">\(y_i \in \mathbb{N}_0\)</span>.</p>
<p><br></p>
<p><strong>Model 1</strong>: Say <span class="math inline">\(Y_i \sim \mathsf{Poisson}(\lambda(\mathbf{x}_i))\)</span>.</p>
<p>But, the exposures are different for each policy. <span class="math inline">\(\lambda(\mathbf{x}_i)\)</span> is the expected number of claims for the duration of policy <span class="math inline">\(i\)</span>’s contract.</p>
<p><br></p>
<p><strong>Model 2</strong>: Say <span class="math inline">\(Y_i \sim \mathsf{Poisson}(\text{Exposure}_i \times \lambda(\mathbf{x}_i))\)</span>.</p>
<p>Now, <span class="math inline">\(\text{Exposure}_i \not\in \mathbf{x}_i\)</span>, and <span class="math inline">\(\lambda(\mathbf{x}_i)\)</span> is the rate <em>per year</em>.</p>
</section>
<section id="just-take-continuous-variables" class="slide level2">
<h2>Just take continuous variables</h2>
<div class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1"></a>ct <span class="op">=</span> make_column_transformer(</span>
<span id="cb121-2"><a href="#cb121-2"></a>  (<span class="st">"passthrough"</span>, [<span class="st">"Exposure"</span>]),</span>
<span id="cb121-3"><a href="#cb121-3"></a>  (<span class="st">"drop"</span>, [<span class="st">"VehBrand"</span>, <span class="st">"Region"</span>, <span class="st">"Area"</span>, <span class="st">"VehGas"</span>]),</span>
<span id="cb121-4"><a href="#cb121-4"></a>  remainder<span class="op">=</span>StandardScaler()</span>
<span id="cb121-5"><a href="#cb121-5"></a>)</span>
<span id="cb121-6"><a href="#cb121-6"></a>X_train_ct <span class="op">=</span> ct.fit_transform(X_train)</span>
<span id="cb121-7"><a href="#cb121-7"></a>X_test_ct <span class="op">=</span> ct.transform(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Split exposure apart from the rest:</p>
<div class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1"></a>X_train_exp <span class="op">=</span> X_train_ct[:,<span class="dv">0</span>]<span class="op">;</span> X_test_exp <span class="op">=</span> X_test_ct[:,<span class="dv">0</span>]</span>
<span id="cb122-2"><a href="#cb122-2"></a>X_train_rest <span class="op">=</span> X_train_ct[:,<span class="dv">1</span>:]<span class="op">;</span> X_test_rest <span class="op">=</span> X_test_ct[:,<span class="dv">1</span>:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Organise the inputs:</p>
<div class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1"></a>exposure <span class="op">=</span> Input(shape<span class="op">=</span>(<span class="dv">1</span>,), name<span class="op">=</span><span class="st">"exposure"</span>)</span>
<span id="cb123-2"><a href="#cb123-2"></a>otherInputs <span class="op">=</span> Input(shape<span class="op">=</span>X_train_rest.shape[<span class="dv">1</span>:], name<span class="op">=</span><span class="st">"otherInputs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="make-fit-the-model" class="slide level2">
<h2>Make &amp; fit the model</h2>
<p>Feed the continuous inputs to some normal dense layers.</p>
<div class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1"></a>tf.random.set_seed(<span class="dv">1337</span>)</span>
<span id="cb124-2"><a href="#cb124-2"></a>x <span class="op">=</span> Dense(<span class="dv">30</span>, <span class="st">"relu"</span>, name<span class="op">=</span><span class="st">"hidden1"</span>)(otherInputs)</span>
<span id="cb124-3"><a href="#cb124-3"></a>x <span class="op">=</span> Dense(<span class="dv">30</span>, <span class="st">"relu"</span>, name<span class="op">=</span><span class="st">"hidden2"</span>)(x)</span>
<span id="cb124-4"><a href="#cb124-4"></a>lambda_ <span class="op">=</span> Dense(<span class="dv">1</span>, <span class="st">"exponential"</span>, name<span class="op">=</span><span class="st">"lambda"</span>)(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Multiply</span>
<span id="cb125-2"><a href="#cb125-2"></a></span>
<span id="cb125-3"><a href="#cb125-3"></a>out <span class="op">=</span> Multiply(name<span class="op">=</span><span class="st">"out"</span>)([lambda_, exposure])</span>
<span id="cb125-4"><a href="#cb125-4"></a>model <span class="op">=</span> Model([exposure, otherInputs], out)</span>
<span id="cb125-5"><a href="#cb125-5"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span><span class="st">"adam"</span>, loss<span class="op">=</span><span class="st">"poisson"</span>)</span>
<span id="cb125-6"><a href="#cb125-6"></a></span>
<span id="cb125-7"><a href="#cb125-7"></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">10</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>, verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb125-8"><a href="#cb125-8"></a>hist <span class="op">=</span> model.fit((X_train_exp, X_train_rest),</span>
<span id="cb125-9"><a href="#cb125-9"></a>    y_train, epochs<span class="op">=</span><span class="dv">100</span>, verbose<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb125-10"><a href="#cb125-10"></a>    callbacks<span class="op">=</span>[es], validation_split<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb125-11"><a href="#cb125-11"></a>np.<span class="bu">min</span>(hist.history[<span class="st">"val_loss"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Restoring model weights from the end of the best epoch: 22.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 32: early stopping</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="82">
<pre><code>0.9111013412475586</code></pre>
</div>
</div>
</section>
<section id="plot-the-model" class="slide level2">
<h2>Plot the model</h2>
<div class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1"></a>plot_model(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="network-architectures-for-tabular-data_files/figure-revealjs/cell-84-output-1.png" class="r-stretch"></section></section>
<section>
<section id="multi-task-learning" class="title-slide slide level1 center" data-background-image="unsw-yellow-shape.png" data-visibility="uncounted">
<h1>Multi-task Learning</h1>

</section>
<section id="swedish-third-party-motor-insurance" class="slide level2">
<h2>Swedish third party motor insurance</h2>
<p>This example is by Jacky Poon (next week’s guest lecturer).</p>
<div class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1"></a>url <span class="op">=</span> <span class="st">"http://www.statsci.org/data/general/motorins.txt"</span></span>
<span id="cb130-2"><a href="#cb130-2"></a>df <span class="op">=</span> pd.read_csv(url, sep<span class="op">=</span><span class="st">"</span><span class="ch">\t</span><span class="st">"</span>) <span class="op">\</span></span>
<span id="cb130-3"><a href="#cb130-3"></a>  .assign(</span>
<span id="cb130-4"><a href="#cb130-4"></a>    frequency <span class="op">=</span> <span class="kw">lambda</span> x: x.Claims <span class="op">/</span> x.Insured,</span>
<span id="cb130-5"><a href="#cb130-5"></a>    severity <span class="op">=</span> <span class="kw">lambda</span> x: np.where(x.Claims <span class="op">==</span> <span class="dv">0</span>, <span class="dv">0</span>, x.Payment <span class="op">/</span> x.Claims),</span>
<span id="cb130-6"><a href="#cb130-6"></a>    risk_premium <span class="op">=</span> <span class="kw">lambda</span> x: x.Payment <span class="op">/</span> x.Insured</span>
<span id="cb130-7"><a href="#cb130-7"></a>  )</span>
<span id="cb130-8"><a href="#cb130-8"></a>train, test <span class="op">=</span> train_test_split(df, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">12345</span>)</span>
<span id="cb130-9"><a href="#cb130-9"></a>df.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="84">

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Kilometres</th>
      <th>Zone</th>
      <th>Bonus</th>
      <th>Make</th>
      <th>Insured</th>
      <th>Claims</th>
      <th>Payment</th>
      <th>frequency</th>
      <th>severity</th>
      <th>risk_premium</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>455.13</td>
      <td>108</td>
      <td>392491</td>
      <td>0.237295</td>
      <td>3634.175926</td>
      <td>862.371191</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>69.17</td>
      <td>19</td>
      <td>46221</td>
      <td>0.274686</td>
      <td>2432.684211</td>
      <td>668.223218</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>72.88</td>
      <td>13</td>
      <td>15694</td>
      <td>0.178375</td>
      <td>1207.230769</td>
      <td>215.340285</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="footer">
<p>Source: Poon (2021), <a href="https://actuariesinstitute.github.io/cookbook/docs/multitasking_risk_pricing.html"><em>Multitasking Risk Pricing Using Deep Learning</em></a>, Actuaries’ Analytical Cookbook.</p>
</div>
</section>
<section id="summarise-the-targets" class="slide level2">
<h2>Summarise the targets</h2>
<div class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1"></a>totals <span class="op">=</span> train.loc[:, [<span class="st">"Insured"</span>, <span class="st">"Claims"</span>, <span class="st">"Payment"</span>]].agg(<span class="st">'sum'</span>)</span>
<span id="cb131-2"><a href="#cb131-2"></a>train_average_frequency <span class="op">=</span> totals[<span class="st">"Claims"</span>] <span class="op">/</span> totals[<span class="st">"Insured"</span>]</span>
<span id="cb131-3"><a href="#cb131-3"></a>train_average_severity <span class="op">=</span> totals[<span class="st">"Payment"</span>] <span class="op">/</span> totals[<span class="st">"Claims"</span>]</span>
<span id="cb131-4"><a href="#cb131-4"></a>train_average_risk_premium <span class="op">=</span> totals[<span class="st">"Payment"</span>] <span class="op">/</span> totals[<span class="st">"Insured"</span>]</span>
<span id="cb131-5"><a href="#cb131-5"></a><span class="bu">print</span>(train_average_frequency,</span>
<span id="cb131-6"><a href="#cb131-6"></a>  train_average_severity,</span>
<span id="cb131-7"><a href="#cb131-7"></a>  train_average_risk_premium)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.0474910948615842 4959.405313081085 235.5275881805785</code></pre>
</div>
</div>
<div class="footer">
<p>Source: Poon (2021), <a href="https://actuariesinstitute.github.io/cookbook/docs/multitasking_risk_pricing.html"><em>Multitasking Risk Pricing Using Deep Learning</em></a>, Actuaries’ Analytical Cookbook.</p>
</div>
</section>
<section id="organising-the-inputs" class="slide level2">
<h2>Organising the inputs</h2>
<div class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1"></a>zone_input <span class="op">=</span> Input(shape<span class="op">=</span>(<span class="dv">1</span>,), name<span class="op">=</span><span class="st">'zone_input'</span>) </span>
<span id="cb133-2"><a href="#cb133-2"></a>make_input <span class="op">=</span> Input(shape<span class="op">=</span>(<span class="dv">1</span>,), name<span class="op">=</span><span class="st">'make_input'</span>)</span>
<span id="cb133-3"><a href="#cb133-3"></a></span>
<span id="cb133-4"><a href="#cb133-4"></a>zone_embedding <span class="op">=</span> Embedding(output_dim<span class="op">=</span><span class="dv">2</span>, input_dim<span class="op">=</span><span class="dv">7</span>)(zone_input)</span>
<span id="cb133-5"><a href="#cb133-5"></a>zone_embedding <span class="op">=</span> Reshape(target_shape<span class="op">=</span>(<span class="dv">2</span>,))(zone_embedding)</span>
<span id="cb133-6"><a href="#cb133-6"></a>make_embedding <span class="op">=</span> Embedding(output_dim<span class="op">=</span><span class="dv">2</span>, input_dim<span class="op">=</span><span class="dv">9</span>)(make_input)</span>
<span id="cb133-7"><a href="#cb133-7"></a>make_embedding <span class="op">=</span> Reshape(target_shape<span class="op">=</span>(<span class="dv">2</span>,))(make_embedding)</span>
<span id="cb133-8"><a href="#cb133-8"></a></span>
<span id="cb133-9"><a href="#cb133-9"></a>kilometres_input <span class="op">=</span> Input(shape<span class="op">=</span>(<span class="dv">1</span>,), name<span class="op">=</span><span class="st">'kilometres_input'</span>) </span>
<span id="cb133-10"><a href="#cb133-10"></a>bonus_input <span class="op">=</span> Input(shape<span class="op">=</span>(<span class="dv">1</span>,), name<span class="op">=</span><span class="st">'bonus_input'</span>)</span>
<span id="cb133-11"><a href="#cb133-11"></a></span>
<span id="cb133-12"><a href="#cb133-12"></a>x <span class="op">=</span> Concatenate(name<span class="op">=</span><span class="st">"combined"</span>)(</span>
<span id="cb133-13"><a href="#cb133-13"></a>  [zone_embedding, make_embedding, kilometres_input, bonus_input])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">
<p>Source: Poon (2021), <a href="https://actuariesinstitute.github.io/cookbook/docs/multitasking_risk_pricing.html"><em>Multitasking Risk Pricing Using Deep Learning</em></a>, Actuaries’ Analytical Cookbook.</p>
</div>
</section>
<section id="plot-the-incomplete-model" class="slide level2">
<h2>Plot the incomplete model</h2>
<div class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1"></a>model <span class="op">=</span> Model([zone_input, make_input, kilometres_input, bonus_input], x)</span>
<span id="cb134-2"><a href="#cb134-2"></a>plot_model(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="network-architectures-for-tabular-data_files/figure-revealjs/cell-88-output-1.png" class="r-stretch"><div class="footer">
<p>Source: Poon (2021), <a href="https://actuariesinstitute.github.io/cookbook/docs/multitasking_risk_pricing.html"><em>Multitasking Risk Pricing Using Deep Learning</em></a>, Actuaries’ Analytical Cookbook.</p>
</div>
</section>
<section id="add-layers-outputs-create-model" class="slide level2">
<h2>Add layers &amp; outputs, create model</h2>
<div class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1"></a>x <span class="op">=</span> Dense(<span class="dv">64</span>, activation<span class="op">=</span><span class="st">'relu'</span>)(x) </span>
<span id="cb135-2"><a href="#cb135-2"></a>x <span class="op">=</span> Dense(<span class="dv">64</span>, activation<span class="op">=</span><span class="st">'relu'</span>)(x) </span>
<span id="cb135-3"><a href="#cb135-3"></a>x <span class="op">=</span> Dense(<span class="dv">64</span>, activation<span class="op">=</span><span class="st">'relu'</span>)(x)</span>
<span id="cb135-4"><a href="#cb135-4"></a></span>
<span id="cb135-5"><a href="#cb135-5"></a>frequency_output <span class="op">=</span> Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">'relu'</span>, name<span class="op">=</span><span class="st">'frequency'</span>)(x) </span>
<span id="cb135-6"><a href="#cb135-6"></a>severity_output <span class="op">=</span> Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">'relu'</span>, name<span class="op">=</span><span class="st">'severity'</span>)(x) </span>
<span id="cb135-7"><a href="#cb135-7"></a>risk_premium_output <span class="op">=</span> Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">'relu'</span>, name<span class="op">=</span><span class="st">'risk_premium'</span>)(x)</span>
<span id="cb135-8"><a href="#cb135-8"></a></span>
<span id="cb135-9"><a href="#cb135-9"></a>model <span class="op">=</span> Model(</span>
<span id="cb135-10"><a href="#cb135-10"></a>    inputs<span class="op">=</span>[zone_input, make_input, kilometres_input, bonus_input], </span>
<span id="cb135-11"><a href="#cb135-11"></a>    outputs<span class="op">=</span>[frequency_output, severity_output, risk_premium_output])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">
<p>Source: Poon (2021), <a href="https://actuariesinstitute.github.io/cookbook/docs/multitasking_risk_pricing.html"><em>Multitasking Risk Pricing Using Deep Learning</em></a>, Actuaries’ Analytical Cookbook.</p>
</div>
</section>
<section id="plot-the-model-1" class="slide level2">
<h2>Plot the model</h2>
<div class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1"></a>plot_model(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="network-architectures-for-tabular-data_files/figure-revealjs/cell-90-output-1.png" class="r-stretch"></section>
<section id="plot-the-last-part-of-the-model" class="slide level2">
<h2>Plot the last part of the model</h2>
<div class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1"></a>plot_model(model, layer_range<span class="op">=</span>(<span class="st">"combined"</span>, <span class="st">""</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="network-architectures-for-tabular-data_files/figure-revealjs/cell-91-output-1.png" class="r-stretch"><div class="footer">
<p>Source: Poon (2021), <a href="https://actuariesinstitute.github.io/cookbook/docs/multitasking_risk_pricing.html"><em>Multitasking Risk Pricing Using Deep Learning</em></a>, Actuaries’ Analytical Cookbook.</p>
</div>
</section>
<section id="prepare-model-data-for-fitting" class="slide level2">
<h2>Prepare model &amp; data for fitting</h2>
<div class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span><span class="st">'adam'</span>, </span>
<span id="cb138-2"><a href="#cb138-2"></a>  loss <span class="op">=</span> {</span>
<span id="cb138-3"><a href="#cb138-3"></a>    <span class="st">'risk_premium'</span>: <span class="st">'mean_squared_error'</span>,</span>
<span id="cb138-4"><a href="#cb138-4"></a>    <span class="st">'frequency'</span>: <span class="st">'poisson'</span>,</span>
<span id="cb138-5"><a href="#cb138-5"></a>    <span class="st">'severity'</span>: <span class="st">'mean_squared_logarithmic_error'</span></span>
<span id="cb138-6"><a href="#cb138-6"></a>  }, </span>
<span id="cb138-7"><a href="#cb138-7"></a>  loss_weights <span class="op">=</span> {</span>
<span id="cb138-8"><a href="#cb138-8"></a>    <span class="st">'risk_premium'</span>: <span class="fl">1.0</span>,</span>
<span id="cb138-9"><a href="#cb138-9"></a>    <span class="st">'frequency'</span>: <span class="fl">1.0</span>,</span>
<span id="cb138-10"><a href="#cb138-10"></a>    <span class="st">'severity'</span>: <span class="fl">1.0</span></span>
<span id="cb138-11"><a href="#cb138-11"></a>  })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1"></a><span class="kw">def</span> InputDataTransformer(x):</span>
<span id="cb139-2"><a href="#cb139-2"></a>  <span class="cf">return</span> {</span>
<span id="cb139-3"><a href="#cb139-3"></a>  <span class="st">'kilometres_input'</span>: (x.Kilometres.values <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> <span class="dv">5</span>,</span>
<span id="cb139-4"><a href="#cb139-4"></a>  <span class="st">'zone_input'</span>: x.Zone.values <span class="op">-</span> <span class="dv">1</span>,</span>
<span id="cb139-5"><a href="#cb139-5"></a>  <span class="st">'bonus_input'</span>: (x.Bonus.values <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> <span class="dv">7</span>,</span>
<span id="cb139-6"><a href="#cb139-6"></a>  <span class="st">'make_input'</span>: x.Make.values <span class="op">-</span> <span class="dv">1</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">
<p>Source: Poon (2021), <a href="https://actuariesinstitute.github.io/cookbook/docs/multitasking_risk_pricing.html"><em>Multitasking Risk Pricing Using Deep Learning</em></a>, Actuaries’ Analytical Cookbook.</p>
</div>
</section>
<section id="fit-the-data" class="slide level2">
<h2>Fit the data</h2>
<div class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1"></a>model.fit(</span>
<span id="cb140-2"><a href="#cb140-2"></a>  InputDataTransformer(train),</span>
<span id="cb140-3"><a href="#cb140-3"></a>  {</span>
<span id="cb140-4"><a href="#cb140-4"></a>    <span class="st">'frequency'</span>: train.frequency.values<span class="op">/</span>train_average_frequency,</span>
<span id="cb140-5"><a href="#cb140-5"></a>    <span class="st">'severity'</span>: train.severity.values<span class="op">/</span>train_average_severity,</span>
<span id="cb140-6"><a href="#cb140-6"></a>    <span class="st">'risk_premium'</span>: train.risk_premium.values<span class="op">/</span>train_average_risk_premium</span>
<span id="cb140-7"><a href="#cb140-7"></a>  }, </span>
<span id="cb140-8"><a href="#cb140-8"></a>  sample_weight <span class="op">=</span> {</span>
<span id="cb140-9"><a href="#cb140-9"></a>    <span class="st">'frequency'</span>: train.Insured.values,</span>
<span id="cb140-10"><a href="#cb140-10"></a>    <span class="st">'severity'</span>: train.Claims.values,</span>
<span id="cb140-11"><a href="#cb140-11"></a>    <span class="st">'risk_premium'</span>: train.Insured.values</span>
<span id="cb140-12"><a href="#cb140-12"></a>  },</span>
<span id="cb140-13"><a href="#cb140-13"></a>  epochs<span class="op">=</span><span class="dv">40</span>, batch_size<span class="op">=</span><span class="dv">32</span>, verbose<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">
<p>Source: Poon (2021), <a href="https://actuariesinstitute.github.io/cookbook/docs/multitasking_risk_pricing.html"><em>Multitasking Risk Pricing Using Deep Learning</em></a>, Actuaries’ Analytical Cookbook.</p>
</div>
</section></section>
<section>
<section id="keras-eager-execution" class="title-slide slide level1 center" data-background-image="unsw-yellow-shape.png" data-visibility="uncounted">
<h1>Keras Eager Execution</h1>

</section>
<section id="california-housing-with-mathrmex" class="slide level2">
<h2>California housing with <span class="math inline">\(\mathrm{e}^x\)</span></h2>
<div class="columns">
<div class="column">
<p><br></p>
<div class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1"></a>tf.random.set_seed(<span class="dv">123</span>)</span>
<span id="cb141-2"><a href="#cb141-2"></a></span>
<span id="cb141-3"><a href="#cb141-3"></a>model <span class="op">=</span> Sequential([</span>
<span id="cb141-4"><a href="#cb141-4"></a>    Dense(<span class="dv">30</span>,</span>
<span id="cb141-5"><a href="#cb141-5"></a>      activation<span class="op">=</span><span class="st">"relu"</span>,</span>
<span id="cb141-6"><a href="#cb141-6"></a>      name<span class="op">=</span><span class="st">"hidden"</span>),</span>
<span id="cb141-7"><a href="#cb141-7"></a>    Dense(<span class="dv">1</span>,</span>
<span id="cb141-8"><a href="#cb141-8"></a>      activation<span class="op">=</span><span class="st">"exponential"</span>)</span>
<span id="cb141-9"><a href="#cb141-9"></a>])</span>
<span id="cb141-10"><a href="#cb141-10"></a></span>
<span id="cb141-11"><a href="#cb141-11"></a>model.<span class="bu">compile</span>(<span class="st">"adam"</span>, <span class="st">"mse"</span>)</span>
<span id="cb141-12"><a href="#cb141-12"></a>hist <span class="op">=</span> model.fit(X_train, y_train, epochs<span class="op">=</span><span class="dv">5</span>, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb141-13"><a href="#cb141-13"></a>hist.history[<span class="st">"loss"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="95">
<pre><code>[nan, nan, nan, nan, nan]</code></pre>
</div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="96">
<div class="cell-output cell-output-display">
<p><img data-src="network-architectures-for-tabular-data_files/figure-revealjs/cell-97-output-1.png"></p>
</div>
</div>
</div>
</div>
<div class="smaller">
<p>Remember in Week 2, we fit this model to the unscaled California housing dataset.</p>
</div>
</section>
<section id="check-the-initial-activations" class="slide level2">
<h2>Check the initial activations</h2>
<div class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1"></a>tf.random.set_seed(<span class="dv">123</span>)</span>
<span id="cb143-2"><a href="#cb143-2"></a>model <span class="op">=</span> Sequential([</span>
<span id="cb143-3"><a href="#cb143-3"></a>    Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"relu"</span>),</span>
<span id="cb143-4"><a href="#cb143-4"></a>    Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"exponential"</span>)</span>
<span id="cb143-5"><a href="#cb143-5"></a>])</span>
<span id="cb143-6"><a href="#cb143-6"></a></span>
<span id="cb143-7"><a href="#cb143-7"></a>y_pred <span class="op">=</span> model.predict(X_train) </span>
<span id="cb143-8"><a href="#cb143-8"></a>y_pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="97">
<pre><code>array([[     inf],
       [     inf],
       [1.31e+35],
       ...,
       [     inf],
       [     inf],
       [     inf]], dtype=float32)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="dv">100</span><span class="op">*</span>np<span class="sc">.</span>mean(np.isinf(y_pred))<span class="sc">:.2f}</span><span class="ss">% of predictions are inf."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>76.36% of predictions are inf.</code></pre>
</div>
</div>
</section>
<section id="check-the-pre-activations" class="slide level2">
<h2>Check the pre-activations</h2>
<div class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1"></a>tf.random.set_seed(<span class="dv">123</span>)</span>
<span id="cb147-2"><a href="#cb147-2"></a>model <span class="op">=</span> Sequential([</span>
<span id="cb147-3"><a href="#cb147-3"></a>    Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"relu"</span>),</span>
<span id="cb147-4"><a href="#cb147-4"></a>    Dense(<span class="dv">1</span>),</span>
<span id="cb147-5"><a href="#cb147-5"></a>])</span>
<span id="cb147-6"><a href="#cb147-6"></a>preActivations <span class="op">=</span> model.predict(X_train) </span>
<span id="cb147-7"><a href="#cb147-7"></a>plt.hist(preActivations, bins<span class="op">=</span><span class="dv">100</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="network-architectures-for-tabular-data_files/figure-revealjs/cell-100-output-1.png" class="r-stretch"></section>
<section id="check-the-output-of-first-layer" class="slide level2">
<h2>Check the output of first layer</h2>
<div class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1"></a>tf.random.set_seed(<span class="dv">123</span>)</span>
<span id="cb148-2"><a href="#cb148-2"></a>model <span class="op">=</span> Sequential([</span>
<span id="cb148-3"><a href="#cb148-3"></a>    Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"relu"</span>, name<span class="op">=</span><span class="st">"hidden"</span>),</span>
<span id="cb148-4"><a href="#cb148-4"></a>    Dense(<span class="dv">1</span>),</span>
<span id="cb148-5"><a href="#cb148-5"></a>])</span>
<span id="cb148-6"><a href="#cb148-6"></a>hiddenLayer <span class="op">=</span> model.get_layer(<span class="st">"hidden"</span>) <span class="co"># or simply 'model.layers[0]'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1"></a>hiddenLayer(X_train.head(<span class="dv">1</span>)) <span class="co"># Won't work as 'X_train' is a DataFrame.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>AttributeError: 'tuple' object has no attribute 'rank'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1"></a>hiddenLayer(X_train.head(<span class="dv">1</span>).to_numpy()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="102">
<pre><code>&lt;tf.Tensor: shape=(1, 30), dtype=float32, numpy=
array([[  0.  ,   0.  ,   0.  , 154.57, 289.01, 131.85,   0.  ,   0.  ,
         26.33,  48.95,   0.  ,  23.89,   0.  ,   0.  ,   0.  ,   0.  ,
          0.  ,   0.  ,   0.  ,   0.  , 151.69, 193.75,   0.  ,   0.  ,
        135.15,   0.  ,   0.  ,   0.  ,   0.  , 249.42]], dtype=float32)&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1"></a>hiddenLayer(X_train.head(<span class="dv">1</span>).to_numpy()).numpy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="103">
<pre><code>array([[  0.  ,   0.  ,   0.  , 154.57, 289.01, 131.85,   0.  ,   0.  ,
         26.33,  48.95,   0.  ,  23.89,   0.  ,   0.  ,   0.  ,   0.  ,
          0.  ,   0.  ,   0.  ,   0.  , 151.69, 193.75,   0.  ,   0.  ,
        135.15,   0.  ,   0.  ,   0.  ,   0.  , 249.42]], dtype=float32)</code></pre>
</div>
</div>
</section>
<section id="revisit-our-first-ever-neural-network" class="slide level2">
<h2>Revisit our first ever neural network</h2>
<div class="columns">
<div class="column">
<p><br></p>
<div class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1"></a>tf.random.set_seed(<span class="dv">123</span>)</span>
<span id="cb155-2"><a href="#cb155-2"></a></span>
<span id="cb155-3"><a href="#cb155-3"></a>model <span class="op">=</span> Sequential([</span>
<span id="cb155-4"><a href="#cb155-4"></a>    Dense(<span class="dv">30</span>,</span>
<span id="cb155-5"><a href="#cb155-5"></a>      activation<span class="op">=</span><span class="st">"relu"</span>,</span>
<span id="cb155-6"><a href="#cb155-6"></a>      name<span class="op">=</span><span class="st">"hidden"</span>),</span>
<span id="cb155-7"><a href="#cb155-7"></a>    Dense(<span class="dv">1</span>)</span>
<span id="cb155-8"><a href="#cb155-8"></a>])</span>
<span id="cb155-9"><a href="#cb155-9"></a></span>
<span id="cb155-10"><a href="#cb155-10"></a>model.<span class="bu">compile</span>(<span class="st">"adam"</span>, <span class="st">"mse"</span>)</span>
<span id="cb155-11"><a href="#cb155-11"></a>hist <span class="op">=</span> model.fit(X_train, y_train, epochs<span class="op">=</span><span class="dv">5</span>, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb155-12"><a href="#cb155-12"></a>hist.history[<span class="st">"loss"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="104">
<pre><code>[1640.6534423828125,
 4.11346960067749,
 1.8220018148422241,
 1.1254563331604004,
 0.8774542212486267]</code></pre>
</div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="105">
<div class="cell-output cell-output-display">
<p><img data-src="network-architectures-for-tabular-data_files/figure-revealjs/cell-106-output-1.png"></p>
</div>
</div>
</div>
</div>
</section>
<section id="find-dead-relu-neurons" class="slide level2">
<h2>Find dead ReLU neurons</h2>
<div class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1"></a>acts <span class="op">=</span> model.get_layer(<span class="st">"hidden"</span>)(X_train.to_numpy()).numpy()</span>
<span id="cb157-2"><a href="#cb157-2"></a>acts[:<span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="107">
<pre><code>array([[  0.  ,   0.  ,   0.  , ...,   0.  ,   0.  , 215.47],
       [  0.  ,   0.  ,   0.  , ...,   0.  ,   0.  , 240.79],
       [  0.  ,   0.  ,   0.  , ...,   0.  ,   0.  , 172.84]],
      dtype=float32)</code></pre>
</div>
</div>
<div class="fragment">
<div class="cell" data-execution_count="108">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1"></a>acts.mean(axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="108">
<pre><code>array([  0.  ,   0.  ,   0.  , ...,   0.  ,   0.  , 373.75], dtype=float32)</code></pre>
</div>
</div>
</div>
<div class="columns">
<div class="column">
<div class="fragment">
<div class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1"></a>np.<span class="bu">sum</span>(acts.mean(axis<span class="op">=</span><span class="dv">0</span>) <span class="op">==</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="109">
<pre><code>15</code></pre>
</div>
</div>
</div>
</div><div class="column">
<div class="fragment">
<div class="smaller">
<p>My reaction to finding <em>half</em> of my neurons dead..</p>
</div>
<iframe src="https://giphy.com/embed/3ofSBfxkp3fPTgANB6" width="480" height="206" frameborder="0" class="giphy-embed" allowfullscreen="">
</iframe>
</div>
</div>
</div>
</section>
<section id="trying-different-seeds" class="slide level2">
<h2>Trying different seeds</h2>
<p>Create a function which counts the number of dead ReLU neurons in the first hidden layer for a given seed:</p>
<div class="cell" data-execution_count="111">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1"></a><span class="kw">def</span> count_dead(seed):</span>
<span id="cb163-2"><a href="#cb163-2"></a>    tf.random.set_seed(seed)</span>
<span id="cb163-3"><a href="#cb163-3"></a>    hidden <span class="op">=</span> Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"relu"</span>)</span>
<span id="cb163-4"><a href="#cb163-4"></a>    acts <span class="op">=</span> hidden(X_train.to_numpy()).numpy()</span>
<span id="cb163-5"><a href="#cb163-5"></a>    <span class="cf">return</span> np.<span class="bu">sum</span>(acts.mean(axis<span class="op">=</span><span class="dv">0</span>) <span class="op">==</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we can try out different seeds:</p>
<div class="cell" data-execution_count="112">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1"></a>numDead <span class="op">=</span> [count_dead(seed) <span class="cf">for</span> seed <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1_000</span>)]</span>
<span id="cb164-2"><a href="#cb164-2"></a>np.median(numDead)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="112">
<pre><code>5.0</code></pre>
</div>
</div>
</section>
<section id="look-at-distribution-of-dead-relus" class="slide level2">
<h2>Look at distribution of dead ReLUs</h2>
<div class="cell" data-execution_count="113">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1"></a>labels, counts <span class="op">=</span> np.unique(numDead, return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb166-2"><a href="#cb166-2"></a>plt.bar(labels, counts, align<span class="op">=</span><span class="st">'center'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="network-architectures-for-tabular-data_files/figure-revealjs/cell-114-output-1.png" class="r-stretch"></section>
<section id="list-comprehensions" class="slide level2">
<h2>List comprehensions</h2>
<div class="cell" data-execution_count="114">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1"></a>[x<span class="op">**</span><span class="dv">2</span> <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="114">
<pre><code>[0, 1, 4, 9, 16, 25, 36, 49, 64, 81]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="115">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb169-1"><a href="#cb169-1"></a>[x<span class="op">**</span><span class="dv">2</span> <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>) <span class="cf">if</span> x <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="115">
<pre><code>[0, 4, 16, 36, 64]</code></pre>
</div>
</div>
<p>They can get more complicated:</p>
<div class="cell" data-execution_count="116">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1"></a>[x<span class="op">*</span>y <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>) <span class="cf">for</span> y <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="116">
<pre><code>[0, 0, 0, 0, 0, 1, 2, 3, 0, 2, 4, 6, 0, 3, 6, 9]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="117">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb173-1"><a href="#cb173-1"></a>[[x<span class="op">*</span>y <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>)] <span class="cf">for</span> y <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="117">
<pre><code>[[0, 0, 0, 0], [0, 1, 2, 3], [0, 2, 4, 6], [0, 3, 6, 9]]</code></pre>
</div>
</div>
<p>but I’d recommend just using <code>for</code> loops at that point.</p>
</section></section>
<section>
<section id="regularisation" class="title-slide slide level1 center" data-background-image="unsw-yellow-shape.png" data-visibility="uncounted">
<h1>Regularisation</h1>

</section>
<section id="traditional-regularisation" class="slide level2">
<h2>Traditional regularisation</h2>
<p>Say all the <span class="math inline">\(m\)</span> weights are in the vector <span class="math inline">\(\boldsymbol{\theta}\)</span>. If we change the loss function to <span class="math display">\[
\text{Loss}_{1:n}
= \frac{1}{n} \sum_{i=1}^n \text{Loss}_i
  + \lambda \sum_{j=1}^{m} \left| \theta_j \right|
\]</span></p>
<p>this would be using <span class="math inline">\(\ell_1\)</span> regularisation. A loss like</p>
<p><span class="math display">\[
\text{Loss}_{1:n}
= \frac{1}{n} \sum_{i=1}^n \text{Loss}_i
  + \lambda \sum_{j=1}^{m} \theta_j^2
\]</span></p>
<p>is called <span class="math inline">\(\ell_2\)</span> regularisation.</p>
</section>
<section id="regularisation-in-keras" class="slide level2">
<h2>Regularisation in Keras</h2>
<div class="cell" data-execution_count="118">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb175-1"><a href="#cb175-1"></a><span class="im">from</span> tensorflow.keras.regularizers <span class="im">import</span> l1, l2</span>
<span id="cb175-2"><a href="#cb175-2"></a></span>
<span id="cb175-3"><a href="#cb175-3"></a><span class="kw">def</span> l1_model(regulariserStrength<span class="op">=</span><span class="fl">0.01</span>):</span>
<span id="cb175-4"><a href="#cb175-4"></a>  tf.random.set_seed(<span class="dv">123</span>)</span>
<span id="cb175-5"><a href="#cb175-5"></a>  model <span class="op">=</span> Sequential([</span>
<span id="cb175-6"><a href="#cb175-6"></a>      Dense(<span class="dv">30</span>,</span>
<span id="cb175-7"><a href="#cb175-7"></a>        activation<span class="op">=</span><span class="st">"leaky_relu"</span>,</span>
<span id="cb175-8"><a href="#cb175-8"></a>        name<span class="op">=</span><span class="st">"hidden1"</span>),</span>
<span id="cb175-9"><a href="#cb175-9"></a>      Dense(<span class="dv">30</span>,</span>
<span id="cb175-10"><a href="#cb175-10"></a>        activation<span class="op">=</span><span class="st">"leaky_relu"</span>,</span>
<span id="cb175-11"><a href="#cb175-11"></a>        kernel_regularizer<span class="op">=</span>l1(regulariserStrength),</span>
<span id="cb175-12"><a href="#cb175-12"></a>        name<span class="op">=</span><span class="st">"hidden2"</span>),</span>
<span id="cb175-13"><a href="#cb175-13"></a>      Dense(<span class="dv">1</span>, </span>
<span id="cb175-14"><a href="#cb175-14"></a>        activation<span class="op">=</span><span class="st">"exponential"</span>,</span>
<span id="cb175-15"><a href="#cb175-15"></a>        name<span class="op">=</span><span class="st">"output"</span>)</span>
<span id="cb175-16"><a href="#cb175-16"></a>  ])</span>
<span id="cb175-17"><a href="#cb175-17"></a></span>
<span id="cb175-18"><a href="#cb175-18"></a>  model.<span class="bu">compile</span>(<span class="st">"adam"</span>, <span class="st">"mse"</span>)</span>
<span id="cb175-19"><a href="#cb175-19"></a>  model.fit(X_train_sc, y_train, epochs<span class="op">=</span><span class="dv">4</span>, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb175-20"><a href="#cb175-20"></a>  <span class="cf">return</span> model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="weights-before-after-ell_1" class="slide level2">
<h2>Weights before &amp; after <span class="math inline">\(\ell_1\)</span></h2>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="120">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1"></a>model <span class="op">=</span> l1_model(<span class="dv">0</span>)</span>
<span id="cb176-2"><a href="#cb176-2"></a>weights <span class="op">=</span> model.get_layer(<span class="st">"hidden2"</span>).get_weights()[<span class="dv">0</span>].flatten()</span>
<span id="cb176-3"><a href="#cb176-3"></a><span class="bu">print</span>(<span class="ss">f"Number of weights almost 0: </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">sum</span>(np.<span class="bu">abs</span>(weights) <span class="op">&lt;</span> <span class="fl">1e-5</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb176-4"><a href="#cb176-4"></a>plt.hist(weights, bins<span class="op">=</span><span class="dv">100</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of weights almost 0: 0</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img data-src="network-architectures-for-tabular-data_files/figure-revealjs/cell-121-output-2.png"></p>
</div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="121">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1"></a>model <span class="op">=</span> l1_model(<span class="fl">0.1</span>)</span>
<span id="cb178-2"><a href="#cb178-2"></a>weights <span class="op">=</span> model.get_layer(<span class="st">"hidden2"</span>).get_weights()[<span class="dv">0</span>].flatten()</span>
<span id="cb178-3"><a href="#cb178-3"></a><span class="bu">print</span>(<span class="ss">f"Number of weights almost 0: </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">sum</span>(np.<span class="bu">abs</span>(weights) <span class="op">&lt;</span> <span class="fl">1e-5</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb178-4"><a href="#cb178-4"></a>plt.hist(weights, bins<span class="op">=</span><span class="dv">100</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of weights almost 0: 33</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img data-src="network-architectures-for-tabular-data_files/figure-revealjs/cell-122-output-2.png"></p>
</div>
</div>
</div>
</div>
</section>
<section id="weights-before-after-ell_2" class="slide level2">
<h2>Weights before &amp; after <span class="math inline">\(\ell_2\)</span></h2>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="123">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1"></a>model <span class="op">=</span> l2_model(<span class="dv">0</span>)</span>
<span id="cb180-2"><a href="#cb180-2"></a>weights <span class="op">=</span> model.get_layer(<span class="st">"hidden2"</span>).get_weights()[<span class="dv">0</span>].flatten()</span>
<span id="cb180-3"><a href="#cb180-3"></a><span class="bu">print</span>(<span class="ss">f"Number of weights almost 0: </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">sum</span>(np.<span class="bu">abs</span>(weights) <span class="op">&lt;</span> <span class="fl">1e-5</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb180-4"><a href="#cb180-4"></a>plt.hist(weights, bins<span class="op">=</span><span class="dv">100</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of weights almost 0: 0</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img data-src="network-architectures-for-tabular-data_files/figure-revealjs/cell-124-output-2.png"></p>
</div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="124">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1"></a>model <span class="op">=</span> l2_model(<span class="fl">0.1</span>)</span>
<span id="cb182-2"><a href="#cb182-2"></a>weights <span class="op">=</span> model.get_layer(<span class="st">"hidden2"</span>).get_weights()[<span class="dv">0</span>].flatten()</span>
<span id="cb182-3"><a href="#cb182-3"></a><span class="bu">print</span>(<span class="ss">f"Number of weights almost 0: </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">sum</span>(np.<span class="bu">abs</span>(weights) <span class="op">&lt;</span> <span class="fl">1e-5</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb182-4"><a href="#cb182-4"></a>plt.hist(weights, bins<span class="op">=</span><span class="dv">100</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of weights almost 0: 3</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img data-src="network-architectures-for-tabular-data_files/figure-revealjs/cell-125-output-2.png"></p>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="dropout" class="title-slide slide level1 center" data-background-image="unsw-yellow-shape.png" data-visibility="uncounted">
<h1>Dropout</h1>

</section>
<section id="early-stopping-dropout" class="slide level2">
<h2>Early stopping &amp; dropout</h2>
<div class="columns">
<div class="column" style="width:33%;">
<div class="smaller">
<p>Early stopping is a kind of implicit regularisation.</p>
</div>
<p><img data-src="xkcd-tax_ai_2x.png"></p>
</div><div class="column" style="width:66%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Geron-mls2_1109-blur.png"></p>
<p></p><figcaption>An example of neurons dropped during training.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="footer">
<p>Sources: Randall Munroe (2020), <a href="https://xkcd.com/2265/">xkcd #2265: Tax AI</a>, and Aurélien Géron (2019), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, Fig. 11-9 (<strong>redacted</strong>).</p>
</div>
</section>
<section id="dropout-quote-1" class="slide level2">
<h2>Dropout quote #1</h2>
<blockquote>
<p>It’s surprising at first that this destructive technique works at all. Would a company perform better if its employees were told to toss a coin every morning to decide whether or not to go to work? Well, who knows; perhaps it would! The company would be forced to adapt its organization; it could not rely on any single person to work the coffee machine or perform any other critical tasks, so this expertise would have to be spread across several people. Employees would have to learn to cooperate with many of their coworkers, not just a handful of them.</p>
</blockquote>
<div class="footer">
<p>Source: Aurélien Géron (2019), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, p.&nbsp;366.</p>
</div>
</section>
<section id="dropout-quote-2" class="slide level2">
<h2>Dropout quote #2</h2>
<blockquote>
<p>The company would become much more resilient. If one person quit, it wouldn’t make much of a difference. It’s unclear whether this idea would actually work for companies, but it certainly does for neural networks. Neurons trained with dropout cannot co-adapt with their neighboring neurons; they have to be as useful as possible on their own. They also cannot rely excessively on just a few input neurons; they must pay attention to each of their input neurons. They end up being less sensitive to slight changes in the inputs. In the end, you get a more robust network that generalizes better.</p>
</blockquote>
<div class="footer">
<p>Source: Aurélien Géron (2019), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, p.&nbsp;366.</p>
</div>
</section>
<section id="dropout-in-keras" class="slide level2">
<h2>Dropout in Keras</h2>
<p>Dropout is just another layer in Keras.</p>
<div class="cell" data-execution_count="126">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb184-1"><a href="#cb184-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Dropout</span>
<span id="cb184-2"><a href="#cb184-2"></a></span>
<span id="cb184-3"><a href="#cb184-3"></a>tf.random.set_seed(<span class="dv">123</span>)</span>
<span id="cb184-4"><a href="#cb184-4"></a>model <span class="op">=</span> Sequential([</span>
<span id="cb184-5"><a href="#cb184-5"></a>    Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"leaky_relu"</span>, name<span class="op">=</span><span class="st">"hidden1"</span>),</span>
<span id="cb184-6"><a href="#cb184-6"></a>    Dropout(<span class="fl">0.2</span>),</span>
<span id="cb184-7"><a href="#cb184-7"></a>    Dense(<span class="dv">30</span>, activation<span class="op">=</span><span class="st">"leaky_relu"</span>, name<span class="op">=</span><span class="st">"hidden2"</span>),</span>
<span id="cb184-8"><a href="#cb184-8"></a>    Dropout(<span class="fl">0.2</span>),</span>
<span id="cb184-9"><a href="#cb184-9"></a>    Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"exponential"</span>, name<span class="op">=</span><span class="st">"output"</span>)</span>
<span id="cb184-10"><a href="#cb184-10"></a>])</span>
<span id="cb184-11"><a href="#cb184-11"></a></span>
<span id="cb184-12"><a href="#cb184-12"></a>model.<span class="bu">compile</span>(<span class="st">"adam"</span>, <span class="st">"mse"</span>)</span>
<span id="cb184-13"><a href="#cb184-13"></a>model.fit(X_train_sc, y_train, epochs<span class="op">=</span><span class="dv">4</span>, verbose<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dropout-turns-off-after-training" class="slide level2">
<h2>Dropout turns off after training</h2>
<p>Making predictions is the same as any other model:</p>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="127">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1"></a>model.predict(X_test_sc[:<span class="dv">3</span>,:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="127">
<pre><code>array([[0.87],
       [0.9 ],
       [1.2 ]], dtype=float32)</code></pre>
</div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="128">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb187-1"><a href="#cb187-1"></a>model.predict(X_test_sc[:<span class="dv">3</span>,:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="128">
<pre><code>array([[0.87],
       [0.9 ],
       [1.2 ]], dtype=float32)</code></pre>
</div>
</div>
</div>
</div>
<p>We can make the model think it is still training:</p>
<div class="columns">
<div class="column">
<div class="cell" data-execution_count="129">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1"></a>model(X_test_sc[:<span class="dv">3</span>,:],</span>
<span id="cb189-2"><a href="#cb189-2"></a>    training<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="129">
<pre><code>&lt;tf.Tensor: shape=(3, 1), dtype=float32, numpy=
array([[0.83],
       [0.91],
       [1.07]], dtype=float32)&gt;</code></pre>
</div>
</div>
</div><div class="column">
<div class="cell" data-execution_count="130">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1"></a>model(X_test_sc[:<span class="dv">3</span>,:],</span>
<span id="cb191-2"><a href="#cb191-2"></a>    training<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="130">
<pre><code>&lt;tf.Tensor: shape=(3, 1), dtype=float32, numpy=
array([[0.94],
       [0.88],
       [1.14]], dtype=float32)&gt;</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="monte-carlo-dropout" class="slide level2">
<h2>Monte Carlo Dropout</h2>
<p>Intentially leave the dropout on when making predictions.</p>
<div class="cell" data-execution_count="131">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb193-1"><a href="#cb193-1"></a>predictions <span class="op">=</span> [model(X_test_sc[:<span class="dv">3</span>,:], training<span class="op">=</span><span class="va">True</span>) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>)]</span>
<span id="cb193-2"><a href="#cb193-2"></a>predictions[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="131">
<pre><code>&lt;tf.Tensor: shape=(3, 1), dtype=float32, numpy=
array([[0.83],
       [0.92],
       [1.03]], dtype=float32)&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="132">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb195-1"><a href="#cb195-1"></a>allPredictions <span class="op">=</span> np.concatenate(predictions, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb195-2"><a href="#cb195-2"></a>allPredictions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="132">
<pre><code>array([[0.83, 0.83, 0.89, 0.87, 0.88, 0.8 , 0.91, 0.89, 0.95, 0.9 ],
       [0.92, 0.84, 0.89, 0.89, 0.93, 0.98, 0.92, 0.88, 0.87, 0.92],
       [1.03, 1.75, 1.11, 1.33, 1.21, 0.96, 0.9 , 1.21, 0.71, 1.26]],
      dtype=float32)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="133">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb197-1"><a href="#cb197-1"></a>np.mean(allPredictions, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="133">
<pre><code>array([0.88, 0.9 , 1.15], dtype=float32)</code></pre>
</div>
</div>
</section></section>
<section>
<section id="combining-models" class="title-slide slide level1 center" data-background-image="unsw-yellow-shape.png" data-visibility="uncounted">
<h1>Combining models</h1>

</section>
<section id="fit-many-models-to-the-same-data" class="slide level2">
<h2>Fit many models to the same data</h2>
<p><br></p>

<img data-src="Geron-mls2_0701-blur.png" class="r-stretch quarto-figure-center"><p class="caption">Create multiple models for the same problem.</p><div class="footer">
<p>Source: Aurélien Géron (2019), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, Figure 7-1 (<strong>redacted</strong>).</p>
</div>
</section>
<section id="ensembles" class="slide level2">
<h2>Ensembles</h2>

<img data-src="Geron-mls2_0702-blur.png" class="r-stretch quarto-figure-center"><p class="caption">Combine many models to get better predictions.</p><div class="footer">
<p>Source: Aurélien Géron (2019), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, Figure 7-2 (<strong>redacted</strong>).</p>
</div>
</section>
<section id="ann-can-feed-into-a-glm" class="slide level2">
<h2>ANN can feed into a GLM</h2>

<img data-src="richman-glm-and-ann.png" class="r-stretch quarto-figure-center"><p class="caption">Combining GLM &amp; ANN.</p><div class="footer">
<p>Source: Ronald Richman (2022), Mind the Gap - Safely Incorporating Deep Learning Models into the Actuarial Toolkit, IFoA seminar, Slide 14.</p>
</div>
</section></section>
<section>
<section id="preview-of-recurrent-neural-networks" class="title-slide slide level1 center" data-background-image="unsw-yellow-shape.png" data-visibility="uncounted">
<h1>Preview of Recurrent Neural Networks</h1>

</section>
<section id="recurrent-neural-network" class="slide level2">
<h2>Recurrent neural network</h2>
<p>The RNN processes each data in the sequence one by one, while keeping memory of what came before.</p>

<img data-src="Geron-mls2_1501-blur.png" class="r-stretch quarto-figure-center"><p class="caption">Illustration of <em>unrolling the network through time</em>.</p><p>Common RNN structures are: LSTM and GRU cells.</p>
<div class="footer">
<p>Source: Aurélien Géron (2019), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, Figure 15-1 (<strong>redacted</strong>).</p>
</div>
</section></section>
<section id="section" class="title-slide slide level1 center" data-visibility="uncounted">
<h1></h1>
<h2>
Glossary
</h2>
<div class="columns">
<div class="column">
<ul>
<li>confusion matrix</li>
<li>dead ReLU neurons</li>
<li>dropout</li>
<li>ensemble model</li>
<li>entity embeddings</li>
<li>Input layer</li>
<li>Keras eager execution</li>
<li>Keras functional API</li>
</ul>
</div><div class="column">
<ul>
<li><span class="math inline">\(\ell_1\)</span> &amp; <span class="math inline">\(\ell_2\)</span> regularisation</li>
<li>leaky ReLU</li>
<li>Monte Carlo dropout</li>
<li>regularisation</li>
<li>Reshape layer</li>
<li>skip connection</li>
<li>wide &amp; deep network structure</li>
</ul>
</div>
</div>
<script defer="">
    // Remove the highlight.js class for the 'compile', 'min', 'max'
    // as there's a bug where they are treated like the Python built-in
    // global functions but we only ever see it as methods like
    // 'model.compile()' or 'predictions.max()'
    buggyBuiltIns = ["compile", "min", "max", "round", "sum"];

    document.querySelectorAll('.bu').forEach((elem) => {
        if (buggyBuiltIns.includes(elem.innerHTML)) {
            elem.classList.remove('bu');
        }
    })

    var registerRevealCallbacks = function() {
        Reveal.on('overviewshown', event => {
            document.querySelector(".line.right").hidden = true;
        });
        Reveal.on('overviewhidden', event => {
            document.querySelector(".line.right").hidden = false;
        });
    };
</script>

<img src="unsw-logo.svg" class="slide-logo r-stretch"><div class="footer footer-default">
<p>Slides: <a href="https://pat-laub.github.io">Dr Patrick Laub</a> (<span class="citation" data-cites="PatrickLaub">@PatrickLaub</span>).</p>
</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="network-architectures-for-tabular-data_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="network-architectures-for-tabular-data_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="network-architectures-for-tabular-data_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="network-architectures-for-tabular-data_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="network-architectures-for-tabular-data_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="network-architectures-for-tabular-data_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="network-architectures-for-tabular-data_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="network-architectures-for-tabular-data_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="network-architectures-for-tabular-data_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="network-architectures-for-tabular-data_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="network-architectures-for-tabular-data_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': false,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true,"boardmarkerWidth":6,"grid":false,"background":["rgba(255,255,255,0.0)","https://github.com/rajgoel/reveal.js-plugins/raw/master/chalkboard/img/blackboard.png"]},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.2,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        target: function(trigger) {
          return trigger.previousElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        setTimeout(function() {
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto-reveal',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const cites = ref.parentNode.getAttribute('data-cites').split(' ');
        tippyHover(ref, function() {
          var popup = window.document.createElement('div');
          cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    });
    </script>
    <script>registerRevealCallbacks();</script>
    

</body></html>