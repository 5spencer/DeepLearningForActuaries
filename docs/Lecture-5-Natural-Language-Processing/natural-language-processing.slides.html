<!DOCTYPE html>
<html lang="en"><head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-contrib/reveal-auto-agenda-0.0.3/reveal-auto-agenda.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.4.554">

  <meta name="author" content="Patrick Laub">
  <title>AI for Actuaries - Natural Language Processing</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {  background-color: #e9ecef; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #0040ff; font-weight: bold; } /* Alert */
    code span.an { color: #4090c0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #336699; } /* Attribute */
    code span.bn { color: #0033a0; } /* BaseN */
    code span.bu { color: #0055cc; } /* BuiltIn */
    code span.cf { color: #0055cc; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #002080; } /* Constant */
    code span.co { color: #4090c0; font-style: italic; } /* Comment */
    code span.cv { color: #4090c0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #3060a0; font-style: italic; } /* Documentation */
    code span.dt { color: #0044bb; } /* DataType */
    code span.dv { color: #0033a0; } /* DecVal */
    code span.er { color: #0040ff; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #0033a0; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #0055cc; font-weight: bold; } /* Import */
    code span.in { color: #4090c0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #0055cc; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #0055cc; } /* Other */
    code span.pp { color: #336699; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #336699; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #4090c0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto.css">
  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="../site_libs/quarto-diagram/mermaid.min.js"></script>
  <script src="../site_libs/quarto-diagram/mermaid-init.js"></script>
  <link href="../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Natural Language Processing</h1>
  <p class="subtitle">ACTL3143 &amp; ACTL5111 Deep Learning for Actuaries</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Patrick Laub 
</div>
</div>
</div>

</section>
<section>
<section id="natural-language-processing" class="title-slide slide level1 agenda-slide center" data-visibility="uncounted">
<h1>Natural Language Processing</h1>
<div class="agenda-heading">
<p>Lecture Outline</p>
</div>
<div class="agenda">
<ul>
<li><div class="agenda-active">
<p>Natural Language Processing</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Car Crash Police Reports</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Text Vectorisation</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Bag Of Words</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Limiting The Vocabulary</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Intelligently Limit The Vocabulary</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Interrogate The Model</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Word Embeddings</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Word Embeddings II</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Car Crash NLP Part II</p>
</div></li>
</ul>
</div>
</section>
<section id="what-is-nlp" class="slide level2">
<h2>What is NLP?</h2>
<p>A field of research at the intersection of computer science, linguistics, and artificial intelligence that takes the <strong>naturally spoken or written language</strong> of humans and <strong>processes it with machines</strong> to automate or help in certain tasks</p>
</section>
<section id="how-the-computer-sees-text" class="slide level2">
<h2>How the computer sees text</h2>
<p>Spot the odd one out:</p>
<div id="9b4cd471" class="cell" data-execution_count="3">
<div class="cell-output cell-output-stdout">
<pre><code>[112, 97, 116, 114, 105, 99, 107, 32, 108, 97, 117, 98]</code></pre>
</div>
</div>
<div id="1e15f151" class="cell" data-execution_count="4">
<div class="cell-output cell-output-stdout">
<pre><code>[80, 65, 84, 82, 73, 67, 75, 32, 76, 65, 85, 66]</code></pre>
</div>
</div>
<div id="bc9e14f6" class="cell" data-execution_count="5">
<div class="cell-output cell-output-stdout">
<pre><code>[76, 101, 118, 105, 32, 65, 99, 107, 101, 114, 109, 97, 110]</code></pre>
</div>
</div>
<div class="fragment">
<p>Generated by:</p>
<div id="e5606833" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a></a><span class="bu">print</span>([<span class="bu">ord</span>(x) <span class="cf">for</span> x <span class="kw">in</span> <span class="st">"patrick laub"</span>])</span>
<span id="cb4-2"><a></a><span class="bu">print</span>([<span class="bu">ord</span>(x) <span class="cf">for</span> x <span class="kw">in</span> <span class="st">"PATRICK LAUB"</span>])</span>
<span id="cb4-3"><a></a><span class="bu">print</span>([<span class="bu">ord</span>(x) <span class="cf">for</span> x <span class="kw">in</span> <span class="st">"Levi Ackerman"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>ord</code> built-in turns characters into their ASCII form.</p>
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Question</strong></p>
</div>
<div class="callout-content">
<p>The largest value for a character is 127, can you guess why?</p>
</div>
</div>
</div>
</div>
</section>
<section id="ascii" class="slide level2">
<h2>ASCII</h2>

<img data-src="wiki-ASCII-Table-wide.png" class="r-stretch quarto-figure-center"><p class="caption">American Standard Code for Information Interchange</p><p>Unicode is the new standard.</p>
<div class="footer">
<p>Source: <a href="https://commons.wikimedia.org/wiki/File:ASCII-Table-wide.svg">Wikipedia</a></p>
</div>
</section>
<section id="random-strings" class="slide level2">
<h2>Random strings</h2>
<p>The built-in <code>chr</code> function turns numbers into characters.</p>
<div id="892e6b86" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a></a>rnd.seed(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="e885e960" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a></a>chars <span class="op">=</span> [<span class="bu">chr</span>(rnd.randint(<span class="dv">32</span>, <span class="dv">127</span>)) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>)]</span>
<span id="cb6-2"><a></a>chars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>['E', ',', 'h', ')', 'k', '%', 'o', '`', '0', '!']</code></pre>
</div>
</div>
<div id="7ea9401c" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a></a><span class="co">" "</span>.join(chars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>'E , h ) k % o ` 0 !'</code></pre>
</div>
</div>
<div id="c5790e7c" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a></a><span class="co">""</span>.join([<span class="bu">chr</span>(rnd.randint(<span class="dv">32</span>, <span class="dv">127</span>)) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">50</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>"lg&amp;9R42t+&lt;=.Rdww~v-)'_]6Y! \\q(x-Oh&gt;g#f5QY#d8Kl:TpI"</code></pre>
</div>
</div>
<div id="a8d92ac0" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a></a><span class="co">""</span>.join([<span class="bu">chr</span>(rnd.randint(<span class="dv">0</span>, <span class="dv">128</span>)) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">50</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>'R\x0f@D\x19obW\x07\x1a\x19h\x16\tCg~\x17}d\x1b%9S&amp;\x08 "\n\x17\x0foW\x19Gs\\J&gt;. X\x177AqM\x03\x00x'</code></pre>
</div>
</div>
</section>
<section id="escape-characters" class="slide level2">
<h2>Escape characters</h2>
<div class="columns">
<div class="column">
<div id="397c93d5" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a></a><span class="bu">print</span>(<span class="st">"Hello,</span><span class="ch">\t</span><span class="st">world!"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Hello,  world!</code></pre>
</div>
</div>
<div id="17285366" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a></a><span class="bu">print</span>(<span class="st">"Line 1</span><span class="ch">\n</span><span class="st">Line 2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Line 1
Line 2</code></pre>
</div>
</div>
<div id="f45499a8" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a></a><span class="bu">print</span>(<span class="st">"Patrick</span><span class="ch">\r</span><span class="st">Laub"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="7dbb3feb" class="cell" data-execution_count="15">
<div class="cell-output cell-output-stdout">
<pre><code>Laubick</code></pre>
</div>
</div>
</div><div class="column">
<div id="bbd34d65" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a></a><span class="bu">print</span>(<span class="st">"C:</span><span class="ch">\t</span><span class="st">om</span><span class="ch">\n</span><span class="st">ew folder"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>C:  om
ew folder</code></pre>
</div>
</div>
<p>Escape the backslash:</p>
<div id="bb43e57b" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a></a><span class="bu">print</span>(<span class="st">"C:</span><span class="ch">\\</span><span class="st">tom</span><span class="ch">\\</span><span class="st">new folder"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>C:\tom\new folder</code></pre>
</div>
</div>
<div id="ca19bb3c" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a></a><span class="bu">repr</span>(<span class="st">"Hello,</span><span class="ch">\r</span><span class="st">world!"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>"'Hello,\\rworld!'"</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="non-natural-language-processing-i" class="slide level2">
<h2>Non-natural language processing I</h2>
<p>How would you evaluate</p>
<blockquote>
<p>10 + 2 * -3</p>
</blockquote>
<div class="fragment">
<p>All that Python sees is a string of characters.</p>
<div id="f3bbc2cf" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a></a>[<span class="bu">ord</span>(c) <span class="cf">for</span> c <span class="kw">in</span> <span class="st">"10 + 2 * -3"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>[49, 48, 32, 43, 32, 50, 32, 42, 32, 45, 51]</code></pre>
</div>
</div>
</div>
<div class="fragment">
<div id="0004c68c" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a></a><span class="dv">10</span> <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> <span class="op">-</span><span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>4</code></pre>
</div>
</div>
</div>
</section>
<section id="non-natural-language-processing-ii" class="slide level2">
<h2>Non-natural language processing II</h2>
<p>Python first tokenizes the string:</p>
<div id="9b1039be" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a></a><span class="im">import</span> tokenize</span>
<span id="cb30-2"><a></a><span class="im">import</span> io</span>
<span id="cb30-3"><a></a></span>
<span id="cb30-4"><a></a>code <span class="op">=</span> <span class="st">"10 + 2 * -3"</span></span>
<span id="cb30-5"><a></a>tokens <span class="op">=</span> tokenize.tokenize(io.BytesIO(code.encode(<span class="st">"utf-8"</span>)).readline)</span>
<span id="cb30-6"><a></a><span class="cf">for</span> token <span class="kw">in</span> tokens:</span>
<span id="cb30-7"><a></a>    <span class="bu">print</span>(token)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>TokenInfo(type=63 (ENCODING), string='utf-8', start=(0, 0), end=(0, 0), line='')
TokenInfo(type=2 (NUMBER), string='10', start=(1, 0), end=(1, 2), line='10 + 2 * -3')
TokenInfo(type=54 (OP), string='+', start=(1, 3), end=(1, 4), line='10 + 2 * -3')
TokenInfo(type=2 (NUMBER), string='2', start=(1, 5), end=(1, 6), line='10 + 2 * -3')
TokenInfo(type=54 (OP), string='*', start=(1, 7), end=(1, 8), line='10 + 2 * -3')
TokenInfo(type=54 (OP), string='-', start=(1, 9), end=(1, 10), line='10 + 2 * -3')
TokenInfo(type=2 (NUMBER), string='3', start=(1, 10), end=(1, 11), line='10 + 2 * -3')
TokenInfo(type=4 (NEWLINE), string='', start=(1, 11), end=(1, 12), line='')
TokenInfo(type=0 (ENDMARKER), string='', start=(2, 0), end=(2, 0), line='')</code></pre>
</div>
</div>
</section>
<section id="non-natural-language-processing-iii" class="slide level2">
<h2>Non-natural language processing III</h2>
<p>Python needs to <em>parse</em> the tokens into an abstract syntax tree.</p>
<div class="columns">
<div class="column" style="width:70%;">
<div id="50025c19" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a></a><span class="im">import</span> ast</span>
<span id="cb32-2"><a></a></span>
<span id="cb32-3"><a></a><span class="bu">print</span>(ast.dump(ast.parse(<span class="st">"10 + 2 * -3"</span>), indent<span class="op">=</span><span class="st">"  "</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Module(
  body=[
    Expr(
      value=BinOp(
        left=Constant(value=10),
        op=Add(),
        right=BinOp(
          left=Constant(value=2),
          op=Mult(),
          right=UnaryOp(
            op=USub(),
            operand=Constant(value=3)))))],
  type_ignores=[])</code></pre>
</div>
</div>
</div><div class="column" style="width:30%;">
<div class="cell" data-reveal="true" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class=""><p></p>
<div>
<pre class="mermaid mermaid-js">graph TD;
    Expr --&gt; C[Add]
    C --&gt; D[10]
    C --&gt; E[Mult]
    E --&gt; F[2]
    E --&gt; G[USub]
    G --&gt; H[3]

</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="non-natural-language-processing-iv" class="slide level2">
<h2>Non-natural language processing IV</h2>
<p>The abstract syntax tree is then compiled into bytecode.</p>
<div class="columns">
<div class="column" style="width:60%;">
<div id="617f9b4b" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a></a><span class="im">import</span> dis</span>
<span id="cb34-2"><a></a></span>
<span id="cb34-3"><a></a><span class="kw">def</span> expression(a, b, c):</span>
<span id="cb34-4"><a></a>    <span class="cf">return</span> a <span class="op">+</span> b <span class="op">*</span> <span class="op">-</span>c</span>
<span id="cb34-5"><a></a></span>
<span id="cb34-6"><a></a>dis.dis(expression)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  3           0 RESUME                   0

  4           2 LOAD_FAST                0 (a)
              4 LOAD_FAST                1 (b)
              6 LOAD_FAST                2 (c)
              8 UNARY_NEGATIVE
             10 BINARY_OP                5 (*)
             14 BINARY_OP                0 (+)
             18 RETURN_VALUE</code></pre>
</div>
</div>
</div><div class="column" style="width:40%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="stack-anim.gif"></p>
<figcaption>Running the bytecode</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="chatgpt-tokenization" class="slide level2">
<h2>ChatGPT tokenization</h2>
<p><a href="https://platform.openai.com/tokenizer">https://platform.openai.com/tokenizer</a></p>

<img data-src="gpt-tokens.png" class="r-stretch quarto-figure-center"><p class="caption">Example of GPT 3.5/4’s tokenization</p></section>
<section id="applications-of-nlp-in-industry" class="slide level2">
<h2>Applications of NLP in Industry</h2>
<p><strong>1) Classifying documents</strong>: Using the language within a body of text to classify it into a particular category, e.g.:</p>
<ul>
<li>Grouping emails into high and low urgency</li>
<li>Movie reviews into positive and negative sentiment (i.e.&nbsp;<em>sentiment analysis</em>)</li>
<li>Company news into bullish (positive) and bearish (negative) statements</li>
</ul>
<p><strong>2) Machine translation</strong>: Assisting language translators with machine-generated suggestions from a source language (e.g.&nbsp;English) to a target language</p>
</section>
<section id="applications-of-nlp-in-industry-1" class="slide level2">
<h2>Applications of NLP in Industry</h2>
<p><strong>3) Search engine</strong> functions, including:</p>
<ul>
<li>Autocomplete</li>
<li>Predicting what information or website user is seeking</li>
</ul>
<p><strong>4) Speech recognition</strong>: Interpreting voice commands to provide information or take action. Used in virtual assistants such as Alexa, Siri, and Cortana</p>
</section>
<section id="deep-learning-nlp" class="slide level2">
<h2>Deep learning &amp; NLP?</h2>
<p>Simple NLP applications such as spell checkers and synonym suggesters <strong>do not require deep learning</strong> and can be solved with <strong>deterministic, rules-based code</strong> with a dictionary/thesaurus.</p>
<p>More complex NLP applications such as classifying documents, search engine word prediction, and chatbots are complex enough to be solved using deep learning methods.</p>
</section>
<section id="nlp-in-1966-1973-1" class="slide level2">
<h2>NLP in 1966-1973 #1</h2>
<blockquote>
<p>A typical story occurred in early machine translation efforts, which were generously funded by the U.S. National Research Council in an attempt to speed up the translation of Russian scientific papers in the wake of the Sputnik launch in 1957. It was thought initially that simple syntactic transformations, based on the grammars of Russian and English, and word replacement from an electronic dictionary, would suffice to preserve the exact meanings of sentences.</p>
</blockquote>
<div class="footer">
<p>Source: Russell and Norvig (2016), <em>Artificial Intelligence: A Modern Approach</em>, Third Edition, p.&nbsp;21.</p>
</div>
</section>
<section id="nlp-in-1966-1973-2" class="slide level2">
<h2>NLP in 1966-1973 #2</h2>
<blockquote>
<p>The fact is that accurate translation requires background knowledge in order to resolve ambiguity and establish the content of the sentence. The famous retranslation of <strong>“the spirit is willing but the flesh is weak”</strong> as <strong>“the vodka is good but the meat is rotten”</strong> illustrates the difficulties encountered. In 1966, a report by an advisory committee found that “there has been no machine translation of general scientific text, and none is in immediate prospect.” All U.S. government funding for academic translation projects was canceled.</p>
</blockquote>
<div class="footer">
<p>Source: Russell and Norvig (2016), <em>Artificial Intelligence: A Modern Approach</em>, Third Edition, p.&nbsp;21.</p>
</div>
</section>
<section id="high-level-history-of-deep-learning" class="slide level2">
<h2>High-level history of deep learning</h2>

<img data-src="krohn_f02_03.jpeg" class="r-stretch quarto-figure-center"><p class="caption">A brief history of deep learning.</p><div class="footer">
<p>Source: Krohn (2019), <em>Deep Learning Illustrated</em>, Figure 2-3.</p>
</div>
</section></section>
<section>
<section id="car-crash-police-reports" class="title-slide slide level1 agenda-slide center" data-visibility="uncounted">
<h1>Car Crash Police Reports</h1>
<div class="agenda-heading">
<p>Lecture Outline</p>
</div>
<div class="agenda">
<ul>
<li><div class="agenda-inactive agenda-pre-active">
<p>Natural Language Processing</p>
</div></li>
<li><div class="agenda-active">
<p>Car Crash Police Reports</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Text Vectorisation</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Bag Of Words</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Limiting The Vocabulary</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Intelligently Limit The Vocabulary</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Interrogate The Model</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Word Embeddings</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Word Embeddings II</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Car Crash NLP Part II</p>
</div></li>
</ul>
</div>
</section>
<section id="downloading-the-dataset" class="slide level2">
<h2>Downloading the dataset</h2>
<p>Look at the (U.S.) National Highway Traffic Safety Administration’s (NHTSA) <a href="https://crashstats.nhtsa.dot.gov/Api/Public/ViewPublication/812506">National Motor Vehicle Crash Causation Survey</a> (NMVCCS) dataset.</p>
<div id="663dfbdb" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb36-2"><a></a></span>
<span id="cb36-3"><a></a><span class="cf">if</span> <span class="kw">not</span> Path(<span class="st">"NHTSA_NMVCCS_extract.parquet.gzip"</span>).exists():</span>
<span id="cb36-4"><a></a>    <span class="bu">print</span>(<span class="st">"Downloading dataset"</span>)                                    </span>
<span id="cb36-5"><a></a>    <span class="op">!</span>wget https:<span class="op">//</span>github.com<span class="op">/</span>JSchelldorfer<span class="op">/</span>ActuarialDataScience<span class="op">/</span>raw<span class="op">/</span>master<span class="op">/</span><span class="dv">12</span><span class="op">%</span><span class="dv">20</span><span class="op">-%</span><span class="dv">20</span><span class="er">NLP</span><span class="op">%</span><span class="dv">20</span><span class="er">Using</span><span class="op">%</span><span class="dv">20</span><span class="er">Transformers</span><span class="op">/</span>NHTSA_NMVCCS_extract.parquet.gzip</span>
<span id="cb36-6"><a></a></span>
<span id="cb36-7"><a></a>df <span class="op">=</span> pd.read_parquet(<span class="st">"NHTSA_NMVCCS_extract.parquet.gzip"</span>)</span>
<span id="cb36-8"><a></a><span class="bu">print</span>(<span class="ss">f"shape of DataFrame: </span><span class="sc">{</span>df<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape of DataFrame: (6949, 16)</code></pre>
</div>
</div>
</section>
<section id="features" class="slide level2 smaller">
<h2>Features</h2>
<ul>
<li><code>level_0</code>, <code>index</code>, <code>SCASEID</code>: all useless row numbers</li>
<li><code>SUMMARY_EN</code> and <code>SUMMARY_GE</code>: summaries of the accident</li>
<li><code>NUMTOTV</code>: total number of vehicles involved in the accident</li>
<li><code>WEATHER1</code> to <code>WEATHER8</code> (<strong>not one-hot</strong>):
<ul>
<li><code>WEATHER1</code>: cloudy</li>
<li><code>WEATHER2</code>: snow</li>
<li><code>WEATHER3</code>: fog, smog, smoke</li>
<li><code>WEATHER4</code>: rain</li>
<li><code>WEATHER5</code>: sleet, hail (freezing drizzle or rain)</li>
<li><code>WEATHER6</code>: blowing snow</li>
<li><code>WEATHER7</code>: severe crosswinds</li>
<li><code>WEATHER8</code>: other</li>
</ul></li>
<li><code>INJSEVA</code> and <code>INJSEVB</code>: injury severity &amp; (binary) presence of bodily injury</li>
</ul>
<div class="footer">
<p>Source: <a href="https://github.com/JSchelldorfer/ActuarialDataScience/blob/master/12%20-%20NLP%20Using%20Transformers/Actuarial_Applications_of_NLP_Part_1.ipynb">JSchelldorfer’s GitHub</a>.</p>
</div>
</section>
<section id="crash-summaries" class="slide level2">
<h2>Crash summaries</h2>
<div id="67103fe1" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a></a>df[<span class="st">"SUMMARY_EN"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>0       V1, a 2000 Pontiac Montana minivan, made a lef...
1       The crash occurred in the eastbound lane of a ...
2       This crash occurred just after the noon time h...
                              ...                        
6946    The crash occurred in the eastbound lanes of a...
6947    This single-vehicle crash occurred in a rural ...
6948    This two vehicle daytime collision occurred mi...
Name: SUMMARY_EN, Length: 6949, dtype: object</code></pre>
</div>
</div>
<div id="dd0a285d" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a></a>df[<span class="st">"SUMMARY_EN"</span>].<span class="bu">map</span>(<span class="kw">lambda</span> summary: <span class="bu">len</span>(summary)).hist(grid<span class="op">=</span><span class="va">False</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="natural-language-processing_files/figure-revealjs/cell-28-output-1.png" class="r-stretch"></section>
<section id="a-crash-summary" class="slide level2">
<h2>A crash summary</h2>
<div id="76282d99" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a></a>df[<span class="st">"SUMMARY_EN"</span>].iloc[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>"The crash occurred in the eastbound lane of a two-lane, two-way asphalt roadway on level grade.  The conditions were daylight and wet with cloudy skies in the early afternoon on a weekday.\t\r \r V1, a 1995 Chevrolet Lumina was traveling eastbound.  V2, a 2004 Chevrolet Trailblazer was also traveling eastbound on the same roadway.  V2, was attempting to make a left-hand turn into a private drive on the North side of the roadway.  While turning V1 attempted to pass V2 on the left-hand side contacting it's front to the left side of V2.  Both vehicles came to final rest on the roadway at impact.\r \r The driver of V1 fled the scene and was not identified, so no further information could be obtained from him.  The Driver of V2 stated that the driver was a male and had hit his head and was bleeding.  She did not pursue the driver because she thought she saw a gun. The officer said that the car had been reported stolen.\r \r The Critical Precrash Event for the driver of V1 was this vehicle traveling over left lane line on the left side of travel.  The Critical Reason for the Critical Event was coded as unknown reason for the critical event because the driver was not available. \r \r The driver of V2 was a 41-year old female who had reported that she had stopped prior to turning to make sure she was at the right house.  She was going to show a house for a client.  She had no health related problems.  She had taken amoxicillin.  She does not wear corrective lenses and felt rested.  She was not injured in the crash.\r \r The Critical Precrash Event for the driver of V2 was other vehicle encroachment from adjacent lane over left lane line.  The Critical Reason for the Critical Event was not coded for this vehicle and the driver of V2 was not thought to have contributed to the crash."</code></pre>
</div>
</div>
</section>
<section id="carriage-returns" class="slide level2">
<h2>Carriage returns</h2>
<div id="20bedee8" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a></a><span class="bu">print</span>(df[<span class="st">"SUMMARY_EN"</span>].iloc[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="9c6cfb2e" class="cell" data-execution_count="30">
<div class="cell-output cell-output-stdout">
<pre><code>The Critical Precrash Event for the driver of V2 was other vehicle encroachment from adjacent lane over left lane line.  The Critical Reason for the Critical Event was not coded for this vehicle and the driver of V2 was not thought to have contributed to the crash.r corrective lenses and felt rested.  She was not injured in the crash. of V2.  Both vehicles came to final rest on the roadway at impact.</code></pre>
</div>
</div>
<div id="3426c276" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a></a><span class="co"># Replace every \r with \n</span></span>
<span id="cb45-2"><a></a><span class="kw">def</span> replace_carriage_return(summary):</span>
<span id="cb45-3"><a></a>    <span class="cf">return</span> summary.replace(<span class="st">"</span><span class="ch">\r</span><span class="st">"</span>, <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb45-4"><a></a></span>
<span id="cb45-5"><a></a>df[<span class="st">"SUMMARY_EN"</span>] <span class="op">=</span> df[<span class="st">"SUMMARY_EN"</span>].<span class="bu">map</span>(replace_carriage_return)</span>
<span id="cb45-6"><a></a><span class="bu">print</span>(df[<span class="st">"SUMMARY_EN"</span>].iloc[<span class="dv">1</span>][:<span class="dv">500</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The crash occurred in the eastbound lane of a two-lane, two-way asphalt roadway on level grade.  The conditions were daylight and wet with cloudy skies in the early afternoon on a weekday.    
 
 V1, a 1995 Chevrolet Lumina was traveling eastbound.  V2, a 2004 Chevrolet Trailblazer was also traveling eastbound on the same roadway.  V2, was attempting to make a left-hand turn into a private drive on the North side of the roadway.  While turning V1 attempted to pass V2 on the left-hand side contactin</code></pre>
</div>
</div>
</section>
<section id="target" class="slide level2">
<h2>Target</h2>
<div class="columns">
<div class="column">
<p>Predict number of vehicles in the crash.</p>
<div id="0929fba2" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a></a>df[<span class="st">"NUMTOTV"</span>].value_counts()<span class="op">\</span></span>
<span id="cb47-2"><a></a>    .sort_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>NUMTOTV
1    1822
2    4151
3     783
4     150
5      34
6       5
7       2
8       1
9       1
Name: count, dtype: int64</code></pre>
</div>
</div>
<div id="5deb6c7a" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a></a>np.sum(df[<span class="st">"NUMTOTV"</span>] <span class="op">&gt;</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>193</code></pre>
</div>
</div>
</div><div class="column">
<p>Simplify the target to just:</p>
<ul>
<li>1 vehicle</li>
<li>2 vehicles</li>
<li>3+ vehicles</li>
</ul>
<div id="80054d73" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a></a>df[<span class="st">"NUM_VEHICLES"</span>] <span class="op">=</span> <span class="op">\</span></span>
<span id="cb51-2"><a></a>  df[<span class="st">"NUMTOTV"</span>].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="op">\</span></span>
<span id="cb51-3"><a></a>    <span class="bu">str</span>(x) <span class="cf">if</span> x <span class="op">&lt;=</span> <span class="dv">2</span> <span class="cf">else</span> <span class="st">"3+"</span>)</span>
<span id="cb51-4"><a></a>df[<span class="st">"NUM_VEHICLES"</span>].value_counts()<span class="op">\</span></span>
<span id="cb51-5"><a></a>  .sort_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>NUM_VEHICLES
1     1822
2     4151
3+     976
Name: count, dtype: int64</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="just-ignore-this-for-now" class="slide level2">
<h2>Just ignore this for now…</h2>
<div id="e336ea93" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a></a>rnd.seed(<span class="dv">123</span>)</span>
<span id="cb53-2"><a></a></span>
<span id="cb53-3"><a></a><span class="cf">for</span> i, summary <span class="kw">in</span> <span class="bu">enumerate</span>(df[<span class="st">"SUMMARY_EN"</span>]):</span>
<span id="cb53-4"><a></a>    word_numbers <span class="op">=</span> [<span class="st">"one"</span>, <span class="st">"two"</span>, <span class="st">"three"</span>, <span class="st">"four"</span>, <span class="st">"five"</span>, <span class="st">"six"</span>, <span class="st">"seven"</span>, <span class="st">"eight"</span>, <span class="st">"nine"</span>, <span class="st">"ten"</span>]</span>
<span id="cb53-5"><a></a>    num_cars <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb53-6"><a></a>    new_car_nums <span class="op">=</span> [<span class="ss">f"V</span><span class="sc">{</span>rnd<span class="sc">.</span>randint(<span class="dv">100</span>, <span class="dv">10000</span>)<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(num_cars)]</span>
<span id="cb53-7"><a></a>    num_spaces <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb53-8"><a></a></span>
<span id="cb53-9"><a></a>    <span class="cf">for</span> car <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, num_cars<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb53-10"><a></a>        new_num <span class="op">=</span> new_car_nums[car<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb53-11"><a></a>        summary <span class="op">=</span> summary.replace(<span class="ss">f"V-</span><span class="sc">{</span>car<span class="sc">}</span><span class="ss">"</span>, new_num)</span>
<span id="cb53-12"><a></a>        summary <span class="op">=</span> summary.replace(<span class="ss">f"Vehicle </span><span class="sc">{</span>word_numbers[car<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>, new_num).replace(<span class="ss">f"vehicle </span><span class="sc">{</span>word_numbers[car<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>, new_num)</span>
<span id="cb53-13"><a></a>        summary <span class="op">=</span> summary.replace(<span class="ss">f"Vehicle #</span><span class="sc">{</span>word_numbers[car<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>, new_num).replace(<span class="ss">f"vehicle #</span><span class="sc">{</span>word_numbers[car<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>, new_num)</span>
<span id="cb53-14"><a></a>        summary <span class="op">=</span> summary.replace(<span class="ss">f"Vehicle </span><span class="sc">{</span>car<span class="sc">}</span><span class="ss">"</span>, new_num).replace(<span class="ss">f"vehicle </span><span class="sc">{</span>car<span class="sc">}</span><span class="ss">"</span>, new_num)</span>
<span id="cb53-15"><a></a>        summary <span class="op">=</span> summary.replace(<span class="ss">f"Vehicle #</span><span class="sc">{</span>car<span class="sc">}</span><span class="ss">"</span>, new_num).replace(<span class="ss">f"vehicle #</span><span class="sc">{</span>car<span class="sc">}</span><span class="ss">"</span>, new_num)</span>
<span id="cb53-16"><a></a>        summary <span class="op">=</span> summary.replace(<span class="ss">f"Vehicle # </span><span class="sc">{</span>car<span class="sc">}</span><span class="ss">"</span>, new_num).replace(<span class="ss">f"vehicle # </span><span class="sc">{</span>car<span class="sc">}</span><span class="ss">"</span>, new_num)</span>
<span id="cb53-17"><a></a></span>
<span id="cb53-18"><a></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(num_spaces<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb53-19"><a></a>            summary <span class="op">=</span> summary.replace(<span class="ss">f"V</span><span class="sc">{</span><span class="st">' '</span><span class="op">*</span>j<span class="sc">}{</span>car<span class="sc">}</span><span class="ss">"</span>, new_num).replace(<span class="ss">f"V</span><span class="sc">{</span><span class="st">' '</span><span class="op">*</span>j<span class="sc">}</span><span class="ss">#</span><span class="sc">{</span>car<span class="sc">}</span><span class="ss">"</span>, new_num).replace(<span class="ss">f"V</span><span class="sc">{</span><span class="st">' '</span><span class="op">*</span>j<span class="sc">}</span><span class="ss"># </span><span class="sc">{</span>car<span class="sc">}</span><span class="ss">"</span>, new_num)</span>
<span id="cb53-20"><a></a>            summary <span class="op">=</span> summary.replace(<span class="ss">f"v</span><span class="sc">{</span><span class="st">' '</span><span class="op">*</span>j<span class="sc">}{</span>car<span class="sc">}</span><span class="ss">"</span>, new_num).replace(<span class="ss">f"v</span><span class="sc">{</span><span class="st">' '</span><span class="op">*</span>j<span class="sc">}</span><span class="ss">#</span><span class="sc">{</span>car<span class="sc">}</span><span class="ss">"</span>, new_num).replace(<span class="ss">f"v</span><span class="sc">{</span><span class="st">' '</span><span class="op">*</span>j<span class="sc">}</span><span class="ss"># </span><span class="sc">{</span>car<span class="sc">}</span><span class="ss">"</span>, new_num)</span>
<span id="cb53-21"><a></a>         </span>
<span id="cb53-22"><a></a>    df.loc[i, <span class="st">"SUMMARY_EN"</span>] <span class="op">=</span> summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="convert-y-to-integers-split-the-data" class="slide level2">
<h2>Convert <span class="math inline">y</span> to integers &amp; split the data</h2>
<div id="406bce75" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span>
<span id="cb54-2"><a></a>target_labels <span class="op">=</span> df[<span class="st">"NUM_VEHICLES"</span>]</span>
<span id="cb54-3"><a></a>target <span class="op">=</span> LabelEncoder().fit_transform(target_labels)</span>
<span id="cb54-4"><a></a>target</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>array([1, 1, 1, ..., 2, 0, 1])</code></pre>
</div>
</div>
<div id="beb7d200" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a></a>weather_cols <span class="op">=</span> [<span class="ss">f"WEATHER</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">9</span>)]</span>
<span id="cb56-2"><a></a>features <span class="op">=</span> df[[<span class="st">"SUMMARY_EN"</span>] <span class="op">+</span> weather_cols]</span>
<span id="cb56-3"><a></a></span>
<span id="cb56-4"><a></a>X_main, X_test, y_main, y_test <span class="op">=</span> <span class="op">\</span></span>
<span id="cb56-5"><a></a>    train_test_split(features, target, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb56-6"><a></a></span>
<span id="cb56-7"><a></a><span class="co"># As 0.25 x 0.8 = 0.2</span></span>
<span id="cb56-8"><a></a>X_train, X_val, y_train, y_val <span class="op">=</span> <span class="op">\</span></span>
<span id="cb56-9"><a></a>    train_test_split(X_main, y_main, test_size<span class="op">=</span><span class="fl">0.25</span>, random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb56-10"><a></a></span>
<span id="cb56-11"><a></a>X_train.shape, X_val.shape, X_test.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>((4169, 9), (1390, 9), (1390, 9))</code></pre>
</div>
</div>
<div id="5d7bc1a2" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a></a><span class="bu">print</span>([np.mean(y_train <span class="op">==</span> y) <span class="cf">for</span> y <span class="kw">in</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0.25833533221396016, 0.6032621731830176, 0.1384024946030223]</code></pre>
</div>
</div>
</section></section>
<section>
<section id="text-vectorisation" class="title-slide slide level1 agenda-slide center" data-visibility="uncounted">
<h1>Text Vectorisation</h1>
<div class="agenda-heading">
<p>Lecture Outline</p>
</div>
<div class="agenda">
<ul>
<li><div class="agenda-inactive agenda-pre-active">
<p>Natural Language Processing</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Car Crash Police Reports</p>
</div></li>
<li><div class="agenda-active">
<p>Text Vectorisation</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Bag Of Words</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Limiting The Vocabulary</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Intelligently Limit The Vocabulary</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Interrogate The Model</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Word Embeddings</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Word Embeddings II</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Car Crash NLP Part II</p>
</div></li>
</ul>
</div>
</section>
<section id="grab-the-start-of-a-few-summaries" class="slide level2">
<h2>Grab the start of a few summaries</h2>
<div id="634de11e" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a></a>first_summaries <span class="op">=</span> X_train[<span class="st">"SUMMARY_EN"</span>].iloc[:<span class="dv">3</span>]</span>
<span id="cb60-2"><a></a>first_summaries</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>2532    This crash occurred in the early afternoon of ...
6209    This two-vehicle crash occurred in a four-legg...
2561    The crash occurred in the eastbound direction ...
Name: SUMMARY_EN, dtype: object</code></pre>
</div>
</div>
<div id="2d577d2f" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a></a>first_words <span class="op">=</span> first_summaries.<span class="bu">map</span>(<span class="kw">lambda</span> txt: txt.split(<span class="st">" "</span>)[:<span class="dv">7</span>])</span>
<span id="cb62-2"><a></a>first_words</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>2532    [This, crash, occurred, in, the, early, aftern...
6209    [This, two-vehicle, crash, occurred, in, a, fo...
2561    [The, crash, occurred, in, the, eastbound, dir...
Name: SUMMARY_EN, dtype: object</code></pre>
</div>
</div>
<div id="728116db" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a></a>start_of_summaries <span class="op">=</span> first_words.<span class="bu">map</span>(<span class="kw">lambda</span> txt: <span class="st">" "</span>.join(txt))</span>
<span id="cb64-2"><a></a>start_of_summaries</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>2532          This crash occurred in the early afternoon
6209    This two-vehicle crash occurred in a four-legged
2561       The crash occurred in the eastbound direction
Name: SUMMARY_EN, dtype: object</code></pre>
</div>
</div>
</section>
<section id="count-words-in-the-first-summaries" class="slide level2">
<h2>Count words in the first summaries</h2>
<div id="8a2330ad" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> CountVectorizer</span>
<span id="cb66-2"><a></a></span>
<span id="cb66-3"><a></a>vect <span class="op">=</span> CountVectorizer()</span>
<span id="cb66-4"><a></a>counts <span class="op">=</span> vect.fit_transform(start_of_summaries)</span>
<span id="cb66-5"><a></a>vocab <span class="op">=</span> vect.get_feature_names_out()</span>
<span id="cb66-6"><a></a><span class="bu">print</span>(<span class="bu">len</span>(vocab), vocab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>13 ['afternoon' 'crash' 'direction' 'early' 'eastbound' 'four' 'in' 'legged'
 'occurred' 'the' 'this' 'two' 'vehicle']</code></pre>
</div>
</div>
<div id="eb0a65e2" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a></a>counts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>&lt;3x13 sparse matrix of type '&lt;class 'numpy.int64'&gt;'
    with 21 stored elements in Compressed Sparse Row format&gt;</code></pre>
</div>
</div>
<div id="6f47f2a3" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a></a>counts.toarray()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>array([[1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 0],
       [0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 1],
       [0, 1, 1, 0, 1, 0, 1, 0, 1, 2, 0, 0, 0]])</code></pre>
</div>
</div>
</section>
<section id="encode-new-sentences-to-bow" class="slide level2">
<h2>Encode new sentences to BoW</h2>
<div id="cc47a07c" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a></a>vect.transform([</span>
<span id="cb72-2"><a></a>    <span class="st">"first car hit second car in a crash"</span>,</span>
<span id="cb72-3"><a></a>    <span class="st">"ipad os 16 beta released"</span>,</span>
<span id="cb72-4"><a></a>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>&lt;2x13 sparse matrix of type '&lt;class 'numpy.int64'&gt;'
    with 2 stored elements in Compressed Sparse Row format&gt;</code></pre>
</div>
</div>
<div id="6b2605eb" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a></a>vect.transform([</span>
<span id="cb74-2"><a></a>    <span class="st">"first car hit second car in a crash"</span>,</span>
<span id="cb74-3"><a></a>    <span class="st">"ipad os 18 beta released"</span>,</span>
<span id="cb74-4"><a></a>]).toarray()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>array([[0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0],
       [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]])</code></pre>
</div>
</div>
<div id="8370a9e2" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a></a><span class="bu">print</span>(vocab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['afternoon' 'crash' 'direction' 'early' 'eastbound' 'four' 'in' 'legged'
 'occurred' 'the' 'this' 'two' 'vehicle']</code></pre>
</div>
</div>
</section>
<section id="bag-of-n-grams" class="slide level2">
<h2>Bag of <span class="math inline">n</span>-grams</h2>
<div id="6815dca9" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a></a>vect <span class="op">=</span> CountVectorizer(ngram_range<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb78-2"><a></a>counts <span class="op">=</span> vect.fit_transform(start_of_summaries)</span>
<span id="cb78-3"><a></a>vocab <span class="op">=</span> vect.get_feature_names_out()</span>
<span id="cb78-4"><a></a><span class="bu">print</span>(<span class="bu">len</span>(vocab), vocab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>27 ['afternoon' 'crash' 'crash occurred' 'direction' 'early'
 'early afternoon' 'eastbound' 'eastbound direction' 'four' 'four legged'
 'in' 'in four' 'in the' 'legged' 'occurred' 'occurred in' 'the'
 'the crash' 'the early' 'the eastbound' 'this' 'this crash' 'this two'
 'two' 'two vehicle' 'vehicle' 'vehicle crash']</code></pre>
</div>
</div>
<div id="5a6c9bf9" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a></a>counts.toarray()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>array([[1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1,
        0, 0, 0, 0, 0],
       [0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0,
        1, 1, 1, 1, 1],
       [0, 1, 1, 1, 0, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 2, 1, 0, 1, 0, 0,
        0, 0, 0, 0, 0]])</code></pre>
</div>
</div>
<p>See: <a href="https://books.google.com/ngrams">Google Books Ngram Viewer</a></p>
</section>
<section id="tf-idf" class="slide level2">
<h2>TF-IDF</h2>
<p>Stands for <em>term frequency-inverse document frequency</em>.</p>

<img data-src="tf-idf-graphic.png" class="r-stretch quarto-figure-center"><p class="caption">Infographic explaining TF-IDF</p><div class="footer">
<p>Source: FiloTechnologia (2014), <a href="http://filotechnologia.blogspot.com/2014/01/a-simple-java-class-for-tfidf-scoring.html">A simple Java class for TF-IDF scoring</a>, Blog post.</p>
</div>
</section></section>
<section>
<section id="bag-of-words" class="title-slide slide level1 agenda-slide center" data-visibility="uncounted">
<h1>Bag Of Words</h1>
<div class="agenda-heading">
<p>Lecture Outline</p>
</div>
<div class="agenda">
<ul>
<li><div class="agenda-inactive agenda-pre-active">
<p>Natural Language Processing</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Car Crash Police Reports</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Text Vectorisation</p>
</div></li>
<li><div class="agenda-active">
<p>Bag Of Words</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Limiting The Vocabulary</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Intelligently Limit The Vocabulary</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Interrogate The Model</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Word Embeddings</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Word Embeddings II</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Car Crash NLP Part II</p>
</div></li>
</ul>
</div>
</section>
<section id="count-words-in-all-the-summaries" class="slide level2">
<h2>Count words in all the summaries</h2>
<div id="55467ee4" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a></a>vect <span class="op">=</span> CountVectorizer()</span>
<span id="cb82-2"><a></a>vect.fit(X_train[<span class="st">"SUMMARY_EN"</span>])</span>
<span id="cb82-3"><a></a>vocab <span class="op">=</span> <span class="bu">list</span>(vect.get_feature_names_out())</span>
<span id="cb82-4"><a></a><span class="bu">len</span>(vocab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>18866</code></pre>
</div>
</div>
<div id="65387935" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a></a>vocab[:<span class="dv">5</span>], vocab[<span class="bu">len</span>(vocab)<span class="op">//</span><span class="dv">2</span>:(<span class="bu">len</span>(vocab)<span class="op">//</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">5</span>)], vocab[<span class="op">-</span><span class="dv">5</span>:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<pre><code>(['00', '000', '000lbs', '003', '005'],
 ['swinger', 'swinging', 'swipe', 'swiped', 'swiping'],
 ['zorcor', 'zotril', 'zx2', 'zx5', 'zyrtec'])</code></pre>
</div>
</div>
</section>
<section id="create-the-x-matrices" class="slide level2">
<h2>Create the <span class="math inline">X</span> matrices</h2>
<div id="02512e70" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a></a><span class="kw">def</span> vectorise_dataset(X, vect, txt_col<span class="op">=</span><span class="st">"SUMMARY_EN"</span>, dataframe<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb86-2"><a></a>    X_vects <span class="op">=</span> vect.transform(X[txt_col]).toarray()</span>
<span id="cb86-3"><a></a>    X_other <span class="op">=</span> X.drop(txt_col, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb86-4"><a></a></span>
<span id="cb86-5"><a></a>    <span class="cf">if</span> <span class="kw">not</span> dataframe:</span>
<span id="cb86-6"><a></a>        <span class="cf">return</span> np.concatenate([X_vects, X_other], axis<span class="op">=</span><span class="dv">1</span>)                           </span>
<span id="cb86-7"><a></a>    <span class="cf">else</span>:</span>
<span id="cb86-8"><a></a>        <span class="co"># Add column names and indices to the combined dataframe.</span></span>
<span id="cb86-9"><a></a>        vocab <span class="op">=</span> <span class="bu">list</span>(vect.get_feature_names_out())</span>
<span id="cb86-10"><a></a>        X_vects_df <span class="op">=</span> pd.DataFrame(X_vects, columns<span class="op">=</span>vocab, index<span class="op">=</span>X.index)</span>
<span id="cb86-11"><a></a>        <span class="cf">return</span> pd.concat([X_vects_df, X_other], axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="638b65dc" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a></a>X_train_bow <span class="op">=</span> vectorise_dataset(X_train, vect)</span>
<span id="cb87-2"><a></a>X_val_bow <span class="op">=</span> vectorise_dataset(X_val, vect)</span>
<span id="cb87-3"><a></a>X_test_bow <span class="op">=</span> vectorise_dataset(X_test, vect)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="check-the-input-matrix" class="slide level2">
<h2>Check the input matrix</h2>
<div id="7d2fda60" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a></a>vectorise_dataset(X_train, vect, dataframe<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<div>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">00</th>
<th data-quarto-table-cell-role="th">000</th>
<th data-quarto-table-cell-role="th">000lbs</th>
<th data-quarto-table-cell-role="th">003</th>
<th data-quarto-table-cell-role="th">005</th>
<th data-quarto-table-cell-role="th">007</th>
<th data-quarto-table-cell-role="th">00am</th>
<th data-quarto-table-cell-role="th">00pm</th>
<th data-quarto-table-cell-role="th">00tydo2</th>
<th data-quarto-table-cell-role="th">01</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">zx5</th>
<th data-quarto-table-cell-role="th">zyrtec</th>
<th data-quarto-table-cell-role="th">WEATHER1</th>
<th data-quarto-table-cell-role="th">WEATHER2</th>
<th data-quarto-table-cell-role="th">WEATHER3</th>
<th data-quarto-table-cell-role="th">WEATHER4</th>
<th data-quarto-table-cell-role="th">WEATHER5</th>
<th data-quarto-table-cell-role="th">WEATHER6</th>
<th data-quarto-table-cell-role="th">WEATHER7</th>
<th data-quarto-table-cell-role="th">WEATHER8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2532</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6209</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2561</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6882</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">206</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6356</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>4169 rows × 18874 columns</p>
</div>
</div>
</div>
</div>
</section>
<section id="make-a-simple-dense-model" class="slide level2">
<h2>Make a simple dense model</h2>
<div id="21e59da0" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a></a>num_features <span class="op">=</span> X_train_bow.shape[<span class="dv">1</span>]</span>
<span id="cb89-2"><a></a>num_cats <span class="op">=</span> <span class="dv">3</span> <span class="co"># 1, 2, 3+ vehicles</span></span>
<span id="cb89-3"><a></a></span>
<span id="cb89-4"><a></a><span class="kw">def</span> build_model(num_features, num_cats):</span>
<span id="cb89-5"><a></a>    random.seed(<span class="dv">42</span>)</span>
<span id="cb89-6"><a></a>    </span>
<span id="cb89-7"><a></a>    model <span class="op">=</span> Sequential([</span>
<span id="cb89-8"><a></a>        Input((num_features,)),</span>
<span id="cb89-9"><a></a>        Dense(<span class="dv">100</span>, activation<span class="op">=</span><span class="st">"relu"</span>),</span>
<span id="cb89-10"><a></a>        Dense(num_cats, activation<span class="op">=</span><span class="st">"softmax"</span>)</span>
<span id="cb89-11"><a></a>    ])</span>
<span id="cb89-12"><a></a>    </span>
<span id="cb89-13"><a></a>    topk <span class="op">=</span> SparseTopKCategoricalAccuracy(k<span class="op">=</span><span class="dv">2</span>, name<span class="op">=</span><span class="st">"topk"</span>)</span>
<span id="cb89-14"><a></a>    model.compile(<span class="st">"adam"</span>, <span class="st">"sparse_categorical_crossentropy"</span>,</span>
<span id="cb89-15"><a></a>        metrics<span class="op">=</span>[<span class="st">"accuracy"</span>, topk])</span>
<span id="cb89-16"><a></a>    </span>
<span id="cb89-17"><a></a>    <span class="cf">return</span> model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="inspect-the-model" class="slide level2">
<h2>Inspect the model</h2>
<div id="b4296936" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a></a>model <span class="op">=</span> build_model(num_features, num_cats)</span>
<span id="cb90-2"><a></a>model.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Model: "sequential"</span>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> Layer (type)                    </span>┃<span style="font-weight: bold"> Output Shape           </span>┃<span style="font-weight: bold">       Param # </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ dense (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                   │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">100</span>)            │     <span style="color: #00af00; text-decoration-color: #00af00">1,887,500</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense_1 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                 │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">3</span>)              │           <span style="color: #00af00; text-decoration-color: #00af00">303</span> │
└─────────────────────────────────┴────────────────────────┴───────────────┘
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Total params: </span><span style="color: #00af00; text-decoration-color: #00af00">1,887,803</span> (7.20 MB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">1,887,803</span> (7.20 MB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Non-trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">0</span> (0.00 B)
</pre>
</div>
</div>
</section>
<section id="fit-evaluate-the-model" class="slide level2">
<h2>Fit &amp; evaluate the model</h2>
<div id="854147db" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">1</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb91-2"><a></a>    monitor<span class="op">=</span><span class="st">"val_accuracy"</span>, verbose<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb91-3"><a></a><span class="op">%</span>time hist <span class="op">=</span> model.fit(X_train_bow, y_train, epochs<span class="op">=</span><span class="dv">10</span>, <span class="op">\</span></span>
<span id="cb91-4"><a></a>    callbacks<span class="op">=</span>[es], validation_data<span class="op">=</span>(X_val_bow, y_val), verbose<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 5: early stopping
Restoring model weights from the end of the best epoch: 4.
CPU times: user 36.8 s, sys: 1.4 s, total: 38.2 s
Wall time: 4.42 s</code></pre>
</div>
</div>
<div id="2cb85054" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a></a>model.evaluate(X_train_bow, y_train, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>[0.002541527384892106, 1.0, 1.0]</code></pre>
</div>
</div>
<div id="dbc0d855" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a></a>model.evaluate(X_val_bow, y_val, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>[2.776606559753418, 0.9453237652778625, 0.9949640035629272]</code></pre>
</div>
</div>
<p>As this happens to be the best in validation set, we can check the performance on the test set.</p>
<div id="12f30a4f" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a></a>model.evaluate(X_test_bow, y_test, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>[0.1902949959039688, 0.9374100565910339, 0.9971222877502441]</code></pre>
</div>
</div>
</section></section>
<section>
<section id="limiting-the-vocabulary" class="title-slide slide level1 agenda-slide center" data-visibility="uncounted">
<h1>Limiting The Vocabulary</h1>
<div class="agenda-heading">
<p>Lecture Outline</p>
</div>
<div class="agenda">
<ul>
<li><div class="agenda-inactive agenda-pre-active">
<p>Natural Language Processing</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Car Crash Police Reports</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Text Vectorisation</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Bag Of Words</p>
</div></li>
<li><div class="agenda-active">
<p>Limiting The Vocabulary</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Intelligently Limit The Vocabulary</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Interrogate The Model</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Word Embeddings</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Word Embeddings II</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Car Crash NLP Part II</p>
</div></li>
</ul>
</div>
</section>
<section id="the-max_features-value" class="slide level2">
<h2>The <code>max_features</code> value</h2>
<div id="35b56e3a" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a></a>vect <span class="op">=</span> CountVectorizer(max_features<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb99-2"><a></a>vect.fit(X_train[<span class="st">"SUMMARY_EN"</span>])</span>
<span id="cb99-3"><a></a>vocab <span class="op">=</span> vect.get_feature_names_out()</span>
<span id="cb99-4"><a></a><span class="bu">len</span>(vocab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>10</code></pre>
</div>
</div>
<div id="d69df639" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a></a><span class="bu">print</span>(vocab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['and' 'driver' 'for' 'in' 'lane' 'of' 'the' 'to' 'vehicle' 'was']</code></pre>
</div>
</div>
</section>
<section id="what-is-left" class="slide level2">
<h2>What is left?</h2>
<div id="111fb823" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb103-2"><a></a>    sentence <span class="op">=</span> X_train[<span class="st">"SUMMARY_EN"</span>].iloc[i]</span>
<span id="cb103-3"><a></a>    <span class="cf">for</span> word <span class="kw">in</span> sentence.split(<span class="st">" "</span>)[:<span class="dv">10</span>]:</span>
<span id="cb103-4"><a></a>        word_or_qn <span class="op">=</span> word <span class="cf">if</span> word <span class="kw">in</span> vocab <span class="cf">else</span> <span class="st">"?"</span></span>
<span id="cb103-5"><a></a>        <span class="bu">print</span>(word_or_qn, end<span class="op">=</span><span class="st">" "</span>)</span>
<span id="cb103-6"><a></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>? ? ? in the ? ? of ? ? 

? ? ? ? in ? ? ? ? ? 

? ? ? in the ? ? of ? ? 
</code></pre>
</div>
</div>
<div id="abbe69b9" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb105-2"><a></a>    sentence <span class="op">=</span> X_train[<span class="st">"SUMMARY_EN"</span>].iloc[i]</span>
<span id="cb105-3"><a></a>    num_words <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb105-4"><a></a>    <span class="cf">for</span> word <span class="kw">in</span> sentence.split(<span class="st">" "</span>):</span>
<span id="cb105-5"><a></a>        <span class="cf">if</span> word <span class="kw">in</span> vocab:</span>
<span id="cb105-6"><a></a>            <span class="bu">print</span>(word, end<span class="op">=</span><span class="st">" "</span>)</span>
<span id="cb105-7"><a></a>            num_words <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb105-8"><a></a>        <span class="cf">if</span> num_words <span class="op">==</span> <span class="dv">10</span>:</span>
<span id="cb105-9"><a></a>            <span class="cf">break</span></span>
<span id="cb105-10"><a></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>in the of in the of of was and was 

in and of in and for the of the and 

in the of to was was of was was and 
</code></pre>
</div>
</div>
</section>
<section id="remove-stop-words" class="slide level2">
<h2>Remove stop words</h2>
<div id="34e1caec" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a></a>vect <span class="op">=</span> CountVectorizer(max_features<span class="op">=</span><span class="dv">10</span>, stop_words<span class="op">=</span><span class="st">"english"</span>)</span>
<span id="cb107-2"><a></a>vect.fit(X_train[<span class="st">"SUMMARY_EN"</span>])</span>
<span id="cb107-3"><a></a>vocab <span class="op">=</span> vect.get_feature_names_out()</span>
<span id="cb107-4"><a></a><span class="bu">len</span>(vocab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<pre><code>10</code></pre>
</div>
</div>
<div id="ce0a49c8" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a></a><span class="bu">print</span>(vocab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['coded' 'crash' 'critical' 'driver' 'event' 'intersection' 'lane' 'left'
 'roadway' 'vehicle']</code></pre>
</div>
</div>
<div id="47bb3d61" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb111-2"><a></a>    sentence <span class="op">=</span> X_train[<span class="st">"SUMMARY_EN"</span>].iloc[i]</span>
<span id="cb111-3"><a></a>    num_words <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb111-4"><a></a>    <span class="cf">for</span> word <span class="kw">in</span> sentence.split(<span class="st">" "</span>):</span>
<span id="cb111-5"><a></a>        <span class="cf">if</span> word <span class="kw">in</span> vocab:</span>
<span id="cb111-6"><a></a>            <span class="bu">print</span>(word, end<span class="op">=</span><span class="st">" "</span>)</span>
<span id="cb111-7"><a></a>            num_words <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb111-8"><a></a>        <span class="cf">if</span> num_words <span class="op">==</span> <span class="dv">10</span>:</span>
<span id="cb111-9"><a></a>            <span class="cf">break</span></span>
<span id="cb111-10"><a></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>crash intersection roadway roadway roadway intersection lane lane intersection driver 

crash roadway left roadway roadway roadway lane lane roadway crash 

crash vehicle left left vehicle driver vehicle lane lane coded 
</code></pre>
</div>
</div>
</section>
<section id="keep-1000-most-frequent-words" class="slide level2">
<h2>Keep 1,000 most frequent words</h2>
<div id="044fbdfb" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a></a>vect <span class="op">=</span> CountVectorizer(max_features<span class="op">=</span><span class="dv">1_000</span>, stop_words<span class="op">=</span><span class="st">"english"</span>)</span>
<span id="cb113-2"><a></a>vect.fit(X_train[<span class="st">"SUMMARY_EN"</span>])</span>
<span id="cb113-3"><a></a>vocab <span class="op">=</span> vect.get_feature_names_out()</span>
<span id="cb113-4"><a></a><span class="bu">len</span>(vocab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<pre><code>1000</code></pre>
</div>
</div>
<div id="a090fd04" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a></a><span class="bu">print</span>(vocab[:<span class="dv">5</span>], vocab[<span class="bu">len</span>(vocab)<span class="op">//</span><span class="dv">2</span>:(<span class="bu">len</span>(vocab)<span class="op">//</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">5</span>)], vocab[<span class="op">-</span><span class="dv">5</span>:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['10' '105' '113' '12' '15'] ['interruption' 'intersected' 'intersecting' 'intersection' 'interstate'] ['year' 'years' 'yellow' 'yield' 'zone']</code></pre>
</div>
</div>
<p>Create the <span class="math inline">X</span> matrices:</p>
<div id="148ea037" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a></a>X_train_bow <span class="op">=</span> vectorise_dataset(X_train, vect)</span>
<span id="cb117-2"><a></a>X_val_bow <span class="op">=</span> vectorise_dataset(X_val, vect)</span>
<span id="cb117-3"><a></a>X_test_bow <span class="op">=</span> vectorise_dataset(X_test, vect)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="what-is-left-1" class="slide level2">
<h2>What is left?</h2>
<div id="0a4882a1" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb118-2"><a></a>    sentence <span class="op">=</span> X_train[<span class="st">"SUMMARY_EN"</span>].iloc[i]</span>
<span id="cb118-3"><a></a>    num_words <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb118-4"><a></a>    <span class="cf">for</span> word <span class="kw">in</span> sentence.split(<span class="st">" "</span>):</span>
<span id="cb118-5"><a></a>        <span class="cf">if</span> word <span class="kw">in</span> vocab:</span>
<span id="cb118-6"><a></a>            <span class="bu">print</span>(word, end<span class="op">=</span><span class="st">" "</span>)</span>
<span id="cb118-7"><a></a>            num_words <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb118-8"><a></a>        <span class="cf">if</span> num_words <span class="op">==</span> <span class="dv">10</span>:</span>
<span id="cb118-9"><a></a>            <span class="cf">break</span></span>
<span id="cb118-10"><a></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>crash occurred early afternoon weekday middle suburban intersection consisted lanes 

crash occurred roadway level consists lanes direction center left turn 

crash occurred eastbound direction entrance ramp right curved road uphill 

crash occurred straight roadway consists lanes direction center left turn 

collision occurred evening hours crash occurred level bituminous roadway residential 

vehicle crash occurred daylight location lane undivided left curved downhill 

vehicle crash occurred early morning daylight hours roadway traffic roadway 

crash occurred northbound lanes northbound southbound slightly street curved posted 

crash occurred eastbound lanes access highway weekend roadway consisted lanes 

collision occurred intersection north south traffic controlled stop roadways left 
</code></pre>
</div>
</div>
</section>
<section id="check-the-input-matrix-1" class="slide level2">
<h2>Check the input matrix</h2>
<div id="278411de" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a></a>vectorise_dataset(X_train, vect, dataframe<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<div>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">10</th>
<th data-quarto-table-cell-role="th">105</th>
<th data-quarto-table-cell-role="th">113</th>
<th data-quarto-table-cell-role="th">12</th>
<th data-quarto-table-cell-role="th">15</th>
<th data-quarto-table-cell-role="th">150</th>
<th data-quarto-table-cell-role="th">16</th>
<th data-quarto-table-cell-role="th">17</th>
<th data-quarto-table-cell-role="th">18</th>
<th data-quarto-table-cell-role="th">180</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">yield</th>
<th data-quarto-table-cell-role="th">zone</th>
<th data-quarto-table-cell-role="th">WEATHER1</th>
<th data-quarto-table-cell-role="th">WEATHER2</th>
<th data-quarto-table-cell-role="th">WEATHER3</th>
<th data-quarto-table-cell-role="th">WEATHER4</th>
<th data-quarto-table-cell-role="th">WEATHER5</th>
<th data-quarto-table-cell-role="th">WEATHER6</th>
<th data-quarto-table-cell-role="th">WEATHER7</th>
<th data-quarto-table-cell-role="th">WEATHER8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2532</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6209</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2561</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6882</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">206</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6356</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>4169 rows × 1008 columns</p>
</div>
</div>
</div>
</div>
</section>
<section id="make-inspect-the-model" class="slide level2">
<h2>Make &amp; inspect the model</h2>
<div id="dbb41c38" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a></a>num_features <span class="op">=</span> X_train_bow.shape[<span class="dv">1</span>]</span>
<span id="cb121-2"><a></a>model <span class="op">=</span> build_model(num_features, num_cats)</span>
<span id="cb121-3"><a></a>model.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Model: "sequential_1"</span>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> Layer (type)                    </span>┃<span style="font-weight: bold"> Output Shape           </span>┃<span style="font-weight: bold">       Param # </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ dense_2 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                 │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">100</span>)            │       <span style="color: #00af00; text-decoration-color: #00af00">100,900</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense_3 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                 │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">3</span>)              │           <span style="color: #00af00; text-decoration-color: #00af00">303</span> │
└─────────────────────────────────┴────────────────────────┴───────────────┘
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Total params: </span><span style="color: #00af00; text-decoration-color: #00af00">101,203</span> (395.32 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">101,203</span> (395.32 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Non-trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">0</span> (0.00 B)
</pre>
</div>
</div>
</section>
<section id="fit-evaluate-the-model-1" class="slide level2">
<h2>Fit &amp; evaluate the model</h2>
<div id="f53f12e1" class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">1</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb122-2"><a></a>    monitor<span class="op">=</span><span class="st">"val_accuracy"</span>, verbose<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb122-3"><a></a><span class="op">%</span>time hist <span class="op">=</span> model.fit(X_train_bow, y_train, epochs<span class="op">=</span><span class="dv">10</span>, <span class="op">\</span></span>
<span id="cb122-4"><a></a>    callbacks<span class="op">=</span>[es], validation_data<span class="op">=</span>(X_val_bow, y_val), verbose<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 3: early stopping
Restoring model weights from the end of the best epoch: 2.
CPU times: user 1.23 s, sys: 194 ms, total: 1.42 s
Wall time: 810 ms</code></pre>
</div>
</div>
<div id="7a1efd88" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a></a>model.evaluate(X_train_bow, y_train, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="74">
<pre><code>[0.1021684780716896, 0.9815303683280945, 0.9990405440330505]</code></pre>
</div>
</div>
<div id="f4209ff0" class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a></a>model.evaluate(X_val_bow, y_val, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="75">
<pre><code>[2.4335882663726807, 0.9381294846534729, 0.9942445755004883]</code></pre>
</div>
</div>
</section></section>
<section>
<section id="intelligently-limit-the-vocabulary" class="title-slide slide level1 agenda-slide center" data-visibility="uncounted">
<h1>Intelligently Limit The Vocabulary</h1>
<div class="agenda-heading">
<p>Lecture Outline</p>
</div>
<div class="agenda">
<ul>
<li><div class="agenda-inactive agenda-pre-active">
<p>Natural Language Processing</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Car Crash Police Reports</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Text Vectorisation</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Bag Of Words</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Limiting The Vocabulary</p>
</div></li>
<li><div class="agenda-active">
<p>Intelligently Limit The Vocabulary</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Interrogate The Model</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Word Embeddings</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Word Embeddings II</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Car Crash NLP Part II</p>
</div></li>
</ul>
</div>
</section>
<section id="keep-1000-most-frequent-words-1" class="slide level2">
<h2>Keep 1,000 most frequent words</h2>
<div id="48e9298f" class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a></a>vect <span class="op">=</span> CountVectorizer(max_features<span class="op">=</span><span class="dv">1_000</span>, stop_words<span class="op">=</span><span class="st">"english"</span>)</span>
<span id="cb128-2"><a></a>vect.fit(X_train[<span class="st">"SUMMARY_EN"</span>])</span>
<span id="cb128-3"><a></a>vocab <span class="op">=</span> vect.get_feature_names_out()</span>
<span id="cb128-4"><a></a><span class="bu">len</span>(vocab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="76">
<pre><code>1000</code></pre>
</div>
</div>
<div id="af3d2e7a" class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a></a><span class="bu">print</span>(vocab[:<span class="dv">5</span>], vocab[<span class="bu">len</span>(vocab)<span class="op">//</span><span class="dv">2</span>:(<span class="bu">len</span>(vocab)<span class="op">//</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">5</span>)], vocab[<span class="op">-</span><span class="dv">5</span>:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['10' '105' '113' '12' '15'] ['interruption' 'intersected' 'intersecting' 'intersection' 'interstate'] ['year' 'years' 'yellow' 'yield' 'zone']</code></pre>
</div>
</div>
</section>
<section id="install-spacy" class="slide level2">
<h2>Install spacy</h2>
<div id="d344f220" class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a></a><span class="op">!</span>pip install spacy</span>
<span id="cb132-2"><a></a><span class="op">!</span>python <span class="op">-</span>m spacy download en_core_web_sm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="3b05f5ce" class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a></a><span class="im">import</span> spacy</span>
<span id="cb133-2"><a></a></span>
<span id="cb133-3"><a></a>nlp <span class="op">=</span> spacy.load(<span class="st">"en_core_web_sm"</span>)</span>
<span id="cb133-4"><a></a>doc <span class="op">=</span> nlp(<span class="st">"Apple is looking at buying U.K. startup for $1 billion"</span>)</span>
<span id="cb133-5"><a></a><span class="cf">for</span> token <span class="kw">in</span> doc:</span>
<span id="cb133-6"><a></a>    <span class="bu">print</span>(token.text, token.pos_, token.dep_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Apple PROPN nsubj
is AUX aux
looking VERB ROOT
at ADP prep
buying VERB pcomp
U.K. PROPN dobj
startup NOUN dobj
for ADP prep
$ SYM quantmod
1 NUM compound
billion NUM pobj</code></pre>
</div>
</div>
</section>
<section id="lemmatize-the-text" class="slide level2">
<h2>Lemmatize the text</h2>
<div id="d17a2d25" class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a></a><span class="kw">def</span> lemmatize(txt):</span>
<span id="cb135-2"><a></a>    doc <span class="op">=</span> nlp(txt)</span>
<span id="cb135-3"><a></a>    good_tokens <span class="op">=</span> [token.lemma_.lower() <span class="cf">for</span> token <span class="kw">in</span> doc <span class="op">\</span></span>
<span id="cb135-4"><a></a>        <span class="cf">if</span> <span class="kw">not</span> token.like_num <span class="kw">and</span> <span class="op">\</span></span>
<span id="cb135-5"><a></a>           <span class="kw">not</span> token.is_punct <span class="kw">and</span> <span class="op">\</span></span>
<span id="cb135-6"><a></a>           <span class="kw">not</span> token.is_space <span class="kw">and</span> <span class="op">\</span></span>
<span id="cb135-7"><a></a>           <span class="kw">not</span> token.is_currency <span class="kw">and</span> <span class="op">\</span></span>
<span id="cb135-8"><a></a>           <span class="kw">not</span> token.is_stop]</span>
<span id="cb135-9"><a></a>    <span class="cf">return</span> <span class="st">" "</span>.join(good_tokens)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="171e9adc" class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a></a>test_str <span class="op">=</span> <span class="st">"Incident at 100kph and '10 incidents -13.3%' are incidental?</span><span class="ch">\t</span><span class="st"> $5"</span></span>
<span id="cb136-2"><a></a>lemmatize(test_str)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="81">
<pre><code>'incident 100kph incident incidental'</code></pre>
</div>
</div>
<div id="1335256d" class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a></a>test_str <span class="op">=</span> <span class="st">"I interviewed 5-years ago, 150 interviews every year at 10:30 are.."</span></span>
<span id="cb138-2"><a></a>lemmatize(test_str)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="82">
<pre><code>'interview year ago interview year 10:30'</code></pre>
</div>
</div>
</section>
<section id="apply-to-the-whole-dataset" class="slide level2">
<h2>Apply to the whole dataset</h2>
<div id="2958cdaf" class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a></a>df[<span class="st">"SUMMARY_EN_LEMMA"</span>] <span class="op">=</span> df[<span class="st">"SUMMARY_EN"</span>].<span class="bu">map</span>(lemmatize)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="ab3ca1f4" class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a></a>weather_cols <span class="op">=</span> [<span class="ss">f"WEATHER</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">9</span>)]</span>
<span id="cb141-2"><a></a>features <span class="op">=</span> df[[<span class="st">"SUMMARY_EN_LEMMA"</span>] <span class="op">+</span> weather_cols]</span>
<span id="cb141-3"><a></a></span>
<span id="cb141-4"><a></a>X_main, X_test, y_main, y_test <span class="op">=</span> <span class="op">\</span></span>
<span id="cb141-5"><a></a>    train_test_split(features, target, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb141-6"><a></a></span>
<span id="cb141-7"><a></a><span class="co"># As 0.25 x 0.8 = 0.2</span></span>
<span id="cb141-8"><a></a>X_train, X_val, y_train, y_val <span class="op">=</span> <span class="op">\</span></span>
<span id="cb141-9"><a></a>    train_test_split(X_main, y_main, test_size<span class="op">=</span><span class="fl">0.25</span>, random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb141-10"><a></a></span>
<span id="cb141-11"><a></a>X_train.shape, X_val.shape, X_test.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="84">
<pre><code>((4169, 9), (1390, 9), (1390, 9))</code></pre>
</div>
</div>
</section>
<section id="keep-1000-most-frequent-lemmas" class="slide level2">
<h2>Keep 1,000 most frequent lemmas</h2>
<div id="3943da13" class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a></a>vect <span class="op">=</span> CountVectorizer(max_features<span class="op">=</span><span class="dv">1_000</span>, stop_words<span class="op">=</span><span class="st">"english"</span>)</span>
<span id="cb143-2"><a></a>vect.fit(X_train[<span class="st">"SUMMARY_EN_LEMMA"</span>])</span>
<span id="cb143-3"><a></a>vocab <span class="op">=</span> vect.get_feature_names_out()</span>
<span id="cb143-4"><a></a><span class="bu">len</span>(vocab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="85">
<pre><code>1000</code></pre>
</div>
</div>
<div id="28f3435c" class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a></a><span class="bu">print</span>(vocab[:<span class="dv">5</span>], vocab[<span class="bu">len</span>(vocab)<span class="op">//</span><span class="dv">2</span>:(<span class="bu">len</span>(vocab)<span class="op">//</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">5</span>)], vocab[<span class="op">-</span><span class="dv">5</span>:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['10' '150' '48kmph' '4x4' '56kmph'] ['let' 'level' 'lexus' 'license' 'light'] ['yaw' 'year' 'yellow' 'yield' 'zone']</code></pre>
</div>
</div>
<p>Create the <span class="math inline">X</span> matrices:</p>
<div id="b722167d" class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a></a>X_train_bow <span class="op">=</span> vectorise_dataset(X_train, vect, <span class="st">"SUMMARY_EN_LEMMA"</span>)</span>
<span id="cb147-2"><a></a>X_val_bow <span class="op">=</span> vectorise_dataset(X_val, vect, <span class="st">"SUMMARY_EN_LEMMA"</span>)</span>
<span id="cb147-3"><a></a>X_test_bow <span class="op">=</span> vectorise_dataset(X_test, vect, <span class="st">"SUMMARY_EN_LEMMA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="check-the-input-matrix-2" class="slide level2">
<h2>Check the input matrix</h2>
<div id="7195aac3" class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a></a>vectorise_dataset(X_train, vect, <span class="st">"SUMMARY_EN_LEMMA"</span>, dataframe<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="88">
<div>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">10</th>
<th data-quarto-table-cell-role="th">150</th>
<th data-quarto-table-cell-role="th">48kmph</th>
<th data-quarto-table-cell-role="th">4x4</th>
<th data-quarto-table-cell-role="th">56kmph</th>
<th data-quarto-table-cell-role="th">64kmph</th>
<th data-quarto-table-cell-role="th">72kmph</th>
<th data-quarto-table-cell-role="th">ability</th>
<th data-quarto-table-cell-role="th">able</th>
<th data-quarto-table-cell-role="th">accelerate</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">yield</th>
<th data-quarto-table-cell-role="th">zone</th>
<th data-quarto-table-cell-role="th">WEATHER1</th>
<th data-quarto-table-cell-role="th">WEATHER2</th>
<th data-quarto-table-cell-role="th">WEATHER3</th>
<th data-quarto-table-cell-role="th">WEATHER4</th>
<th data-quarto-table-cell-role="th">WEATHER5</th>
<th data-quarto-table-cell-role="th">WEATHER6</th>
<th data-quarto-table-cell-role="th">WEATHER7</th>
<th data-quarto-table-cell-role="th">WEATHER8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2532</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6209</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2561</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6882</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">206</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6356</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>4169 rows × 1008 columns</p>
</div>
</div>
</div>
</div>
</section>
<section id="make-inspect-the-model-1" class="slide level2">
<h2>Make &amp; inspect the model</h2>
<div id="f77c2471" class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a></a>num_features <span class="op">=</span> X_train_bow.shape[<span class="dv">1</span>]</span>
<span id="cb149-2"><a></a>model <span class="op">=</span> build_model(num_features, num_cats)</span>
<span id="cb149-3"><a></a>model.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Model: "sequential_2"</span>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> Layer (type)                    </span>┃<span style="font-weight: bold"> Output Shape           </span>┃<span style="font-weight: bold">       Param # </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ dense_4 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                 │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">100</span>)            │       <span style="color: #00af00; text-decoration-color: #00af00">100,900</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense_5 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                 │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">3</span>)              │           <span style="color: #00af00; text-decoration-color: #00af00">303</span> │
└─────────────────────────────────┴────────────────────────┴───────────────┘
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Total params: </span><span style="color: #00af00; text-decoration-color: #00af00">101,203</span> (395.32 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">101,203</span> (395.32 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Non-trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">0</span> (0.00 B)
</pre>
</div>
</div>
</section>
<section id="fit-evaluate-the-model-2" class="slide level2">
<h2>Fit &amp; evaluate the model</h2>
<div id="4c772d35" class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a></a>es <span class="op">=</span> EarlyStopping(patience<span class="op">=</span><span class="dv">1</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb150-2"><a></a>    monitor<span class="op">=</span><span class="st">"val_accuracy"</span>, verbose<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb150-3"><a></a><span class="op">%</span>time hist <span class="op">=</span> model.fit(X_train_bow, y_train, epochs<span class="op">=</span><span class="dv">10</span>, <span class="op">\</span></span>
<span id="cb150-4"><a></a>    callbacks<span class="op">=</span>[es], validation_data<span class="op">=</span>(X_val_bow, y_val), verbose<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 3: early stopping
Restoring model weights from the end of the best epoch: 2.
CPU times: user 2.16 s, sys: 257 ms, total: 2.42 s
Wall time: 1.21 s</code></pre>
</div>
</div>
<div id="13ee5a64" class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a></a>model.evaluate(X_train_bow, y_train, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="91">
<pre><code>[0.09055039286613464, 0.9851283431053162, 0.9990405440330505]</code></pre>
</div>
</div>
<div id="0356a68e" class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a></a>model.evaluate(X_val_bow, y_val, verbose<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="92">
<pre><code>[3.8409152030944824, 0.9402877688407898, 0.9928057789802551]</code></pre>
</div>
</div>
</section></section>
<section>
<section id="interrogate-the-model" class="title-slide slide level1 agenda-slide center" data-visibility="uncounted">
<h1>Interrogate The Model</h1>
<div class="agenda-heading">
<p>Lecture Outline</p>
</div>
<div class="agenda">
<ul>
<li><div class="agenda-inactive agenda-pre-active">
<p>Natural Language Processing</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Car Crash Police Reports</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Text Vectorisation</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Bag Of Words</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Limiting The Vocabulary</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Intelligently Limit The Vocabulary</p>
</div></li>
<li><div class="agenda-active">
<p>Interrogate The Model</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Word Embeddings</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Word Embeddings II</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Car Crash NLP Part II</p>
</div></li>
</ul>
</div>
</section>
<section id="permutation-importance-algorithm" class="slide level2 smaller">
<h2>Permutation importance algorithm</h2>
<p>Taken directly from scikit-learn documentation:</p>
<ul>
<li><p>Inputs: fitted predictive model <span class="math inline">m</span>, tabular dataset (training or validation) <span class="math inline">D</span>.</p></li>
<li><p>Compute the reference score <span class="math inline">s</span> of the model <span class="math inline">m</span> on data <span class="math inline">D</span> (for instance the accuracy for a classifier or the <span class="math inline">R^2</span> for a regressor).</p></li>
<li><p>For each feature <span class="math inline">j</span> (column of <span class="math inline">D</span>):</p>
<ul>
<li><p>For each repetition <span class="math inline">k</span> in <span class="math inline">{1, \dots, K}</span>:</p>
<ul>
<li>Randomly shuffle column <span class="math inline">j</span> of dataset <span class="math inline">D</span> to generate a corrupted version of the data named <span class="math inline">\tilde{D}_{k,j}</span>.</li>
<li>Compute the score <span class="math inline">s_{k,j}</span> of model <span class="math inline">m</span> on corrupted data <span class="math inline">\tilde{D}_{k,j}</span>.</li>
</ul></li>
<li><p>Compute importance <span class="math inline">i_j</span> for feature <span class="math inline">f_j</span> defined as:</p>
<p><span class="math display"> i_j = s - \frac{1}{K} \sum_{k=1}^{K} s_{k,j} </span></p></li>
</ul></li>
</ul>
<div class="footer">
<p>Source: scikit-learn documentation, <a href="https://scikit-learn.org/stable/modules/permutation_importance.html">permutation_importance function</a>.</p>
</div>
</section>
<section id="find-important-inputs" class="slide level2">
<h2>Find important inputs</h2>
<div id="59d915bf" class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a></a><span class="kw">def</span> permutation_test(model, X, y, num_reps<span class="op">=</span><span class="dv">1</span>, seed<span class="op">=</span><span class="dv">42</span>):</span>
<span id="cb156-2"><a></a>    <span class="co">"""</span></span>
<span id="cb156-3"><a></a><span class="co">    Run the permutation test for variable importance.</span></span>
<span id="cb156-4"><a></a><span class="co">    Returns matrix of shape (X.shape[1], len(model.evaluate(X, y))).</span></span>
<span id="cb156-5"><a></a><span class="co">    """</span></span>
<span id="cb156-6"><a></a>    rnd.seed(seed)</span>
<span id="cb156-7"><a></a>    scores <span class="op">=</span> []    </span>
<span id="cb156-8"><a></a></span>
<span id="cb156-9"><a></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(X.shape[<span class="dv">1</span>]):</span>
<span id="cb156-10"><a></a>        original_column <span class="op">=</span> np.copy(X[:, j])</span>
<span id="cb156-11"><a></a>        col_scores <span class="op">=</span> []</span>
<span id="cb156-12"><a></a></span>
<span id="cb156-13"><a></a>        <span class="cf">for</span> r <span class="kw">in</span> <span class="bu">range</span>(num_reps):</span>
<span id="cb156-14"><a></a>            rnd.shuffle(X[:,j])</span>
<span id="cb156-15"><a></a>            col_scores.append(model.evaluate(X, y, verbose<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb156-16"><a></a></span>
<span id="cb156-17"><a></a>        scores.append(np.mean(col_scores, axis<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb156-18"><a></a>        X[:,j] <span class="op">=</span> original_column</span>
<span id="cb156-19"><a></a>    </span>
<span id="cb156-20"><a></a>    <span class="cf">return</span> np.array(scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="run-the-permutation-test" class="slide level2">
<h2>Run the permutation test</h2>
<div id="a19c049b" class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a></a>perm_scores <span class="op">=</span> permutation_test(model, X_val_bow, y_val)[:,<span class="dv">1</span>]</span>
<span id="cb157-2"><a></a>plt.plot(perm_scores)<span class="op">;</span></span>
<span id="cb157-3"><a></a>plt.xlabel(<span class="st">"Input index"</span>)<span class="op">;</span> plt.ylabel(<span class="st">"Accuracy when shuffled"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="natural-language-processing_files/figure-revealjs/cell-100-output-1.png" class="r-stretch"></section>
<section id="find-the-most-significant-inputs" class="slide level2">
<h2>Find the most significant inputs</h2>
<div id="778c64e7" class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a></a>vocab <span class="op">=</span> vect.get_feature_names_out()</span>
<span id="cb158-2"><a></a>input_cols <span class="op">=</span> <span class="bu">list</span>(vocab) <span class="op">+</span> weather_cols</span>
<span id="cb158-3"><a></a></span>
<span id="cb158-4"><a></a>best_input_inds <span class="op">=</span> np.argsort(perm_scores)[:<span class="dv">100</span>]</span>
<span id="cb158-5"><a></a>best_inputs <span class="op">=</span> [input_cols[idx] <span class="cf">for</span> idx <span class="kw">in</span> best_input_inds]</span>
<span id="cb158-6"><a></a></span>
<span id="cb158-7"><a></a><span class="bu">print</span>(best_inputs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['harmful', 'involve', 'event', 'contact', 'pre', 'stop', 'rear', 'motor', 'female', 'impact', 'single', 'occur', 'drive', 'code', 'male', 'continue', 'driver', 'direction', 'push', 'northbound', 'state', 'park', 'light', 'line', 'control', 'WEATHER4', 'reason', 'traffic', 'night', 'old', 'injure', 'right', 'apply', 'tow', 'rest', 'WEATHER1', 'year', 'morning', 'tire', 'work', 'south', 'westbound', 'intersection', 'second', 'shoulder', 'sign', 'edge', 'southbound', 'spin', 'seat', 'cross', 'encroachment', 'pressure', 'cause', 'error', 'clear', 'come', 'malibu', 'loss', 'local', 'hospital', 'correct', 'coupe', 'door', 'minivan', 'WEATHER8', 'turn', 'street', 'WEATHER5', 'undivided', 'trailer', 'travel', 'asphalt', 'ahead', 'afternoon', 'aggressive', 'undivide', 'color', 'collision', 'minor', 'miss', 'associative', 'alcohol', 'adverse', 'mph', 'near', 'chevrolet', 'past', 'physical', 'pickup', 'clockwise', 'WEATHER7', 'adjacent', 'position', 'edr', 'dodge', 'yield', 'directional', 'hard', 'departure']</code></pre>
</div>
</div>
</section>
<section id="how-about-a-simple-decision-tree" class="slide level2">
<h2>How about a simple decision tree?</h2>
<div id="6280d848" class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb160-1"><a></a><span class="im">from</span> sklearn <span class="im">import</span> tree</span>
<span id="cb160-2"><a></a>clf <span class="op">=</span> tree.DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">0</span>, max_leaf_nodes<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb160-3"><a></a>clf.fit(X_train_bow[:, best_input_inds], y_train)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="03c46658" class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb161-1"><a></a><span class="bu">print</span>(clf.score(X_train_bow[:, best_input_inds], y_train))</span>
<span id="cb161-2"><a></a><span class="bu">print</span>(clf.score(X_val_bow[:, best_input_inds], y_val))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.920844327176781
0.9330935251798561</code></pre>
</div>
</div>
</section>
<section id="decision-tree" class="slide level2">
<h2>Decision tree</h2>
<div id="5013f35a" class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a></a>tree.plot_tree(clf, feature_names<span class="op">=</span>best_inputs, filled<span class="op">=</span><span class="va">True</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<img data-src="natural-language-processing_files/figure-revealjs/cell-105-output-1.svg" class="r-stretch"><div id="e68aa145" class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb164-1"><a></a><span class="bu">print</span>(np.where(clf.feature_importances_ <span class="op">&gt;</span> <span class="dv">0</span>)[<span class="dv">0</span>])</span>
<span id="cb164-2"><a></a>[best_inputs[ind] <span class="cf">for</span> ind <span class="kw">in</span> np.where(clf.feature_importances_ <span class="op">&gt;</span> <span class="dv">0</span>)[<span class="dv">0</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[ 0 26]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="99">
<pre><code>['harmful', 'reason']</code></pre>
</div>
</div>
</section>
<section id="using-the-original-dataset" class="slide level2">
<h2>Using the original dataset</h2>
<div id="ad4de517" class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a></a>perm_scores <span class="op">=</span> permutation_test(model, X_val_bow, y_val)[:,<span class="dv">1</span>]</span>
<span id="cb167-2"><a></a>plt.plot(perm_scores)<span class="op">;</span></span>
<span id="cb167-3"><a></a>plt.xlabel(<span class="st">"Input index"</span>)<span class="op">;</span> plt.ylabel(<span class="st">"Accuracy when shuffled"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="natural-language-processing_files/figure-revealjs/cell-108-output-1.png" class="r-stretch"></section>
<section id="find-the-most-significant-inputs-1" class="slide level2">
<h2>Find the most significant inputs</h2>
<div id="9cde5ecf" class="cell" data-execution_count="108">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb168-1"><a></a>vocab <span class="op">=</span> vect.get_feature_names_out()</span>
<span id="cb168-2"><a></a>input_cols <span class="op">=</span> <span class="bu">list</span>(vocab) <span class="op">+</span> weather_cols</span>
<span id="cb168-3"><a></a></span>
<span id="cb168-4"><a></a>best_input_inds <span class="op">=</span> np.argsort(perm_scores)[:<span class="dv">100</span>]</span>
<span id="cb168-5"><a></a>best_inputs <span class="op">=</span> [input_cols[idx] <span class="cf">for</span> idx <span class="kw">in</span> best_input_inds]</span>
<span id="cb168-6"><a></a></span>
<span id="cb168-7"><a></a><span class="bu">print</span>(best_inputs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['v3', 'v2', 'vehicle', 'lane', 'harmful', 'right', 'divided', 'south', 'motor', 'dry', 'event', 'left', 'parked', 'WEATHER4', 'related', 'stop', 'impact', 'v4', 'crash', 'direction', 'involved', 'internal', 'stated', 'barrier', 'dodge', 'asphalt', 'chevrolet', 'higher', 'forward', 'pre', 'precrash', 'pushed', 'corner', 'hand', 'prior', 'door', 'WEATHER8', 'factor', 'work', 'mph', 'year', 'critical', 'WEATHER1', 'WEATHER3', 'single', 'WEATHER5', 'straight', 'ahead', 'turning', 'honda', 'hours', 'type', 'daylight', 'possible', 'ford', 'male', 'facing', 'actions', 'consists', 'unknown', 'uphill', 'pick', 'stopped', 'point', 'alcohol', 'high', 'pull', 'proceeded', 'encroaching', 'morning', 'trailer', 'grand', 'associated', 'blood', 'meters', 'basis', 'experience', 'prescription', 'moved', 'small', 'steered', 'maneuver', 'medication', 'heart', 'rotate', 'old', 'pain', 'weekday', 'clear', 'seconds', 'civic', 'started', 'northbound', '2006', 'noon', 'miles', '44', 'injuries', 'vehicles', 'saw']</code></pre>
</div>
</div>
</section>
<section id="how-about-a-simple-decision-tree-1" class="slide level2">
<h2>How about a simple decision tree?</h2>
<div id="0bc3c3c9" class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb170-1"><a></a>clf <span class="op">=</span> tree.DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">0</span>, max_leaf_nodes<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb170-2"><a></a>clf.fit(X_train_bow[:, best_input_inds], y_train)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="2a9b4551" class="cell" data-execution_count="110">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb171-1"><a></a><span class="bu">print</span>(clf.score(X_train_bow[:, best_input_inds], y_train))</span>
<span id="cb171-2"><a></a><span class="bu">print</span>(clf.score(X_val_bow[:, best_input_inds], y_val))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.9275605660829935
0.939568345323741</code></pre>
</div>
</div>
</section>
<section id="decision-tree-1" class="slide level2">
<h2>Decision tree</h2>
<div id="176aa335" class="cell" data-execution_count="111">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb173-1"><a></a>tree.plot_tree(clf, feature_names<span class="op">=</span>best_inputs, filled<span class="op">=</span><span class="va">True</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<img data-src="natural-language-processing_files/figure-revealjs/cell-113-output-1.svg" class="r-stretch"><div id="02d71b89" class="cell" data-execution_count="113">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb174-1"><a></a><span class="bu">print</span>(np.where(clf.feature_importances_ <span class="op">&gt;</span> <span class="dv">0</span>)[<span class="dv">0</span>])</span>
<span id="cb174-2"><a></a>[best_inputs[ind] <span class="cf">for</span> ind <span class="kw">in</span> np.where(clf.feature_importances_ <span class="op">&gt;</span> <span class="dv">0</span>)[<span class="dv">0</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[ 0 41]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="106">
<pre><code>['v3', 'critical']</code></pre>
</div>
</div>
</section></section>
<section>
<section id="word-embeddings" class="title-slide slide level1 agenda-slide center" data-visibility="uncounted">
<h1>Word Embeddings</h1>
<div class="agenda-heading">
<p>Lecture Outline</p>
</div>
<div class="agenda">
<ul>
<li><div class="agenda-inactive agenda-pre-active">
<p>Natural Language Processing</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Car Crash Police Reports</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Text Vectorisation</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Bag Of Words</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Limiting The Vocabulary</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Intelligently Limit The Vocabulary</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Interrogate The Model</p>
</div></li>
<li><div class="agenda-active">
<p>Word Embeddings</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Word Embeddings II</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Car Crash NLP Part II</p>
</div></li>
</ul>
</div>
</section>
<section id="overview" class="slide level2">
<h2>Overview</h2>
<aside class="notes">
<p>In order for deep learning models to process language, we need to supply that language to the model in a way it can digest, i.e.&nbsp;a <strong>quantitative representation</strong> such as a 2-D matrix of numerical values.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="columns">
<div class="column" style="width:60%;">
<p>Popular methods for converting text into numbers include:</p>
<ul>
<li>One-hot encoding</li>
<li>Bag of words</li>
<li>TF-IDF</li>
<li>Word vectors (<em>transfer learning</em>)</li>
</ul>
</div><div class="column" style="width:40%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="xkcd-assigning_numbers_2x.png"></p>
<figcaption>Assigning Numbers</figcaption>
</figure>
</div>
</div>
</div>
<div class="footer">
<p>Source: Randall Munroe (2022), <a href="https://xkcd.com/2610/">xkcd #2610: Assigning Numbers</a>.</p>
</div>
</section>
<section id="word-vectors" class="slide level2">
<h2>Word Vectors</h2>
<ul>
<li>One-hot representations capture word ‘existence’ only, whereas word vectors capture information about word meaning as well as location.</li>
<li>This enables deep learning NLP models to automatically learn linguistic features.</li>
<li><strong>Word2Vec</strong> &amp; <strong>GloVe</strong> are popular algorithms for generating word embeddings (i.e.&nbsp;word vectors).</li>
</ul>
</section>
<section id="word-vectors-1" class="slide level2">
<h2>Word Vectors</h2>

<img data-src="krohn_f02_06.jpeg" class="r-stretch quarto-figure-center"><p class="caption">Illustrative word vectors.</p><aside class="notes">
<ul>
<li>Overarching concept is to assign each word within a corpus to a particular, meaningful location within a multidimensional space called the vector space.</li>
<li>Initially each word is assigned to a random location.</li>
<li>BUT by considering the words that tend to be used around a given word within the corpus, the locations of the words shift.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">
<p>Source: Krohn (2019), <em>Deep Learning Illustrated</em>, Figure 2-6.</p>
</div>
</section>
<section id="remember-this-diagram" class="slide level2">
<h2>Remember this diagram?</h2>

<img data-src="entity-embeddings.png" class="r-stretch quarto-figure-center"><p class="caption">Embeddings will gradually improve during training.</p><div class="footer">
<p>Source: Aurélien Géron (2019), <em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em>, 2nd Edition, Figure 13-4.</p>
</div>
</section>
<section id="word2vec" class="slide level2">
<h2>Word2Vec</h2>
<p><strong>Key idea</strong>: You’re known by the company you keep.</p>
<p>Two algorithms are used to calculate embeddings:</p>
<ul>
<li><em>Continuous bag of words</em>: uses the context words to predict the target word</li>
<li><em>Skip-gram</em>: uses the target word to predict the context words</li>
</ul>
<p>Predictions are made using a neural network with one hidden layer. Through backpropagation, we update a set of “weights” which become the word vectors.</p>
<div class="footer">
<p>Paper: Mikolov et al.&nbsp;(2013), <a href="https://arxiv.org/pdf/1301.3781.pdf"><em>Efficient estimation of word representations in vector space</em></a>, arXiv:1301.3781.</p>
</div>
</section>
<section id="word2vec-training-methods" class="slide level2">
<h2>Word2Vec training methods</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Chaudhary-nlp-ssl-center-word-prediction.gif"></p>
<figcaption>Continuous bag of words is a <em>center word prediction</em> task</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Chaudhary-nlp-ssl-neighbor-word-prediction.gif"></p>
<figcaption>Skip-gram is a <em>neighbour word prediction</em> task</figcaption>
</figure>
</div>
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Suggested viewing</strong></p>
</div>
<div class="callout-content">
<p>Computerphile (2019), <a href="https://youtu.be/gQddtTdmG_8">Vectoring Words (Word Embeddings)</a>, YouTube (16 mins).</p>
</div>
</div>
</div>
<div class="footer">
<p>Source: Amit Chaudhary (2020), <a href="https://amitness.com/2020/05/self-supervised-learning-nlp/">Self Supervised Representation Learning in NLP</a>.</p>
</div>
</section>
<section id="the-skip-gram-network" class="slide level2">
<h2>The skip-gram network</h2>

<img data-src="lilianweng-word2vec-skip-gram.png" class="r-stretch quarto-figure-center"><p class="caption">The skip-gram model. Both the input vector <span class="math inline">\boldsymbol{x}</span> and the output <span class="math inline">\boldsymbol{y}</span> are one-hot encoded word representations. The hidden layer is the word embedding of size <span class="math inline">N</span>.</p><div class="footer">
<p>Source: Lilian Weng (2017), <a href="https://lilianweng.github.io/posts/2017-10-15-word-embedding/">Learning Word Embedding</a>, Blog post, Figure 1.</p>
</div>
</section>
<section id="word-vector-arithmetic" class="slide level2">
<h2>Word Vector Arithmetic</h2>
<div class="columns">
<div class="column">
<p>Relationships between words becomes vector math.</p>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="vectors-Figure_03_02_09.jpeg"></p>
<figcaption>You remember vectors, right?</figcaption>
</figure>
</div>
<aside class="notes">
<ul>
<li>E.g., if we calculate the direction and distance between the coordinates of the words <em>Paris</em> and <em>France</em>, and trace this direction and distance from <em>London</em>, we should be close to the word <em>England</em>.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div><div class="column">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="krohn_f02_07.jpeg"></p>
<figcaption>Illustrative word vector arithmetic</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="krohn_f02_08.jpeg"></p>
<figcaption>Screenshot from <a href="https://lamyiowce.github.io/word2viz/">Word2viz</a></figcaption>
</figure>
</div>
</div>
</div>
<div class="footer">
<p>Sources: PressBooks, <a href="https://pressbooks.bccampus.ca/collegephysics/chapter/vector-addition-and-subtraction-graphical-methods/">College Physics: OpenStax</a>, Chapter 17 Figure 9, and Krohn (2019), <em>Deep Learning Illustrated</em>, Figures 2-7 &amp; 2-8.</p>
</div>
</section></section>
<section>
<section id="word-embeddings-ii" class="title-slide slide level1 agenda-slide center" data-visibility="uncounted">
<h1>Word Embeddings II</h1>
<div class="agenda-heading">
<p>Lecture Outline</p>
</div>
<div class="agenda">
<ul>
<li><div class="agenda-inactive agenda-pre-active">
<p>Natural Language Processing</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Car Crash Police Reports</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Text Vectorisation</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Bag Of Words</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Limiting The Vocabulary</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Intelligently Limit The Vocabulary</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Interrogate The Model</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Word Embeddings</p>
</div></li>
<li><div class="agenda-active">
<p>Word Embeddings II</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Car Crash NLP Part II</p>
</div></li>
</ul>
</div>
</section>
<section id="pretrained-word-embeddings" class="slide level2">
<h2>Pretrained word embeddings</h2>
<div id="9b90e765" class="cell" data-execution_count="114">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb177-1"><a></a><span class="op">!</span>pip install gensim</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Load word2vec embeddings trained on Google News:</p>
<div id="92192c01" class="cell" data-execution_count="115">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb178-1"><a></a><span class="im">import</span> gensim.downloader <span class="im">as</span> api</span>
<span id="cb178-2"><a></a>wv <span class="op">=</span> api.load(<span class="st">'word2vec-google-news-300'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When run for the first time, that downloads a huge file:</p>
<div id="762425f0" class="cell" data-execution_count="116">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb179-1"><a></a>gensim_dir <span class="op">=</span> Path(<span class="st">"~/gensim-data/"</span>).expanduser()</span>
<span id="cb179-2"><a></a>[<span class="bu">str</span>(p) <span class="cf">for</span> p <span class="kw">in</span> gensim_dir.iterdir()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="109">
<pre><code>['/home/plaub/gensim-data/information.json',
 '/home/plaub/gensim-data/word2vec-google-news-300']</code></pre>
</div>
</div>
<div id="87016879" class="cell" data-execution_count="117">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb181-1"><a></a><span class="bu">next</span>(gensim_dir.glob(<span class="st">"*/*.gz"</span>)).stat().st_size <span class="op">/</span> <span class="dv">1024</span><span class="op">**</span><span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="110">
<pre><code>1.6238203644752502</code></pre>
</div>
</div>
<div id="1f8b15d8" class="cell" data-execution_count="118">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb183-1"><a></a><span class="ss">f"The size of the vocabulary is </span><span class="sc">{</span><span class="bu">len</span>(wv)<span class="sc">}</span><span class="ss">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="111">
<pre><code>'The size of the vocabulary is 3000000'</code></pre>
</div>
</div>
</section>
<section id="treat-wv-like-a-dictionary" class="slide level2">
<h2>Treat <code>wv</code> like a dictionary</h2>
<div id="71a560c8" class="cell" data-execution_count="119">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb185-1"><a></a>wv[<span class="st">"pizza"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="112">
<pre><code>array([-1.26e-01,  2.54e-02,  1.67e-01,  5.51e-01, -7.67e-02,  1.29e-01,
        1.03e-01, -3.95e-04,  1.22e-01,  4.32e-02,  1.73e-01, -6.84e-02,
        3.42e-01,  8.40e-02,  6.69e-02,  2.68e-01, -3.71e-02, -5.57e-02,
        1.81e-01,  1.90e-02, -5.08e-02,  9.03e-03,  1.77e-01,  6.49e-02,
       -6.25e-02, -9.42e-02, -9.72e-02,  4.00e-01,  1.15e-01,  1.03e-01,
       -1.87e-02, -2.70e-01,  1.81e-01,  1.25e-01, -3.17e-02, -5.49e-02,
        3.46e-01, -1.57e-02,  1.82e-05,  2.07e-01, -1.26e-01, -2.83e-01,
        2.00e-01,  8.35e-02, -4.74e-02, -3.11e-02, -2.62e-01,  1.70e-01,
       -2.03e-02,  1.53e-01, -1.21e-01,  3.75e-01, -5.69e-02, -4.76e-03,
       -1.95e-01, -2.03e-01,  3.01e-01, -1.01e-01, -3.18e-01, -9.03e-02,
       -1.19e-01,  1.95e-01, -8.79e-02,  1.58e-01,  1.52e-02, -1.60e-01,
       -3.30e-01, -4.67e-01,  1.69e-01,  2.23e-02,  1.55e-01,  1.08e-01,
       -3.56e-02,  9.13e-02, -8.69e-02, -1.20e-01, -3.09e-01, -2.61e-02,
       -7.23e-02, -4.80e-01,  3.78e-02, -1.36e-01, -1.03e-01, -2.91e-01,
       -1.93e-01, -4.22e-01, -1.06e-01,  3.55e-01,  1.67e-01, -3.63e-03,
       -7.42e-02, -3.22e-01, -7.52e-02, -8.25e-02, -2.91e-01, -1.26e-01,
        1.68e-02,  5.00e-02,  1.28e-01, -7.42e-02, -1.31e-01, -2.46e-01,
        6.49e-02,  1.53e-01,  2.60e-01, -1.05e-01,  3.57e-01, -4.30e-02,
       -1.58e-01,  8.20e-02, -5.98e-02, -2.34e-01, -3.22e-01, -1.26e-01,
        5.40e-02, -1.88e-01,  1.36e-01, -6.59e-02,  8.36e-03, -1.85e-01,
       -2.97e-01, -1.85e-01, -4.74e-02, -1.06e-01, -6.93e-02,  3.83e-02,
       -3.20e-02,  3.64e-02, -1.20e-01,  1.77e-01, -1.16e-01,  1.99e-02,
        8.64e-02,  6.08e-02, -1.41e-01,  3.30e-01,  1.94e-01, -1.56e-01,
        3.93e-01,  1.81e-03,  7.28e-02, -2.54e-01, -3.54e-02,  2.87e-03,
       -1.73e-01,  9.77e-03, -1.56e-02,  3.23e-03, -1.70e-01,  1.55e-01,
        7.18e-02,  4.10e-01, -2.11e-01,  1.32e-01,  7.63e-03,  4.79e-02,
       -4.54e-02,  7.32e-02, -4.06e-01, -2.06e-02, -4.04e-01, -1.01e-01,
       -2.03e-01,  1.55e-01, -1.89e-01,  6.59e-02,  6.54e-02, -2.05e-01,
        5.47e-02, -3.06e-02, -1.54e-01, -2.62e-01,  3.81e-03, -8.20e-02,
       -3.20e-01,  2.84e-02,  2.70e-01,  1.74e-01, -1.67e-01,  2.23e-01,
        6.35e-02, -1.96e-01,  1.46e-01, -1.56e-02,  2.60e-02, -6.30e-02,
        2.94e-02,  3.28e-01, -4.69e-02, -1.52e-01,  6.98e-02,  3.18e-01,
       -1.08e-01,  3.66e-02, -1.99e-01,  1.64e-03,  6.41e-03, -1.47e-01,
       -6.25e-02, -4.36e-03, -2.75e-01,  8.54e-02, -5.00e-02, -3.12e-01,
       -1.34e-01, -1.99e-01,  5.18e-02, -9.28e-02, -2.40e-01, -7.86e-02,
       -1.54e-01, -6.64e-02, -1.97e-01,  1.77e-01, -1.57e-01, -1.63e-01,
        6.01e-02, -5.86e-02, -2.23e-01, -6.59e-02, -9.38e-02, -4.14e-01,
        2.56e-01, -1.77e-01,  2.52e-01,  1.48e-01, -1.04e-01, -8.61e-03,
       -1.23e-01, -9.23e-02,  4.42e-02, -1.71e-01, -1.98e-01,  1.92e-01,
        2.85e-01, -4.35e-02,  1.08e-01, -5.37e-02, -2.10e-02,  1.46e-01,
        3.83e-01,  2.32e-02, -8.84e-02,  7.32e-02, -1.01e-01, -1.06e-01,
        4.12e-01,  2.11e-01,  2.79e-01, -2.09e-02,  2.07e-01,  9.81e-02,
        2.39e-01,  7.67e-02,  2.02e-01, -6.08e-02, -2.64e-03, -1.84e-01,
       -1.57e-02, -3.20e-01,  9.03e-02,  1.02e-01, -4.96e-01, -9.72e-02,
       -8.11e-02, -1.81e-01, -1.46e-01,  8.64e-02, -2.04e-01, -2.02e-01,
       -5.47e-02,  2.54e-01,  2.09e-02, -1.16e-01,  2.02e-01, -8.06e-02,
       -1.05e-01, -7.96e-02,  1.97e-02, -2.49e-01,  1.31e-01,  2.89e-01,
       -2.26e-01,  4.55e-01, -2.73e-01, -2.58e-01, -3.15e-02,  4.04e-01,
       -2.68e-01,  2.89e-01, -1.84e-01, -1.48e-01, -1.07e-01,  1.28e-01,
        5.47e-01, -8.69e-02, -1.48e-02,  6.98e-02, -8.50e-02, -1.55e-01],
      dtype=float32)</code></pre>
</div>
</div>
<div id="994b58c4" class="cell" data-execution_count="120">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb187-1"><a></a><span class="bu">len</span>(wv[<span class="st">"pizza"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="113">
<pre><code>300</code></pre>
</div>
</div>
</section>
<section id="find-nearby-word-vectors" class="slide level2">
<h2>Find nearby word vectors</h2>
<div id="a7840d1c" class="cell" data-execution_count="121">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb189-1"><a></a>wv.most_similar(<span class="st">"Python"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="114">
<pre><code>[('Jython', 0.6152505874633789),
 ('Perl_Python', 0.5710949897766113),
 ('IronPython', 0.5704679489135742),
 ('scripting_languages', 0.5695090889930725),
 ('PHP_Perl', 0.5687724947929382),
 ('Java_Python', 0.5681070685386658),
 ('PHP', 0.5660915970802307),
 ('Python_Ruby', 0.5632461905479431),
 ('Visual_Basic', 0.5603480339050293),
 ('Perl', 0.5530891418457031)]</code></pre>
</div>
</div>
<div id="d0b20621" class="cell" data-execution_count="122">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb191-1"><a></a>wv.similarity(<span class="st">"Python"</span>, <span class="st">"Java"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="115">
<pre><code>0.46189708</code></pre>
</div>
</div>
<div id="7e974297" class="cell" data-execution_count="123">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb193-1"><a></a>wv.similarity(<span class="st">"Python"</span>, <span class="st">"sport"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="116">
<pre><code>0.08406468</code></pre>
</div>
</div>
<div id="1981baba" class="cell" data-execution_count="124">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb195-1"><a></a>wv.similarity(<span class="st">"Python"</span>, <span class="st">"R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="117">
<pre><code>0.066954285</code></pre>
</div>
</div>
<div class="footer">
<p>Fun fact: Gensim’s <code>most_similar</code> uses Spotify’s <code>annoy</code> library (“Approximate Nearest Neighbors Oh Yeah”)</p>
</div>
</section>
<section id="what-does-similarity-mean" class="slide level2">
<h2>What does ‘similarity’ mean?</h2>
<p>The ‘similarity’ scores</p>
<div id="260ff6ac" class="cell" data-execution_count="125">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb197-1"><a></a>wv.similarity(<span class="st">"Sydney"</span>, <span class="st">"Melbourne"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="118">
<pre><code>0.8613987</code></pre>
</div>
</div>
<p>are normally based on cosine distance.</p>
<div id="b52ede63" class="cell" data-execution_count="126">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb199-1"><a></a>x <span class="op">=</span> wv[<span class="st">"Sydney"</span>]</span>
<span id="cb199-2"><a></a>y <span class="op">=</span> wv[<span class="st">"Melbourne"</span>]</span>
<span id="cb199-3"><a></a>x.dot(y) <span class="op">/</span> (np.linalg.norm(x) <span class="op">*</span> np.linalg.norm(y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="119">
<pre><code>0.86139864</code></pre>
</div>
</div>
<div id="d7400e32" class="cell" data-execution_count="127">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb201-1"><a></a>wv.similarity(<span class="st">"Sydney"</span>, <span class="st">"Aarhus"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="120">
<pre><code>0.19079602</code></pre>
</div>
</div>
</section>
<section id="wengs-got-word2vec" class="slide level2">
<h2>Weng’s GoT Word2Vec</h2>
<p>In the GoT word embedding space, the top similar words to “king” and “queen” are:</p>
<div class="columns">
<div class="column">
<div class="sourceCode" id="cb203"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb203-1"><a></a>model.most_similar(<span class="st">"king"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>('kings', 0.897245) 
('baratheon', 0.809675) 
('son', 0.763614)
('robert', 0.708522)
('lords', 0.698684)
('joffrey', 0.696455)
('prince', 0.695699)
('brother', 0.685239)
('aerys', 0.684527)
('stannis', 0.682932)</code></pre>
</div><div class="column">
<div class="sourceCode" id="cb205"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb205-1"><a></a>model.most_similar(<span class="st">"queen"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>('cersei', 0.942618)
('joffrey', 0.933756)
('margaery', 0.931099)
('sister', 0.928902)
('prince', 0.927364)
('uncle', 0.922507)
('varys', 0.918421)
('ned', 0.917492)
('melisandre', 0.915403)
('robb', 0.915272)</code></pre>
</div>
</div>
<div class="footer">
<p>Source: Lilian Weng (2017), <a href="https://lilianweng.github.io/posts/2017-10-15-word-embedding/">Learning Word Embedding</a>, Blog post.</p>
</div>
</section>
<section id="combining-word-vectors" class="slide level2">
<h2>Combining word vectors</h2>
<p>You can summarise a sentence by averaging the individual word vectors.</p>
<div id="8787c9a1" class="cell" data-execution_count="128">
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb207-1"><a></a>sv <span class="op">=</span> (wv[<span class="st">"Melbourne"</span>] <span class="op">+</span> wv[<span class="st">"has"</span>] <span class="op">+</span> wv[<span class="st">"better"</span>] <span class="op">+</span> wv[<span class="st">"coffee"</span>]) <span class="op">/</span> <span class="dv">4</span></span>
<span id="cb207-2"><a></a><span class="bu">len</span>(sv), sv[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="121">
<pre><code>(300, array([-0.08, -0.11, -0.16,  0.24,  0.06], dtype=float32))</code></pre>
</div>
</div>
<blockquote>
<p>As it turns out, averaging word embeddings is a surprisingly effective way to create word embeddings. It’s not perfect (as you’ll see), but it does a strong job of capturing what you might perceive to be complex relationships between words.</p>
</blockquote>
<div class="footer">
<p>Source: Trask (2019), Grokking Deep Learning, Chapter 12.</p>
</div>
</section>
<section id="recipe-recommender" class="slide level2">
<h2>Recipe recommender</h2>
<div class="columns">
<div class="column" style="width:49%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="duarte-o-carmo-recipe-space-1.png"></p>
<figcaption>Recipes are the average of the word vectors of the ingredients.</figcaption>
</figure>
</div>
</div><div class="column" style="width:51%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="duarte-o-carmo-recipe-space-2.png"></p>
<figcaption>Nearest neighbours used to classify new recipes as potentially delicious.</figcaption>
</figure>
</div>
</div>
</div>
<div class="footer">
<p>Source: Duarte O.Carmo (2022), <a href="https://duarteocarmo.com/blog/scandinavia-food-python-recommendation-systems">A recipe recommendation system</a>, Blog post.</p>
</div>
</section>
<section id="analogies-with-word-vectors" class="slide level2">
<h2>Analogies with word vectors</h2>
<p>Obama is to America as ___ is to Australia.</p>
<div class="fragment">
<p><span class="math display"> \text{Obama} - \text{America} + \text{Australia} = ? </span></p>
</div>
<div class="fragment">
<div id="d1e35d9f" class="cell" data-execution_count="129">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb209-1"><a></a>wv.most_similar(positive<span class="op">=</span>[<span class="st">"Obama"</span>, <span class="st">"Australia"</span>], negative<span class="op">=</span>[<span class="st">"America"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="122">
<pre><code>[('Mr_Rudd', 0.6151423454284668),
 ('Prime_Minister_Julia_Gillard', 0.6045385003089905),
 ('Prime_Minister_Kevin_Rudd', 0.5982581973075867),
 ('Kevin_Rudd', 0.5627648830413818),
 ('Ms_Gillard', 0.5517690777778625),
 ('Opposition_Leader_Kevin_Rudd', 0.5298037528991699),
 ('Mr_Beazley', 0.5259249210357666),
 ('Gillard', 0.5250653624534607),
 ('NARDA_GILMORE', 0.5203536748886108),
 ('Mr_Downer', 0.5150347948074341)]</code></pre>
</div>
</div>
</div>
</section>
<section id="testing-more-associations" class="slide level2">
<h2>Testing more associations</h2>
<div id="a35cc797" class="cell" data-execution_count="130">
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb211-1"><a></a>wv.most_similar(positive<span class="op">=</span>[<span class="st">"France"</span>, <span class="st">"London"</span>], negative<span class="op">=</span>[<span class="st">"Paris"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="123">
<pre><code>[('Britain', 0.7368935346603394),
 ('UK', 0.6637030839920044),
 ('England', 0.6119861602783203),
 ('United_Kingdom', 0.6067784428596497),
 ('Great_Britain', 0.5870823860168457),
 ('Britian', 0.5852951407432556),
 ('Scotland', 0.5410018563270569),
 ('British', 0.5318332314491272),
 ('Europe', 0.5307435989379883),
 ('East_Midlands', 0.5230222344398499)]</code></pre>
</div>
</div>
</section>
<section id="quickly-get-to-bad-associations" class="slide level2">
<h2>Quickly get to bad associations</h2>
<div id="da21eacc" class="cell" data-execution_count="131">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb213-1"><a></a>wv.most_similar(positive<span class="op">=</span>[<span class="st">"King"</span>, <span class="st">"woman"</span>], negative<span class="op">=</span>[<span class="st">"man"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="124">
<pre><code>[('Queen', 0.5515626668930054),
 ('Oprah_BFF_Gayle', 0.47597548365592957),
 ('Geoffrey_Rush_Exit', 0.46460166573524475),
 ('Princess', 0.4533674716949463),
 ('Yvonne_Stickney', 0.4507041573524475),
 ('L._Bonauto', 0.4422135353088379),
 ('gal_pal_Gayle', 0.4408389925956726),
 ('Alveda_C.', 0.4402790665626526),
 ('Tupou_V.', 0.4373864233493805),
 ('K._Letourneau', 0.4351031482219696)]</code></pre>
</div>
</div>
<div id="924c4a67" class="cell" data-execution_count="132">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb215-1"><a></a>wv.most_similar(positive<span class="op">=</span>[<span class="st">"computer_programmer"</span>, <span class="st">"woman"</span>], negative<span class="op">=</span>[<span class="st">"man"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="125">
<pre><code>[('homemaker', 0.5627118945121765),
 ('housewife', 0.5105047225952148),
 ('graphic_designer', 0.505180299282074),
 ('schoolteacher', 0.497949481010437),
 ('businesswoman', 0.493489146232605),
 ('paralegal', 0.49255111813545227),
 ('registered_nurse', 0.4907974898815155),
 ('saleswoman', 0.4881627559661865),
 ('electrical_engineer', 0.4797725975513458),
 ('mechanical_engineer', 0.4755399227142334)]</code></pre>
</div>
</div>
</section>
<section id="bias-in-nlp-models" class="slide level2 smaller">
<h2>Bias in NLP models</h2>
<div class="columns">
<div class="column">
<p><img data-src="the-verge-banner-microsoft-tay.jpeg"></p>
<p>The Verge (2016), <a href="https://www.theverge.com/2016/3/24/11297050/tay-microsoft-chatbot-racist">Twitter taught Microsoft’s AI chatbot to be a racist a****** in less than a day</a>.</p>
</div><div class="column">
<blockquote>
<p>… there are serious questions to answer, like how are we going to teach AI using public data without incorporating the worst traits of humanity? If we create bots that mirror their users, do we care if their users are human trash? There are plenty of examples of technology embodying — either accidentally or on purpose — the prejudices of society, and Tay’s adventures on Twitter show that even big corporations like Microsoft forget to take any preventative measures against these problems.</p>
</blockquote>
</div>
</div>
</section>
<section id="the-library-cheats-a-little-bit" class="slide level2">
<h2>The library cheats a little bit</h2>
<div id="13339dcd" class="cell" data-execution_count="133">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb217-1"><a></a>wv.similar_by_vector(wv[<span class="st">"computer_programmer"</span>] <span class="op">-</span> wv[<span class="st">"man"</span>] <span class="op">+</span> wv[<span class="st">"woman"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="126">
<pre><code>[('computer_programmer', 0.910581111907959),
 ('homemaker', 0.5771316289901733),
 ('schoolteacher', 0.5500192046165466),
 ('graphic_designer', 0.5464698672294617),
 ('mechanical_engineer', 0.539836585521698),
 ('electrical_engineer', 0.5337055325508118),
 ('housewife', 0.5274525284767151),
 ('programmer', 0.5096209049224854),
 ('businesswoman', 0.5029540657997131),
 ('keypunch_operator', 0.4974639415740967)]</code></pre>
</div>
</div>
<p>To get the ‘nice’ analogies, the <code>.most_similar</code> ignores the input words as possible answers.</p>
<div id="e722cd39" class="cell" data-execution_count="134">
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb219-1"><a></a><span class="co"># ignore (don't return) keys from the input</span></span>
<span id="cb219-2"><a></a>result <span class="op">=</span> [</span>
<span id="cb219-3"><a></a>    (<span class="va">self</span>.index_to_key[sim <span class="op">+</span> clip_start], <span class="bu">float</span>(dists[sim]))</span>
<span id="cb219-4"><a></a>    <span class="cf">for</span> sim <span class="kw">in</span> best <span class="cf">if</span> (sim <span class="op">+</span> clip_start) <span class="kw">not</span> <span class="kw">in</span> all_keys</span>
<span id="cb219-5"><a></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">
<p>Source: gensim, <a href="https://github.com/RaRe-Technologies/gensim/blob/eeb7e8662d5350efe68fa14db08b02d273735af9/gensim/models/keyedvectors.py#L853">gensim/models/keyedvectors.py</a>, lines 853-857.</p>
</div>
</section></section>
<section>
<section id="car-crash-nlp-part-ii" class="title-slide slide level1 agenda-slide center" data-visibility="uncounted">
<h1>Car Crash NLP Part II</h1>
<div class="agenda-heading">
<p>Lecture Outline</p>
</div>
<div class="agenda">
<ul>
<li><div class="agenda-inactive agenda-pre-active">
<p>Natural Language Processing</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Car Crash Police Reports</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Text Vectorisation</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Bag Of Words</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Limiting The Vocabulary</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Intelligently Limit The Vocabulary</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Interrogate The Model</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Word Embeddings</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Word Embeddings II</p>
</div></li>
<li><div class="agenda-active">
<p>Car Crash NLP Part II</p>
</div></li>
</ul>
</div>
<div class="footer">
<p>Dataset source: <a href="https://github.com/JSchelldorfer/ActuarialDataScience/blob/master/12%20-%20NLP%20Using%20Transformers/Actuarial_Applications_of_NLP_Part_1.ipynb">Dr Jürg Schelldorfer’s GitHub</a>.</p>
</div>
</section>
<section id="predict-injury-severity" class="slide level2">
<h2>Predict injury severity</h2>
<div id="69c19fa4" class="cell" data-execution_count="135">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb220-1"><a></a>features <span class="op">=</span> df[<span class="st">"SUMMARY_EN"</span>]</span>
<span id="cb220-2"><a></a>target <span class="op">=</span> LabelEncoder().fit_transform(df[<span class="st">"INJSEVB"</span>])</span>
<span id="cb220-3"><a></a></span>
<span id="cb220-4"><a></a>X_main, X_test, y_main, y_test <span class="op">=</span> <span class="op">\</span></span>
<span id="cb220-5"><a></a>    train_test_split(features, target, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb220-6"><a></a>X_train, X_val, y_train, y_val <span class="op">=</span> <span class="op">\</span></span>
<span id="cb220-7"><a></a>    train_test_split(X_main, y_main, test_size<span class="op">=</span><span class="fl">0.25</span>, random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb220-8"><a></a>X_train.shape, X_val.shape, X_test.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="127">
<pre><code>((4169,), (1390,), (1390,))</code></pre>
</div>
</div>
</section>
<section id="using-keras-textvectorization" class="slide level2">
<h2>Using Keras <code>TextVectorization</code></h2>
<div id="3df49d35" class="cell" data-execution_count="136">
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb222-1"><a></a>max_tokens <span class="op">=</span> <span class="dv">1_000</span></span>
<span id="cb222-2"><a></a>vect <span class="op">=</span> layers.TextVectorization(</span>
<span id="cb222-3"><a></a>    max_tokens<span class="op">=</span>max_tokens,</span>
<span id="cb222-4"><a></a>    output_mode<span class="op">=</span><span class="st">"tf_idf"</span>,</span>
<span id="cb222-5"><a></a>    standardize<span class="op">=</span><span class="st">"lower_and_strip_punctuation"</span>,</span>
<span id="cb222-6"><a></a>)</span>
<span id="cb222-7"><a></a></span>
<span id="cb222-8"><a></a>vect.adapt(X_train)</span>
<span id="cb222-9"><a></a>vocab <span class="op">=</span> vect.get_vocabulary()</span>
<span id="cb222-10"><a></a></span>
<span id="cb222-11"><a></a>X_train_txt <span class="op">=</span> vect(X_train)</span>
<span id="cb222-12"><a></a>X_val_txt <span class="op">=</span> vect(X_val)</span>
<span id="cb222-13"><a></a>X_test_txt <span class="op">=</span> vect(X_test)</span>
<span id="cb222-14"><a></a></span>
<span id="cb222-15"><a></a><span class="bu">print</span>(vocab[:<span class="dv">50</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['[UNK]', 'the', 'was', 'a', 'to', 'of', 'and', 'in', 'driver', 'for', 'this', 'vehicle', 'critical', 'lane', 'he', 'on', 'with', 'that', 'left', 'roadway', 'coded', 'she', 'event', 'crash', 'not', 'at', 'intersection', 'traveling', 'right', 'precrash', 'as', 'from', 'were', 'by', 'had', 'reason', 'his', 'side', 'is', 'front', 'her', 'traffic', 'an', 'it', 'two', 'speed', 'stated', 'one', 'occurred', 'no']</code></pre>
</div>
</div>
</section>
<section id="the-tf-idf-vectors" class="slide level2">
<h2>The TF-IDF vectors</h2>
<div id="6ade13d7" class="cell" data-execution_count="137">
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb224-1"><a></a>pd.DataFrame(X_train_txt, columns<span class="op">=</span>vocab, index<span class="op">=</span>X_train.index)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="129">
<div>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">[UNK]</th>
<th data-quarto-table-cell-role="th">the</th>
<th data-quarto-table-cell-role="th">was</th>
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">to</th>
<th data-quarto-table-cell-role="th">of</th>
<th data-quarto-table-cell-role="th">and</th>
<th data-quarto-table-cell-role="th">in</th>
<th data-quarto-table-cell-role="th">driver</th>
<th data-quarto-table-cell-role="th">for</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">encroaching</th>
<th data-quarto-table-cell-role="th">closely</th>
<th data-quarto-table-cell-role="th">ordinarily</th>
<th data-quarto-table-cell-role="th">locked</th>
<th data-quarto-table-cell-role="th">history</th>
<th data-quarto-table-cell-role="th">fourleg</th>
<th data-quarto-table-cell-role="th">determined</th>
<th data-quarto-table-cell-role="th">box</th>
<th data-quarto-table-cell-role="th">altima</th>
<th data-quarto-table-cell-role="th">above</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2532</td>
<td>121.857979</td>
<td>42.274662</td>
<td>10.395409</td>
<td>10.395409</td>
<td>11.785541</td>
<td>8.323526</td>
<td>8.323526</td>
<td>9.775118</td>
<td>3.489896</td>
<td>4.168983</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.00000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6209</td>
<td>72.596237</td>
<td>17.325682</td>
<td>10.395409</td>
<td>5.544218</td>
<td>4.159603</td>
<td>5.549018</td>
<td>7.629900</td>
<td>4.887559</td>
<td>4.187876</td>
<td>6.253474</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.00000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2561</td>
<td>124.450699</td>
<td>30.493198</td>
<td>15.246599</td>
<td>11.088436</td>
<td>9.012472</td>
<td>7.629900</td>
<td>8.323526</td>
<td>2.792891</td>
<td>3.489896</td>
<td>5.558644</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.00000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6882</td>
<td>75.188965</td>
<td>20.790817</td>
<td>4.851191</td>
<td>7.623300</td>
<td>9.012472</td>
<td>4.855391</td>
<td>4.161763</td>
<td>2.094668</td>
<td>5.583834</td>
<td>2.084491</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>3.61771</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">206</td>
<td>147.785202</td>
<td>27.028063</td>
<td>13.167518</td>
<td>6.237246</td>
<td>8.319205</td>
<td>4.855391</td>
<td>6.242645</td>
<td>2.094668</td>
<td>3.489896</td>
<td>9.032796</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.00000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6356</td>
<td>75.188965</td>
<td>15.246599</td>
<td>9.702381</td>
<td>8.316327</td>
<td>7.625938</td>
<td>5.549018</td>
<td>7.629900</td>
<td>8.378673</td>
<td>2.791917</td>
<td>5.558644</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.00000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>4169 rows × 1000 columns</p>
</div>
</div>
</div>
</div>
</section>
<section id="feed-tf-idf-into-an-ann" class="slide level2">
<h2>Feed TF-IDF into an ANN</h2>
<div id="c21091cc" class="cell" data-execution_count="138">
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb225-1"><a></a>random.seed(<span class="dv">42</span>)</span>
<span id="cb225-2"><a></a>tfidf_model <span class="op">=</span> keras.models.Sequential([</span>
<span id="cb225-3"><a></a>    layers.Input((X_train_txt.shape[<span class="dv">1</span>],)),</span>
<span id="cb225-4"><a></a>    layers.Dense(<span class="dv">250</span>, <span class="st">"relu"</span>),</span>
<span id="cb225-5"><a></a>    layers.Dense(<span class="dv">1</span>, <span class="st">"sigmoid"</span>)</span>
<span id="cb225-6"><a></a>])</span>
<span id="cb225-7"><a></a></span>
<span id="cb225-8"><a></a>tfidf_model.compile(<span class="st">"adam"</span>, <span class="st">"binary_crossentropy"</span>, metrics<span class="op">=</span>[<span class="st">"accuracy"</span>])</span>
<span id="cb225-9"><a></a>tfidf_model.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Model: "sequential_4"</span>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> Layer (type)                    </span>┃<span style="font-weight: bold"> Output Shape           </span>┃<span style="font-weight: bold">       Param # </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ dense_8 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                 │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">250</span>)            │       <span style="color: #00af00; text-decoration-color: #00af00">250,250</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense_9 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                 │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">1</span>)              │           <span style="color: #00af00; text-decoration-color: #00af00">251</span> │
└─────────────────────────────────┴────────────────────────┴───────────────┘
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Total params: </span><span style="color: #00af00; text-decoration-color: #00af00">250,501</span> (978.52 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">250,501</span> (978.52 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Non-trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">0</span> (0.00 B)
</pre>
</div>
</div>
</section>
<section id="fit-evaluate" class="slide level2">
<h2>Fit &amp; evaluate</h2>
<div id="b2717f5d" class="cell" data-execution_count="139">
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb226-1"><a></a>es <span class="op">=</span> keras.callbacks.EarlyStopping(patience<span class="op">=</span><span class="dv">10</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb226-2"><a></a>    monitor<span class="op">=</span><span class="st">"val_accuracy"</span>, verbose<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb226-3"><a></a></span>
<span id="cb226-4"><a></a><span class="cf">if</span> <span class="kw">not</span> Path(<span class="st">"tfidf-model.keras"</span>).exists():</span>
<span id="cb226-5"><a></a>    tfidf_model.fit(X_train_txt, y_train, epochs<span class="op">=</span><span class="dv">1_000</span>, callbacks<span class="op">=</span>es,</span>
<span id="cb226-6"><a></a>        validation_data<span class="op">=</span>(X_val_txt, y_val), verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb226-7"><a></a>    tfidf_model.save(<span class="st">"tfidf-model.keras"</span>)</span>
<span id="cb226-8"><a></a><span class="cf">else</span>:</span>
<span id="cb226-9"><a></a>    tfidf_model <span class="op">=</span> keras.models.load_model(<span class="st">"tfidf-model.keras"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="62b5561c" class="cell" data-execution_count="140">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb227-1"><a></a>tfidf_model.evaluate(X_train_txt, y_train, verbose<span class="op">=</span><span class="dv">0</span>, batch_size<span class="op">=</span><span class="dv">1_000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="132">
<pre><code>[0.11705566942691803, 0.9575437903404236]</code></pre>
</div>
</div>
<div id="82bada21" class="cell" data-execution_count="141">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb229-1"><a></a>tfidf_model.evaluate(X_val_txt, y_val, verbose<span class="op">=</span><span class="dv">0</span>, batch_size<span class="op">=</span><span class="dv">1_000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="133">
<pre><code>[0.3212660849094391, 0.8848921060562134]</code></pre>
</div>
</div>
</section>
<section id="keep-text-as-sequence-of-tokens" class="slide level2">
<h2>Keep text as sequence of tokens</h2>
<div id="a0b61ce8" class="cell" data-execution_count="142">
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb231-1"><a></a>max_length <span class="op">=</span> <span class="dv">500</span></span>
<span id="cb231-2"><a></a>max_tokens <span class="op">=</span> <span class="dv">1_000</span></span>
<span id="cb231-3"><a></a>vect <span class="op">=</span> layers.TextVectorization(</span>
<span id="cb231-4"><a></a>    max_tokens<span class="op">=</span>max_tokens,</span>
<span id="cb231-5"><a></a>    output_sequence_length<span class="op">=</span>max_length,</span>
<span id="cb231-6"><a></a>    standardize<span class="op">=</span><span class="st">"lower_and_strip_punctuation"</span>,</span>
<span id="cb231-7"><a></a>)</span>
<span id="cb231-8"><a></a></span>
<span id="cb231-9"><a></a>vect.adapt(X_train)</span>
<span id="cb231-10"><a></a>vocab <span class="op">=</span> vect.get_vocabulary()</span>
<span id="cb231-11"><a></a></span>
<span id="cb231-12"><a></a>X_train_txt <span class="op">=</span> vect(X_train)</span>
<span id="cb231-13"><a></a>X_val_txt <span class="op">=</span> vect(X_val)</span>
<span id="cb231-14"><a></a>X_test_txt <span class="op">=</span> vect(X_test)</span>
<span id="cb231-15"><a></a></span>
<span id="cb231-16"><a></a><span class="bu">print</span>(vocab[:<span class="dv">50</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['', '[UNK]', 'the', 'was', 'a', 'to', 'of', 'and', 'in', 'driver', 'for', 'this', 'vehicle', 'critical', 'lane', 'he', 'on', 'with', 'that', 'left', 'roadway', 'coded', 'she', 'event', 'crash', 'not', 'at', 'intersection', 'traveling', 'right', 'precrash', 'as', 'from', 'were', 'by', 'had', 'reason', 'his', 'side', 'is', 'front', 'her', 'traffic', 'an', 'it', 'two', 'speed', 'stated', 'one', 'occurred']</code></pre>
</div>
</div>
</section>
<section id="a-sequence-of-integers" class="slide level2">
<h2>A sequence of integers</h2>
<div id="865377ca" class="cell" data-execution_count="143">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb233-1"><a></a>X_train_txt[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="135">
<pre><code>&lt;tf.Tensor: shape=(500,), dtype=int64, numpy=
array([ 11,  24,  49,   8,   2, 253, 219,   6,   4, 165,   8,   2, 410,
         6,   4, 564, 971,  27,   2,  27, 568,   6,   4, 192,   1,  45,
        51, 208,  65, 235,  54,  14,  20, 867,  34,  43, 183,   1,  45,
        51, 208,  65, 235,  54,  14,  20, 178,  34,   4, 676,   1,  42,
       237,   2, 153, 192,  20,   3, 107,   7,  75,  17,   4, 612, 441,
       549,   2,  88,  46,   3, 207,  63, 185,  55,   2,  42, 243,   3,
       400,   7,  58,  33,  50, 172, 251,  84,  26,   2,  60,   6,   2,
        24,   1,   4, 402, 970,   1,   1,   3,  68,  26,   2,  27,  94,
       118,   8,  14, 101, 311,  10,   2, 237,   5, 422, 269,  44, 154,
        54,  19,   1,   4, 308, 342,   1,   3,  79,   8,  14,  45, 159,
         2, 121,  27, 190,  44, 598,   5, 325,  75,  70,   2, 105, 189,
       231,   1, 241,  81,  19,  31,   1, 193,   2,  54,  81,   9, 134,
         4, 174,  12,  17,   1, 390,   1, 159,   2,  27,  32,   2, 119,
         1,  68,   8,   2, 410,   6,   2,  27,   8,   1,   5,   2, 159,
       174,  12,   1, 168,   2,  27,   7,  69,   2,  40,   6,   1,  17,
        81,  40,  19, 246,  73,  83,  64,   5, 129,  56,   8,   2,  27,
         7,  33,  73,  71,  57,   5,  82,   2,   9,   6,   1,   4,   1,
        59, 382,   5, 113,   8, 276, 258,   1, 317, 928, 284,  10, 784,
       294, 462, 483,   7,   1,  15,   3,  16,  37, 112,   5, 677, 144,
         1,  26,   2,  60,   6,   2,  24,  15,  47,  18,  70,   2, 105,
       429,  15,  35, 448,   1,   5, 493,  37,  54,  62,  68,  25,   1,
        33,   5, 325,  70,  15, 134,   2, 174, 232, 406,  15, 341, 134,
         1, 691,   2,  27,   7,  15,   1,  10,  93,  15,   3,  25, 216,
         8,   2,  24,   2,  13,  30,  23,  10,   1,   3,  21,  11,  12,
        28,  76,   2,  14, 130,  19,  38,   6, 106,  14,   2,  13,  36,
         3,  21,  31,   4,   9,  91, 180,   1, 137,   1,   2,  87,  97,
        21,   5,   1, 285,  43,   1, 511, 569,  15, 775, 140,   1,   2,
        27,   7,  25,  68,  31, 184,  31,   2, 159, 174,  12,   1,   2,
        42,   1,   2,   9,   6,   1,   4,   1,  59,   8, 276, 258,   3,
       489,  37, 753, 544,  10,   4, 975, 313,  26,   2,  60,   6,   2,
        24,  15,   3,  16,  37, 112, 110,  32, 151,  70,   2,  24,  49,
        15,  47,  15,   3,  79,   8,  14, 191,  31,   2,  42, 105, 189,
       231,  15, 647,   2,  12,   8,   2,  19,  94, 118,  35,   1,   5,
        54,  19,   7, 141,   2,  27,  15,   1,  31,   2,  12, 347,  81,
        54,   7,  90,   8,   2, 410,   6,   2,  27,  15, 503,  62, 154,
        25, 143,   1,  15, 157, 134,   2, 174,  12,  17,  81, 390,   7,
         1,  16, 111,  15, 168,   2,  27,  15, 588, 329, 117,   7,   3,
       163,   5, 113, 947, 175,  26,   4, 643,   1,   2,  13,  30,  23,
        10,   1,   3,  21,  52,  12])&gt;</code></pre>
</div>
</div>
</section>
<section id="feed-lstm-a-sequence-of-one-hots" class="slide level2">
<h2>Feed LSTM a sequence of one-hots</h2>
<div id="5a1b56fc" class="cell" data-execution_count="144">
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb235-1"><a></a><span class="im">from</span> keras.layers <span class="im">import</span> CategoryEncoding, Bidirectional, LSTM</span>
<span id="cb235-2"><a></a>random.seed(<span class="dv">42</span>)</span>
<span id="cb235-3"><a></a>one_hot_model <span class="op">=</span> Sequential([Input(shape<span class="op">=</span>(max_length,), dtype<span class="op">=</span><span class="st">"int64"</span>),</span>
<span id="cb235-4"><a></a>    CategoryEncoding(num_tokens<span class="op">=</span>max_tokens, output_mode<span class="op">=</span><span class="st">"one_hot"</span>),</span>
<span id="cb235-5"><a></a>    Bidirectional(LSTM(<span class="dv">24</span>)),</span>
<span id="cb235-6"><a></a>    Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"sigmoid"</span>)])</span>
<span id="cb235-7"><a></a>one_hot_model.compile(optimizer<span class="op">=</span><span class="st">"adam"</span>,</span>
<span id="cb235-8"><a></a>    loss<span class="op">=</span><span class="st">"binary_crossentropy"</span>, metrics<span class="op">=</span>[<span class="st">"accuracy"</span>])</span>
<span id="cb235-9"><a></a>one_hot_model.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Model: "sequential_5"</span>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> Layer (type)                    </span>┃<span style="font-weight: bold"> Output Shape           </span>┃<span style="font-weight: bold">       Param # </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ category_encoding               │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">500</span>, <span style="color: #00af00; text-decoration-color: #00af00">1000</span>)      │             <span style="color: #00af00; text-decoration-color: #00af00">0</span> │
│ (<span style="color: #0087ff; text-decoration-color: #0087ff">CategoryEncoding</span>)              │                        │               │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ bidirectional (<span style="color: #0087ff; text-decoration-color: #0087ff">Bidirectional</span>)   │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">48</span>)             │       <span style="color: #00af00; text-decoration-color: #00af00">196,800</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense_10 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">1</span>)              │            <span style="color: #00af00; text-decoration-color: #00af00">49</span> │
└─────────────────────────────────┴────────────────────────┴───────────────┘
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Total params: </span><span style="color: #00af00; text-decoration-color: #00af00">196,849</span> (768.94 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">196,849</span> (768.94 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Non-trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">0</span> (0.00 B)
</pre>
</div>
</div>
</section>
<section id="fit-evaluate-1" class="slide level2">
<h2>Fit &amp; evaluate</h2>
<div id="3f74ebbb" class="cell" data-execution_count="145">
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb236-1"><a></a>es <span class="op">=</span> keras.callbacks.EarlyStopping(patience<span class="op">=</span><span class="dv">10</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb236-2"><a></a>    monitor<span class="op">=</span><span class="st">"val_accuracy"</span>, verbose<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb236-3"><a></a></span>
<span id="cb236-4"><a></a><span class="cf">if</span> <span class="kw">not</span> Path(<span class="st">"one-hot-model.keras"</span>).exists():</span>
<span id="cb236-5"><a></a>    one_hot_model.fit(X_train_txt, y_train, epochs<span class="op">=</span><span class="dv">1_000</span>, callbacks<span class="op">=</span>es,</span>
<span id="cb236-6"><a></a>        validation_data<span class="op">=</span>(X_val_txt, y_val), verbose<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb236-7"><a></a>    one_hot_model.save(<span class="st">"one-hot-model.keras"</span>)</span>
<span id="cb236-8"><a></a><span class="cf">else</span>:</span>
<span id="cb236-9"><a></a>    one_hot_model <span class="op">=</span> keras.models.load_model(<span class="st">"one-hot-model.keras"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="4b6734e0" class="cell" data-execution_count="146">
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb237-1"><a></a>one_hot_model.evaluate(X_train_txt, y_train, verbose<span class="op">=</span><span class="dv">0</span>, batch_size<span class="op">=</span><span class="dv">1_000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="138">
<pre><code>[0.3188040852546692, 0.8918206095695496]</code></pre>
</div>
</div>
<div id="02f0860b" class="cell" data-execution_count="147">
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb239-1"><a></a>one_hot_model.evaluate(X_val_txt, y_val, verbose<span class="op">=</span><span class="dv">0</span>, batch_size<span class="op">=</span><span class="dv">1_000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="139">
<pre><code>[0.37093353271484375, 0.8776978254318237]</code></pre>
</div>
</div>
</section>
<section id="custom-embeddings" class="slide level2">
<h2>Custom embeddings</h2>
<div id="3ab93398" class="cell" data-execution_count="148">
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb241-1"><a></a><span class="im">from</span> keras.layers <span class="im">import</span> Embedding</span>
<span id="cb241-2"><a></a>embed_lstm <span class="op">=</span> Sequential([Input(shape<span class="op">=</span>(max_length,), dtype<span class="op">=</span><span class="st">"int64"</span>),</span>
<span id="cb241-3"><a></a>    Embedding(input_dim<span class="op">=</span>max_tokens, output_dim<span class="op">=</span><span class="dv">32</span>, mask_zero<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb241-4"><a></a>    Bidirectional(LSTM(<span class="dv">24</span>)),</span>
<span id="cb241-5"><a></a>    Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"sigmoid"</span>)])</span>
<span id="cb241-6"><a></a>embed_lstm.compile(<span class="st">"adam"</span>, <span class="st">"binary_crossentropy"</span>, metrics<span class="op">=</span>[<span class="st">"accuracy"</span>])</span>
<span id="cb241-7"><a></a>embed_lstm.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Model: "sequential_6"</span>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> Layer (type)                    </span>┃<span style="font-weight: bold"> Output Shape           </span>┃<span style="font-weight: bold">       Param # </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ embedding (<span style="color: #0087ff; text-decoration-color: #0087ff">Embedding</span>)           │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">500</span>, <span style="color: #00af00; text-decoration-color: #00af00">32</span>)        │        <span style="color: #00af00; text-decoration-color: #00af00">32,000</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ bidirectional_1 (<span style="color: #0087ff; text-decoration-color: #0087ff">Bidirectional</span>) │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">48</span>)             │        <span style="color: #00af00; text-decoration-color: #00af00">10,944</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense_11 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">1</span>)              │            <span style="color: #00af00; text-decoration-color: #00af00">49</span> │
└─────────────────────────────────┴────────────────────────┴───────────────┘
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Total params: </span><span style="color: #00af00; text-decoration-color: #00af00">42,993</span> (167.94 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">42,993</span> (167.94 KB)
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Non-trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">0</span> (0.00 B)
</pre>
</div>
</div>
</section>
<section id="fit-evaluate-2" class="slide level2">
<h2>Fit &amp; evaluate</h2>
<div id="6e5e4ea0" class="cell" data-execution_count="149">
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb242-1"><a></a>es <span class="op">=</span> keras.callbacks.EarlyStopping(patience<span class="op">=</span><span class="dv">10</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb242-2"><a></a>    monitor<span class="op">=</span><span class="st">"val_accuracy"</span>, verbose<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb242-3"><a></a></span>
<span id="cb242-4"><a></a><span class="cf">if</span> <span class="kw">not</span> Path(<span class="st">"embed-lstm.keras"</span>).exists():</span>
<span id="cb242-5"><a></a>    embed_lstm.fit(X_train_txt, y_train, epochs<span class="op">=</span><span class="dv">1_000</span>, callbacks<span class="op">=</span>es,</span>
<span id="cb242-6"><a></a>        validation_data<span class="op">=</span>(X_val_txt, y_val), verbose<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb242-7"><a></a>    embed_lstm.save(<span class="st">"embed-lstm.keras"</span>)</span>
<span id="cb242-8"><a></a><span class="cf">else</span>:</span>
<span id="cb242-9"><a></a>    embed_lstm <span class="op">=</span> keras.models.load_model(<span class="st">"embed-lstm.keras"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="d0a5cdf8" class="cell" data-execution_count="150">
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb243-1"><a></a>embed_lstm.evaluate(X_train_txt, y_train, verbose<span class="op">=</span><span class="dv">0</span>, batch_size<span class="op">=</span><span class="dv">1_000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="142">
<pre><code>[0.27049171924591064, 0.9030942916870117]</code></pre>
</div>
</div>
<div id="27fea1e8" class="cell" data-execution_count="151">
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb245-1"><a></a>embed_lstm.evaluate(X_val_txt, y_val, verbose<span class="op">=</span><span class="dv">0</span>, batch_size<span class="op">=</span><span class="dv">1_000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="143">
<pre><code>[0.36852043867111206, 0.8553956747055054]</code></pre>
</div>
</div>
<div id="d9c8aaeb" class="cell" data-execution_count="152">
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb247-1"><a></a>embed_lstm.evaluate(X_test_txt, y_test, verbose<span class="op">=</span><span class="dv">0</span>, batch_size<span class="op">=</span><span class="dv">1_000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="144">
<pre><code>[0.3872850239276886, 0.8467625975608826]</code></pre>
</div>
</div>
</section>
<section id="package-versions" class="slide level2 appendix" data-visibility="uncounted">
<h2>Package Versions</h2>
<div id="ab3fe310" class="cell" data-execution_count="153">
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb249-1"><a></a><span class="im">from</span> watermark <span class="im">import</span> watermark</span>
<span id="cb249-2"><a></a><span class="bu">print</span>(watermark(python<span class="op">=</span><span class="va">True</span>, packages<span class="op">=</span><span class="st">"keras,matplotlib,numpy,pandas,seaborn,scipy,torch,tensorflow,tf_keras"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Python implementation: CPython
Python version       : 3.11.9
IPython version      : 8.24.0

keras     : 3.3.3
matplotlib: 3.9.0
numpy     : 1.26.4
pandas    : 2.2.2
seaborn   : 0.13.2
scipy     : 1.11.0
torch     : 2.3.1
tensorflow: 2.16.1
tf_keras  : 2.16.0
</code></pre>
</div>
</div>
</section>
<section id="glossary" class="slide level2 appendix" data-visibility="uncounted">
<h2>Glossary</h2>
<div class="columns">
<div class="column">
<ul>
<li>bag of words</li>
<li>lemmatization</li>
<li><span class="math inline">n</span>-grams</li>
<li>one-hot embedding</li>
<li>permutation importance test</li>
</ul>
</div><div class="column">
<ul>
<li>TF-IDF</li>
<li>vocabulary</li>
<li>word embedding</li>
<li>word2vec</li>
</ul>
</div>
</div>

<div class="quarto-auto-generated-content">
<p><img src="../unsw-logo.png" class="slide-logo"></p>
<div class="footer footer-default">

</div>
</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': false,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true,"boardmarkerWidth":4,"grid":false,"background":["rgba(255,255,255,0.0)","https://github.com/rajgoel/reveal.js-plugins/raw/master/chalkboard/img/blackboard.png"]},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: false,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1000,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
            // Handle positioning of the toggle
        window.addEventListener(
          "resize",
          throttle(() => {
            elRect = undefined;
            if (selectedAnnoteEl) {
              selectCodeLines(selectedAnnoteEl);
            }
          }, 10)
        );
        function throttle(fn, ms) {
        let throttle = false;
        let timer;
          return (...args) => {
            if(!throttle) { // first call gets through
                fn.apply(this, args);
                throttle = true;
            } else { // all the others get throttled
                if(timer) clearTimeout(timer); // cancel #2
                timer = setTimeout(() => {
                  fn.apply(this, args);
                  timer = throttle = false;
                }, ms);
            }
          };
        }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>